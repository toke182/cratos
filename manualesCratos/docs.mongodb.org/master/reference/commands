<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Command Reference &mdash; MongoDB Manual</title>

    <link rel="shortcut icon" href="http://media.mongodb.org/favicon.ico" />
    <meta name="robots" content="index" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="canonical" href="http://docs.mongodb.org/master/reference/commands" />

    
    
    <link rel="stylesheet" href="../../_static/mongodb-docs.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.2.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
      <link rel="search" type="application/opensearchdescription+xml" href="http://docs.mongodb.org/osd.xml" title="MongoDB Help"/>
<link rel="author" title="About these documents" href="../../about/" />
<link rel="top" title="MongoDB Manual" href="../../" />
<!-- Put the following javascript before the closing </head> tag. -->
<script>
  (function() {
    var cx = '017213726194841070573:WMX6838984';
    var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
  })();
</script>
  </head>
  <body>
<div id="top-right">
        <div class="user-right">
                <ul id="header-menu-bar" class="ajs-menu-bar">
                <li class="normal"><a target="_blank" href="http://groups.google.com/group/mongodb-user">Forums</a></li>
                <li class="normal"><a target="_blank" href="http://blog.mongodb.org/">Blog</a></li>
                <li class="normal"><a href="http://www.mongodb.org/downloads">Download</a></li>
                <li class="normal"><a href="http://www.mongodb.org/display/DOCS/Drivers">Drivers</a></li>
                <li class="normal"><a href="http://www.mongodb.org/display/DOCS/Events">Events</a></li>
                <li class="normal last"><a class="last" href="http://www.mongodb.org/display/DOCS/International+Documentation">International</a></li>
                </ul>
        </div>
</div>
<div id="header-db" class="spread">
        <div class="split">
                <div id="logo">
                        <div><a href="../../"><img src="../../_static/logo-mongodb.png" width="190" height="55" alt="mongoDB" /></a></div>
                </div>
        </div>
<div class="search-db"><gcse:searchbox></gcse:searchbox></div>
<div id="etp">
<ul>
<li><a href="https://github.com/mongodb/docs/blob/master/source/reference/commands.txt" target="_blank" title="Edit reference/commands.txt on github">Edit this Page</a></li>
<li><a href="http://github.com/mongodb/docs" target="_blank" title="Fork the documentation on GitHub and contribute.">GitHub</a></li>
<li><a href="https://jira.mongodb.org/secure/CreateIssueDetails!init.jspa?pid=10380&issuetype=4&priority=4&summary=Comment+on%3a+%22reference/commands%2Etxt%22" target="_blank" title="Report a problem with reference/commands.txt on Jira">Report a problem</a></li>
</ul>
</div>
</div>  
    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            <div id="cse-results"><gcse:searchresults></gcse:searchresults></div>
            
  <div class="section" id="command-reference">
<h1>Command Reference<a class="headerlink" href="#command-reference" title="Permalink to this headline">¶</a></h1>
<p>This document contains a reference to all <a class="reference internal" href="../glossary/#term-database-command"><em class="xref std std-term">database commands</em></a>.</p>
<p>The MongoDB command interface provides access to all <a class="reference internal" href="../glossary/#term-crud"><em class="xref std std-term">non CRUD</em></a> database operations. Fetching server stats, initializing a
replica set, and running a map-reduce job are all accomplished by
running a command.</p>
<p>You specify a command first by constructing a standard <a class="reference internal" href="../glossary/#term-bson"><em class="xref std std-term">BSON</em></a>
document whose first key is the name of the command. For example,
specify the <a class="reference internal" href="../replica-commands/#isMaster" title="isMaster"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">isMaster</span></tt></a> command using the following
<a class="reference internal" href="../glossary/#term-bson"><em class="xref std std-term">BSON</em></a> document:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">isMaster</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>The <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell provides a helper method for running
commands called <a class="reference internal" href="../method/db.runCommand/#db.runCommand" title="db.runCommand"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.runCommand()</span></tt></a>. The following operation in
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> runs the above command:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">isMaster</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>Many <a class="reference internal" href="../../applications/drivers/"><em>drivers</em></a> provide an equivalent for
the <a class="reference internal" href="../method/db.runCommand/#db.runCommand" title="db.runCommand"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.runCommand()</span></tt></a> method. Internally, running commands
with <a class="reference internal" href="../method/db.runCommand/#db.runCommand" title="db.runCommand"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.runCommand()</span></tt></a> is equivalent to a special query
against the <a class="reference internal" href="../glossary/#term-cmd"><em class="xref std std-term">$cmd</em></a> collection.</p>
<p>Many common commands have their own shell helpers or wrappers in the
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell and drivers, such as the
<a class="reference internal" href="../replica-commands/#db.isMaster" title="db.isMaster"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.isMaster()</span></tt></a> method in the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> JavaScript
shell.</p>
<p id="admin-command">You must run some commands on the <a class="reference internal" href="../glossary/#term-admin-database"><em class="xref std std-term">admin database</em></a>. Normally,
these operations resemble the followings:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">use</span> <span class="nx">admin</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span><span class="nx">buildInfo</span><span class="o">:</span> <span class="mi">1</span><span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>However, there&#8217;s also a command helper that automatically runs the
command in the context of the <tt class="docutils literal"><span class="pre">admin</span></tt> database:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">_adminCommand</span><span class="p">(</span> <span class="p">{</span><span class="nx">buildInfo</span><span class="o">:</span> <span class="mi">1</span><span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>All commands return, at minimum, a document with an <tt class="docutils literal"><span class="pre">ok</span></tt> field
indicating whether the command has succeeded:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="s1">&#39;ok&#39;</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>Failed commands return the <tt class="docutils literal"><span class="pre">ok</span></tt> field with a value of <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
<p>All of the following command descriptions, provide a document template
or prototype for each command. Some command documentation also
includes the relevant <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell helpers. See
<a class="reference internal" href="../command/"><em>Database Commands</em></a> for a list of all commands.</p>
<div class="section" id="user-commands">
<h2>User Commands<a class="headerlink" href="#user-commands" title="Permalink to this headline">¶</a></h2>
<div class="section" id="sharding-commands">
<span id="id1"></span><h3>Sharding Commands<a class="headerlink" href="#sharding-commands" title="Permalink to this headline">¶</a></h3>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../../sharding/"><em>Sharding</em></a> for more information about MongoDB&#8217;s
sharding functionality.</p>
</div>
<dl class="dbcommand">
<dt id="addShard">
<tt class="descname">addShard</tt><a class="headerlink" href="#addShard" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>hostname</strong> (<em>string</em>) &#8211; a hostname or replica-set/hostname string.</li>
<li><strong>name</strong> (<em>string</em>) &#8211; Optional. Unless specified, a name will be
automatically provided to uniquely identify
the shard.</li>
<li><strong>maxSize</strong> (<em>integer</em>) &#8211; Optional. Unless specified, shards will consume
the total amount of available space on their
machines if necessary. Use the <tt class="docutils literal"><span class="pre">maxSize</span></tt> value
to limit the amount of space the database can
use. Specify this value in megabytes.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Use the <a class="reference internal" href="#addShard" title="addShard"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">addShard</span></tt></a> command to add a database instance
or replica set to a <a class="reference internal" href="../glossary/#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a>.
You must run this command when connected a <a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instance.</p>
<p>The command takes the following form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">addShard</span><span class="o">:</span> <span class="s2">&quot;&lt;hostname&gt;:&lt;port&gt;&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<div class="admonition-example admonition">
<p class="first admonition-title">Example</p>
<div class="last highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">({</span><span class="nx">addShard</span><span class="o">:</span> <span class="s2">&quot;mongodb0.example.net:27027&quot;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<p>Replace <tt class="docutils literal"><span class="pre">&lt;hostname&gt;:&lt;port&gt;</span></tt> with the hostname and port of the
database instance you want to add as a shard.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not use <tt class="docutils literal"><span class="pre">localhost</span></tt> for the hostname unless your
<a class="reference internal" href="../glossary/#term-config-database"><em class="xref std std-term">configuration server</em></a>
is also running on <tt class="docutils literal"><span class="pre">localhost</span></tt>.</p>
</div>
<p>The optimal configuration is to deploy shards across
<a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica sets</em></a>.
To add a shard on a replica set you must specify the name of the
replica set and the hostname of at least one member of the replica
set. You must specify at least one member of the set, but can
specify all members in the set or another subset if
desired. <a class="reference internal" href="#addShard" title="addShard"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">addShard</span></tt></a> takes the following form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">addShard</span><span class="o">:</span> <span class="s2">&quot;replica-set/hostname:port&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<div class="admonition-example admonition">
<p class="first admonition-title">Example</p>
<div class="last highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">addShard</span><span class="o">:</span> <span class="s2">&quot;repl0/mongodb3.example.net:27327&quot;</span><span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<p>If you specify additional hostnames, all must be members of the same
replica set.</p>
<p>Send this command to only one <a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instance, it will
store shard configuration information in the <a class="reference internal" href="../glossary/#term-config-database"><em class="xref std std-term">config database</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Specify a <tt class="docutils literal"><span class="pre">maxSize</span></tt> when you have machines with different disk
capacities, or if you want to limit the amount of data on some
shards.</p>
<p class="last">The <tt class="docutils literal"><span class="pre">maxSize</span></tt> constraint prevents the <a class="reference internal" href="../glossary/#term-balancer"><em class="xref std std-term">balancer</em></a> from
migrating chunks to the shard when the value of
<a class="reference internal" href="../server-status/#mem.mapped" title="mem.mapped"><tt class="xref mongodb mongodb-status docutils literal"><span class="pre">mem.mapped</span></tt></a> exceeds the value of <tt class="docutils literal"><span class="pre">maxSize</span></tt>.</p>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference internal" href="../method/sh.addShard/#sh.addShard" title="sh.addShard"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.addShard()</span></tt></a></li>
<li><a class="reference internal" href="../../administration/sharding/"><em>Sharded Cluster Administration</em></a></li>
<li><a class="reference internal" href="../../tutorial/add-shards-to-shard-cluster/"><em>Add Shards to an Existing Cluster</em></a></li>
<li><a class="reference internal" href="../../tutorial/remove-shards-from-cluster/"><em>Remove Shards from an Existing Sharded Cluster</em></a></li>
</ul>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="listShards">
<tt class="descname">listShards</tt><a class="headerlink" href="#listShards" title="Permalink to this definition">¶</a></dt>
<dd><p>Use the <a class="reference internal" href="#listShards" title="listShards"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">listShards</span></tt></a> command to return a list of
configured shards. The command takes the following form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">listShards</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="enableSharding">
<tt class="descname">enableSharding</tt><a class="headerlink" href="#enableSharding" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#enableSharding" title="enableSharding"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">enableSharding</span></tt></a> command enables sharding on a per-database
level. Use the following command form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">enableSharding</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>Once you&#8217;ve enabled sharding in a database, you can use the <a class="reference internal" href="#shardCollection" title="shardCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">shardCollection</span></tt></a>
command to begin the process of distributing data among the shards.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="shardCollection">
<tt class="descname">shardCollection</tt><a class="headerlink" href="#shardCollection" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#shardCollection" title="shardCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">shardCollection</span></tt></a> command marks a collection for sharding and
will allow data to begin distributing among shards. You must run
<a class="reference internal" href="#enableSharding" title="enableSharding"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">enableSharding</span></tt></a> on a database before running the
<a class="reference internal" href="#shardCollection" title="shardCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">shardCollection</span></tt></a> command.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">shardCollection</span><span class="o">:</span> <span class="s2">&quot;&lt;db&gt;.&lt;collection&gt;&quot;</span><span class="p">,</span> <span class="nx">key</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">shardkey</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This enables sharding for the collection specified by
<tt class="docutils literal"><span class="pre">&lt;collection&gt;</span></tt> in the database named <tt class="docutils literal"><span class="pre">&lt;db&gt;</span></tt>, using the key
<tt class="docutils literal"><span class="pre">&lt;shardkey&gt;</span></tt> to distribute documents among the
shard. <tt class="docutils literal"><span class="pre">&lt;shardkey&gt;</span></tt> is a document, and takes the same form as an
<a class="reference internal" href="../../core/document/#document-index-specification"><em>index specification document</em></a>.</p>
<p>Choosing the right shard key to effectively distribute load among
your shards requires some planning.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../../sharding/"><em>Sharding</em></a> for more information related to
sharding. Also consider the section on <a class="reference internal" href="../../core/sharding/#sharding-shard-key"><em>Shard Keys</em></a>
for documentation regarding shard keys.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">There&#8217;s no easy way to disable sharding after running <a class="reference internal" href="#shardCollection" title="shardCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">shardCollection</span></tt></a>. In addition,
you cannot change shard keys once set. If you must convert a sharded cluster to a <a class="reference internal" href="../glossary/#term-standalone"><em class="xref std std-term">standalone</em></a>
node or <a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a>, you must make a single backup of the entire cluster
and then restore the backup to the standalone <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt>
or the replica set..</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="shardingState">
<tt class="descname">shardingState</tt><a class="headerlink" href="#shardingState" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#shardingState" title="shardingState"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">shardingState</span></tt></a> command returns <tt class="docutils literal"><span class="pre">true</span></tt> if the
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> instance is a member of a sharded cluster. Run the
command using the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">shardingState</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This command obtains a write lock on the affected database and
will block other operations until it has completed; however, the
operation is typically short lived.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="removeShard">
<tt class="descname">removeShard</tt><a class="headerlink" href="#removeShard" title="Permalink to this definition">¶</a></dt>
<dd><p>Starts the process of removing a shard from a <a class="reference internal" href="../glossary/#term-sharded-cluster"><em class="xref std std-term">cluster</em></a>. This
is a multi-stage process. Begin by issuing the following command:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">removeShard</span> <span class="o">:</span> <span class="s2">&quot;[shardName]&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The balancer will then migrating chunks from the shard specified by
<tt class="docutils literal"><span class="pre">[shardName]</span></tt>. This process happens slowly to avoid placing
undue load on the overall cluster.</p>
<p>The command returns immediately, with the following message:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">msg</span> <span class="o">:</span> <span class="s2">&quot;draining started successfully&quot;</span> <span class="p">,</span> <span class="nx">state</span><span class="o">:</span> <span class="s2">&quot;started&quot;</span> <span class="p">,</span> <span class="nx">shard</span><span class="o">:</span> <span class="s2">&quot;shardName&quot;</span> <span class="p">,</span> <span class="nx">ok</span> <span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>If you run the command again, you&#8217;ll see the following progress
output:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">msg</span><span class="o">:</span> <span class="s2">&quot;draining ongoing&quot;</span> <span class="p">,</span> <span class="nx">state</span><span class="o">:</span> <span class="s2">&quot;ongoing&quot;</span> <span class="p">,</span> <span class="nx">remaining</span><span class="o">:</span> <span class="p">{</span> <span class="nx">chunks</span><span class="o">:</span> <span class="mi">23</span> <span class="p">,</span> <span class="nx">dbs</span><span class="o">:</span> <span class="mi">1</span> <span class="p">},</span> <span class="nx">ok</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">remaining</span></tt> <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a> specifies how many chunks and
databases remain on the shard. Use <a class="reference internal" href="#printShardingStatus" title="printShardingStatus"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">printShardingStatus</span></tt></a>
to list the databases that you must move from the shard.</p>
<p>Each database in a sharded cluster has a primary shard. If the
shard you want to remove is also the primary of one the cluster&#8217;s
databases, then you must manually move the database to a new
shard. This can be only after the shard is empty. See the
<a class="reference internal" href="#movePrimary" title="movePrimary"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">movePrimary</span></tt></a> command for details.</p>
<p>After removing all chunks and databases from the shard, you
may issue the command again, to return:</p>
<div class="highlight-javascript"><pre>{ msg: "remove shard completed successfully , stage: "completed", host: "shardName", ok : 1 }</pre>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="printShardingStatus">
<tt class="descname">printShardingStatus</tt><a class="headerlink" href="#printShardingStatus" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns data regarding the status of a <a class="reference internal" href="../glossary/#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a> and
includes information regarding the distribution of
<a class="reference internal" href="../glossary/#term-chunk"><em class="xref std std-term">chunks</em></a>. <a class="reference internal" href="#printShardingStatus" title="printShardingStatus"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">printShardingStatus</span></tt></a> is only available
when connected to a <a class="reference internal" href="../glossary/#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a> via a
<a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a>. Typically, you will use the
<a class="reference internal" href="../method/sh.status/#sh.status" title="sh.status"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.status()</span></tt></a> <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell wrapper to access
this data.</p>
</dd></dl>

</div>
<div class="section" id="aggregation-commands">
<h3>Aggregation Commands<a class="headerlink" href="#aggregation-commands" title="Permalink to this headline">¶</a></h3>
<dl class="dbcommand">
<dt id="group">
<tt class="descname">group</tt><a class="headerlink" href="#group" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#group" title="group"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">group</span></tt></a> command groups documents in a collection by
the specified key and performs simple aggregation functions such as
computing counts and sums. The command is analogous to a <tt class="docutils literal"><span class="pre">SELECT</span>
<span class="pre">...</span> <span class="pre">GROUP</span> <span class="pre">BY</span></tt> statement in SQL. The command returns a document with
the grouped records as well as the command meta-data.</p>
<p>The <a class="reference internal" href="#group" title="group"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">group</span></tt></a> command takes the following prototype
form:</p>
<div class="highlight-none"><div class="highlight"><pre>{ group: { ns: &lt;namespace&gt;,
           key: &lt;key&gt;,
           $reduce: &lt;reduce function&gt;,
           $keyf: &lt;key function&gt;,
           cond: &lt;query&gt;,
           finalize: &lt;finalize function&gt; } }
</pre></div>
</div>
<p>The command fields are as follows:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Fields:</th><td class="field-body"><ul class="first last simple">
<li><strong>ns</strong> &#8211; Specifies the collection from which to perform the group by
operation.</li>
<li><strong>key</strong> &#8211; Specifies one or more document fields to group. Returns
a &#8220;key object&#8221; for use as the grouping key.</li>
<li><strong>$reduce</strong> &#8211; Specifies an aggregation function that operates on
the documents during the grouping operation, such as
compute a sum or a count. The aggregation function
takes two arguments: the current document and an
aggregation result document for that group.</li>
<li><strong>initial</strong> &#8211; Initializes the aggregation result document.</li>
<li><strong>$keyf</strong> &#8211; Optional. Alternative to the <tt class="docutils literal"><span class="pre">key</span></tt> field. Specifies a
function that creates a &#8220;key object&#8221; for
use as the grouping key. Use the <tt class="docutils literal"><span class="pre">keyf</span></tt> instead of
<tt class="docutils literal"><span class="pre">key</span></tt> to group by calculated fields rather than
existing document fields.</li>
<li><strong>cond</strong> &#8211; Optional. Specifies the selection criteria to determine
which documents in the collection to process. If the
<tt class="docutils literal"><span class="pre">cond</span></tt> field is omitted, the
<a class="reference internal" href="../method/db.collection.group/#db.collection.group" title="db.collection.group"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.group()</span></tt></a> processes all the
documents in the collection for the group operation.</li>
<li><strong>finalize</strong> &#8211; <p>Optional. Specifies a function that runs each item
in the result set before <a class="reference internal" href="../method/db.collection.group/#db.collection.group" title="db.collection.group"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.group()</span></tt></a>
returns the final value. This function
can either modify the result document or
replace the result document as a whole.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Unlike the <tt class="docutils literal"><span class="pre">$keyf</span></tt> and the <tt class="docutils literal"><span class="pre">$reduce</span></tt> fields
that specify a function, the field name is
<tt class="docutils literal"><span class="pre">finalize</span></tt> and not <tt class="docutils literal"><span class="pre">$finalize</span></tt>.</p>
</div>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<ul class="last simple">
<li>The <a class="reference internal" href="#group" title="group"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">group</span></tt></a> command does not work with
<a class="reference internal" href="../glossary/#term-sharded-cluster"><em class="xref std std-term">sharded clusters</em></a>. Use the
<a class="reference internal" href="../glossary/#term-aggregation-framework"><em class="xref std std-term">aggregation framework</em></a> or <a class="reference internal" href="../glossary/#term-map-reduce"><em class="xref std std-term">map-reduce</em></a> in
<a class="reference internal" href="../glossary/#term-sharding"><em class="xref std std-term">sharded environments</em></a>.</li>
<li>The <a class="reference internal" href="#group" title="group"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">group</span></tt></a> command takes a read lock and does not
allow any other threads to execute JavaScript while it is
running.</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The result set must fit within the <a class="reference internal" href="../limits/#limit-bson-document-size"><em>maximum BSON document
size</em></a>.</p>
<p class="last">Additionally, in version 2.2, the returned array can contain at most 20,000
elements; i.e. at most 20,000 unique groupings. For group by
operations that results in more than 20,000 unique groupings, use
<a class="reference internal" href="#mapReduce" title="mapReduce"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">mapReduce</span></tt></a>. Previous versions had a limit of 10,000
elements.</p>
</div>
<p>For the shell, MongoDB provides a wrapper method
<a class="reference internal" href="../method/db.collection.group/#db.collection.group" title="db.collection.group"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.group()</span></tt></a>; however, the
<a class="reference internal" href="../method/db.collection.group/#db.collection.group" title="db.collection.group"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.group()</span></tt></a> method takes the <tt class="docutils literal"><span class="pre">keyf</span></tt> field and
the <tt class="docutils literal"><span class="pre">reduce</span></tt> field whereas the <a class="reference internal" href="#group" title="group"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">group</span></tt></a> command takes
the <tt class="docutils literal"><span class="pre">$keyf</span></tt> field and the <tt class="docutils literal"><span class="pre">$reduce</span></tt> field.</p>
<p>Consider the following examples of the <a class="reference internal" href="../method/db.collection.group/#db.collection.group" title="db.collection.group"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.group()</span></tt></a> method:</p>
<p>The examples assume an <tt class="docutils literal"><span class="pre">orders</span></tt> collection with documents of the
following prototype:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="nx">_id</span><span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;5085a95c8fada716c89d0021&quot;</span><span class="p">),</span>
  <span class="nx">ord_dt</span><span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-07-01T04:00:00Z&quot;</span><span class="p">),</span>
  <span class="nx">ship_dt</span><span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-07-02T04:00:00Z&quot;</span><span class="p">),</span>
  <span class="nx">item</span><span class="o">:</span> <span class="p">{</span> <span class="nx">sku</span><span class="o">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">,</span>
          <span class="nx">price</span><span class="o">:</span> <span class="mf">1.99</span><span class="p">,</span>
          <span class="nx">uom</span><span class="o">:</span> <span class="s2">&quot;pcs&quot;</span><span class="p">,</span>
          <span class="nx">qty</span><span class="o">:</span> <span class="mi">25</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul>
<li><p class="first">The following example groups by the <tt class="docutils literal"><span class="pre">ord_dt</span></tt> and <tt class="docutils literal"><span class="pre">item.sku</span></tt>
fields those documents that have <tt class="docutils literal"><span class="pre">ord_dt</span></tt> greater than
<tt class="docutils literal"><span class="pre">01/01/2012</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">group</span><span class="o">:</span>
                   <span class="p">{</span>
                     <span class="nx">ns</span><span class="o">:</span> <span class="s1">&#39;orders&#39;</span><span class="p">,</span>
                     <span class="nx">key</span><span class="o">:</span> <span class="p">{</span> <span class="nx">ord_dt</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;item.sku&#39;</span><span class="o">:</span> <span class="mi">1</span> <span class="p">},</span>
                     <span class="nx">cond</span><span class="o">:</span> <span class="p">{</span> <span class="nx">ord_dt</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span> <span class="s1">&#39;01/01/2012&#39;</span> <span class="p">)</span> <span class="p">}</span> <span class="p">},</span>
                     <span class="nx">$reduce</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">curr</span><span class="p">,</span> <span class="nx">result</span> <span class="p">)</span> <span class="p">{</span> <span class="p">},</span>
                     <span class="nx">initial</span><span class="o">:</span> <span class="p">{</span> <span class="p">}</span>
                   <span class="p">}</span>
                <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>The result is a documents that contain the <tt class="docutils literal"><span class="pre">retval</span></tt> field which
contains the group by records, the <tt class="docutils literal"><span class="pre">count</span></tt> field which contains
the total number of documents grouped, the <tt class="docutils literal"><span class="pre">keys</span></tt> field which
contains the number of unique groupings (i.e. number of elements
in the <tt class="docutils literal"><span class="pre">retval</span></tt>), and the <tt class="docutils literal"><span class="pre">ok</span></tt> field which contains the
command status:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;retval&quot;</span> <span class="o">:</span>
      <span class="p">[</span> <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-07-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-07-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc456&quot;</span><span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-07-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;bcd123&quot;</span><span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-07-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;efg456&quot;</span><span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-06-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-06-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;efg456&quot;</span><span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-06-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;ijk123&quot;</span><span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-05-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-05-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc456&quot;</span><span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-06-08T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-06-08T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc456&quot;</span><span class="p">}</span>
      <span class="p">],</span>
  <span class="s2">&quot;count&quot;</span> <span class="o">:</span> <span class="mi">13</span><span class="p">,</span>
  <span class="s2">&quot;keys&quot;</span> <span class="o">:</span> <span class="mi">11</span><span class="p">,</span>
  <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>The method call is analogous to the SQL statement:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">ord_dt</span><span class="p">,</span> <span class="n">item_sku</span>
<span class="k">FROM</span> <span class="n">orders</span>
<span class="k">WHERE</span> <span class="n">ord_dt</span> <span class="o">&gt;</span> <span class="s1">&#39;01/01/2012&#39;</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">ord_dt</span><span class="p">,</span> <span class="n">item_sku</span>
</pre></div>
</div>
</li>
<li><p class="first">The following example groups by the <tt class="docutils literal"><span class="pre">ord_dt</span></tt> and <tt class="docutils literal"><span class="pre">item.sku</span></tt>
fields, those documents that have <tt class="docutils literal"><span class="pre">ord_dt</span></tt> greater than
<tt class="docutils literal"><span class="pre">01/01/2012</span></tt> and calculates the sum of the <tt class="docutils literal"><span class="pre">qty</span></tt> field for each
grouping:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">group</span><span class="o">:</span>
                   <span class="p">{</span>
                     <span class="nx">ns</span><span class="o">:</span> <span class="s1">&#39;orders&#39;</span><span class="p">,</span>
                     <span class="nx">key</span><span class="o">:</span> <span class="p">{</span> <span class="nx">ord_dt</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;item.sku&#39;</span><span class="o">:</span> <span class="mi">1</span> <span class="p">},</span>
                     <span class="nx">cond</span><span class="o">:</span> <span class="p">{</span> <span class="nx">ord_dt</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span> <span class="s1">&#39;01/01/2012&#39;</span> <span class="p">)</span> <span class="p">}</span> <span class="p">},</span>
                     <span class="nx">$reduce</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">curr</span><span class="p">,</span> <span class="nx">result</span> <span class="p">)</span> <span class="p">{</span>
                                  <span class="nx">result</span><span class="p">.</span><span class="nx">total</span> <span class="o">+=</span> <span class="nx">curr</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">qty</span><span class="p">;</span>
                              <span class="p">},</span>
                     <span class="nx">initial</span><span class="o">:</span> <span class="p">{</span> <span class="nx">total</span> <span class="o">:</span> <span class="mi">0</span> <span class="p">}</span>
                   <span class="p">}</span>
                <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">retval</span></tt> field of the returned document is an array of
documents that contain the group by fields and the calculated
aggregation field:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;retval&quot;</span> <span class="o">:</span>
      <span class="p">[</span> <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-07-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">25</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-07-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc456&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">25</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-07-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;bcd123&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">10</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-07-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;efg456&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">10</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-06-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">25</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-06-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;efg456&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">15</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-06-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;ijk123&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">20</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-05-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">45</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-05-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc456&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">25</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-06-08T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">25</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-06-08T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc456&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">25</span> <span class="p">}</span>
      <span class="p">],</span>
  <span class="s2">&quot;count&quot;</span> <span class="o">:</span> <span class="mi">13</span><span class="p">,</span>
  <span class="s2">&quot;keys&quot;</span> <span class="o">:</span> <span class="mi">11</span><span class="p">,</span>
  <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>The method call is analogous to the SQL statement:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">ord_dt</span><span class="p">,</span> <span class="n">item_sku</span><span class="p">,</span> <span class="k">SUM</span><span class="p">(</span><span class="n">item_qty</span><span class="p">)</span> <span class="k">as</span> <span class="n">total</span>
<span class="k">FROM</span> <span class="n">orders</span>
<span class="k">WHERE</span> <span class="n">ord_dt</span> <span class="o">&gt;</span> <span class="s1">&#39;01/01/2012&#39;</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">ord_dt</span><span class="p">,</span> <span class="n">item_sku</span>
</pre></div>
</div>
</li>
<li><p class="first">The following example groups by the calculated <tt class="docutils literal"><span class="pre">day_of_week</span></tt> field,
those documents that have <tt class="docutils literal"><span class="pre">ord_dt</span></tt> greater than <tt class="docutils literal"><span class="pre">01/01/2012</span></tt> and
calculates the sum, count, and average of the <tt class="docutils literal"><span class="pre">qty</span></tt> field for each
grouping:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">group</span><span class="o">:</span>
                   <span class="p">{</span>
                     <span class="nx">ns</span><span class="o">:</span> <span class="s1">&#39;orders&#39;</span><span class="p">,</span>
                     <span class="nx">$keyf</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
                               <span class="k">return</span> <span class="p">{</span> <span class="nx">day_of_week</span><span class="o">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">ord_dt</span><span class="p">.</span><span class="nx">getDay</span><span class="p">()</span> <span class="p">}</span> <span class="p">;</span> <span class="p">},</span>
                     <span class="nx">cond</span><span class="o">:</span> <span class="p">{</span> <span class="nx">ord_dt</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span> <span class="s1">&#39;01/01/2012&#39;</span> <span class="p">)</span> <span class="p">}</span> <span class="p">},</span>
                     <span class="nx">$reduce</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">curr</span><span class="p">,</span> <span class="nx">result</span> <span class="p">)</span> <span class="p">{</span>
                                  <span class="nx">result</span><span class="p">.</span><span class="nx">total</span> <span class="o">+=</span> <span class="nx">curr</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">qty</span><span class="p">;</span>
                                  <span class="nx">result</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span><span class="p">;</span>
                              <span class="p">},</span>
                     <span class="nx">initial</span><span class="o">:</span> <span class="p">{</span> <span class="nx">total</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">count</span><span class="o">:</span> <span class="mi">0</span> <span class="p">},</span>
                     <span class="nx">finalize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                                 <span class="kd">var</span> <span class="nx">weekdays</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;Sunday&quot;</span><span class="p">,</span> <span class="s2">&quot;Monday&quot;</span><span class="p">,</span> <span class="s2">&quot;Tuesday&quot;</span><span class="p">,</span>
                                                  <span class="s2">&quot;Wednesday&quot;</span><span class="p">,</span> <span class="s2">&quot;Thursday&quot;</span><span class="p">,</span>
                                                  <span class="s2">&quot;Friday&quot;</span><span class="p">,</span> <span class="s2">&quot;Saturday&quot;</span> <span class="p">];</span>

                                 <span class="nx">result</span><span class="p">.</span><span class="nx">day_of_week</span> <span class="o">=</span> <span class="nx">weekdays</span><span class="p">[</span><span class="nx">result</span><span class="p">.</span><span class="nx">day_of_week</span><span class="p">];</span>
                                 <span class="nx">result</span><span class="p">.</span><span class="nx">avg</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">total</span> <span class="o">/</span> <span class="nx">result</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span>
                     <span class="p">}</span>

                   <span class="p">}</span>
                <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">retval</span></tt> field of the returned document is an array of
documents that contain the group by fields and the calculated
aggregation field:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;retval&quot;</span> <span class="o">:</span>
      <span class="p">[</span> <span class="p">{</span> <span class="s2">&quot;day_of_week&quot;</span> <span class="o">:</span> <span class="s2">&quot;Sunday&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">70</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span> <span class="o">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;avg&quot;</span> <span class="o">:</span> <span class="mi">18</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;day_of_week&quot;</span> <span class="o">:</span> <span class="s2">&quot;Friday&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">110</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span> <span class="o">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;avg&quot;</span> <span class="o">:</span> <span class="mi">18</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;day_of_week&quot;</span> <span class="o">:</span> <span class="s2">&quot;Tuesday&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">70</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span> <span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;avg&quot;</span> <span class="o">:</span> <span class="mi">23</span> <span class="p">}</span>

      <span class="p">],</span>
  <span class="s2">&quot;count&quot;</span> <span class="o">:</span> <span class="mi">13</span><span class="p">,</span>
  <span class="s2">&quot;keys&quot;</span> <span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
  <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../../applications/aggregation/"><em>Aggregation Framework</em></a></p>
</div>
</li>
</ul>
</dd></dl>

<dl class="dbcommand">
<dt id="count">
<tt class="descname">count</tt><a class="headerlink" href="#count" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#count" title="count"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">count</span></tt></a> command counts the number of documents in a
collection. The command returns a document that contains the count
as well as the command status. The <a class="reference internal" href="#count" title="count"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">count</span></tt></a> command takes
the following prototype form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">count</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">collection</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">query</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">query</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">limit</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">limit</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">skip</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">skip</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The command fields are as follows:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Fields:</th><td class="field-body"><ul class="first last simple">
<li><strong>count</strong> (<em>String</em>) &#8211; The name of the collection to count.</li>
<li><strong>query</strong> (<em>document</em>) &#8211; Optional. Specifies the selection query to determine which
documents in the collection to count.</li>
<li><strong>limit</strong> (<em>integer</em>) &#8211; Optional. Specifies the limit for the documents matching the
selection <tt class="docutils literal"><span class="pre">query</span></tt>.</li>
<li><strong>skip</strong> (<em>integer</em>) &#8211; Optional. Specifies the number of matching documents to skip.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Consider the following examples of the <a class="reference internal" href="#count" title="count"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">count</span></tt></a> command:</p>
<ul>
<li><p class="first">Count the number of all documents in the <tt class="docutils literal"><span class="pre">orders</span></tt> collection:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">count</span><span class="o">:</span> <span class="s1">&#39;orders&#39;</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>In the result, the <tt class="docutils literal"><span class="pre">n</span></tt>, which represents the count, is <tt class="docutils literal"><span class="pre">26</span></tt>
and the command status <tt class="docutils literal"><span class="pre">ok</span></tt> is <tt class="docutils literal"><span class="pre">1</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;n&quot;</span> <span class="o">:</span> <span class="mi">26</span><span class="p">,</span> <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Count the number of the documents in the <tt class="docutils literal"><span class="pre">orders</span></tt> collection
with the field <tt class="docutils literal"><span class="pre">ord_dt</span></tt> greater than <tt class="docutils literal"><span class="pre">new</span> <span class="pre">Date('01/01/2012')</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">count</span><span class="o">:</span><span class="s1">&#39;orders&#39;</span><span class="p">,</span>
                 <span class="nx">query</span><span class="o">:</span> <span class="p">{</span> <span class="nx">ord_dt</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;01/01/2012&#39;</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
               <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>In the result, the <tt class="docutils literal"><span class="pre">n</span></tt>, which represents the count, is <tt class="docutils literal"><span class="pre">13</span></tt>
and the command status <tt class="docutils literal"><span class="pre">ok</span></tt> is <tt class="docutils literal"><span class="pre">1</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;n&quot;</span> <span class="o">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Count the number of the documents in the <tt class="docutils literal"><span class="pre">orders</span></tt> collection
with the field <tt class="docutils literal"><span class="pre">ord_dt</span></tt> greater than <tt class="docutils literal"><span class="pre">new</span> <span class="pre">Date('01/01/2012')</span></tt>
skipping the first <tt class="docutils literal"><span class="pre">10</span></tt> matching records:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">count</span><span class="o">:</span><span class="s1">&#39;orders&#39;</span><span class="p">,</span>
                 <span class="nx">query</span><span class="o">:</span> <span class="p">{</span> <span class="nx">ord_dt</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;01/01/2012&#39;</span><span class="p">)</span> <span class="p">}</span> <span class="p">},</span>
                 <span class="nx">skip</span><span class="o">:</span> <span class="mi">10</span> <span class="p">}</span>  <span class="p">)</span>
</pre></div>
</div>
<p>In the result, the <tt class="docutils literal"><span class="pre">n</span></tt>, which represents the count, is <tt class="docutils literal"><span class="pre">3</span></tt> and
the command status <tt class="docutils literal"><span class="pre">ok</span></tt> is <tt class="docutils literal"><span class="pre">1</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;n&quot;</span> <span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">MongoDB also provides the <a class="reference internal" href="../method/cursor.count/#cursor.count" title="cursor.count"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.count()</span></tt></a>
method and the shell wrapper <a class="reference internal" href="../method/db.collection.count/#db.collection.count" title="db.collection.count"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.count()</span></tt></a>
method.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="mapReduce">
<tt class="descname">mapReduce</tt><a class="headerlink" href="#mapReduce" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#mapReduce" title="mapReduce"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">mapReduce</span></tt></a> command allows you to run
<a class="reference internal" href="../glossary/#term-map-reduce"><em class="xref std std-term">map-reduce</em></a> aggregation operations over a collection. The
<a class="reference internal" href="#mapReduce" title="mapReduce"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">mapReduce</span></tt></a> command has the following prototype
form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span>
               <span class="p">{</span>
                 <span class="nx">mapReduce</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">collection</span><span class="o">&gt;</span><span class="p">,</span>
                 <span class="nx">map</span><span class="o">:</span> <span class="o">&lt;</span><span class="kd">function</span><span class="o">&gt;</span><span class="p">,</span>
                 <span class="nx">reduce</span><span class="o">:</span> <span class="o">&lt;</span><span class="kd">function</span><span class="o">&gt;</span><span class="p">,</span>
                 <span class="nx">out</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">collection</span><span class="o">&gt;</span><span class="p">,</span>
                 <span class="nx">query</span><span class="o">:</span> <span class="o">&lt;</span><span class="nb">document</span><span class="o">&gt;</span><span class="p">,</span>
                 <span class="nx">sort</span><span class="o">:</span> <span class="o">&lt;</span><span class="nb">document</span><span class="o">&gt;</span><span class="p">,</span>
                 <span class="nx">limit</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">number</span><span class="o">&gt;</span><span class="p">,</span>
                 <span class="nx">finalize</span><span class="o">:</span> <span class="o">&lt;</span><span class="kd">function</span><span class="o">&gt;</span><span class="p">,</span>
                 <span class="nx">scope</span><span class="o">:</span> <span class="o">&lt;</span><span class="nb">document</span><span class="o">&gt;</span><span class="p">,</span>
                 <span class="nx">jsMode</span><span class="o">:</span> <span class="o">&lt;</span><span class="kr">boolean</span><span class="o">&gt;</span><span class="p">,</span>
                 <span class="nx">verbose</span><span class="o">:</span> <span class="o">&lt;</span><span class="kr">boolean</span><span class="o">&gt;</span>
               <span class="p">}</span>
             <span class="p">)</span>
</pre></div>
</div>
<p>Pass the name of the collection to the <tt class="docutils literal"><span class="pre">mapReduce</span></tt> command
(i.e. <tt class="docutils literal"><span class="pre">&lt;collection&gt;</span></tt>) to use as the source documents to perform
the map reduce operation. The command also accepts the following
parameters:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>map</strong> &#8211; <p>A JavaScript function that associates or &#8220;maps&#8221; a value with a
key.</p>
<p>The <tt class="docutils literal"><span class="pre">map</span></tt> function has the following prototype:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
   <span class="p">...</span>
   <span class="nx">emit</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">map</span></tt> function process every input document for the
map-reduce operation. All the <tt class="docutils literal"><span class="pre">key</span></tt> and <tt class="docutils literal"><span class="pre">value</span></tt> pairs
emitted by the map function. In map-reduce operations, the
operation groups the output from the map phase by the <tt class="docutils literal"><span class="pre">key</span></tt>
value and passes these groupings to the <tt class="docutils literal"><span class="pre">reduce</span></tt> function.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li>In the <tt class="docutils literal"><span class="pre">map</span></tt> function, reference the current document as
<tt class="docutils literal"><span class="pre">this</span></tt> within the function.</li>
<li>The <tt class="docutils literal"><span class="pre">map</span></tt> function should <em>not</em> access the database for
any reason.</li>
<li>The <tt class="docutils literal"><span class="pre">map</span></tt> function should be pure, or have <em>no</em> impact
outside of the function (i.e. side effects.)</li>
<li>The <tt class="docutils literal"><span class="pre">emit(key,value)</span></tt> function associates the <tt class="docutils literal"><span class="pre">key</span></tt>
with a <tt class="docutils literal"><span class="pre">value</span></tt>.<ul>
<li>A single emit can only hold half of MongoDB&#8217;s <a class="reference internal" href="../limits/#limit-bson-document-size"><em>maximum
BSON document size</em></a>.</li>
<li>There is no limit to the number of times you may call the
<tt class="docutils literal"><span class="pre">emit</span></tt> function per document.</li>
</ul>
</li>
<li>The <tt class="docutils literal"><span class="pre">map</span></tt> function can access the variables defined in
the <tt class="docutils literal"><span class="pre">scope</span></tt> parameter.</li>
</ul>
</div>
</li>
<li><strong>reduce</strong> &#8211; <p>A JavaScript function that &#8220;reduces&#8221; to a single object all the
<tt class="docutils literal"><span class="pre">values</span></tt> associated with a particular <tt class="docutils literal"><span class="pre">key</span></tt>.</p>
<p>The <tt class="docutils literal"><span class="pre">reduce</span></tt> function has the following prototype:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
   <span class="p">...</span>
   <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">reduce</span></tt> function accepts <tt class="docutils literal"><span class="pre">key</span></tt> and <tt class="docutils literal"><span class="pre">values</span></tt>
arguments. The elements of the <tt class="docutils literal"><span class="pre">values</span></tt> array are the
individual <tt class="docutils literal"><span class="pre">value</span></tt> objects emitted by the <tt class="docutils literal"><span class="pre">&lt;map&gt;</span></tt> function,
grouped by the <tt class="docutils literal"><span class="pre">key</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li>The <tt class="docutils literal"><span class="pre">reduce</span></tt> function should <em>not</em> access the database,
even to perform read operations.</li>
<li>The <tt class="docutils literal"><span class="pre">reduce</span></tt> function should <em>not</em> affect the outside
system.</li>
<li>Because it is possible to invoke the <tt class="docutils literal"><span class="pre">reduce</span></tt> function
more than once for the same key, the following three
properties need to be true:<ol class="loweralpha">
<li>the <em>type</em> of the return object must be <strong>identical</strong>
to the type of the <tt class="docutils literal"><span class="pre">value</span></tt> emitted by the <tt class="docutils literal"><span class="pre">&lt;map&gt;</span></tt>
function to ensure that the following operations is
true:<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">reduce</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="p">[</span> <span class="nx">C</span><span class="p">,</span> <span class="nx">reduce</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="p">[</span> <span class="nx">A</span><span class="p">,</span> <span class="nx">B</span> <span class="p">])</span> <span class="p">]</span> <span class="p">)</span> <span class="o">==</span> <span class="nx">reduce</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="p">[</span> <span class="nx">C</span><span class="p">,</span> <span class="nx">A</span><span class="p">,</span> <span class="nx">B</span> <span class="p">]</span> <span class="p">)</span>
</pre></div>
</div>
</li>
<li>the <tt class="docutils literal"><span class="pre">reduce</span></tt> function must be <em>idempotent</em>. Ensure
that the following statement is true:<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">reduce</span><span class="p">(</span> <span class="nx">key</span><span class="p">,</span> <span class="p">[</span> <span class="nx">reduce</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">valuesArray</span><span class="p">)</span> <span class="p">]</span> <span class="p">)</span> <span class="o">==</span> <span class="nx">reduce</span> <span class="p">(</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">valuesArray</span> <span class="p">)</span>
</pre></div>
</div>
</li>
<li>the order of the elements in the
<tt class="docutils literal"><span class="pre">valuesArray</span></tt> should not affect the output of the
<tt class="docutils literal"><span class="pre">reduce</span></tt> function, so that the following statement is
true:<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">reduce</span> <span class="p">(</span> <span class="nx">key</span><span class="p">,</span> <span class="p">[</span> <span class="nx">A</span><span class="p">,</span> <span class="nx">B</span> <span class="p">]</span> <span class="p">)</span> <span class="o">==</span> <span class="nx">reduce</span> <span class="p">(</span> <span class="nx">key</span><span class="p">,</span> <span class="p">[</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">A</span> <span class="p">]</span> <span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</li>
<li>MongoDB will <strong>not</strong> call the <tt class="docutils literal"><span class="pre">reduce</span></tt> function for a key
that has only a single value.</li>
<li>The <tt class="docutils literal"><span class="pre">reduce</span></tt> function can access the variables defined
in the <tt class="docutils literal"><span class="pre">scope</span></tt> parameter.</li>
</ul>
</div>
</li>
<li><strong>out</strong> &#8211; <p>Specifies the location of the result of the map-reduce
operation. You may output to a collection when performing map
reduce operations on the primary members of the set, on
<a class="reference internal" href="../glossary/#term-secondary"><em class="xref std std-term">secondary</em></a> members you may only use the <tt class="docutils literal"><span class="pre">inline</span></tt>
output.</p>
<p>You can specify the following options for the <tt class="docutils literal"><span class="pre">out</span></tt> parameter:</p>
<ul>
<li><strong>Output to a collection</strong>.<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">out</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">collectionName</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
</li>
<li><strong>Output to a collection and specify one of the following
actions</strong>. This option is only available when passing <tt class="docutils literal"><span class="pre">out</span></tt>
a collection that already exists. This option is not
available on secondary members of replica sets.<div class="highlight-none"><div class="highlight"><pre>{ out: { &lt;action&gt;: &lt;collectionName&gt;[, db: &lt;dbName&gt;][, sharded: &lt;boolean&gt; ][, nonAtomic: &lt;boolean&gt; ] } }
</pre></div>
</div>
<ul>
<li><tt class="docutils literal"><span class="pre">&lt;action&gt;</span></tt>: Specify one of the following actions:<blockquote>
<div><ul>
<li><tt class="docutils literal"><span class="pre">replace</span></tt><div class="highlight-none"><div class="highlight"><pre>{ out: { replace: &lt;collectionName&gt; } }
</pre></div>
</div>
<p>Replace the contents of the <tt class="docutils literal"><span class="pre">&lt;collectionName&gt;</span></tt> if the
collection with the <tt class="docutils literal"><span class="pre">&lt;collectionName&gt;</span></tt> exists.</p>
</li>
<li><tt class="docutils literal"><span class="pre">merge</span></tt><div class="highlight-none"><div class="highlight"><pre>{ out: { merge: &lt;collectionName&gt; } }
</pre></div>
</div>
<p>Merge the new result with the existing result if the
output collection already exists. If an existing document
has the same key as the new result, <em>overwrite</em> that
existing document.</p>
</li>
<li><tt class="docutils literal"><span class="pre">reduce</span></tt><div class="highlight-none"><div class="highlight"><pre>{ out: { reduce: &lt;collectionName&gt; } }
</pre></div>
</div>
<p>Merge the new result with the existing result if the
output collection already exists. If an existing document
has the same key as the new result, apply the <tt class="docutils literal"><span class="pre">&lt;reduce&gt;</span></tt>
function to both the new and the existing documents and
overwrite the existing document with the result.</p>
</li>
</ul>
</div></blockquote>
</li>
<li><tt class="docutils literal"><span class="pre">db</span></tt>:<p>Optional.The name of the database that you want the
map-reduce operation to write its output. By default
this will be the same database as the input collection.</p>
</li>
<li><tt class="docutils literal"><span class="pre">sharded</span></tt>:<p>Optional. If <tt class="docutils literal"><span class="pre">true</span></tt> <em>and</em> you have enabled sharding on
output database, the map-reduce operation will shard the
output collection using the <tt class="docutils literal"><span class="pre">_id</span></tt> field as the shard key.</p>
</li>
<li><tt class="docutils literal"><span class="pre">nonAtomic</span></tt>:<p class="versionadded">
<span class="versionmodified">New in version 2.1.</span></p>
<p>Optional. Specify output operation as non-atomic and is
valid <em>only</em> for <tt class="docutils literal"><span class="pre">merge</span></tt> and <tt class="docutils literal"><span class="pre">reduce</span></tt> output modes which
may take minutes to execute.</p>
<p>If <tt class="docutils literal"><span class="pre">nonAtomic</span></tt> is <tt class="docutils literal"><span class="pre">true</span></tt>, the post-processing step will
prevent MongoDB from locking the database; however, other
clients will be able to read intermediate states of the
output collection. Otherwise the map reduce operation must
lock the database during post-processing.</p>
</li>
</ul>
</li>
<li><strong>Output inline</strong>. Perform the map-reduce operation in memory
and return the result. This option is the only available
option for <tt class="docutils literal"><span class="pre">out</span></tt> on secondary members of replica sets.<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">out</span><span class="o">:</span> <span class="p">{</span> <span class="nx">inline</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span>
</pre></div>
</div>
<p>The result must fit within the <a class="reference internal" href="../limits/#limit-bson-document-size"><em>maximum size of a BSON
document</em></a>.</p>
</li>
</ul>
</li>
<li><strong>query</strong> &#8211; Optional. Specifies the selection criteria using <a class="reference internal" href="../operators/"><em>query
operators</em></a> for determining the documents
input to the <tt class="docutils literal"><span class="pre">map</span></tt> function.</li>
<li><strong>sort</strong> &#8211; Optional. Sorts the <em>input</em> documents. This option is useful for
optimization. For example, specify the sort key to be the same
as the emit key so that there are fewer reduce operations.</li>
<li><strong>limit</strong> &#8211; Optional. Specifies a maximum number of documents to return from
the collection.</li>
<li><strong>finalize</strong> &#8211; <p>Optional. A JavaScript function that follows the <tt class="docutils literal"><span class="pre">&lt;reduce&gt;</span></tt>
method and modifies the output and has the following prototype:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">reducedValue</span><span class="p">)</span> <span class="p">{</span>
   <span class="p">...</span>
   <span class="k">return</span> <span class="nx">modifiedObject</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">&lt;finalize&gt;</span></tt> function receives as its arguments a <tt class="docutils literal"><span class="pre">key</span></tt>
value and the <tt class="docutils literal"><span class="pre">reducedValue</span></tt> from the <tt class="docutils literal"><span class="pre">&lt;reduce&gt;</span></tt> function.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li>The <tt class="docutils literal"><span class="pre">finalize</span></tt> function should <em>not</em> access the database for
any reason.</li>
<li>The <tt class="docutils literal"><span class="pre">finalize</span></tt> function should be pure, or have <em>no</em> impact
outside of the function (i.e. side effects.)</li>
<li>The <tt class="docutils literal"><span class="pre">finalize</span></tt> function can access the variables
defined in the <tt class="docutils literal"><span class="pre">scope</span></tt> parameter.</li>
</ul>
</div>
</li>
<li><strong>scope</strong> (<em>document</em>) &#8211; Optional. Specifies global variables that are accessible in the
<tt class="docutils literal"><span class="pre">map</span></tt> , <tt class="docutils literal"><span class="pre">reduce</span></tt> and the <tt class="docutils literal"><span class="pre">finalize</span></tt> functions.</li>
<li><strong>jsMode</strong> (<em>Boolean</em>) &#8211; <p>Optional. Specifies whether to convert intermediate data into
BSON format between the execution of the <tt class="docutils literal"><span class="pre">map</span></tt> and <tt class="docutils literal"><span class="pre">reduce</span></tt>
functions.</p>
<p>If <tt class="docutils literal"><span class="pre">false</span></tt>:</p>
<ul>
<li>Internally, MongoDB converts the JavaScript objects emitted
by the <tt class="docutils literal"><span class="pre">map</span></tt>
function to BSON objects. These BSON
objects are then converted back to JavaScript objects when
calling the <tt class="docutils literal"><span class="pre">reduce</span></tt> function.</li>
<li>The map-reduce operation places the intermediate BSON objects
in temporary, on-disk storage. This allows the map-reduce
operation to execute over arbitrarily large data sets.</li>
</ul>
<p>If <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<ul>
<li>Internally, the JavaScript objects emitted during <tt class="docutils literal"><span class="pre">map</span></tt>
function remain as JavaScript objects. There is no need to
convert the objects for the <tt class="docutils literal"><span class="pre">reduce</span></tt> function, which
can result in faster execution.</li>
<li>You can only use <tt class="docutils literal"><span class="pre">jsMode</span></tt> for result sets with fewer than
500,000 distinct <tt class="docutils literal"><span class="pre">key</span></tt> arguments to the mapper&#8217;s <tt class="docutils literal"><span class="pre">emit()</span></tt>
function.</li>
</ul>
<p>The <tt class="docutils literal"><span class="pre">jsMode</span></tt> defaults to false.</p>
</li>
<li><strong>verbose</strong> (<em>Boolean</em>) &#8211; Optional. Specifies whether to include the <tt class="docutils literal"><span class="pre">timing</span></tt>
information in the result information. The <tt class="docutils literal"><span class="pre">verbose</span></tt>
defaults to <tt class="docutils literal"><span class="pre">true</span></tt> to include the <tt class="docutils literal"><span class="pre">timing</span></tt> information.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Consider the following prototype map:dbcommand:<cite>mapReduce</cite>
operation:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">mapFunction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
<span class="kd">var</span> <span class="nx">reduceFunction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">values</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span>
               <span class="p">{</span>
                 <span class="nx">mapReduce</span><span class="o">:</span> <span class="s1">&#39;orders&#39;</span><span class="p">,</span>
                 <span class="nx">map</span><span class="o">:</span> <span class="nx">mapFunction</span><span class="p">,</span>
                 <span class="nx">reduce</span><span class="o">:</span> <span class="nx">reduceFunction</span><span class="p">,</span>
                 <span class="nx">out</span><span class="o">:</span> <span class="p">{</span> <span class="nx">merge</span><span class="o">:</span> <span class="s1">&#39;map_reduce_results&#39;</span> <span class="p">},</span>
                 <span class="nx">query</span><span class="o">:</span> <span class="p">{</span> <span class="nx">ord_date</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;01/01/2012&#39;</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
               <span class="p">}</span>
             <span class="p">)</span>
</pre></div>
</div>
<p>In the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt>, the <a class="reference internal" href="../method/db.collection.mapReduce/#db.collection.mapReduce" title="db.collection.mapReduce"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.mapReduce()</span></tt></a>
method is a wrapper around the <a class="reference internal" href="#mapReduce" title="mapReduce"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">mapReduce</span></tt></a> command. The
following examples use the <a class="reference internal" href="../method/db.collection.mapReduce/#db.collection.mapReduce" title="db.collection.mapReduce"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.mapReduce()</span></tt></a>:</p>
<p>Consider the following map-reduce operations on a collection <tt class="docutils literal"><span class="pre">orders</span></tt>
that contains documents of the following prototype:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
     <span class="nx">_id</span><span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;50a8240b927d5d8b5891743c&quot;</span><span class="p">),</span>
     <span class="nx">cust_id</span><span class="o">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">,</span>
     <span class="nx">ord_date</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="s2">&quot;Oct 04, 2012&quot;</span><span class="p">),</span>
     <span class="nx">status</span><span class="o">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span>
     <span class="nx">price</span><span class="o">:</span> <span class="mi">250</span><span class="p">,</span>
     <span class="nx">items</span><span class="o">:</span> <span class="p">[</span> <span class="p">{</span> <span class="nx">sku</span><span class="o">:</span> <span class="s2">&quot;mmm&quot;</span><span class="p">,</span> <span class="nx">qty</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">price</span><span class="o">:</span> <span class="mf">2.5</span> <span class="p">},</span>
              <span class="p">{</span> <span class="nx">sku</span><span class="o">:</span> <span class="s2">&quot;nnn&quot;</span><span class="p">,</span> <span class="nx">qty</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">price</span><span class="o">:</span> <span class="mf">2.5</span> <span class="p">}</span> <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<ul>
<li><p class="first">Perform map-reduce operation on the <tt class="docutils literal"><span class="pre">orders</span></tt> collection to group by
the <tt class="docutils literal"><span class="pre">cust_id</span></tt>, and for each <tt class="docutils literal"><span class="pre">cust_id</span></tt>, calculate the sum of the
<tt class="docutils literal"><span class="pre">price</span></tt> for each <tt class="docutils literal"><span class="pre">cust_id</span></tt>:</p>
<blockquote>
<div></div></blockquote>
<ol class="arabic">
<li><p class="first">Define the map function to process each input document:</p>
<ul class="simple">
<li>In the function, <tt class="docutils literal"><span class="pre">this</span></tt> refers to the document that the
map-reduce operation is processing.</li>
<li>The function maps the <tt class="docutils literal"><span class="pre">price</span></tt> to the <tt class="docutils literal"><span class="pre">cust_id</span></tt> for each
document and emits the <tt class="docutils literal"><span class="pre">cust_id</span></tt> and <tt class="docutils literal"><span class="pre">price</span></tt> pair.</li>
</ul>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">mapFunction1</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                       <span class="nx">emit</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cust_id</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">price</span><span class="p">);</span>
                   <span class="p">};</span>
</pre></div>
</div>
</li>
<li><p class="first">Define the corresponding reduce function with two arguments
<tt class="docutils literal"><span class="pre">keyCustId</span></tt> and <tt class="docutils literal"><span class="pre">valuesPrices</span></tt>:</p>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">valuesPrices</span></tt> is an array whose elements are the <tt class="docutils literal"><span class="pre">price</span></tt>
values emitted by the map function and grouped by <tt class="docutils literal"><span class="pre">keyCustId</span></tt>.</li>
<li>The function reduces the <tt class="docutils literal"><span class="pre">valuesPrice</span></tt> array to the
sum of its elements.</li>
</ul>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">reduceFunction1</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">keyCustId</span><span class="p">,</span> <span class="nx">valuesPrices</span><span class="p">)</span> <span class="p">{</span>
                          <span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">sum</span><span class="p">(</span><span class="nx">valuesPrices</span><span class="p">);</span>
                      <span class="p">};</span>
</pre></div>
</div>
</li>
<li><p class="first">Perform the map-reduce on all documents in the <tt class="docutils literal"><span class="pre">orders</span></tt> collection
using the <tt class="docutils literal"><span class="pre">mapFunction1</span></tt> map function and the <tt class="docutils literal"><span class="pre">reduceFunction1</span></tt>
reduce function.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">mapReduce</span><span class="p">(</span>
                     <span class="nx">mapFunction1</span><span class="p">,</span>
                     <span class="nx">reduceFunction1</span><span class="p">,</span>
                     <span class="p">{</span> <span class="nx">out</span><span class="o">:</span> <span class="s2">&quot;map_reduce_example&quot;</span> <span class="p">}</span>
                   <span class="p">)</span>
</pre></div>
</div>
<p>This operation outputs the results to a collection named
<tt class="docutils literal"><span class="pre">map_reduce_example</span></tt>. If the <tt class="docutils literal"><span class="pre">map_reduce_example</span></tt> collection
already exists, the operation will replace the contents with the
results of this map-reduce operation:</p>
</li>
</ol>
</li>
<li><p class="first">In this example you will perform a map-reduce operation on the <tt class="docutils literal"><span class="pre">orders</span></tt> collection, for
all documents that have an <tt class="docutils literal"><span class="pre">ord_date</span></tt> value
greater than <tt class="docutils literal"><span class="pre">01/01/2012</span></tt>. The operation groups by
the <tt class="docutils literal"><span class="pre">item.sku</span></tt> field, and for each <tt class="docutils literal"><span class="pre">sku</span></tt> calculates the number of orders and the
total quantity ordered. The operation concludes by calculating the average quantity per
order for each <tt class="docutils literal"><span class="pre">sku</span></tt> value:</p>
<ol class="arabic">
<li><p class="first">Define the map function to process each input document:</p>
<ul class="simple">
<li>In the function, <tt class="docutils literal"><span class="pre">this</span></tt> refers to the document that the
map-reduce operation is processing.</li>
<li>For each item, the function associates the <tt class="docutils literal"><span class="pre">sku</span></tt> with a new
object <tt class="docutils literal"><span class="pre">value</span></tt> that contains the <tt class="docutils literal"><span class="pre">count</span></tt> of <tt class="docutils literal"><span class="pre">1</span></tt> and the
item <tt class="docutils literal"><span class="pre">qty</span></tt> for the order and emits the <tt class="docutils literal"><span class="pre">sku</span></tt> and <tt class="docutils literal"><span class="pre">value</span></tt> pair.</li>
</ul>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">mapFunction2</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                       <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">idx</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                           <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">idx</span><span class="p">].</span><span class="nx">sku</span><span class="p">;</span>
                           <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="p">{</span>
                                         <span class="nx">count</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
                                         <span class="nx">qty</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">idx</span><span class="p">].</span><span class="nx">qty</span>
                                       <span class="p">};</span>
                           <span class="nx">emit</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
                       <span class="p">}</span>
                    <span class="p">};</span>
</pre></div>
</div>
</li>
<li><p class="first">Define the corresponding reduce function with two arguments
<tt class="docutils literal"><span class="pre">keySKU</span></tt> and <tt class="docutils literal"><span class="pre">valuesCountObjects</span></tt>:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">valuesCountObjects</span></tt> is an array whose elements are the objects
mapped to the grouped <tt class="docutils literal"><span class="pre">keySKU</span></tt> values passed by map
function to the reducer function.</li>
<li>The function reduces the <tt class="docutils literal"><span class="pre">valuesCountObjects</span></tt> array to a single
object <tt class="docutils literal"><span class="pre">reducedValue</span></tt> that also contains the <tt class="docutils literal"><span class="pre">count</span></tt> and the
<tt class="docutils literal"><span class="pre">qty</span></tt> fields.</li>
<li>In <tt class="docutils literal"><span class="pre">reducedValue</span></tt>, the <tt class="docutils literal"><span class="pre">count</span></tt> field contains the sum of the
<tt class="docutils literal"><span class="pre">count</span></tt> fields from the individual array elements, and the
<tt class="docutils literal"><span class="pre">qty</span></tt> field contains the sum of the <tt class="docutils literal"><span class="pre">qty</span></tt> fields from the
individual array elements.</li>
</ul>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">reduceFunction2</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">keySKU</span><span class="p">,</span> <span class="nx">valuesCountObjects</span><span class="p">)</span> <span class="p">{</span>
                          <span class="nx">reducedValue</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">count</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">qty</span><span class="o">:</span> <span class="mi">0</span> <span class="p">};</span>

                          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">idx</span> <span class="o">&lt;</span> <span class="nx">valuesCountObjects</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                              <span class="nx">reducedValue</span><span class="p">.</span><span class="nx">count</span> <span class="o">+=</span> <span class="nx">valuesCountObjects</span><span class="p">[</span><span class="nx">idx</span><span class="p">].</span><span class="nx">count</span><span class="p">;</span>
                              <span class="nx">reducedValue</span><span class="p">.</span><span class="nx">qty</span> <span class="o">+=</span> <span class="nx">valuesCountObjects</span><span class="p">[</span><span class="nx">idx</span><span class="p">].</span><span class="nx">qty</span><span class="p">;</span>
                          <span class="p">}</span>

                          <span class="k">return</span> <span class="nx">reducedValue</span><span class="p">;</span>
                      <span class="p">};</span>
</pre></div>
</div>
</li>
<li><p class="first">Define a finalize function with two arguments <tt class="docutils literal"><span class="pre">key</span></tt> and
<tt class="docutils literal"><span class="pre">reducedValue</span></tt>. The function modifies the <tt class="docutils literal"><span class="pre">reducedValue</span></tt> object
to add a computed field named <tt class="docutils literal"><span class="pre">average</span></tt> and returns the modified
object:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">finalizeFunction2</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">reducedValue</span><span class="p">)</span> <span class="p">{</span>

                            <span class="nx">reducedValue</span><span class="p">.</span><span class="nx">average</span> <span class="o">=</span> <span class="nx">reducedValue</span><span class="p">.</span><span class="nx">qty</span><span class="o">/</span><span class="nx">reducedValue</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>

                            <span class="k">return</span> <span class="nx">reducedValue</span><span class="p">;</span>
                        <span class="p">};</span>
</pre></div>
</div>
</li>
<li><p class="first">Perform the map-reduce operation on the <tt class="docutils literal"><span class="pre">orders</span></tt> collection using
the <tt class="docutils literal"><span class="pre">mapFunction2</span></tt>, <tt class="docutils literal"><span class="pre">reduceFunction2</span></tt>, and
<tt class="docutils literal"><span class="pre">finalizeFunction2</span></tt> functions.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">mapReduce</span><span class="p">(</span> <span class="nx">mapFunction2</span><span class="p">,</span>
                     <span class="nx">reduceFunction2</span><span class="p">,</span>
                     <span class="p">{</span>
                       <span class="nx">out</span><span class="o">:</span> <span class="p">{</span> <span class="nx">merge</span><span class="o">:</span> <span class="s2">&quot;map_reduce_example&quot;</span> <span class="p">},</span>
                       <span class="nx">query</span><span class="o">:</span> <span class="p">{</span> <span class="nx">ord_date</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;01/01/2012&#39;</span><span class="p">)</span> <span class="p">}</span> <span class="p">},</span>
                       <span class="nx">finalize</span><span class="o">:</span> <span class="nx">finalizeFunction2</span>
                     <span class="p">}</span>
                   <span class="p">)</span>
</pre></div>
</div>
<p>This operation uses the <tt class="docutils literal"><span class="pre">query</span></tt> field to select only those
documents with <tt class="docutils literal"><span class="pre">ord_date</span></tt> greater than <tt class="docutils literal"><span class="pre">new</span>
<span class="pre">Date(01/01/2012)</span></tt>. Then it output the results to a collection
<tt class="docutils literal"><span class="pre">map_reduce_example</span></tt>. If the <tt class="docutils literal"><span class="pre">map_reduce_example</span></tt> collection
already exists, the operation will merge the existing contents with
the results of this map-reduce operation:</p>
</li>
</ol>
</li>
</ul>
<p>For more information and examples, see the <a class="reference internal" href="../../applications/map-reduce/"><em>Map-Reduce</em></a> page.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference internal" href="../glossary/#term-map-reduce"><em class="xref std std-term">map-reduce</em></a> and <a class="reference internal" href="../method/db.collection.mapReduce/#db.collection.mapReduce" title="db.collection.mapReduce"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.mapReduce()</span></tt></a></li>
<li><a class="reference internal" href="../../applications/aggregation/"><em>Aggregation Framework</em></a></li>
</ul>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="findAndModify">
<tt class="descname">findAndModify</tt><a class="headerlink" href="#findAndModify" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#findAndModify" title="findAndModify"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">findAndModify</span></tt></a> command atomically modifies and
returns a single document. By default, the returned document does
not include the modifications made on the update. To return the
document with the modifications made on the update, use the <tt class="docutils literal"><span class="pre">new</span></tt>
option.</p>
<p>The command has the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">findAndModify</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">collection</span><span class="o">&gt;</span><span class="p">,</span>  <span class="o">&lt;</span><span class="nx">options</span><span class="o">&gt;</span>  <span class="p">}</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#findAndModify" title="findAndModify"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">findAndModify</span></tt></a> command takes the following are
sub-document <tt class="docutils literal"><span class="pre">options</span></tt>:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Fields:</th><td class="field-body"><ul class="first last simple">
<li><strong>query</strong> (<em>document</em>) &#8211; <p>Optional. Specifies the selection criteria for the
modification. The <tt class="docutils literal"><span class="pre">query</span></tt> field employs the same
<a class="reference internal" href="../operators/#query-selectors"><em>query selectors</em></a> as used in the
<a class="reference internal" href="../method/db.collection.find/#db.collection.find" title="db.collection.find"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.find()</span></tt></a> method. Although the query may
match multiple documents, <a class="reference internal" href="#findAndModify" title="findAndModify"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">findAndModify</span></tt></a> will
only select one document to modify.</p>
<p>The <tt class="docutils literal"><span class="pre">query</span></tt> field has the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">query</span><span class="o">:</span> <span class="p">{</span> <span class="o">&lt;</span><span class="nx">query</span> <span class="nx">expression</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
</li>
<li><strong>sort</strong> (<em>document</em>) &#8211; <p>Optional. Determines which document the operation will
modify if the query selects multiple
documents. <a class="reference internal" href="#findAndModify" title="findAndModify"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">findAndModify</span></tt></a> will modify the first
document in the sort order specified by this argument.</p>
<p>The <tt class="docutils literal"><span class="pre">sort</span></tt> field has the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">sort</span><span class="o">:</span> <span class="p">{</span> <span class="nx">field1</span><span class="o">:</span> <span class="nx">value1</span><span class="p">,</span> <span class="nx">field2</span><span class="o">:</span> <span class="nx">value2</span><span class="p">,</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</div>
</li>
<li><strong>remove</strong> (<em>boolean</em>) &#8211; <p>Optional if <tt class="docutils literal"><span class="pre">update</span></tt> field exists. When <tt class="docutils literal"><span class="pre">true</span></tt>, removes
the selected document. The default is <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
<p>The <tt class="docutils literal"><span class="pre">remove</span></tt> field has the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">remove</span><span class="o">:</span> <span class="o">&lt;</span><span class="kr">boolean</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><strong>update</strong> (<em>document</em>) &#8211; <p>Optional if <tt class="docutils literal"><span class="pre">remove</span></tt> field exists. Performs an update of
the selected document. The <tt class="docutils literal"><span class="pre">update</span></tt> field employs the same
<a class="reference internal" href="../operators/#update-operators"><em>update operators</em></a> or <tt class="docutils literal"><span class="pre">field:</span> <span class="pre">value</span></tt>
specifications to modify the selected document.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">update</span><span class="o">:</span> <span class="p">{</span> <span class="o">&lt;</span><span class="nx">update</span> <span class="nx">expression</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
</li>
<li><strong>new</strong> (<em>boolean</em>) &#8211; <p>Optional. When <tt class="docutils literal"><span class="pre">true</span></tt>, returns the modified document rather
than the original. The <a class="reference internal" href="#findAndModify" title="findAndModify"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">findAndModify</span></tt></a> method
ignores the <tt class="docutils literal"><span class="pre">new</span></tt> option for <tt class="docutils literal"><span class="pre">remove</span></tt> operations. The
default is <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="k">new</span><span class="o">:</span> <span class="o">&lt;</span><span class="kr">boolean</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><strong>fields</strong> (<em>document</em>) &#8211; <p>Optional. A subset of fields to return.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">fields</span><span class="o">:</span> <span class="p">{</span> <span class="nx">field1</span><span class="o">:</span> <span class="o">&lt;</span><span class="kr">boolean</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">field2</span><span class="o">:</span> <span class="o">&lt;</span><span class="kr">boolean</span><span class="o">&gt;</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</div>
</li>
<li><strong>upsert</strong> (<em>boolean</em>) &#8211; <p>Optional. Used in conjunction with the <tt class="docutils literal"><span class="pre">update</span></tt> field. When
<tt class="docutils literal"><span class="pre">true</span></tt>, the <a class="reference internal" href="#findAndModify" title="findAndModify"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">findAndModify</span></tt></a> command creates a
new document if the <tt class="docutils literal"><span class="pre">query</span></tt> returns no documents. The
default is <tt class="docutils literal"><span class="pre">false</span></tt>. In version 2.2, the
<a class="reference internal" href="#findAndModify" title="findAndModify"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">findAndModify</span></tt></a> command returns <tt class="docutils literal"><span class="pre">null</span></tt> when
<tt class="docutils literal"><span class="pre">upsert</span></tt> is <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">upsert</span><span class="o">:</span> <span class="o">&lt;</span><span class="kr">boolean</span><span class="o">&gt;</span>
</pre></div>
</div>
<p class="versionchanged">
<span class="versionmodified">Changed in version 2.2: </span>Previously, <tt class="docutils literal"><span class="pre">upsert</span></tt> operations returned a an empty
document (e.g. <tt class="docutils literal"><span class="pre">{</span> <span class="pre">}</span></tt>,) see <a class="reference internal" href="../../release-notes/2.2/#findandmodify-returns-null"><em>the 2.2 release notes</em></a> for more information.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Consider the following example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">findAndModify</span><span class="o">:</span> <span class="s2">&quot;people&quot;</span><span class="p">,</span>
  <span class="nx">query</span><span class="o">:</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Tom&quot;</span><span class="p">,</span> <span class="nx">state</span><span class="o">:</span> <span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="nx">rating</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">10</span> <span class="p">}</span> <span class="p">},</span>
  <span class="nx">sort</span><span class="o">:</span> <span class="p">{</span> <span class="nx">rating</span><span class="o">:</span> <span class="mi">1</span> <span class="p">},</span>
  <span class="nx">update</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$inc</span><span class="o">:</span> <span class="p">{</span> <span class="nx">score</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This command performs the following actions:</p>
<ol class="arabic simple">
<li>The <tt class="docutils literal"><span class="pre">query</span></tt> finds a document in the <tt class="docutils literal"><span class="pre">people</span></tt> collection where the
<tt class="docutils literal"><span class="pre">name</span></tt> field has the value <tt class="docutils literal"><span class="pre">Tom</span></tt>, the <tt class="docutils literal"><span class="pre">state</span></tt> field has the
value <tt class="docutils literal"><span class="pre">active</span></tt> and the <tt class="docutils literal"><span class="pre">rating</span></tt> field has a value
<a class="reference internal" href="../operators/#_S_gt" title="$gt"><tt class="xref mongodb mongodb-operator docutils literal"><span class="pre">greater</span> <span class="pre">than</span></tt></a> 10.</li>
<li>The <tt class="docutils literal"><span class="pre">sort</span></tt> orders the results of the query in ascending order.</li>
<li>The update <a class="reference internal" href="../operators/#_S_inc" title="$inc"><tt class="xref mongodb mongodb-operator docutils literal"><span class="pre">increments</span></tt></a> the value of the
<tt class="docutils literal"><span class="pre">score</span></tt> field by 1.</li>
<li>The command returns the original unmodified document
selected for this update.</li>
</ol>
<p>The shell and many <a class="reference internal" href="../glossary/#term-driver"><em class="xref std std-term">drivers</em></a> provide a
<a class="reference internal" href="#findAndModify" title="findAndModify"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">findAndModify()</span></tt></a> helper method. Using the shell helper,
this same operation can take the following form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">findAndModify</span><span class="p">(</span> <span class="p">{</span>
    <span class="nx">query</span><span class="o">:</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Tom&quot;</span><span class="p">,</span> <span class="nx">state</span><span class="o">:</span> <span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="nx">rating</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">10</span> <span class="p">}</span> <span class="p">},</span>
    <span class="nx">sort</span><span class="o">:</span> <span class="p">{</span> <span class="nx">rating</span><span class="o">:</span> <span class="mi">1</span> <span class="p">},</span>
    <span class="nx">update</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$inc</span><span class="o">:</span> <span class="p">{</span> <span class="nx">score</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span>
    <span class="p">}</span> <span class="p">);</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">When using <a class="reference internal" href="#findAndModify" title="findAndModify"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">findAndModify</span></tt></a> in a <a class="reference internal" href="../glossary/#term-sharding"><em class="xref std std-term">sharded</em></a> environment, the <tt class="docutils literal"><span class="pre">query</span></tt> must contain the
<a class="reference internal" href="../glossary/#term-shard-key"><em class="xref std std-term">shard key</em></a> for all operations against the shard
cluster. <a class="reference internal" href="#findAndModify" title="findAndModify"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">findAndModify</span></tt></a> operations issued against
<a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances for non-sharded collections function
normally.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This command obtains a write lock on the affected database and
will block other operations until it has completed; however,
typically the write lock is short lived and equivalent to other
similar <a class="reference internal" href="../method/db.collection.update/#db.collection.update" title="db.collection.update"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">update()</span></tt></a> operations.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="distinct">
<tt class="descname">distinct</tt><a class="headerlink" href="#distinct" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#distinct" title="distinct"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">distinct</span></tt></a> command finds the distinct values for a
specified field across a single collection. The command returns a
document that contains an array of the distinct values as well as
the query plan and status. The command takes the following prototype
form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">distinct</span><span class="o">:</span> <span class="nx">collection</span><span class="p">,</span> <span class="nx">key</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">field</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">query</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">query</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The command fields are as follows:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Fields:</th><td class="field-body"><ul class="first last simple">
<li><strong>collection</strong> (<em>String</em>) &#8211; The name of the collection to query for distinct values.</li>
<li><strong>field</strong> (<em>string</em>) &#8211; Specifies the field for which to return the distinct values.</li>
<li><strong>query</strong> (<em>document</em>) &#8211; Optional. Specifies the selection <tt class="docutils literal"><span class="pre">query</span></tt> to determine the
subset of documents from which to retrieve the distinct
values.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Consider the following examples of the <a class="reference internal" href="#distinct" title="distinct"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">distinct</span></tt></a> command:</p>
<ul>
<li><p class="first">Return an array of the distinct values of the field <tt class="docutils literal"><span class="pre">ord_dt</span></tt>
from all documents in the <tt class="docutils literal"><span class="pre">orders</span></tt> collection:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span> <span class="p">(</span> <span class="p">{</span> <span class="nx">distinct</span><span class="o">:</span> <span class="s1">&#39;orders&#39;</span><span class="p">,</span> <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;ord_dt&#39;</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Return an array of the distinct values of the field <tt class="docutils literal"><span class="pre">sku</span></tt> in the
subdocument <tt class="docutils literal"><span class="pre">item</span></tt> from all documents in the <tt class="docutils literal"><span class="pre">orders</span></tt>
collection:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span> <span class="p">(</span> <span class="p">{</span> <span class="nx">distinct</span><span class="o">:</span> <span class="s1">&#39;orders&#39;</span><span class="p">,</span> <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;item.sku&#39;</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Return an array of the distinct values of the field <tt class="docutils literal"><span class="pre">ord_dt</span></tt>
from the documents in the <tt class="docutils literal"><span class="pre">orders</span></tt> collection where the
<tt class="docutils literal"><span class="pre">price</span></tt> is greater than <tt class="docutils literal"><span class="pre">10</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span> <span class="p">(</span> <span class="p">{</span> <span class="nx">distinct</span><span class="o">:</span> <span class="s1">&#39;orders&#39;</span><span class="p">,</span>
                  <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;ord_dt&#39;</span><span class="p">,</span>
                  <span class="nx">query</span><span class="o">:</span> <span class="p">{</span> <span class="nx">price</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">10</span> <span class="p">}</span> <span class="p">}</span>
                <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>MongoDB also provides the shell wrapper method
<a class="reference internal" href="../method/db.collection.distinct/#db.collection.distinct" title="db.collection.distinct"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.distinct()</span></tt></a> for the
<a class="reference internal" href="#distinct" title="distinct"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">distinct</span></tt></a> command. Additionally, many MongoDB
<a class="reference internal" href="../glossary/#term-driver"><em class="xref std std-term">drivers</em></a> also provide a wrapper method. Refer
to the specific driver documentation.</li>
<li>When possible, the <a class="reference internal" href="#distinct" title="distinct"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">distinct</span></tt></a> command will use an
index to find the documents in the query as well as to return
the data.</li>
</ul>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="eval">
<tt class="descname">eval</tt><a class="headerlink" href="#eval" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#eval" title="eval"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">eval</span></tt></a> command evaluates JavaScript functions on the
database server and has the following form:</p>
<div class="highlight-none"><div class="highlight"><pre>{
  eval: &lt;function&gt;,
  args: [ &lt;arg1&gt;, &lt;arg2&gt; ... ],
  nolock: &lt;boolean&gt;
}
</pre></div>
</div>
<p>The command contains the following fields:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>function</strong> (<em>JavaScript</em>) &#8211; <p>A JavaScript function.</p>
<p>The function may accept no arguments, as in the following
example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The function can also accept arguments, as in the following example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">)</span> <span class="p">{</span>
   <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><strong>arguments</strong> &#8211; A list of arguments to pass to the JavaScript <tt class="docutils literal"><span class="pre">function</span></tt> if
the function accepts arguments. Omit if the <tt class="docutils literal"><span class="pre">function</span></tt> does
not take arguments.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Fields:</th><td class="field-body"><ul class="first last simple">
<li><strong>args</strong> (<em>Array</em>) &#8211; An array of corresponding arguments to the <tt class="docutils literal"><span class="pre">function</span></tt>. Omit
<tt class="docutils literal"><span class="pre">args</span></tt> if the <tt class="docutils literal"><span class="pre">function</span></tt> does not take arguments.</li>
<li><strong>nolock</strong> (<em>Boolean</em>) &#8211; <p>Optional. Specifies whether to disable the write lock. By
default, <a class="reference internal" href="#eval" title="eval"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">eval</span></tt></a> takes a write lock. There are
circumstances where the <a class="reference internal" href="#eval" title="eval"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">eval</span></tt></a> executes a strictly
read-only operation that does not need to block other
operations. If <tt class="docutils literal"><span class="pre">nolock</span></tt> is <tt class="docutils literal"><span class="pre">true</span></tt>, the
<a class="reference internal" href="#eval" title="eval"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">eval</span></tt></a> does not take a write lock.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not disable the write lock if the function may modify
the contents of the database in any way.</p>
</div>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Consider the following example which uses <a class="reference internal" href="#eval" title="eval"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">eval</span></tt></a> to
perform an increment and calculate the average on the server:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span>
      <span class="nb">eval</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">incAmount</span><span class="p">)</span> <span class="p">{</span>
               <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">myCollection</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(</span> <span class="p">{</span> <span class="nx">name</span> <span class="o">:</span> <span class="nx">name</span> <span class="p">}</span> <span class="p">);</span>

               <span class="nx">doc</span> <span class="o">=</span> <span class="nx">doc</span> <span class="o">||</span> <span class="p">{</span> <span class="nx">name</span> <span class="o">:</span> <span class="nx">name</span> <span class="p">,</span> <span class="nx">num</span> <span class="o">:</span> <span class="mi">0</span> <span class="p">,</span> <span class="nx">total</span> <span class="o">:</span> <span class="mi">0</span> <span class="p">,</span> <span class="nx">avg</span> <span class="o">:</span> <span class="mi">0</span> <span class="p">};</span>

               <span class="nx">doc</span><span class="p">.</span><span class="nx">num</span><span class="o">++</span><span class="p">;</span>
               <span class="nx">doc</span><span class="p">.</span><span class="nx">total</span> <span class="o">+=</span> <span class="nx">incAmount</span><span class="p">;</span>
               <span class="nx">doc</span><span class="p">.</span><span class="nx">avg</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">total</span> <span class="o">/</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">num</span><span class="p">;</span>

               <span class="nx">db</span><span class="p">.</span><span class="nx">myCollection</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span> <span class="nx">doc</span> <span class="p">);</span>
               <span class="k">return</span> <span class="nx">doc</span><span class="p">;</span>
            <span class="p">},</span>
      <span class="nx">args</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;eliot&quot;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">]</span>
   <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">db</span></tt> in the function refers to the current database.</p>
<p>The shell also provides a helper method <a class="reference internal" href="../method/db.eval/#db.eval" title="db.eval"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.eval()</span></tt></a>, so you
can express the above as follows:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nb">eval</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">incAmount</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">myCollection</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(</span> <span class="p">{</span> <span class="nx">name</span> <span class="o">:</span> <span class="nx">name</span> <span class="p">}</span> <span class="p">);</span>

            <span class="nx">doc</span> <span class="o">=</span> <span class="nx">doc</span> <span class="o">||</span> <span class="p">{</span> <span class="nx">name</span> <span class="o">:</span> <span class="nx">name</span> <span class="p">,</span> <span class="nx">num</span> <span class="o">:</span> <span class="mi">0</span> <span class="p">,</span> <span class="nx">total</span> <span class="o">:</span> <span class="mi">0</span> <span class="p">,</span> <span class="nx">avg</span> <span class="o">:</span> <span class="mi">0</span> <span class="p">};</span>

            <span class="nx">doc</span><span class="p">.</span><span class="nx">num</span><span class="o">++</span><span class="p">;</span>
            <span class="nx">doc</span><span class="p">.</span><span class="nx">total</span> <span class="o">+=</span> <span class="nx">incAmount</span><span class="p">;</span>
            <span class="nx">doc</span><span class="p">.</span><span class="nx">avg</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">total</span> <span class="o">/</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">num</span><span class="p">;</span>

            <span class="nx">db</span><span class="p">.</span><span class="nx">myCollection</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span> <span class="nx">doc</span> <span class="p">);</span>
            <span class="k">return</span> <span class="nx">doc</span><span class="p">;</span>
         <span class="p">},</span>
         <span class="s2">&quot;eliot&quot;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
</pre></div>
</div>
<p>You cannot pass the <tt class="docutils literal"><span class="pre">nolock</span></tt> flag to the <a class="reference internal" href="../method/db.eval/#db.eval" title="db.eval"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.eval()</span></tt></a>
in the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell.</p>
<p>If you want to use the server&#8217;s interpreter, you must run
<a class="reference internal" href="#eval" title="eval"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">eval</span></tt></a>. Otherwise, the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell&#8217;s
JavaScript interpreter evaluates functions entered directly into the
shell.</p>
<p>If an error occurs, <a class="reference internal" href="#eval" title="eval"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">eval</span></tt></a> throws an exception. Consider
the following invalid function that uses the variable <tt class="docutils literal"><span class="pre">x</span></tt> without
declaring it as an argument:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span>
               <span class="p">{</span>
                 <span class="nb">eval</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">x</span><span class="p">;</span> <span class="p">},</span>
                 <span class="nx">args</span><span class="o">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span>
               <span class="p">}</span>
             <span class="p">)</span>
</pre></div>
</div>
<p>The statement will result in the following exception:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
   <span class="s2">&quot;errno&quot;</span> <span class="o">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span>
   <span class="s2">&quot;errmsg&quot;</span> <span class="o">:</span> <span class="s2">&quot;invoke failed: JS Error: ReferenceError: x is not defined nofile_b:1&quot;</span><span class="p">,</span>
   <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<ul class="last simple">
<li>The <a class="reference internal" href="../method/db.eval/#db.eval" title="db.eval"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.eval()</span></tt></a> operation takes a write lock by
default. This means that <a class="reference internal" href="#eval" title="eval"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">eval</span></tt></a> blocks all other
read and write operations to the database while the
<a class="reference internal" href="#eval" title="eval"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">eval</span></tt></a> operation runs. You can, however, disable
the lock by setting the <tt class="docutils literal"><span class="pre">nolock</span></tt> flag to <tt class="docutils literal"><span class="pre">true</span></tt> if the
<a class="reference internal" href="#eval" title="eval"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">eval</span></tt></a> performs a strictly read-only operation.</li>
<li><a class="reference internal" href="#eval" title="eval"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">eval</span></tt></a> also takes a JavaScript lock.</li>
<li>Do not use <a class="reference internal" href="#eval" title="eval"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">eval</span></tt></a> for long running operations as
<a class="reference internal" href="#eval" title="eval"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">eval</span></tt></a> blocks all other operations. Consider using
<a class="reference internal" href="../../applications/server-side-javascript/"><em>other server side code execution options</em></a>.</li>
<li>You can not use <a class="reference internal" href="#eval" title="eval"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">eval</span></tt></a> with <a class="reference internal" href="../glossary/#term-sharding"><em class="xref std std-term">sharded</em></a> data. In general, you should avoid using
<a class="reference internal" href="#eval" title="eval"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">eval</span></tt></a> in <a class="reference internal" href="../glossary/#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a>; nevertheless, it
is possible to use <a class="reference internal" href="#eval" title="eval"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">eval</span></tt></a> with non-sharded
collections and databases stored in a <a class="reference internal" href="../glossary/#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a>.</li>
</ul>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../../applications/server-side-javascript/"><em>Server-side JavaScript</em></a></p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="aggregate">
<tt class="descname">aggregate</tt><a class="headerlink" href="#aggregate" title="Permalink to this definition">¶</a></dt>
<dd><p class="versionadded">
<span class="versionmodified">New in version 2.1.0.</span></p>
<p><a class="reference internal" href="#aggregate" title="aggregate"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">aggregate</span></tt></a> implements the <a class="reference internal" href="../glossary/#term-aggregation-framework"><em class="xref std std-term">aggregation
framework</em></a>. Consider the following prototype form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">aggregate</span><span class="o">:</span> <span class="s2">&quot;[collection]&quot;</span><span class="p">,</span> <span class="nx">pipeline</span><span class="o">:</span> <span class="p">[</span><span class="nx">pipeline</span><span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<p>Where <tt class="docutils literal"><span class="pre">[collection]</span></tt> specifies the name of the collection that
contains the data that you wish to aggregate. The <tt class="docutils literal"><span class="pre">pipeline</span></tt>
argument holds an array that contains the specification for the
aggregation operation. Consider the following example from the
<a class="reference internal" href="../../applications/aggregation/"><em>aggregation documentation</em></a>.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span>
<span class="p">{</span> <span class="nx">aggregate</span> <span class="o">:</span> <span class="s2">&quot;article&quot;</span><span class="p">,</span> <span class="nx">pipeline</span> <span class="o">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="nx">$project</span> <span class="o">:</span> <span class="p">{</span>
     <span class="nx">author</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
     <span class="nx">tags</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="p">}</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">$unwind</span> <span class="o">:</span> <span class="s2">&quot;$tags&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">$group</span> <span class="o">:</span> <span class="p">{</span>
     <span class="nx">_id</span> <span class="o">:</span> <span class="s2">&quot;$tags&quot;</span><span class="p">,</span>
     <span class="nx">authors</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">$addToSet</span> <span class="o">:</span> <span class="s2">&quot;$author&quot;</span> <span class="p">}</span>
  <span class="p">}</span> <span class="p">}</span>
 <span class="p">]</span> <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>More typically this operation would use the <a class="reference internal" href="#aggregate" title="aggregate"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">aggregate</span></tt></a>
helper in the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell, and would resemble the
following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">article</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">(</span>
  <span class="p">{</span> <span class="nx">$project</span> <span class="o">:</span> <span class="p">{</span>
     <span class="nx">author</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
     <span class="nx">tags</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="p">}</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">$unwind</span> <span class="o">:</span> <span class="s2">&quot;$tags&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">$group</span> <span class="o">:</span> <span class="p">{</span>
     <span class="nx">_id</span> <span class="o">:</span> <span class="s2">&quot;$tags&quot;</span><span class="p">,</span>
     <span class="nx">authors</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">$addToSet</span> <span class="o">:</span> <span class="s2">&quot;$author&quot;</span> <span class="p">}</span>
  <span class="p">}</span> <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>For more aggregation documentation, please see:</p>
<ul class="simple">
<li><a class="reference internal" href="../../applications/aggregation/"><em>Aggregation Framework</em></a></li>
<li><a class="reference internal" href="../aggregation/"><em>Aggregation Framework Reference</em></a></li>
<li><a class="reference internal" href="../../tutorial/aggregation-examples/"><em>Aggregation Framework Examples</em></a></li>
</ul>
</dd></dl>

</div>
<div class="section" id="replication-commands">
<h3>Replication Commands<a class="headerlink" href="#replication-commands" title="Permalink to this headline">¶</a></h3>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">&#8220;<a class="reference internal" href="../../core/replication/"><em>Replication Fundamentals</em></a>&#8221; for more information regarding
replication.</p>
</div>
<dl class="dbcommand">
<dt id="resync">
<tt class="descname">resync</tt><a class="headerlink" href="#resync" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="../replica-commands/#resync" title="resync"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">resync</span></tt></a> command forces an out-of-date slave
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> instance to re-synchronize itself. Note
that this command is relevant to master-slave replication only. It does
no apply to replica sets.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This command obtains a global write lock and will block other
operations until it has completed.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="replSetFreeze">
<tt class="descname">replSetFreeze</tt><a class="headerlink" href="#replSetFreeze" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="../replica-commands/#replSetFreeze" title="replSetFreeze"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetFreeze</span></tt></a> command prevents a replica set
member from seeking election for the specified number of
seconds. Use this command in conjunction with the
<a class="reference internal" href="../command/replSetStepDown/#replSetStepDown" title="replSetStepDown"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetStepDown</span></tt></a> command to make a different node in
the replica set a primary.</p>
<p>The <a class="reference internal" href="../replica-commands/#replSetFreeze" title="replSetFreeze"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetFreeze</span></tt></a> command uses the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">replSetFreeze</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">seconds</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>If you want to unfreeze a replica set member before the specified number
of seconds has elapsed, you can issue the command with a seconds
value of <tt class="docutils literal"><span class="pre">0</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">replSetFreeze</span><span class="o">:</span> <span class="mi">0</span> <span class="p">}</span>
</pre></div>
</div>
<p>Restarting the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> process also unfreezes a replica
set member.</p>
<p><a class="reference internal" href="../replica-commands/#replSetFreeze" title="replSetFreeze"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetFreeze</span></tt></a> is an administrative command, and you
must issue the it against the <a class="reference internal" href="../glossary/#term-admin-database"><em class="xref std std-term">admin database</em></a>.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="replSetGetStatus">
<tt class="descname">replSetGetStatus</tt><a class="headerlink" href="#replSetGetStatus" title="Permalink to this definition">¶</a></dt>
<dd><p>The <tt class="docutils literal"><span class="pre">replSetGetStatus</span></tt> command returns the status of the replica
set from the point of view of the current server. You must run the
command against the <a class="reference internal" href="../glossary/#term-admin-database"><em class="xref std std-term">admin database</em></a>. The command has the following
prototype format:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">replSetGetStatus</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>However, you can also run this command from the shell like so:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">rs</span><span class="p">.</span><span class="nx">status</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">&#8220;<a class="reference internal" href="../replica-status/"><em>Replica Set Status Reference</em></a>&#8221; and &#8220;<a class="reference internal" href="../../core/replication/"><em>Replication Fundamentals</em></a>&#8220;</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="replSetInitiate">
<tt class="descname">replSetInitiate</tt><a class="headerlink" href="#replSetInitiate" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="../replica-commands/#replSetInitiate" title="replSetInitiate"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetInitiate</span></tt></a> command initializes a new replica set. Use the
following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">replSetInitiate</span> <span class="o">:</span> <span class="o">&lt;</span><span class="nx">config_document</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">&lt;config_document&gt;</span></tt> is a <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a> that specifies
the replica set&#8217;s configuration. For instance, here&#8217;s a config document
for creating a simple 3-member replica set:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="nx">_id</span> <span class="o">:</span> <span class="o">&lt;</span><span class="nx">setname</span><span class="o">&gt;</span><span class="p">,</span>
     <span class="nx">members</span> <span class="o">:</span> <span class="p">[</span>
         <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">host</span> <span class="o">:</span> <span class="o">&lt;</span><span class="nx">host0</span><span class="o">&gt;</span><span class="p">},</span>
         <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">host</span> <span class="o">:</span> <span class="o">&lt;</span><span class="nx">host1</span><span class="o">&gt;</span><span class="p">},</span>
         <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">host</span> <span class="o">:</span> <span class="o">&lt;</span><span class="nx">host2</span><span class="o">&gt;</span><span class="p">},</span>
     <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A typical way of running this command is to assign the config document to
a variable and then to pass the document to the
<a class="reference internal" href="../replica-commands/#rs.initiate" title="rs.initiate"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">rs.initiate()</span></tt></a> helper:</p>
<div class="highlight-javascript"><pre>  config = {
      _id : "my_replica_set",
       members : [
           {_id : 0, host : "rs1.example.net:27017"},
           {_id : 1, host : "rs2.example.net:27017"},
           {_id : 2, host : "rs3.example.net", arbiterOnly: true},
       ]
  }

  rs.initiate(config)

Notice that omitting the port cause the host to use the default port
of 27017. Notice also that you can specify other options in the config
documents such as the ``arbiterOnly`` setting in this example.</pre>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">&#8220;<a class="reference internal" href="../replica-configuration/"><em>Replica Set Configuration</em></a>,&#8221;
&#8220;<a class="reference internal" href="../../administration/replica-sets/"><em>Replica Set Administration</em></a>,&#8221; and &#8220;<a class="reference internal" href="../replica-configuration/#replica-set-reconfiguration-usage"><em>Replica Set
Reconfiguration</em></a>.&#8221;</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="replSetReconfig">
<tt class="descname">replSetReconfig</tt><a class="headerlink" href="#replSetReconfig" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="../replica-commands/#replSetReconfig" title="replSetReconfig"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetReconfig</span></tt></a> command modifies the configuration
of an existing replica set. You can use this command to add and
remove members, and to alter the options set on existing
members. Use the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">replSetReconfig</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">new_config_document</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">force</span><span class="o">:</span> <span class="kc">false</span> <span class="p">}</span>
</pre></div>
</div>
<p>You may also run the command using the shell&#8217;s <a class="reference internal" href="../replica-commands/#rs.reconfig" title="rs.reconfig"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">rs.reconfig()</span></tt></a> method.</p>
<p>Be aware of the following <a class="reference internal" href="../replica-commands/#replSetReconfig" title="replSetReconfig"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetReconfig</span></tt></a> behaviors:</p>
<ul>
<li><p class="first">You must issue this command against the <a class="reference internal" href="../glossary/#term-admin-database"><em class="xref std std-term">admin database</em></a> of the current
primary member of the replica set.</p>
</li>
<li><p class="first">You can optionally force the replica set to accept the new
configuration by specifying <tt class="docutils literal"><span class="pre">force:</span> <span class="pre">true</span></tt>. Use this option if
the current member is not primary or if a majority of the members
of the set are not accessible.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Forcing the <a class="reference internal" href="../replica-commands/#replSetReconfig" title="replSetReconfig"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetReconfig</span></tt></a> command can lead to a
<a class="reference internal" href="../glossary/#term-rollback"><em class="xref std std-term">rollback</em></a> situation. Use with caution.</p>
</div>
<p>Use the force option to restore a replica set to new servers with
different hostnames. This works even if the set members already
have a copy of the data.</p>
</li>
<li><p class="first">A majority of the set&#8217;s members must be operational for the
changes to propagate properly.</p>
</li>
<li><p class="first">This command can cause downtime as the set renegotiates
primary-status. Typically this is 10-20 seconds, but could
be as long as a minute or more. Therefore, you should attempt
to reconfigure only during scheduled maintenance periods.</p>
</li>
<li><p class="first">In some cases, <a class="reference internal" href="../replica-commands/#replSetReconfig" title="replSetReconfig"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetReconfig</span></tt></a> forces the current
primary to step down, initiating an election for primary among
the members of the replica set. When this happens, the set will
drop all current connections.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference internal" href="../replica-commands/#replSetReconfig" title="replSetReconfig"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetReconfig</span></tt></a> obtains a special mutually
exclusive lock to prevent more than one
:dbcommand`replSetReconfig` operation from occurring at the same
time.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="replSetSyncFrom">
<tt class="descname">replSetSyncFrom</tt><a class="headerlink" href="#replSetSyncFrom" title="Permalink to this definition">¶</a></dt>
<dd><p class="versionadded">
<span class="versionmodified">New in version 2.2.</span></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Options:</th><td class="field-body"><ul class="first last simple">
<li><strong>host</strong> &#8211; Specifies the name and port number of the set member
that you want <em>this</em> member to sync from. Use
the <tt class="docutils literal"><span class="pre">[hostname]:[port]</span></tt> form.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="../replica-commands/#replSetSyncFrom" title="replSetSyncFrom"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetSyncFrom</span></tt></a> allows you to explicitly configure
which host the current <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> will poll <a class="reference internal" href="../glossary/#term-oplog"><em class="xref std std-term">oplog</em></a>
entries from. This operation may be useful for testing different
patterns and in situations where a set member is not syncing from
the host you want. The member to sync from must be a valid
source for data in the set; a member of a replica set cannot sync from:</p>
<ul class="simple">
<li>itself.</li>
<li>an arbiter, because arbiters do not hold data.</li>
<li>a member that does not build indexes.</li>
<li>an unreachable member.</li>
<li>a <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> instance that is not a member of the same
replica set.</li>
</ul>
<p>If you attempt to sync from a member that is more than 10 seconds
behind the current member, <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> will return and log a
warning, but <em>will</em> sync from such members.</p>
<p>The command has the following prototype form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">replSetSyncFrom</span><span class="o">:</span> <span class="s2">&quot;[hostname]:[port]&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>To run the command in the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell, use the following
invocation:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">adminCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">replSetSyncFrom</span><span class="o">:</span> <span class="s2">&quot;[hostname]:[port]&quot;</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>You may also use the <a class="reference internal" href="../replica-commands/#rs.syncFrom" title="rs.syncFrom"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">rs.syncFrom()</span></tt></a> helper in the
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell, in an operation with the following form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">rs</span><span class="p">.</span><span class="nx">syncFrom</span><span class="p">(</span><span class="s2">&quot;[hostname]:[port]&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference internal" href="../replica-commands/#replSetSyncFrom" title="replSetSyncFrom"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetSyncFrom</span></tt></a> provides a temporary override of
default behavior. When you restart the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt>
instance, if the connection that the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> uses to
sync, the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> will revert to the default logic for
selecting a sync source.</p>
</div>
</dd></dl>

</div>
<div class="section" id="geospatial-commands">
<h3>Geospatial Commands<a class="headerlink" href="#geospatial-commands" title="Permalink to this headline">¶</a></h3>
<dl class="dbcommand">
<dt id="geoNear">
<tt class="descname">geoNear</tt><a class="headerlink" href="#geoNear" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#geoNear" title="geoNear"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">geoNear</span></tt></a> command provides an alternative to the
<a class="reference internal" href="../operators/#_S_near" title="$near"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">$near</span></tt></a> operator. In addition to the
functionality of <a class="reference internal" href="../operators/#_S_near" title="$near"><tt class="xref mongodb mongodb-operator docutils literal"><span class="pre">$near</span></tt></a>, <a class="reference internal" href="#geoNear" title="geoNear"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">geoNear</span></tt></a> returns the distance of
each item from the specified point along with additional diagnostic
information. For example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">geoNear</span> <span class="o">:</span> <span class="s2">&quot;places&quot;</span> <span class="p">,</span> <span class="nx">near</span> <span class="o">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span> <span class="nx">num</span> <span class="o">:</span> <span class="mi">10</span> <span class="p">}</span>
</pre></div>
</div>
<p>Here, <a class="reference internal" href="#geoNear" title="geoNear"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">geoNear</span></tt></a> returns the 10 items nearest to the
coordinates <tt class="docutils literal"><span class="pre">[50,50]</span></tt> in the collection named
<tt class="docutils literal"><span class="pre">places</span></tt>. <cite>geoNear</cite> provides the following options (specify all
distances in the same units as the document coordinate system:)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Fields:</th><td class="field-body"><ul class="first last simple">
<li><strong>near</strong> &#8211; Takes the coordinates (e.g. <tt class="docutils literal"><span class="pre">[</span> <span class="pre">x,</span> <span class="pre">y</span> <span class="pre">]</span></tt>) to use as
the center of a geospatial query.</li>
<li><strong>num</strong> &#8211; Optional. Specifies the maximum number of documents to
return. The default value is 100.</li>
<li><strong>maxDistance</strong> &#8211; Optional. Limits the results to those falling within
a given distance of the center coordinate.</li>
<li><strong>query</strong> &#8211; Optional. Further narrows the results using any standard
MongoDB query operator or selection. See <a class="reference internal" href="../method/db.collection.find/#db.collection.find" title="db.collection.find"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.find()</span></tt></a>
and &#8220;<a class="reference internal" href="../operators/"><em>Operator Reference</em></a>&#8221; for more
information.</li>
<li><strong>spherical</strong> &#8211; Optional. Default: <tt class="docutils literal"><span class="pre">false</span></tt>. When <tt class="docutils literal"><span class="pre">true</span></tt>
MongoDB will return the query as if the
coordinate system references points on a
spherical plane rather than a plane.</li>
<li><strong>distanceMultiplier</strong> &#8211; <p>Optional. Specifies a factor to multiply
all distances returned by
<a class="reference internal" href="#geoNear" title="geoNear"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">geoNear</span></tt></a>. For example, use
<tt class="docutils literal"><span class="pre">distanceMultiplier</span></tt> to convert from
spherical queries returned in radians to
linear units (i.e. miles or kilometers)
by multiplying by the radius of the
Earth.</p>
<span class="target" id="index-1"></span></li>
<li><strong>includeLocs</strong> &#8211; Optional. Default: <tt class="docutils literal"><span class="pre">false</span></tt>. When specified
<tt class="docutils literal"><span class="pre">true</span></tt>, the query will return the location of
the matching documents in the result.</li>
<li><strong>uniqueDocs</strong> &#8211; Optional. Default <tt class="docutils literal"><span class="pre">true</span></tt>. The default settings
will only return a matching document once, even
if more than one of its location fields match
the query. When <tt class="docutils literal"><span class="pre">false</span></tt> the query will return
documents with multiple matching location fields
more than once. See <a class="reference internal" href="../operators/#_S_uniqueDocs" title="$uniqueDocs"><tt class="xref mongodb mongodb-operator docutils literal"><span class="pre">$uniqueDocs</span></tt></a> for
more information on this option</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="dbcommand">
<dt id="geoSearch">
<tt class="descname">geoSearch</tt><a class="headerlink" href="#geoSearch" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#geoSearch" title="geoSearch"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">geoSearch</span></tt></a> command provides an interface to
MongoDB&#8217;s <a class="reference internal" href="../glossary/#term-haystack-index"><em class="xref std std-term">haystack index</em></a> functionality. These indexes are
useful for returning results based on location coordinates <em>after</em>
collecting results based on some other query (i.e. a &#8220;haystack.&#8221;)
Consider the following example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">geoSearch</span> <span class="o">:</span> <span class="s2">&quot;places&quot;</span><span class="p">,</span> <span class="nx">near</span> <span class="o">:</span> <span class="p">[</span><span class="mi">33</span><span class="p">,</span> <span class="mi">33</span><span class="p">],</span> <span class="nx">maxDistance</span> <span class="o">:</span> <span class="mi">6</span><span class="p">,</span> <span class="nx">search</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">type</span> <span class="o">:</span> <span class="s2">&quot;restaurant&quot;</span> <span class="p">},</span> <span class="nx">limit</span> <span class="o">:</span> <span class="mi">30</span> <span class="p">}</span>
</pre></div>
</div>
<p>The above command returns all documents with a <tt class="docutils literal"><span class="pre">type</span></tt> of
<tt class="docutils literal"><span class="pre">restaurant</span></tt> having a maximum distance of 6 units from the
coordinates <tt class="docutils literal"><span class="pre">[30,33]</span></tt> in the collection <tt class="docutils literal"><span class="pre">places</span></tt> up to a
maximum of 30 results.</p>
<p>Unless specified otherwise, the <a class="reference internal" href="#geoSearch" title="geoSearch"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">geoSearch</span></tt></a> command
limits results to 50 documents.</p>
</dd></dl>

</div>
<div class="section" id="collection-commands">
<span id="id2"></span><h3>Collection Commands<a class="headerlink" href="#collection-commands" title="Permalink to this headline">¶</a></h3>
<dl class="dbcommand">
<dt id="drop">
<tt class="descname">drop</tt><a class="headerlink" href="#drop" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#drop" title="drop"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">drop</span></tt></a> command removes an entire collection from a
database. The command has following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">drop</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">collection_name</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell provides the equivalent helper
method:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">drop</span><span class="p">();</span>
</pre></div>
</div>
<p>Note that this command also removes any indexes associated with the
dropped collection.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This command obtains a write lock on the affected database and
will block other operations until it has completed.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="cloneCollection">
<tt class="descname">cloneCollection</tt><a class="headerlink" href="#cloneCollection" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#cloneCollection" title="cloneCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">cloneCollection</span></tt></a> command copies a collection from a
remote server to the server where you run the command.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>from</strong> &#8211; Specify a resolvable hostname, and optional port number
of the remote server where the specified collection resides.</li>
<li><strong>query</strong> &#8211; Optional. A query document, in the form of a
<a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a>, that filters the documents
in the remote collection that
<a class="reference internal" href="#cloneCollection" title="cloneCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">cloneCollection</span></tt></a> will copy to the
current database. See <a class="reference internal" href="../method/db.collection.find/#db.collection.find" title="db.collection.find"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.find()</span></tt></a>.</li>
<li><strong>copyIndexes</strong> (<em>Boolean</em>) &#8211; Optional. <tt class="docutils literal"><span class="pre">true</span></tt> by default. When set
to <tt class="docutils literal"><span class="pre">false</span></tt> the indexes on the
originating server are <em>not</em> copied with
the documents in the collection.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Consider the following example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">cloneCollection</span><span class="o">:</span> <span class="s2">&quot;users&quot;</span><span class="p">,</span> <span class="nx">from</span><span class="o">:</span> <span class="s2">&quot;db.example.net:27017&quot;</span><span class="p">,</span> <span class="nx">query</span><span class="o">:</span> <span class="p">{</span> <span class="nx">active</span><span class="o">:</span> <span class="kc">true</span> <span class="p">},</span> <span class="nx">copyIndexes</span><span class="o">:</span> <span class="kc">false</span> <span class="p">}</span>
</pre></div>
</div>
<p>This operation copies the &#8220;users&#8221; collection from the current
database on the server at <tt class="docutils literal"><span class="pre">db.example.net</span></tt>. The operation only
copies documents that satisfy the query <tt class="docutils literal"><span class="pre">{</span> <span class="pre">active:</span> <span class="pre">true</span> <span class="pre">}</span></tt> and
does not copy indexes. <a class="reference internal" href="#cloneCollection" title="cloneCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">cloneCollection</span></tt></a> copies indexes
by default, but you can disable this behavior by setting <tt class="docutils literal"><span class="pre">{</span>
<span class="pre">copyIndexes:</span> <span class="pre">false</span> <span class="pre">}</span></tt>. The <tt class="docutils literal"><span class="pre">query</span></tt> and <tt class="docutils literal"><span class="pre">copyIndexes</span></tt>
arguments are optional.</p>
<p><a class="reference internal" href="#cloneCollection" title="cloneCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">cloneCollection</span></tt></a> creates a collection on the current
database with the same name as the origin collection. If, in the
above example, the <tt class="docutils literal"><span class="pre">users</span></tt> collection already exists, then
MongoDB appends documents in the remote collection to the
destination collection.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="create">
<tt class="descname">create</tt><a class="headerlink" href="#create" title="Permalink to this definition">¶</a></dt>
<dd><p>The <tt class="docutils literal"><span class="pre">create</span></tt> command explicitly creates a collection. The command
uses the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">create</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">collection_name</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>To create a <a class="reference internal" href="../glossary/#term-capped-collection"><em class="xref std std-term">capped collection</em></a> limited to 40 KB, issue command in
the following form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">create</span><span class="o">:</span> <span class="s2">&quot;collection&quot;</span><span class="p">,</span> <span class="nx">capped</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">size</span><span class="o">:</span> <span class="mi">40</span> <span class="o">*</span> <span class="mi">1024</span> <span class="p">}</span>
</pre></div>
</div>
<p>The options for creating capped collections are:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Options:</th><td class="field-body"><ul class="first last simple">
<li><strong>capped</strong> &#8211; Specify <tt class="docutils literal"><span class="pre">true</span></tt> to create a <a class="reference internal" href="../glossary/#term-capped-collection"><em class="xref std std-term">capped collection</em></a>.</li>
<li><strong>autoIndexId</strong> &#8211; Specify <tt class="docutils literal"><span class="pre">false</span></tt> to disable the automatic
index created on the <tt class="docutils literal"><span class="pre">_id</span></tt> field. Before
2.2, the default value for <tt class="docutils literal"><span class="pre">autoIndexId</span></tt> was
<tt class="docutils literal"><span class="pre">false</span></tt>. See <a class="reference internal" href="../../release-notes/2.2/#id-indexes-capped-collections"><em>_id Fields and Indexes on Capped Collections</em></a>
for more information.</li>
<li><strong>size</strong> &#8211; The maximum size for the capped collection. Once a
capped collection reaches its max size, MongoDB will
drop old documents from the database to make way for
the new documents. You must specify a <tt class="docutils literal"><span class="pre">size</span></tt>
argument for all capped collections.</li>
<li><strong>max</strong> &#8211; The maximum number of documents to preserve in the
capped collection. This limit is subject to the
overall size of the capped collection. If a capped
collection reaches its maximum size before it contains
the maximum number of documents, the database will
remove old documents. Thus, if you use this option,
ensure that the total size for the capped collection
is sufficient to contain the max.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The <a class="reference internal" href="../method/db.createCollection/#db.createCollection" title="db.createCollection"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.createCollection()</span></tt></a> provides a wrapper function that
provides access to this functionality.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This command obtains a write lock on the affected database and
will block other operations until it has completed. The write
lock for this operation is typically short lived; however,
allocations for large capped collections may take longer.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="convertToCapped">
<tt class="descname">convertToCapped</tt><a class="headerlink" href="#convertToCapped" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#convertToCapped" title="convertToCapped"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">convertToCapped</span></tt></a> command converts an existing,
non-capped collection to a <a class="reference internal" href="../glossary/#term-capped-collection"><em class="xref std std-term">capped collection</em></a> within the same
database.</p>
<p>The command has the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span><span class="nx">convertToCapped</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">collection</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">size</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">capped</span> <span class="nx">size</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p><a class="reference internal" href="#convertToCapped" title="convertToCapped"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">convertToCapped</span></tt></a> takes an existing collection
(<tt class="docutils literal"><span class="pre">&lt;collection&gt;</span></tt>) and transforms it into a capped collection with
a maximum size in bytes, specified to the <tt class="docutils literal"><span class="pre">size</span></tt> argument
(<tt class="docutils literal"><span class="pre">&lt;capped</span> <span class="pre">size&gt;</span></tt>).</p>
<p>During the conversion process, the <a class="reference internal" href="#convertToCapped" title="convertToCapped"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">convertToCapped</span></tt></a>
command exhibit the following behavior:</p>
<ul class="simple">
<li>MongoDB transverses the documents in the original collection in
<a class="reference internal" href="../glossary/#term-natural-order"><em class="xref std std-term">natural order</em></a> and loads the documents into a new
capped collection.</li>
<li>If the <tt class="docutils literal"><span class="pre">capped</span> <span class="pre">size</span></tt> specified for the capped collection is
smaller than the size of the original uncapped collection, then
MongoDB will overwrite documents in the capped collection based
on insertion order, or <em>first in, first out</em> order.</li>
<li>Internally, to convert the collection, MongoDB uses the following
procedure<ul>
<li><a class="reference internal" href="#cloneCollectionAsCapped" title="cloneCollectionAsCapped"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">cloneCollectionAsCapped</span></tt></a> command creates the capped
collection and imports the data.</li>
<li>MongoDB drops the original collection.</li>
<li><a class="reference internal" href="#renameCollection" title="renameCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">renameCollection</span></tt></a> renames the new capped collection
to the name of the original collection.</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">MongoDB does not support the <a class="reference internal" href="#convertToCapped" title="convertToCapped"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">convertToCapped</span></tt></a>
command in a sharded cluster.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <a class="reference internal" href="#convertToCapped" title="convertToCapped"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">convertToCapped</span></tt></a> will not recreate indexes from
the original collection on the new collection. If you need
indexes on this collection you will need to create these indexes
after the conversion is complete.</p>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="#create" title="create"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">create</span></tt></a></p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This command obtains a global write lock and will block other
operations until it has completed.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="cloneCollectionAsCapped">
<tt class="descname">cloneCollectionAsCapped</tt><a class="headerlink" href="#cloneCollectionAsCapped" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#cloneCollectionAsCapped" title="cloneCollectionAsCapped"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">cloneCollectionAsCapped</span></tt></a> command creates a new
<a class="reference internal" href="../glossary/#term-capped-collection"><em class="xref std std-term">capped collection</em></a> from an existing, non-capped collection
within the same database. The operation does not affect the
original non-capped collection.</p>
<p>The command has the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">cloneCollectionAsCapped</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">existing</span> <span class="nx">collection</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">toCollection</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">capped</span> <span class="nx">collection</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">size</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">capped</span> <span class="nx">size</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The command copies an <tt class="docutils literal"><span class="pre">existing</span> <span class="pre">collection</span></tt> and creates a new
<tt class="docutils literal"><span class="pre">capped</span> <span class="pre">collection</span></tt> with a maximum size specified by the <tt class="docutils literal"><span class="pre">capped</span>
<span class="pre">size</span></tt> in bytes. The name of the new capped collection must be
distinct and cannot be the same as that of the original existing
collection. To replace the original non-capped collection with a
capped collection, use the <a class="reference internal" href="#convertToCapped" title="convertToCapped"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">convertToCapped</span></tt></a> command.</p>
<p>During the cloning, the <a class="reference internal" href="#cloneCollectionAsCapped" title="cloneCollectionAsCapped"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">cloneCollectionAsCapped</span></tt></a> command
exhibit the following behavior:</p>
<ul class="simple">
<li>MongoDB will transverse the documents in the original collection
in <a class="reference internal" href="../glossary/#term-natural-order"><em class="xref std std-term">natural order</em></a> as they&#8217;re loaded.</li>
<li>If the <tt class="docutils literal"><span class="pre">capped</span> <span class="pre">size</span></tt> specified for the new collection is
smaller than the size of the original uncapped collection, then
MongoDB will begin overwriting earlier documents in
insertion order, which is <em>first in, first out</em> (e.g &#8220;FIFO&#8221;).</li>
</ul>
</dd></dl>

<dl class="dbcommand">
<dt id="emptycapped">
<tt class="descname">emptycapped</tt><a class="headerlink" href="#emptycapped" title="Permalink to this definition">¶</a></dt>
<dd><p>The <tt class="docutils literal"><span class="pre">emptycapped</span></tt> command removes all documents from a capped
collection. Use the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">emptycapped</span><span class="o">:</span> <span class="s2">&quot;events&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This command removes all records from the capped collection named
<tt class="docutils literal"><span class="pre">events</span></tt>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This command obtains a write lock on the affected database and
will block other operations until it has completed.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="collStats">
<tt class="descname">collStats</tt><a class="headerlink" href="#collStats" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#collStats" title="collStats"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">collStats</span></tt></a> command returns a variety of storage statistics
for a given collection. Use the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">collStats</span><span class="o">:</span> <span class="s2">&quot;database.collection&quot;</span> <span class="p">,</span> <span class="nx">scale</span> <span class="o">:</span> <span class="mi">1024</span> <span class="p">}</span>
</pre></div>
</div>
<p>Specify a namespace <tt class="docutils literal"><span class="pre">database.collection</span></tt> and
use the <tt class="docutils literal"><span class="pre">scale</span></tt> argument to scale the output. The above example
will display values in kilobytes.</p>
<p>Examine the following example output, which uses the
<a class="reference internal" href="../method/db.collection.stats/#db.collection.stats" title="db.collection.stats"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.stats()</span></tt></a> helper in the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">stats</span><span class="p">()</span>
<span class="p">{</span>
        <span class="s2">&quot;ns&quot;</span> <span class="o">:</span> <span class="s2">&quot;app.users&quot;</span><span class="p">,</span>             <span class="c1">// namespace</span>
        <span class="s2">&quot;count&quot;</span> <span class="o">:</span> <span class="mi">9</span><span class="p">,</span>                    <span class="c1">// number of documents</span>
        <span class="s2">&quot;size&quot;</span> <span class="o">:</span> <span class="mi">432</span><span class="p">,</span>                   <span class="c1">// collection size in bytes</span>
        <span class="s2">&quot;avgObjSize&quot;</span> <span class="o">:</span> <span class="mi">48</span><span class="p">,</span>              <span class="c1">// average object size in bytes</span>
        <span class="s2">&quot;storageSize&quot;</span> <span class="o">:</span> <span class="mi">3840</span><span class="p">,</span>           <span class="c1">// (pre)allocated space for the collection</span>
        <span class="s2">&quot;numExtents&quot;</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>               <span class="c1">// number of extents (contiguously allocated chunks of datafile space)</span>
        <span class="s2">&quot;nindexes&quot;</span> <span class="o">:</span> <span class="mi">2</span><span class="p">,</span>                 <span class="c1">// number of indexes</span>
        <span class="s2">&quot;lastExtentSize&quot;</span> <span class="o">:</span> <span class="mi">3840</span><span class="p">,</span>        <span class="c1">// size of the most recently created extent</span>
        <span class="s2">&quot;paddingFactor&quot;</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>            <span class="c1">// padding can speed up updates if documents grow</span>
        <span class="s2">&quot;flags&quot;</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;totalIndexSize&quot;</span> <span class="o">:</span> <span class="mi">16384</span><span class="p">,</span>       <span class="c1">// total index size in bytes</span>
        <span class="s2">&quot;indexSizes&quot;</span> <span class="o">:</span> <span class="p">{</span>                <span class="c1">// size of specific indexes in bytes</span>
                <span class="s2">&quot;_id_&quot;</span> <span class="o">:</span> <span class="mi">8192</span><span class="p">,</span>
                <span class="s2">&quot;username&quot;</span> <span class="o">:</span> <span class="mi">8192</span>
        <span class="p">},</span>
        <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The scale factor rounds values to whole numbers. This can
produce unpredictable and unexpected results in some situations.</p>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">&#8220;<a class="reference internal" href="../collection-statistics/"><em>Collection Statistics Reference</em></a>.&#8221;</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="renameCollection">
<tt class="descname">renameCollection</tt><a class="headerlink" href="#renameCollection" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#renameCollection" title="renameCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">renameCollection</span></tt></a> command is an administrative
command that changes the name of an existing collection. You
specify collections to <a class="reference internal" href="#renameCollection" title="renameCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">renameCollection</span></tt></a> in the form of
a complete <a class="reference internal" href="../glossary/#term-namespace"><em class="xref std std-term">namespace</em></a>, which includes the database name. To
rename a collection, issue the <a class="reference internal" href="#renameCollection" title="renameCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">renameCollection</span></tt></a>
command against the <a class="reference internal" href="../glossary/#term-admin-database"><em class="xref std std-term">admin database</em></a> in the form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">renameCollection</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">source</span><span class="o">-</span><span class="nx">namespace</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">to</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">target</span><span class="o">-</span><span class="nx">namespace</span><span class="o">&gt;</span><span class="p">[,</span> <span class="nx">dropTarget</span><span class="o">:</span> <span class="o">&lt;</span><span class="kr">boolean</span><span class="o">&gt;</span> <span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">dropTarget</span></tt> argument is optional.</p>
<p>If you specify a collection to the <tt class="docutils literal"><span class="pre">to</span></tt> argument in a different database, the
<a class="reference internal" href="#renameCollection" title="renameCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">renameCollection</span></tt></a> command will copy the collection to the new
database and then drop the source collection.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>source-namespace</strong> &#8211; Specifies the complete namespace of the collection to rename.</li>
<li><strong>to</strong> (<em>string</em>) &#8211; Specifies the new namespace of the collection.</li>
<li><strong>dropTarget</strong> (<em>boolean</em>) &#8211; Optional. If <tt class="docutils literal"><span class="pre">true</span></tt>, <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> will drop the
<tt class="docutils literal"><span class="pre">target</span></tt> of <a class="reference internal" href="#renameCollection" title="renameCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">renameCollection</span></tt></a> prior to renaming
the collection.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Exception:</th><td class="field-body"><ul class="first last simple">
<li><strong>10026</strong> &#8211; Raised if the <tt class="docutils literal"><span class="pre">source</span></tt> namespace does not exist.</li>
<li><strong>10027</strong> &#8211; Raised if the <tt class="docutils literal"><span class="pre">target</span></tt> namespace exists
and <tt class="docutils literal"><span class="pre">dropTarget</span></tt> is either <tt class="docutils literal"><span class="pre">false</span></tt> or unspecified.</li>
<li><strong>15967</strong> &#8211; Raised if the <tt class="docutils literal"><span class="pre">target</span></tt> namespace is an invalid
collection name.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>You can use <a class="reference internal" href="#renameCollection" title="renameCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">renameCollection</span></tt></a> in production
environments; however:</p>
<ul class="simple">
<li><a class="reference internal" href="#renameCollection" title="renameCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">renameCollection</span></tt></a> will block all database activity
for the duration of the operation.</li>
<li><a class="reference internal" href="#renameCollection" title="renameCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">renameCollection</span></tt></a> is incompatible with sharded
collections.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><a class="reference internal" href="#renameCollection" title="renameCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">renameCollection</span></tt></a> will fail if
<cite>target</cite> is the name of an existing collection
and you do not specify <tt class="docutils literal"><span class="pre">dropTarget:</span> <span class="pre">true</span></tt>.</p>
<p class="last">If the <a class="reference internal" href="#renameCollection" title="renameCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">renameCollection</span></tt></a> operation does not complete
the <tt class="docutils literal"><span class="pre">target</span></tt> collection and indexes will not be usable and
will require manual intervention to clean up.</p>
</div>
<p>The shell helper <a class="reference internal" href="../method/db.collection.renameCollection/#db.collection.renameCollection" title="db.collection.renameCollection"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.renameCollection()</span></tt></a> provides a
simpler interface to using this command within a database.
The following is equivalent to the previous example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">source</span><span class="o">-</span><span class="nx">namespace</span><span class="p">.</span><span class="nx">renameCollection</span><span class="p">(</span> <span class="s2">&quot;target&quot;</span> <span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">You cannot use <a class="reference internal" href="#renameCollection" title="renameCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">renameCollection</span></tt></a> with
sharded collections.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This command obtains a global write lock and will block other
operations until it has completed.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="collMod">
<tt class="descname">collMod</tt><a class="headerlink" href="#collMod" title="Permalink to this definition">¶</a></dt>
<dd><p class="versionadded">
<span class="versionmodified">New in version 2.2.</span></p>
<p><a class="reference internal" href="#collMod" title="collMod"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">collMod</span></tt></a> makes it possible to add flags to a collection
to modify the behavior of MongoDB. In the current release the only
available flag is <a class="reference internal" href="#usePowerOf2Sizes" title="usePowerOf2Sizes"><tt class="xref mongodb mongodb-collflag docutils literal"><span class="pre">usePowerOf2Sizes</span></tt></a>. The command takes the
following prototype form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;collMod&quot;</span> <span class="o">:</span> <span class="o">&lt;</span><span class="nx">collection</span><span class="o">&gt;</span> <span class="p">,</span> <span class="s2">&quot;&lt;flag&gt;&quot;</span> <span class="o">:</span> <span class="o">&lt;</span><span class="nx">value</span><span class="o">&gt;</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>In this command substitute <tt class="docutils literal"><span class="pre">&lt;collection&gt;</span></tt> with the name of a
collection in the current database, and <tt class="docutils literal"><span class="pre">&lt;flag&gt;</span></tt> and <tt class="docutils literal"><span class="pre">&lt;value&gt;</span></tt>
with the flag and value you want to set.</p>
<span class="target" id="index-2"></span><span class="target" id="usepowerof2sizes"><span id="index-3"></span></span><dl class="collflag">
<dt id="usePowerOf2Sizes">
<tt class="descname">usePowerOf2Sizes</tt><a class="headerlink" href="#usePowerOf2Sizes" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#usePowerOf2Sizes" title="usePowerOf2Sizes"><tt class="xref mongodb mongodb-collflag docutils literal"><span class="pre">usePowerOf2Sizes</span></tt></a> flag changes the method that
MongoDB uses to allocate space on disk for documents in this
collection. By setting <a class="reference internal" href="#usePowerOf2Sizes" title="usePowerOf2Sizes"><tt class="xref mongodb mongodb-collflag docutils literal"><span class="pre">usePowerOf2Sizes</span></tt></a>, you ensure
that MongoDB will allocate space for documents in sizes that
are powers of 2 (e.g. 4, 8, 16, 32, 64, 128, 256, 512...8388608).
With this option MongoDB will be able to more effectively reuse
space.</p>
<p><a class="reference internal" href="#usePowerOf2Sizes" title="usePowerOf2Sizes"><tt class="xref mongodb mongodb-collflag docutils literal"><span class="pre">usePowerOf2Sizes</span></tt></a> is useful for collections where you
will be inserting and deleting large numbers of documents to
ensure that MongoDB will effectively use space on disk.</p>
<div class="admonition-example admonition">
<p class="first admonition-title">Example</p>
<p>To enable <a class="reference internal" href="#usePowerOf2Sizes" title="usePowerOf2Sizes"><tt class="xref mongodb mongodb-collflag docutils literal"><span class="pre">usePowerOf2Sizes</span></tt></a> on the collection
named <tt class="docutils literal"><span class="pre">sensor_readings</span></tt>, use the following operation:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">({</span><span class="nx">collMod</span><span class="o">:</span> <span class="s2">&quot;sensor_readings&quot;</span><span class="p">,</span> <span class="nx">usePowerOf2Sizes</span><span class="o">:</span><span class="kc">true</span> <span class="p">})</span>
</pre></div>
</div>
<p>To disable <a class="reference internal" href="#usePowerOf2Sizes" title="usePowerOf2Sizes"><tt class="xref mongodb mongodb-collflag docutils literal"><span class="pre">usePowerOf2Sizes</span></tt></a> on the collection
<tt class="docutils literal"><span class="pre">products</span></tt>, use the following operation:</p>
<div class="last highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">collMod</span><span class="o">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="s2">&quot;usePowerOf2Sizes&quot;</span><span class="o">:</span> <span class="kc">false</span> <span class="p">})</span>
</pre></div>
</div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="versionchanged">
<span class="versionmodified">Changed in version 2.2.1: </span><a class="reference internal" href="#usePowerOf2Sizes" title="usePowerOf2Sizes"><tt class="xref mongodb mongodb-collflag docutils literal"><span class="pre">usePowerOf2Sizes</span></tt></a> now
supports documents larger than 8 megabytes. If you enable
<a class="reference internal" href="#usePowerOf2Sizes" title="usePowerOf2Sizes"><tt class="xref mongodb mongodb-collflag docutils literal"><span class="pre">usePowerOf2Sizes</span></tt></a> you <strong>must</strong> use at least
version 2.2.1.</p>
<p class="last"><a class="reference internal" href="#usePowerOf2Sizes" title="usePowerOf2Sizes"><tt class="xref mongodb mongodb-collflag docutils literal"><span class="pre">usePowerOf2Sizes</span></tt></a> only affects subsequent
allocations cased by document insertion or record relocation
as a result of document growth, and <em>does not</em> affect
existing allocations.</p>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="administration-commands">
<span id="admin-commands"></span><h3>Administration Commands<a class="headerlink" href="#administration-commands" title="Permalink to this headline">¶</a></h3>
<dl class="dbcommand">
<dt id="touch">
<tt class="descname">touch</tt><a class="headerlink" href="#touch" title="Permalink to this definition">¶</a></dt>
<dd><p class="versionadded">
<span class="versionmodified">New in version 2.2.</span></p>
<p>The <a class="reference internal" href="#touch" title="touch"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">touch</span></tt></a> command loads data from the data storage
layer into memory. <a class="reference internal" href="#touch" title="touch"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">touch</span></tt></a> can load the data
(i.e. documents,) indexes or both documents and indexes. Use this
command to ensure that a collection, and/or its indexes, are in
memory before another operation. By loading the collection or
indexes into memory, <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> will ideally be able to
perform subsequent operations more efficiently. The
<a class="reference internal" href="#touch" title="touch"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">touch</span></tt></a> command has the following prototypical form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">touch</span><span class="o">:</span> <span class="p">[</span><span class="nx">collection</span><span class="p">],</span> <span class="nx">data</span><span class="o">:</span> <span class="p">[</span><span class="kr">boolean</span><span class="p">],</span> <span class="nx">index</span><span class="o">:</span> <span class="p">[</span><span class="kr">boolean</span><span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<p>By default, <tt class="docutils literal"><span class="pre">data</span></tt> and <tt class="docutils literal"><span class="pre">index</span></tt> are false, and
<a class="reference internal" href="#touch" title="touch"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">touch</span></tt></a> will perform no operation. For example, to load
both the data and the index for a collection named <tt class="docutils literal"><span class="pre">records</span></tt>, you
would use the following command in the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">({</span> <span class="nx">touch</span><span class="o">:</span> <span class="s2">&quot;records&quot;</span><span class="p">,</span> <span class="nx">data</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">index</span><span class="o">:</span> <span class="kc">true</span> <span class="p">})</span>
</pre></div>
</div>
<p><a class="reference internal" href="#touch" title="touch"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">touch</span></tt></a> will not block read and write operations on a
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt>, and can run on <a class="reference internal" href="../glossary/#term-secondary"><em class="xref std std-term">secondary</em></a> members of
replica sets.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Using <a class="reference internal" href="#touch" title="touch"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">touch</span></tt></a> to control or tweak what a
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> stores in memory may displace other records
data in memory and hinder performance. Use with caution in
production systems.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="fsync">
<tt class="descname">fsync</tt><a class="headerlink" href="#fsync" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#fsync" title="fsync"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">fsync</span></tt></a> command forces the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> process
to flush all pending writes to the storage layer. <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt>
is always writing data to the storage layer as applications write
more data to the database. MongoDB guarantees that it will write
all data to disk within the <a class="reference internal" href="../configuration-options/#syncdelay" title="syncdelay"><tt class="xref mongodb mongodb-setting docutils literal"><span class="pre">syncdelay</span></tt></a> interval, which is
60 seconds by default.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">fsync</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#fsync" title="fsync"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">fsync</span></tt></a> operation is synchronous by default, to run
<a class="reference internal" href="#fsync" title="fsync"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">fsync</span></tt></a> asynchronously, use the following form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">fsync</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">async</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span>
</pre></div>
</div>
<p>The connection will return immediately. You can check the output of
<a class="reference internal" href="../method/db.currentOp/#db.currentOp" title="db.currentOp"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.currentOp()</span></tt></a> for the status of the <a class="reference internal" href="#fsync" title="fsync"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">fsync</span></tt></a>
operation.</p>
<p>The primary use of <a class="reference internal" href="#fsync" title="fsync"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">fsync</span></tt></a> is to lock the database
during backup operations. This will flush all data to the data
storage layer and block all write operations until you unlock the
database. Consider the following command form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">fsync</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">lock</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You may continue to perform read operations on a database that
has a <a class="reference internal" href="#fsync" title="fsync"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">fsync</span></tt></a> lock. However, following the first
write operation all subsequent read operations wait until
you unlock the database.</p>
</div>
<p>To check on the current state of the fsync lock, use
<a class="reference internal" href="../method/db.currentOp/#db.currentOp" title="db.currentOp"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.currentOp()</span></tt></a>. Use the following JavaScript function in
the shell to test if the database is currently locked:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">serverIsLocked</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                     <span class="kd">var</span> <span class="nx">co</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">currentOp</span><span class="p">();</span>
                     <span class="k">if</span> <span class="p">(</span><span class="nx">co</span> <span class="o">&amp;&amp;</span> <span class="nx">co</span><span class="p">.</span><span class="nx">fsyncLock</span><span class="p">)</span> <span class="p">{</span>
                         <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
                     <span class="p">}</span>
                     <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
                 <span class="p">}</span>
</pre></div>
</div>
<p>After loading this function into your <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell
session you can call it as follows:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">serverIsLocked</span><span class="p">()</span>
</pre></div>
</div>
<p>This function will return <tt class="docutils literal"><span class="pre">true</span></tt> if the database is currently
locked and <tt class="docutils literal"><span class="pre">false</span></tt> if the database is not locked. To unlock the
database, make a request for an unlock using the following command:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">getSiblingDB</span><span class="p">(</span><span class="s2">&quot;admin&quot;</span><span class="p">).</span><span class="nx">$cmd</span><span class="p">.</span><span class="nx">sys</span><span class="p">.</span><span class="nx">unlock</span><span class="p">.</span><span class="nx">findOne</span><span class="p">();</span>
</pre></div>
</div>
<p class="versionadded">
<span class="versionmodified">New in version 1.9.0: </span>The <a class="reference internal" href="../method/db.fsyncLock/#db.fsyncLock" title="db.fsyncLock"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.fsyncLock()</span></tt></a> and <a class="reference internal" href="../method/db.fsyncUnlock/#db.fsyncUnlock" title="db.fsyncUnlock"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.fsyncUnlock()</span></tt></a>
helpers in the shell.</p>
<p>In the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell, you may use the
<a class="reference internal" href="../method/db.fsyncLock/#db.fsyncLock" title="db.fsyncLock"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.fsyncLock()</span></tt></a> and <a class="reference internal" href="../method/db.fsyncUnlock/#db.fsyncUnlock" title="db.fsyncUnlock"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.fsyncUnlock()</span></tt></a> wrappers for
the <a class="reference internal" href="#fsync" title="fsync"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">fsync</span></tt></a> lock and unlock process:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">fsyncLock</span><span class="p">();</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">fsyncUnlock</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><a class="reference internal" href="#fsync" title="fsync"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">fsync</span></tt></a> lock is only possible on individual shards of
a sharded cluster, not on the entire sharded cluster. To backup an
entire sharded cluster, please read <a class="reference internal" href="../../administration/backups/#backups-with-sharding-and-replication"><em>considerations for
backing up sharded clusters</em></a>.</p>
<p class="last">If your <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> has <a class="reference internal" href="../glossary/#term-journal"><em class="xref std std-term">journaling</em></a>
enabled, consider using <a class="reference internal" href="../../administration/backups/#backup-with-journaling"><em>another method</em></a> to back up your database.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The database cannot be locked with <a class="reference internal" href="../method/db.fsyncLock/#db.fsyncLock" title="db.fsyncLock"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.fsyncLock()</span></tt></a> while profiling is enabled.
You must disable profiling before locking the database with <a class="reference internal" href="../method/db.fsyncLock/#db.fsyncLock" title="db.fsyncLock"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.fsyncLock()</span></tt></a>.
Disable profiling using <a class="reference internal" href="../method/db.setProfilingLevel/#db.setProfilingLevel" title="db.setProfilingLevel"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.setProfilingLevel()</span></tt></a> as follows in the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell:</p>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">setProfilingLevel</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="dropDatabase">
<tt class="descname">dropDatabase</tt><a class="headerlink" href="#dropDatabase" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#dropDatabase" title="dropDatabase"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">dropDatabase</span></tt></a> command drops a database, deleting
the associated data files. <a class="reference internal" href="#dropDatabase" title="dropDatabase"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">dropDatabase</span></tt></a> operates on the
current database.</p>
<p>In the shell issue the <tt class="docutils literal"><span class="pre">use</span> <span class="pre">&lt;database&gt;</span></tt>
command, replacing <tt class="docutils literal"><span class="pre">&lt;database&gt;</span></tt> with the name of the database
you wish to delete. Then use the following command form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">dropDatabase</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>The <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell also provides the following equivalent helper method:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">dropDatabase</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This command obtains a global write lock and will block other
operations until it has completed.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="dropIndexes">
<tt class="descname">dropIndexes</tt><a class="headerlink" href="#dropIndexes" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#dropIndexes" title="dropIndexes"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">dropIndexes</span></tt></a> command drops one or all indexes from
the current collection.
To drop all indexes, issue the command like so:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">dropIndexes</span><span class="o">:</span> <span class="s2">&quot;collection&quot;</span><span class="p">,</span> <span class="nx">index</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>To drop a single, issue the command by specifying the name
of the index you want to drop. For example, to drop the index
named <tt class="docutils literal"><span class="pre">age_1</span></tt>, use the following command:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">dropIndexes</span><span class="o">:</span> <span class="s2">&quot;collection&quot;</span><span class="p">,</span> <span class="nx">index</span><span class="o">:</span> <span class="s2">&quot;age_1&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The shell provides a useful command helper. Here&#8217;s the equivalent command:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">dropIndex</span><span class="p">(</span><span class="s2">&quot;age_1&quot;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This command obtains a write lock on the affected database and
will block other operations until it has completed.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="clone">
<tt class="descname">clone</tt><a class="headerlink" href="#clone" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#clone" title="clone"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">clone</span></tt></a> command clone a database from a
remote MongoDB instance to the current host. <a class="reference internal" href="#clone" title="clone"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">clone</span></tt></a> copies the
database on the remote instance with the same name as the current
database. The command takes the following form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">clone</span><span class="o">:</span> <span class="s2">&quot;db1.example.net:27017&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>Replace <tt class="docutils literal"><span class="pre">db1.example.net:27017</span></tt> above with the resolvable hostname for the
MongoDB instance you wish to copy from. Note the following
behaviors:</p>
<ul class="simple">
<li><a class="reference internal" href="#clone" title="clone"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">clone</span></tt></a> can run against a <a class="reference internal" href="../glossary/#term-slave"><em class="xref std std-term">slave</em></a> or a
non-<a class="reference internal" href="../glossary/#term-primary"><em class="xref std std-term">primary</em></a> member of a <a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a>.</li>
<li><a class="reference internal" href="#clone" title="clone"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">clone</span></tt></a> does not snapshot the database. If any clients
update the database you&#8217;re copying at any point during the clone
operation, the resulting database may be inconsistent.</li>
<li>You must run <a class="reference internal" href="#clone" title="clone"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">clone</span></tt></a> on the <strong>destination server</strong>.</li>
<li>The destination server is not locked for the duration of the
<a class="reference internal" href="#clone" title="clone"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">clone</span></tt></a> operation. This means that <a class="reference internal" href="#clone" title="clone"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">clone</span></tt></a> will occasionally yield to
allow other operations to complete.</li>
</ul>
<p>See <a class="reference internal" href="#copydb" title="copydb"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">copydb</span></tt></a>  for similar functionality.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This command obtains an intermittent write-lock on the
destination server, that can block other operations until it
completes.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="compact">
<tt class="descname">compact</tt><a class="headerlink" href="#compact" title="Permalink to this definition">¶</a></dt>
<dd><p class="versionadded">
<span class="versionmodified">New in version 2.0.</span></p>
<p>The <a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> command rewrites and defragments a single
collection. Additionally, the command drops all indexes at the
beginning of compaction and rebuilds the indexes at the end.
<a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> is conceptually similar to
<a class="reference internal" href="#repairDatabase" title="repairDatabase"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">repairDatabase</span></tt></a>, but works on a single collection rather
than an entire database.</p>
<p>The command has the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">compact</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">collection</span> <span class="nx">name</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>You may also specify the following options:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>force</strong> &#8211; <p class="versionchanged">
<span class="versionmodified">Changed in version 2.2: </span><a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> blocks activities only
for the database it is compacting.</p>
<p>The <tt class="docutils literal"><span class="pre">force</span></tt> specifies whether the <a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> command
can run on the primary node in a <a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a>. Set to
<tt class="docutils literal"><span class="pre">true</span></tt> to run the <a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> command on the primary
node in a <a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a>. Otherwise, the
<a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> command returns an error when invoked on a
<a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a> primary because the command blocks all other
activity.</p>
</li>
<li><strong>paddingFactor</strong> &#8211; <p class="versionadded">
<span class="versionmodified">New in version v2.2.</span></p>
<p><em>Default:</em> <tt class="docutils literal"><span class="pre">1.0</span></tt></p>
<p><em>Minimum:</em> <tt class="docutils literal"><span class="pre">1.0</span></tt> (no padding.)</p>
<p><em>Maximum:</em> <tt class="docutils literal"><span class="pre">4.0</span></tt></p>
<p>The <tt class="docutils literal"><span class="pre">paddingFactor</span></tt> describes the <a class="reference internal" href="../glossary/#term-record-size"><em class="xref std std-term">record size</em></a>
allocated for each document as a factor of the document
size. If your updates increase the size of the documents,
padding will increase the amount of space allocated to each
document and avoid expensive document relocation operations
within the data files.</p>
<p>You can calculate the padding size by subtracting the document
size from the record size or, in terms of the <tt class="docutils literal"><span class="pre">paddingFactor</span></tt>,
by subtracting <tt class="docutils literal"><span class="pre">1</span></tt> from the <tt class="docutils literal"><span class="pre">paddingFactor</span></tt>:</p>
<div class="highlight-none"><div class="highlight"><pre>padding size = (paddingFactor - 1) * &lt;document size&gt;.
</pre></div>
</div>
<p>For example, a <tt class="docutils literal"><span class="pre">paddingFactor</span></tt> of <tt class="docutils literal"><span class="pre">1.0</span></tt> specifies a
padding size of <tt class="docutils literal"><span class="pre">0</span></tt> whereas a <tt class="docutils literal"><span class="pre">paddingFactor</span></tt> of <tt class="docutils literal"><span class="pre">1.2</span></tt>
specifies a padding size of <tt class="docutils literal"><span class="pre">0.2</span></tt> or 20 percent (20%) of
the document size.</p>
<p>With the following command, you can use the
<tt class="docutils literal"><span class="pre">paddingFactor</span></tt> option of the <a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> command
to set the record size to <tt class="docutils literal"><span class="pre">1.1</span></tt> of the document size, or a
padding factor of 10 percent (10%):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span> <span class="p">(</span> <span class="p">{</span> <span class="nx">compact</span><span class="o">:</span> <span class="s1">&#39;&lt;collection&gt;&#39;</span><span class="p">,</span> <span class="nx">paddingFactor</span><span class="o">:</span> <span class="mf">1.1</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
</li>
<li><strong>paddingBytes</strong> &#8211; <p class="versionadded">
<span class="versionmodified">New in version 2.2.</span></p>
<p>The <tt class="docutils literal"><span class="pre">paddingBytes</span></tt> sets the padding as an absolute number
of bytes. Specifying <tt class="docutils literal"><span class="pre">paddingBytes</span></tt> can be useful if your
documents start small but then increase in size
significantly.  For example,if your documents are initially
40 bytes long and you grow them by 1KB, using
<tt class="docutils literal"><span class="pre">paddingBytes:</span> <span class="pre">1024</span></tt> might be reasonable since using
<tt class="docutils literal"><span class="pre">paddingFactor:</span> <span class="pre">4.0</span></tt> would specify a record size of 160
bytes (<tt class="docutils literal"><span class="pre">4.0</span></tt> times the initial document size), which would
only provide a padding of 120 bytes (i.e.  record size of
160 bytes minus the document size).</p>
<p>With the following command, you can use the <tt class="docutils literal"><span class="pre">paddingBytes</span></tt>
option of the <a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> command to set the
padding size to <tt class="docutils literal"><span class="pre">100</span></tt> bytes on the collection named by
<tt class="docutils literal"><span class="pre">&lt;collection&gt;</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span> <span class="p">(</span> <span class="p">{</span> <span class="nx">compact</span><span class="o">:</span> <span class="s1">&#39;&lt;collection&gt;&#39;</span><span class="p">,</span> <span class="nx">paddingBytes</span><span class="o">:</span> <span class="mi">100</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Always have an up-to-date backup before performing
server maintenance such as the <a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> operation.</p>
</div>
<p>Note the following behaviors:</p>
<ul>
<li><p class="first"><a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> blocks all other activity. In MongoDB 2.2,
<a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> blocks activities only for its database. You
may view the intermediate progress either by viewing the
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> log file, or by running the
<a class="reference internal" href="../method/db.currentOp/#db.currentOp" title="db.currentOp"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.currentOp()</span></tt></a> in another shell instance.</p>
</li>
<li><p class="first"><a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> removes any <a class="reference internal" href="../glossary/#term-padding-factor"><em class="xref std std-term">padding factor</em></a> in the
collection when issued without either the
<tt class="docutils literal"><span class="pre">paddingFactor</span></tt> option or the <tt class="docutils literal"><span class="pre">paddingBytes</span></tt> option. This may
impact performance if the documents grow regularly. However,
<a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> retains
existing paddingFactor statistics for the collection that MongoDB
will use to calculate the padding factor for future inserts.</p>
</li>
<li><p class="first"><a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> generally uses less disk space than
<a class="reference internal" href="#repairDatabase" title="repairDatabase"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">repairDatabase</span></tt></a> and is faster. However,the
<a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> command is still slow and does block other
database use. Only use <a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> during scheduled
maintenance periods.</p>
</li>
<li><p class="first">If you terminate the operation with the
<a class="reference internal" href="../method/db.killOp/#db.killOp" title="db.killOp"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.killOp()</span></tt></a> method or restart the
server before it has finished:</p>
<ul class="simple">
<li>If you have journaling enabled, the data remains consistent and
usable, regardless of the state of the <a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a>
operation. You may have to manually rebuild the indexes.</li>
<li>If you do not have journaling enabled and the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt>
or <a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> terminates during the operation, it&#8217;s
impossible to guarantee that the data is in a consistent
state.</li>
<li>In either case, much of the existing free space in the
collection may become un-reusable. In this scenario, you should
rerun the compaction to completion to restore the use of this free
space.</li>
</ul>
</li>
<li><p class="first"><a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> may increase the total size and number of our
data files, especially when run for the first time. However, this
will not increase the total collection storage space since storage
size is the amount of data allocated within the database files,
and not the size/number of the files on the file system.</p>
</li>
<li><p class="first"><a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> requires a small amount of additional disk
space while running but unlike <a class="reference internal" href="#repairDatabase" title="repairDatabase"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">repairDatabase</span></tt></a> it does
<em>not</em> free space on the file system.</p>
</li>
<li><p class="first">You may also wish to run the <a class="reference internal" href="#collStats" title="collStats"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">collStats</span></tt></a> command before and
after compaction to see how the storage space changes for the
collection.</p>
</li>
<li><p class="first"><a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> commands do not replicate to secondaries in
a <a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a>:</p>
<ul>
<li><p class="first">Compact each member separately.</p>
</li>
<li><p class="first">Ideally, compaction runs on a secondary. See option
<tt class="docutils literal"><span class="pre">force:true</span></tt> above for information regarding compacting the
primary.</p>
</li>
<li><p class="first">If you run <a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> on a secondary, the secondary
will enter a &#8220;recovering&#8221; state to prevent clients from
sending read operations during compaction. Once the compaction
finishes the secondary will automatically return to secondary
state.</p>
<p>You may refer to the &#8220;<a class="reference external" href="https://github.com/mongodb/mongo-snippets/blob/master/js/compact-example.js">partial script for automating step down
and compaction</a>&#8221;)
for an example.</p>
</li>
</ul>
</li>
<li><p class="first"><a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> is a command issued to a <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt>.
In a sharded environment, run <a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> on each shard
separately as a maintenance operation.</p>
</li>
<li><p class="first">It is not possible to compact <a class="reference internal" href="../glossary/#term-capped-collection"><em class="xref std std-term">capped collections</em></a> because they don&#8217;t have padding, and documents cannot
grow in these collections. However, the documents of a
<a class="reference internal" href="../glossary/#term-capped-collection"><em class="xref std std-term">capped collections</em></a> are not subject to
fragmentation.</p>
</li>
</ul>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="#repairDatabase" title="repairDatabase"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">repairDatabase</span></tt></a></p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="repairDatabase">
<tt class="descname">repairDatabase</tt><a class="headerlink" href="#repairDatabase" title="Permalink to this definition">¶</a></dt>
<dd><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In general, if you have an intact copy of your data, such as
would exist on a very recent backup or an intact member of a
<a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a>, <strong>do not</strong> use <a class="reference internal" href="#repairDatabase" title="repairDatabase"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">repairDatabase</span></tt></a>
or related options like <a class="reference internal" href="../method/db.repairDatabase/#db.repairDatabase" title="db.repairDatabase"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.repairDatabase()</span></tt></a> in the
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell or <a class="reference internal" href="../mongod/#cmdoption-mongod--repair"><em class="xref std std-option">mongod --repair</em></a>. Restore
from an intact copy of your data.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When using <a class="reference internal" href="../glossary/#term-journal"><em class="xref std std-term">journaling</em></a>, there is almost never
any need to run <a class="reference internal" href="#repairDatabase" title="repairDatabase"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">repairDatabase</span></tt></a>. In the event of an
unclean shutdown, the server will be able restore the data files
to a pristine state automatically.</p>
</div>
<p>The <a class="reference internal" href="#repairDatabase" title="repairDatabase"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">repairDatabase</span></tt></a> command checks and repairs errors and
inconsistencies with the data storage. The command is analogous to
a <tt class="docutils literal"><span class="pre">fsck</span></tt> command for file systems.</p>
<p>If your <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> instance is not running with journaling
the system experiences an unexpected system restart or crash, and
you have <em>no</em> other intact replica set members with this data, you
should run the <a class="reference internal" href="#repairDatabase" title="repairDatabase"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">repairDatabase</span></tt></a> command to ensure that
there are no errors in the data storage.</p>
<p>As a side effect, the <a class="reference internal" href="#repairDatabase" title="repairDatabase"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">repairDatabase</span></tt></a> command will
compact the database, as the <a class="reference internal" href="#compact" title="compact"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">compact</span></tt></a> command, and also
reduces the total size of the data files on disk. The
<a class="reference internal" href="#repairDatabase" title="repairDatabase"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">repairDatabase</span></tt></a> command will also recreate all indexes
in the database.</p>
<p>Use the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">repairDatabase</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>Be aware that this command can take a long time to run if your
database is large. In addition, it requires a quantity of free disk
space equal to the size of your database. If you lack sufficient
free space on the same volume, you can mount a separate volume and
use that for the repair. In this case, you must run the command
line and use the <a class="reference internal" href="../mongod/#cmdoption-mongod--repairpath"><em class="xref std std-option">--repairpath</em></a>
switch to specify the folder in which to store the temporary repair
files.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This command obtains a global write lock and will block other
operations until it has completed.</p>
</div>
<p>This command is accessible via a number of different avenues. You
may:</p>
<ul>
<li><p class="first">Use the shell to run the above command, as above.</p>
</li>
<li><p class="first">Use the <a class="reference internal" href="../method/db.repairDatabase/#db.repairDatabase" title="db.repairDatabase"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.repairDatabase()</span></tt></a> in the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt>
shell.</p>
</li>
<li><p class="first">Run <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> directly from your system&#8217;s shell. Make sure
that <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> isn&#8217;t already running, and that you issue
this command as a user that has access to MongoDB&#8217;s data
files. Run as:</p>
<div class="highlight-python"><pre>$ mongod --repair</pre>
</div>
<p>To add a repair path:</p>
<div class="highlight-python"><pre>$ mongod --repair --repairpath /opt/vol2/data</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This command will fail if your database is not a master or
primary. In most cases, you should recover a corrupt secondary
using the data from an existing intact node. If you must
repair a secondary or slave node, first restart the node as a
standalone mongod by omitting the <a class="reference internal" href="../mongod/#cmdoption-mongod--replSet"><em class="xref std std-option">--replSet</em></a>
or <a class="reference internal" href="../mongod/#cmdoption-mongod--slave"><em class="xref std std-option">--slave</em></a> options, as necessary.</p>
</div>
</li>
</ul>
</dd></dl>

<dl class="dbcommand">
<dt id="shutdown">
<tt class="descname">shutdown</tt><a class="headerlink" href="#shutdown" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#shutdown" title="shutdown"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">shutdown</span></tt></a> command cleans up all database resources
and then terminates the process.  You must issue
the <a class="reference internal" href="#shutdown" title="shutdown"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">shutdown</span></tt></a> command against the <a class="reference internal" href="../glossary/#term-admin-database"><em class="xref std std-term">admin database</em></a>
in the form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">shutdown</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Run the <a class="reference internal" href="#shutdown" title="shutdown"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">shutdown</span></tt></a> against the <a class="reference internal" href="../glossary/#term-admin-database"><em class="xref std std-term">admin database</em></a>. When
using <a class="reference internal" href="#shutdown" title="shutdown"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">shutdown</span></tt></a>, the connection must originate from
localhost <strong>or</strong> use an authenticated connection.</p>
</div>
<p>If the node you&#8217;re trying to shut down is a <a class="reference internal" href="../../core/replication/"><em>replica set</em></a>
primary, then the command will succeed only if there exists a secondary node
whose oplog data is within 10 seconds of the primary. You can override this protection
using the <tt class="docutils literal"><span class="pre">force</span></tt> option:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">shutdown</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">force</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span>
</pre></div>
</div>
<p>Alternatively, the <a class="reference internal" href="#shutdown" title="shutdown"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">shutdown</span></tt></a> command also supports a <tt class="docutils literal"><span class="pre">timeoutSecs</span></tt> argument
which allows you to specify a number of seconds to wait for other
members of the replica set to catch up:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">shutdown</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">timeoutSecs</span><span class="o">:</span> <span class="mi">60</span> <span class="p">}</span>
</pre></div>
</div>
<p>The equivalent <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell helper syntax looks like this:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">shutdownServer</span><span class="p">({</span><span class="nx">timeoutSecs</span><span class="o">:</span> <span class="mi">60</span><span class="p">});</span>
</pre></div>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="copydb">
<tt class="descname">copydb</tt><a class="headerlink" href="#copydb" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#copydb" title="copydb"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">copydb</span></tt></a> command copies a database from a remote
host to the current host. The command has the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">copydb</span><span class="o">:</span> <span class="mi">1</span><span class="o">:</span>
  <span class="nx">fromhost</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">hostname</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="nx">fromdb</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">db</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="nx">todb</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">db</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="nx">slaveOk</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">bool</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="nx">username</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">username</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="nx">password</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">password</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="nx">nonce</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">nonce</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="nx">key</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">key</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>All of the following arguments are optional:</p>
<ul class="simple">
<li>slaveOk</li>
<li>username</li>
<li>password</li>
<li>nonce</li>
<li>key</li>
</ul>
<p>You can omit the <tt class="docutils literal"><span class="pre">fromhost</span></tt> argument, to copy one database to
another database within a single MongoDB instance.</p>
<p>You must run this command on the destination, or the <tt class="docutils literal"><span class="pre">todb</span></tt>
server.</p>
<p>Be aware of the following behaviors:</p>
<ul>
<li><p class="first"><a class="reference internal" href="#copydb" title="copydb"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">copydb</span></tt></a> can run against a <a class="reference internal" href="../glossary/#term-slave"><em class="xref std std-term">slave</em></a> or a
non-<a class="reference internal" href="../glossary/#term-primary"><em class="xref std std-term">primary</em></a> member of a <a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a>. In this case,
you must set the <tt class="docutils literal"><span class="pre">slaveOk</span></tt> option to <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</li>
<li><p class="first"><a class="reference internal" href="#copydb" title="copydb"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">copydb</span></tt></a> does not snapshot the database. If the state
of the database changes at any point during the operation, the
resulting database may be inconsistent.</p>
</li>
<li><p class="first">You must run <a class="reference internal" href="#copydb" title="copydb"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">copydb</span></tt></a> on the <strong>destination server</strong>.</p>
</li>
<li><p class="first">The destination server is not locked for the duration of the
<a class="reference internal" href="#copydb" title="copydb"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">copydb</span></tt></a> operation. This means that
<a class="reference internal" href="#copydb" title="copydb"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">copydb</span></tt></a> will occasionally yield to allow other
operations to complete.</p>
</li>
<li><p class="first">If the remote server has authentication enabled, then you must
include a username and password. You must also include a nonce
and a key. The nonce is a one-time password that you request from
the remote server using the <a class="reference internal" href="#copydbgetnonce" title="copydbgetnonce"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">copydbgetnonce</span></tt></a>
command. The <tt class="docutils literal"><span class="pre">key</span></tt> is a hash generated as follows:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">hex_md5</span><span class="p">(</span><span class="nx">nonce</span> <span class="o">+</span> <span class="nx">username</span> <span class="o">+</span> <span class="nx">hex_md5</span><span class="p">(</span><span class="nx">username</span> <span class="o">+</span> <span class="s2">&quot;:mongo:&quot;</span> <span class="o">+</span> <span class="nx">pass</span><span class="p">))</span>
</pre></div>
</div>
<p>If you need to copy a database and authenticate, it&#8217;s easiest to use the
shell helper:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">copyDatabase</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">remote_db_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="nx">local_db_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="nx">from_host_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="nx">username</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="nx">password</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</dd></dl>

<dl class="dbcommand">
<dt id="logout">
<tt class="descname">logout</tt><a class="headerlink" href="#logout" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#logout" title="logout"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">logout</span></tt></a> command terminates the current
authenticated session:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">logout</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you&#8217;re not logged in and using authentication, this command will
have no effect.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="logRotate">
<tt class="descname">logRotate</tt><a class="headerlink" href="#logRotate" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#logRotate" title="logRotate"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">logRotate</span></tt></a> command is an administrative command that
allows you to rotate
the MongoDB logs to prevent a single logfile from consuming too
much disk space.
You must issue the
<a class="reference internal" href="#logRotate" title="logRotate"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">logRotate</span></tt></a>
command against the <a class="reference internal" href="../glossary/#term-admin-database"><em class="xref std std-term">admin database</em></a> in the form:</p>
<blockquote>
<div>{ logRotate: 1 }</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Your <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> instance needs to be running with the
<a class="reference internal" href="../mongod/#cmdoption-mongod--logpath"><em class="xref std std-option">--logpath [file]</em></a> option.</p>
</div>
<p>You may also rotate the logs by sending a <tt class="docutils literal"><span class="pre">SIGUSR1</span></tt> signal to the
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> process.
If your <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> has a process ID of 2200, here&#8217;s how to
send the signal on Linux:</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nb">kill</span> -SIGUSR1 2200
</pre></div>
</div>
<p><a class="reference internal" href="#logRotate" title="logRotate"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">logRotate</span></tt></a> renames the existing log file by
appending the current timestamp to the filename.  The appended
timestamp has the following form:</p>
<div class="highlight-none"><div class="highlight"><pre>&lt;YYYY&gt;-&lt;mm&gt;-&lt;DD&gt;T&lt;HH&gt;-&lt;MM&gt;-&lt;SS&gt;
</pre></div>
</div>
<p>Then <a class="reference internal" href="#logRotate" title="logRotate"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">logRotate</span></tt></a> creates a new log file with the same
name as originally specified by the <a class="reference internal" href="../configuration-options/#logpath" title="logpath"><tt class="xref mongodb mongodb-setting docutils literal"><span class="pre">logpath</span></tt></a> setting to
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> or <a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last versionadded">
<span class="versionmodified">New in version 2.0.3: </span>The <a class="reference internal" href="#logRotate" title="logRotate"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">logRotate</span></tt></a> command is available to
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> instances running on Windows systems with
MongoDB release 2.0.3 and higher.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="setParameter">
<tt class="descname">setParameter</tt><a class="headerlink" href="#setParameter" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#setParameter" title="setParameter"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">setParameter</span></tt></a> is an administrative command for
modifying options normally set on the command line. You must issue
the <a class="reference internal" href="#setParameter" title="setParameter"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">setParameter</span></tt></a> command against the <a class="reference internal" href="../glossary/#term-admin-database"><em class="xref std std-term">admin database</em></a>
in the form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">setParameter</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&lt;</span><span class="nx">option</span><span class="o">&gt;:</span> <span class="o">&lt;</span><span class="nx">value</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>Replace the <tt class="docutils literal"><span class="pre">&lt;option&gt;</span></tt> with one of the following options
supported by this command:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Options:</th><td class="field-body"><ul class="first last simple">
<li><strong>journalCommitInterval</strong> (<em>integer</em>) &#8211; <p>Specify an integer between <tt class="docutils literal"><span class="pre">1</span></tt> and <tt class="docutils literal"><span class="pre">500</span></tt> signifying the number
of milliseconds (ms) between journal commits.</p>
<p>Consider the following example which sets the
<tt class="docutils literal"><span class="pre">journalCommitInterval</span></tt> to <tt class="docutils literal"><span class="pre">200</span></tt> ms:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">use</span> <span class="nx">admin</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">setParameter</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">journalCommitInterval</span><span class="o">:</span> <span class="mi">200</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../configuration-options/#journalCommitInterval" title="journalCommitInterval"><tt class="xref mongodb mongodb-setting docutils literal"><span class="pre">journalCommitInterval</span></tt></a>.</p>
</div>
</li>
<li><strong>logLevel</strong> (<em>integer</em>) &#8211; <p>Specify an integer between <tt class="docutils literal"><span class="pre">0</span></tt> and <tt class="docutils literal"><span class="pre">5</span></tt> signifying the
verbosity of the logging, where <tt class="docutils literal"><span class="pre">5</span></tt> is the most verbose.</p>
<p>Consider the following example which sets the
<tt class="docutils literal"><span class="pre">logLevel</span></tt> to <tt class="docutils literal"><span class="pre">2</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">use</span> <span class="nx">admin</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">setParameter</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">logLevel</span><span class="o">:</span> <span class="mi">2</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../configuration-options/#verbose" title="verbose"><tt class="xref mongodb mongodb-setting docutils literal"><span class="pre">verbose</span></tt></a>.</p>
</div>
</li>
<li><strong>notablescan</strong> (<em>boolean</em>) &#8211; <p>Specify whether queries must use indexes. If <tt class="docutils literal"><span class="pre">true</span></tt>,
queries that perform a table scan instead of using an index
will fail.</p>
<p>Consider the following example which sets the
<tt class="docutils literal"><span class="pre">notablescan</span></tt> to true:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">use</span> <span class="nx">admin</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">setParameter</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">notablescan</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../configuration-options/#notablescan" title="notablescan"><tt class="xref mongodb mongodb-setting docutils literal"><span class="pre">notablescan</span></tt></a>.</p>
</div>
</li>
<li><strong>traceExceptions</strong> (<em>boolean</em>) &#8211; <p class="versionadded">
<span class="versionmodified">New in version 2.1.</span></p>
<p>Configures <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> log full stack traces on assertions or
errors. If <tt class="docutils literal"><span class="pre">true</span></tt>, <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> will log full stack
traces on assertions or errors.</p>
<p>Consider the following example which sets the
<tt class="docutils literal"><span class="pre">traceExceptions</span></tt> to true:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">use</span> <span class="nx">admin</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">setParameter</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">traceExceptions</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../configuration-options/#traceExceptions" title="traceExceptions"><tt class="xref mongodb mongodb-setting docutils literal"><span class="pre">traceExceptions</span></tt></a>.</p>
</div>
</li>
<li><strong>quiet</strong> (<em>boolean</em>) &#8211; <p>Sets quiet logging mode. If
<tt class="docutils literal"><span class="pre">true</span></tt>, <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> will go into a quiet logging
mode which will not log the following events/activities:</p>
<blockquote>
<div><ul>
<li>connection events;</li>
<li>the <a class="reference internal" href="#drop" title="drop"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">drop</span></tt></a> command, the
<a class="reference internal" href="#dropIndexes" title="dropIndexes"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">dropIndexes</span></tt></a> command, the
<a class="reference internal" href="#diagLogging" title="diagLogging"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">diagLogging</span></tt></a> command, the
<a class="reference internal" href="#validate" title="validate"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">validate</span></tt></a> command, and the
<a class="reference internal" href="#clean" title="clean"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">clean</span></tt></a> command; and</li>
<li>replication synchronization activities.</li>
</ul>
</div></blockquote>
<p>Consider the following example which sets the
<tt class="docutils literal"><span class="pre">quiet</span></tt> to true:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">use</span> <span class="nx">admin</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">setParameter</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">quiet</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../configuration-options/#quiet" title="quiet"><tt class="xref mongodb mongodb-setting docutils literal"><span class="pre">quiet</span></tt></a>.</p>
</div>
</li>
<li><strong>syncdelay</strong> (<em>integer</em>) &#8211; <p>Specify the interval in seconds between <a class="reference internal" href="../glossary/#term-fsync"><em class="xref std std-term">fsyncs</em></a> (i.e., flushes of memory to disk). By default,
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> will flush memory to disk every 60
seconds. Do not change this value unless you see a
background flush average greater than 60 seconds.</p>
<p>Consider the following example which sets the
<tt class="docutils literal"><span class="pre">syncdelay</span></tt> to <tt class="docutils literal"><span class="pre">60</span></tt> seconds:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">use</span> <span class="nx">admin</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">setParameter</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">syncdelay</span><span class="o">:</span> <span class="mi">60</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../configuration-options/#syncdelay" title="syncdelay"><tt class="xref mongodb mongodb-setting docutils literal"><span class="pre">syncdelay</span></tt></a>.</p>
</div>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="dbcommand">
<dt id="getParameter">
<tt class="descname">getParameter</tt><a class="headerlink" href="#getParameter" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#getParameter" title="getParameter"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">getParameter</span></tt></a> is an administrative command for
retrieving the value of options normally set on the command
line. Issue commands against the <a class="reference internal" href="../glossary/#term-admin-database"><em class="xref std std-term">admin database</em></a> as follows:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">getParameter</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&lt;</span><span class="nx">option</span><span class="o">&gt;:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>The values specified for <tt class="docutils literal"><span class="pre">getParameter</span></tt> and <tt class="docutils literal"><span class="pre">&lt;option&gt;</span></tt> do not
affect the output. The command works with the following options:</p>
<ul class="simple">
<li><strong>quiet</strong></li>
<li><strong>notablescan</strong></li>
<li><strong>logLevel</strong></li>
<li><strong>syncdelay</strong></li>
</ul>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="#setParameter" title="setParameter"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">setParameter</span></tt></a> for more about these parameters.</p>
</div>
</dd></dl>

</div>
<div class="section" id="diagnostic-commands">
<h3>Diagnostic Commands<a class="headerlink" href="#diagnostic-commands" title="Permalink to this headline">¶</a></h3>
<dl class="dbcommand">
<dt id="buildInfo">
<tt class="descname">buildInfo</tt><a class="headerlink" href="#buildInfo" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#buildInfo" title="buildInfo"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">buildInfo</span></tt></a> command is an administrative command which
returns a build summary for the current <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt>.</p>
<div class="highlight-javascript"><div class="highlight"><pre>  <span class="p">{</span> <span class="nx">buildInfo</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>

<span class="nx">The</span> <span class="nx">information</span> <span class="nx">provided</span> <span class="nx">includes</span> <span class="nx">the</span> <span class="nx">following</span><span class="o">:</span>
</pre></div>
</div>
<ul class="simple">
<li>The version of MongoDB currently running.</li>
<li>The information about the system that built the
&#8220;<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt>&#8221; binary, including a timestamp for the build.</li>
<li>The architecture of the binary (i.e. 64 or 32 bits.)</li>
<li>The maximum allowable <a class="reference internal" href="../glossary/#term-bson"><em class="xref std std-term">BSON</em></a> object size in bytes (in the field <tt class="docutils literal"><span class="pre">maxBsonObjectSize</span></tt>.)</li>
</ul>
</dd></dl>

<dl class="dbcommand">
<dt id="dbStats">
<tt class="descname">dbStats</tt><a class="headerlink" href="#dbStats" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#dbStats" title="dbStats"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">dbStats</span></tt></a> command returns storage statistics for a
given database. The command takes the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">dbStats</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">scale</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>The value of the argument (e.g. <tt class="docutils literal"><span class="pre">1</span></tt> above) to <tt class="docutils literal"><span class="pre">dbStats</span></tt> does
not affect the output of the command. The <tt class="docutils literal"><span class="pre">scale</span></tt> option allows
you to specify how to scale byte values. For example, a <tt class="docutils literal"><span class="pre">scale</span></tt>
value of <tt class="docutils literal"><span class="pre">1024</span></tt> will display the results in kilobytes rather
than in bytes.</p>
<p>The time required to run the command depends on the total size of the database.
Because the command has to touch all data files, the command may take several
seconds to run.</p>
<p>In the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell, the <a class="reference internal" href="../method/db.stats/#db.stats" title="db.stats"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.stats()</span></tt></a> function provides
a wrapper around this functionality. See the
&#8220;<a class="reference internal" href="../database-statistics/"><em>Database Statistics Reference</em></a>&#8221; document for an overview of
this output.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="connPoolStats">
<tt class="descname">connPoolStats</tt><a class="headerlink" href="#connPoolStats" title="Permalink to this definition">¶</a></dt>
<dd><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference internal" href="#connPoolStats" title="connPoolStats"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">connPoolStats</span></tt></a> only returns meaningful results for
<a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances and for <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> instances
in sharded clusters.</p>
</div>
<p>The command <a class="reference internal" href="#connPoolStats" title="connPoolStats"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">connPoolStats</span></tt></a> returns information
regarding the number of open connections to the current database
instance, including client connections and server-to-server
connections for replication and clustering. The command takes the
following form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">connPoolStats</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>The value of the argument (i.e. <tt class="docutils literal"><span class="pre">1</span></tt> ) does not affect the
output of the command. See <a class="reference internal" href="../connection-pool-stats/"><em>Connection Pool Statistics Reference</em></a>
for full documentation of the <a class="reference internal" href="#connPoolStats" title="connPoolStats"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">connPoolStats</span></tt></a> output.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="getCmdLineOpts">
<tt class="descname">getCmdLineOpts</tt><a class="headerlink" href="#getCmdLineOpts" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#getCmdLineOpts" title="getCmdLineOpts"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">getCmdLineOpts</span></tt></a> command returns a document containing
command line options used to start the given <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">getCmdLineOpts</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>This command returns a document with two fields, <tt class="docutils literal"><span class="pre">argv</span></tt> and
<tt class="docutils literal"><span class="pre">parsed</span></tt>. The <tt class="docutils literal"><span class="pre">argv</span></tt> field contains an array with each item
from the command string used to invoke <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt>. The document
in the <tt class="docutils literal"><span class="pre">parsed</span></tt> field includes all runtime options, including
those parsed from the command line and those specified in the
configuration file, if specified.</p>
<p>Consider the following example output of
<a class="reference internal" href="#getCmdLineOpts" title="getCmdLineOpts"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">getCmdLineOpts</span></tt></a>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
        <span class="s2">&quot;argv&quot;</span> <span class="o">:</span> <span class="p">[</span>
               <span class="s2">&quot;/usr/bin/mongod&quot;</span><span class="p">,</span>
               <span class="s2">&quot;--config&quot;</span><span class="p">,</span>
               <span class="s2">&quot;/etc/mongodb.conf&quot;</span><span class="p">,</span>
               <span class="s2">&quot;--fork&quot;</span>
        <span class="p">],</span>
        <span class="s2">&quot;parsed&quot;</span> <span class="o">:</span> <span class="p">{</span>
               <span class="s2">&quot;bind_ip&quot;</span> <span class="o">:</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
               <span class="s2">&quot;config&quot;</span> <span class="o">:</span> <span class="s2">&quot;/etc/mongodb/mongodb.conf&quot;</span><span class="p">,</span>
               <span class="s2">&quot;dbpath&quot;</span> <span class="o">:</span> <span class="s2">&quot;/srv/mongodb&quot;</span><span class="p">,</span>
               <span class="s2">&quot;fork&quot;</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
               <span class="s2">&quot;logappend&quot;</span> <span class="o">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
               <span class="s2">&quot;logpath&quot;</span> <span class="o">:</span> <span class="s2">&quot;/var/log/mongodb/mongod.log&quot;</span><span class="p">,</span>
               <span class="s2">&quot;quiet&quot;</span> <span class="o">:</span> <span class="s2">&quot;true&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</div>
<p><a class="reference external" href="http://docs.mongodb.org/manual/administration/import-export/">http://docs.mongodb.org/manual/administration/import-export/</a></p>
</dd></dl>

<dl class="dbcommand">
<dt id="validate">
<tt class="descname">validate</tt><a class="headerlink" href="#validate" title="Permalink to this definition">¶</a></dt>
<dd><p>The <tt class="docutils literal"><span class="pre">validate</span></tt> command checks the contents of a namespace by
scanning a collection&#8217;s data and indexes for correctness. The command
can be slow, particularly on larger data sets:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">validate</span><span class="o">:</span> <span class="s2">&quot;users&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>This command will validate the contents of the collection named
<tt class="docutils literal"><span class="pre">users</span></tt>. You may also specify one of the following
options:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">full:</span> <span class="pre">true</span></tt> provides a more thorough scan of the data.</p>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">scandata:</span> <span class="pre">false</span></tt> skips the scan of the base collection</dt>
<dd><p class="first last">without skipping the scan of the index.</p>
</dd>
</dl>
</li>
</ul>
<p>The <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell also provides a wrapper:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">validate</span><span class="p">();</span>
</pre></div>
</div>
<p>Use one of the following forms to perform the full collection
validation:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">validate</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">validate</span><span class="o">:</span> <span class="s2">&quot;collection&quot;</span><span class="p">,</span> <span class="nx">full</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This command is resource intensive and may have an
impact on the performance of your MongoDB instance.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="top">
<tt class="descname">top</tt><a class="headerlink" href="#top" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#top" title="top"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">top</span></tt></a> command is an administrative command which
returns raw usage of each database,
and provides amount of time, in microseconds, used and a count of
operations for the following event types:</p>
<ul class="simple">
<li>total</li>
<li>readLock</li>
<li>writeLock</li>
<li>queries</li>
<li>getmore</li>
<li>insert</li>
<li>update</li>
<li>remove</li>
<li>commands</li>
</ul>
<p>You must issue the
<a class="reference internal" href="#top" title="top"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">top</span></tt></a>
command against the <a class="reference internal" href="../glossary/#term-admin-database"><em class="xref std std-term">admin database</em></a> in the form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">top</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="getLastError">
<tt class="descname">getLastError</tt><a class="headerlink" href="#getLastError" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#getLastError" title="getLastError"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">getLastError</span></tt></a> command returns the error status of
the last operation on the <em>current connection</em>. By default MongoDB
does not provide a response to confirm the success or failure of a
write operation, clients typically use <a class="reference internal" href="#getLastError" title="getLastError"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">getLastError</span></tt></a> in
combination with write operations to ensure that the write
succeeds.</p>
<p>Consider the following prototype form.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">getLastError</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>The following options are available:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>j</strong> (<em>boolean</em>) &#8211; If <tt class="docutils literal"><span class="pre">true</span></tt>, wait for the next journal commit
before returning, rather than a full disk
flush. If <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> does not have
journaling enabled, this option has no effect.</li>
<li><strong>w</strong> &#8211; When running with replication, this is the number of
servers to replicate to before returning. A <tt class="docutils literal"><span class="pre">w</span></tt> value of
1 indicates the primary only.  A <tt class="docutils literal"><span class="pre">w</span></tt> value of 2
includes the primary and at least one secondary, etc.
In place of a number, you may also set <tt class="docutils literal"><span class="pre">w</span></tt> to
<tt class="docutils literal"><span class="pre">majority</span></tt> to indicate that the command should wait
until the latest write propagates to a majority of
replica set members. If using <tt class="docutils literal"><span class="pre">w</span></tt>, you should also use
<tt class="docutils literal"><span class="pre">wtimeout</span></tt>. Specifying a value for <tt class="docutils literal"><span class="pre">w</span></tt> without also
providing a <tt class="docutils literal"><span class="pre">wtimeout</span></tt> may cause
<a class="reference internal" href="#getLastError" title="getLastError"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">getLastError</span></tt></a> to block indefinitely.</li>
<li><strong>fsync</strong> (<em>boolean</em>) &#8211; If <tt class="docutils literal"><span class="pre">true</span></tt>, wait for <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> to write this
data to disk before returning. Defaults to
false. In most cases, use the <tt class="docutils literal"><span class="pre">j</span></tt> option
to ensure durability and consistency of the
data set.</li>
<li><strong>wtimeout</strong> (<em>integer</em>) &#8211; Optional. Milliseconds. Specify a value in
milliseconds to control how long to
wait for write propagation to complete. If
replication does not complete in the given
timeframe, the <a class="reference internal" href="#getLastError" title="getLastError"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">getLastError</span></tt></a>
command will return with an error status.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../../core/write-operations/#write-concern"><em>Write Concern</em></a>, <a class="reference internal" href="../../applications/replication/#replica-set-write-concern"><em>Replica Set
Write Concern</em></a>, and
<a class="reference internal" href="../method/db.getLastError/#db.getLastError" title="db.getLastError"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.getLastError()</span></tt></a>.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="getLog">
<tt class="descname">getLog</tt><a class="headerlink" href="#getLog" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#getLog" title="getLog"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">getLog</span></tt></a> command returns a document with a <tt class="docutils literal"><span class="pre">log</span></tt>
array that contains recent messages from the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt>
process log. The <a class="reference internal" href="#getLog" title="getLog"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">getLog</span></tt></a> command has the following
syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">getLog</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">log</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>Replace <tt class="docutils literal"><span class="pre">&lt;log&gt;</span></tt> with one of the following values:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">global</span></tt> - returns the combined output of all recent log
entries.</li>
<li><tt class="docutils literal"><span class="pre">rs</span></tt> - if the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> is part of a <a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica
set</em></a>, <a class="reference internal" href="#getLog" title="getLog"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">getLog</span></tt></a> will return recent notices related to
replica set activity.</li>
<li><tt class="docutils literal"><span class="pre">startupWarnings</span></tt> - will return logs that <em>may</em> contain errors
or warnings from MongoDB&#8217;s log from when the current process
started. If <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> started without warnings, this
filter may return an empty array.</li>
</ul>
<p>You may also specify an asterisk (e.g. <tt class="docutils literal"><span class="pre">*</span></tt>) as the <tt class="docutils literal"><span class="pre">&lt;log&gt;</span></tt>
value to return a list of available log filters. The following
interaction from the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell connected to a replica
set:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">adminCommand</span><span class="p">({</span><span class="nx">getLog</span><span class="o">:</span> <span class="s2">&quot;*&quot;</span> <span class="p">})</span>
<span class="p">{</span> <span class="s2">&quot;names&quot;</span> <span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;global&quot;</span><span class="p">,</span> <span class="s2">&quot;rs&quot;</span><span class="p">,</span> <span class="s2">&quot;startupWarnings&quot;</span> <span class="p">],</span> <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p><a class="reference internal" href="#getLog" title="getLog"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">getLog</span></tt></a> returns events from a RAM cache of the
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> events and <em>does not</em> read log data from the log
:file.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="listDatabases">
<tt class="descname">listDatabases</tt><a class="headerlink" href="#listDatabases" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#listDatabases" title="listDatabases"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">listDatabases</span></tt></a> command provides a list of existing
databases along with basic statistics about them:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">listDatabases</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>The value (e.g. <tt class="docutils literal"><span class="pre">1</span></tt>) does not effect the output of the
command. <a class="reference internal" href="#listDatabases" title="listDatabases"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">listDatabases</span></tt></a> returns a document for each
database Each document contains a <tt class="docutils literal"><span class="pre">name</span></tt> field with the database
name, a <tt class="docutils literal"><span class="pre">sizeOnDisk</span></tt> field with the total size of the database
file on disk in bytes, and an <tt class="docutils literal"><span class="pre">empty</span></tt> field specifying whether
the database has any data.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="cursorInfo">
<tt class="descname">cursorInfo</tt><a class="headerlink" href="#cursorInfo" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#cursorInfo" title="cursorInfo"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">cursorInfo</span></tt></a> command returns information about current cursor
allotment and use. Use the following form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">cursorInfo</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>The value (e.g. <tt class="docutils literal"><span class="pre">1</span></tt> above,) does not effect the output of the
command.</p>
<p><a class="reference internal" href="#cursorInfo" title="cursorInfo"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">cursorInfo</span></tt></a> returns the total number of open cursors
(<tt class="docutils literal"><span class="pre">totalOpen</span></tt>,) the size of client cursors in current use
(<tt class="docutils literal"><span class="pre">clientCursors_size</span></tt>,) and the number of timed out cursors
since the last server restart (<tt class="docutils literal"><span class="pre">timedOut</span></tt>.)</p>
</dd></dl>

<dl class="dbcommand">
<dt id="isMaster">
<tt class="descname">isMaster</tt><a class="headerlink" href="#isMaster" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="../replica-commands/#isMaster" title="isMaster"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">isMaster</span></tt></a> command provides a basic overview of the current
replication configuration. MongoDB <a class="reference internal" href="../glossary/#term-driver"><em class="xref std std-term">drivers</em></a> and
<a class="reference internal" href="../glossary/#term-client"><em class="xref std std-term">clients</em></a> use this command to determine what kind of
member they&#8217;re connected to and to discover additional members of a
<a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a>. The <a class="reference internal" href="../replica-commands/#db.isMaster" title="db.isMaster"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.isMaster()</span></tt></a> method provides a
wrapper around this database command.</p>
<p>The command takes the following form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">isMaster</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>This command returns a <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a> containing the
following fields:</p>
<dl class="data">
<dt id="isMaster.setname">
<tt class="descclassname">isMaster.</tt><tt class="descname">setname</tt><a class="headerlink" href="#isMaster.setname" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the current replica set, if applicable.</p>
</dd></dl>

<dl class="data">
<dt id="isMaster.ismaster">
<tt class="descclassname">isMaster.</tt><tt class="descname">ismaster</tt><a class="headerlink" href="#isMaster.ismaster" title="Permalink to this definition">¶</a></dt>
<dd><p>A boolean value that reports when this node is writable. If
<tt class="docutils literal"><span class="pre">true</span></tt>, then the current node is either a <a class="reference internal" href="../glossary/#term-primary"><em class="xref std std-term">primary</em></a>
node in a <a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a>, a <a class="reference internal" href="../glossary/#term-master"><em class="xref std std-term">master</em></a> node in a
master-slave configuration, of a standalone <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt>.</p>
</dd></dl>

<dl class="data">
<dt id="isMaster.secondary">
<tt class="descclassname">isMaster.</tt><tt class="descname">secondary</tt><a class="headerlink" href="#isMaster.secondary" title="Permalink to this definition">¶</a></dt>
<dd><p>A boolean value that, when <tt class="docutils literal"><span class="pre">true</span></tt>, indicates that the
current node is a <a class="reference internal" href="../glossary/#term-secondary"><em class="xref std std-term">secondary</em></a> member of a <a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica
set</em></a>.</p>
</dd></dl>

<dl class="data">
<dt id="isMaster.hosts">
<tt class="descclassname">isMaster.</tt><tt class="descname">hosts</tt><a class="headerlink" href="#isMaster.hosts" title="Permalink to this definition">¶</a></dt>
<dd><p>An array of strings in the format of &#8220;<tt class="docutils literal"><span class="pre">[hostname]:[port]</span></tt>&#8221;
listing all nodes in the <a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a> that are not
&#8220;<a class="reference internal" href="../glossary/#term-hidden-member"><em class="xref std std-term">hidden</em></a>&#8221;.</p>
</dd></dl>

<dl class="data">
<dt id="isMaster.primary">
<tt class="descclassname">isMaster.</tt><tt class="descname">primary</tt><a class="headerlink" href="#isMaster.primary" title="Permalink to this definition">¶</a></dt>
<dd><p>The <tt class="docutils literal"><span class="pre">[hostname]:[port]</span></tt> for the current
<a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a> <a class="reference internal" href="../glossary/#term-primary"><em class="xref std std-term">primary</em></a>, if applicable.</p>
</dd></dl>

<dl class="data">
<dt id="isMaster.me">
<tt class="descclassname">isMaster.</tt><tt class="descname">me</tt><a class="headerlink" href="#isMaster.me" title="Permalink to this definition">¶</a></dt>
<dd><p>The <tt class="docutils literal"><span class="pre">[hostname]:[port]</span></tt> of the node responding to this
command.</p>
</dd></dl>

<dl class="data">
<dt id="isMaster.maxBsonObjectSize">
<tt class="descclassname">isMaster.</tt><tt class="descname">maxBsonObjectSize</tt><a class="headerlink" href="#isMaster.maxBsonObjectSize" title="Permalink to this definition">¶</a></dt>
<dd><p>The maximum permitted size of a <a class="reference internal" href="../glossary/#term-bson"><em class="xref std std-term">BSON</em></a> object in bytes for
this <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> process. If not provided, clients should
assume a max size of &#8220;4 * 1024 * 1024.&#8221;</p>
</dd></dl>

<dl class="data">
<dt id="isMaster.localTime">
<tt class="descclassname">isMaster.</tt><tt class="descname">localTime</tt><a class="headerlink" href="#isMaster.localTime" title="Permalink to this definition">¶</a></dt>
<dd><p class="versionadded">
<span class="versionmodified">New in version 2.1.1.</span></p>
<p>Returns the local server time in UTC. This value is a
<a class="reference internal" href="../glossary/#term-isodate"><em class="xref std std-term">ISOdate</em></a>. You can use the <tt class="xref js js-func docutils literal"><span class="pre">toString()</span></tt>
JavaScript method to convert this value to a local date string,
as in the following example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">isMaster</span><span class="p">().</span><span class="nx">localTime</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="dbcommand">
<dt id="ping">
<tt class="descname">ping</tt><a class="headerlink" href="#ping" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#ping" title="ping"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">ping</span></tt></a> command is a no-op used to test whether a
server is responding to commands. This command will return
immediately even if the server is write-locked:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">ping</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>The value (e.g. <tt class="docutils literal"><span class="pre">1</span></tt> above,) does not impact the behavior of the
command.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="serverStatus">
<tt class="descname">serverStatus</tt><a class="headerlink" href="#serverStatus" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#serverStatus" title="serverStatus"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">serverStatus</span></tt></a> command returns a document that
provides an overview of the database process&#8217;s state. Most
monitoring applications run this command at a regular interval to
collection statistics about the instance:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">serverStatus</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>The value (i.e. <tt class="docutils literal"><span class="pre">1</span></tt> above), does not affect the operation of the
command.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../method/db.serverStatus/#db.serverStatus" title="db.serverStatus"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.serverStatus()</span></tt></a> and &#8220;<a class="reference internal" href="../server-status/"><em>Server Status Reference</em></a>&#8220;</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="resetError">
<tt class="descname">resetError</tt><a class="headerlink" href="#resetError" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#resetError" title="resetError"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">resetError</span></tt></a> command resets the last error status.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../method/db.resetError/#db.resetError" title="db.resetError"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.resetError()</span></tt></a></p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="getPrevError">
<tt class="descname">getPrevError</tt><a class="headerlink" href="#getPrevError" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#getPrevError" title="getPrevError"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">getPrevError</span></tt></a> command returns the errors since the
last <a class="reference internal" href="#resetError" title="resetError"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">resetError</span></tt></a> command.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../method/db.getPrevError/#db.getPrevError" title="db.getPrevError"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.getPrevError()</span></tt></a></p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="forceerror">
<tt class="descname">forceerror</tt><a class="headerlink" href="#forceerror" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#forceerror" title="forceerror"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">forceerror</span></tt></a> command is for testing purposes
only. Use <a class="reference internal" href="#forceerror" title="forceerror"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">forceerror</span></tt></a> to force a user assertion
exception. This command always returns an <tt class="docutils literal"><span class="pre">ok</span></tt> value of 0.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="profile">
<tt class="descname">profile</tt><a class="headerlink" href="#profile" title="Permalink to this definition">¶</a></dt>
<dd><p>Use the <a class="reference internal" href="../configuration-options/#profile" title="profile"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">profile</span></tt></a> command to enable, disable, or change
the query profiling level. This allows administrators to capture
data regarding performance. The database profiling system can
impact performance and can allow the server to write the contents
of queries to the log, which might information security
implications for your deployment. Consider the following prototype
syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">profile</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">level</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The following profiling levels are available:</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Level</strong></td>
<td><strong>Setting</strong></td>
</tr>
<tr class="row-even"><td>0</td>
<td>Off. No profiling.</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>On. Only includes slow operations.</td>
</tr>
<tr class="row-even"><td>2</td>
<td>On. Includes all operations.</td>
</tr>
</tbody>
</table>
<p>You may optionally set a threshold in milliseconds for profiling using
the <tt class="docutils literal"><span class="pre">slowms</span></tt> option, as follows:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">profile</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">slowms</span><span class="o">:</span> <span class="mi">200</span> <span class="p">}</span>
</pre></div>
</div>
<p><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> writes the output of the database profiler to the
<tt class="docutils literal"><span class="pre">system.profile</span></tt> collection.</p>
<p><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> records a record of queries that take longer than
the <a class="reference internal" href="../configuration-options/#slowms" title="slowms"><tt class="xref mongodb mongodb-setting docutils literal"><span class="pre">slowms</span></tt></a> to the log even when the database profiler is
not active.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">Additional documentation regarding database profiling
<a class="reference internal" href="../../administration/monitoring/#database-profiling"><em>Database Profiling</em></a>.</p>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">&#8220;<a class="reference internal" href="../method/db.getProfilingStatus/#db.getProfilingStatus" title="db.getProfilingStatus"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.getProfilingStatus()</span></tt></a>&#8221; and
&#8220;<a class="reference internal" href="../method/db.setProfilingLevel/#db.setProfilingLevel" title="db.setProfilingLevel"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.setProfilingLevel()</span></tt></a>&#8221; provide wrappers
around this functionality in the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt>
shell.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The database cannot be locked with <a class="reference internal" href="../method/db.fsyncLock/#db.fsyncLock" title="db.fsyncLock"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.fsyncLock()</span></tt></a> while profiling is enabled.
You must disable profiling before locking the database with <a class="reference internal" href="../method/db.fsyncLock/#db.fsyncLock" title="db.fsyncLock"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.fsyncLock()</span></tt></a>.
Disable profiling using <a class="reference internal" href="../method/db.setProfilingLevel/#db.setProfilingLevel" title="db.setProfilingLevel"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.setProfilingLevel()</span></tt></a> as follows in the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell:</p>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">setProfilingLevel</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This command obtains a write lock on the affected database and will
block other operations until it has completed; however the write
lock is only in place while the enabling and disabling the
profiler, which is typically a short operation.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="listCommands">
<tt class="descname">listCommands</tt><a class="headerlink" href="#listCommands" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#listCommands" title="listCommands"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">listCommands</span></tt></a> command generates a list of all
database commands implemented for the current <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt>
instance.</p>
</dd></dl>

</div>
<div class="section" id="other-commands">
<h3>Other Commands<a class="headerlink" href="#other-commands" title="Permalink to this headline">¶</a></h3>
<dl class="dbcommand">
<dt id="reIndex">
<tt class="descname">reIndex</tt><a class="headerlink" href="#reIndex" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#reIndex" title="reIndex"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">reIndex</span></tt></a> command rebuilds all indexes for a
specified collection. Use the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">reIndex</span><span class="o">:</span> <span class="s2">&quot;collection&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>Normally, MongoDB compacts indexes during routine updates. For most
users, the <a class="reference internal" href="#reIndex" title="reIndex"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">reIndex</span></tt></a> command is unnecessary. However, it
may be worth running if the collection size has changed significantly
or if the indexes are consuming a disproportionate amount of disk space.</p>
<p>Note that the <a class="reference internal" href="#reIndex" title="reIndex"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">reIndex</span></tt></a> command will block the server against
writes and may take a long time for large collections.</p>
<p>Call <a class="reference internal" href="#reIndex" title="reIndex"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">reIndex</span></tt></a> using the following form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">reIndex</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This command obtains a write lock on the affected database and
will block other operations until it has completed.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="filemd5">
<tt class="descname">filemd5</tt><a class="headerlink" href="#filemd5" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#filemd5" title="filemd5"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">filemd5</span></tt></a> command returns the <a class="reference internal" href="../glossary/#term-md5"><em class="xref std std-term">md5</em></a> hashes for a single
files stored using the <a class="reference internal" href="../glossary/#term-gridfs"><em class="xref std std-term">GridFS</em></a> specification. Client libraries
use this command to verify that files are correctly written to MongoDB.
The command takes the <tt class="docutils literal"><span class="pre">files_id</span></tt> of the file in question and the
name of the GridFS root collection as arguments. For example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">filemd5</span><span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;4f1f10e37671b50e4ecd2776&quot;</span><span class="p">),</span> <span class="nx">root</span><span class="o">:</span> <span class="s2">&quot;fs&quot;</span> <span class="p">}</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>
<div class="section" id="mongos-commands">
<h2><a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> Commands<a class="headerlink" href="#mongos-commands" title="Permalink to this headline">¶</a></h2>
<dl class="dbcommand">
<dt id="flushRouterConfig">
<tt class="descname">flushRouterConfig</tt><a class="headerlink" href="#flushRouterConfig" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#flushRouterConfig" title="flushRouterConfig"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">flushRouterConfig</span></tt></a> clears the current cluster
information cached by a <a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instance and reloads all
<a class="reference internal" href="../glossary/#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a> metadata from the <a class="reference internal" href="../glossary/#term-config-database"><em class="xref std std-term">config database</em></a>.</p>
<p>This forces an update when the configuration database holds data
that is newer that the data cached in the <a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a>
process.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not modify the config data, except as explicitly
documented. A config database cannot typically tolerate manual
manipulation.</p>
</div>
<p><a class="reference internal" href="#flushRouterConfig" title="flushRouterConfig"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">flushRouterConfig</span></tt></a> is an administrative command that is
only available for <a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances.</p>
<p class="versionadded">
<span class="versionmodified">New in version 1.8.2.</span></p>
</dd></dl>

<dl class="dbcommand">
<dt id="isdbgrid">
<tt class="descname">isdbgrid</tt><a class="headerlink" href="#isdbgrid" title="Permalink to this definition">¶</a></dt>
<dd><p>This command verifies that a process is a <a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a>.</p>
<p>If you issue the <a class="reference internal" href="#isdbgrid" title="isdbgrid"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">isdbgrid</span></tt></a> command when connected to a
<a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a>, the response document includes the <tt class="docutils literal"><span class="pre">isdbgrid</span></tt>
field set to <tt class="docutils literal"><span class="pre">1</span></tt>. The returned document is similar to the
following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;isdbgrid&quot;</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;hostname&quot;</span> <span class="o">:</span> <span class="s2">&quot;app.example.net&quot;</span><span class="p">,</span> <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>If you issue the <a class="reference internal" href="#isdbgrid" title="isdbgrid"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">isdbgrid</span></tt></a> command when connected to a
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt>, MongoDB returns an error document. The
<a class="reference internal" href="#isdbgrid" title="isdbgrid"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">isdbgrid</span></tt></a> command is not available to <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt>.
The error document, however, also includes a line that reads
<tt class="docutils literal"><span class="pre">&quot;isdbgrid&quot;</span> <span class="pre">:</span> <span class="pre">1</span></tt>, just as in the document returned for a
<a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a>. The error document is similar to the following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
   <span class="s2">&quot;errmsg&quot;</span> <span class="o">:</span> <span class="s2">&quot;no such cmd: isdbgrid&quot;</span><span class="p">,</span>
   <span class="s2">&quot;bad cmd&quot;</span> <span class="o">:</span> <span class="p">{</span>
         <span class="s2">&quot;isdbgrid&quot;</span> <span class="o">:</span> <span class="mi">1</span>
   <span class="p">},</span>
   <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can instead use the <a class="reference internal" href="../replica-commands/#isMaster" title="isMaster"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">isMaster</span></tt></a> command to determine
connection to a <a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a>. When connected to a
<a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a>, the <a class="reference internal" href="../replica-commands/#isMaster" title="isMaster"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">isMaster</span></tt></a> command returns a document that
contains the string <tt class="docutils literal"><span class="pre">isdbgrid</span></tt> in the <tt class="docutils literal"><span class="pre">msg</span></tt> field.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="movePrimary">
<tt class="descname">movePrimary</tt><a class="headerlink" href="#movePrimary" title="Permalink to this definition">¶</a></dt>
<dd><p>In a <a class="reference internal" href="../glossary/#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a>, this command reassigns the database&#8217;s
<a class="reference internal" href="../glossary/#term-primary-shard"><em class="xref std std-term">primary shard</em></a>, which holds all un-sharded collections in
the database. <a class="reference internal" href="#movePrimary" title="movePrimary"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">movePrimary</span></tt></a> is an administrative command
that is only available for <a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances. Only use
<a class="reference internal" href="#movePrimary" title="movePrimary"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">movePrimary</span></tt></a> when removing a shard from a sharded
cluster.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p>Only use <a class="reference internal" href="#movePrimary" title="movePrimary"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">movePrimary</span></tt></a> when:</p>
<ul class="simple">
<li>the database does not contain any collections with data, <em>or</em></li>
<li>you have drained all sharded collections using the
<a class="reference internal" href="#removeShard" title="removeShard"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">removeShard</span></tt></a> command.</li>
</ul>
<p class="last">See <a class="reference internal" href="../../tutorial/remove-shards-from-cluster/"><em>Remove Shards from an Existing Sharded Cluster</em></a> for a complete
procedure.</p>
</div>
<p><a class="reference internal" href="#movePrimary" title="movePrimary"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">movePrimary</span></tt></a> changes the primary shard for this
database in the cluster metadata, and migrates all un-sharded
collections to the specified shard. Use the command with the
following form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">movePrimary</span> <span class="o">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="nx">to</span> <span class="o">:</span> <span class="s2">&quot;shard0001&quot;</span> <span class="p">}</span>
</pre></div>
</div>
<p>When the command returns, the database&#8217;s primary location will
shift to the designated <a class="reference internal" href="../glossary/#term-shard"><em class="xref std std-term">shard</em></a>. To fully decommission a
shard, use the <a class="reference internal" href="#removeShard" title="removeShard"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">removeShard</span></tt></a> command.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="split">
<tt class="descname">split</tt><a class="headerlink" href="#split" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#split" title="split"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">split</span></tt></a> command creates new <a class="reference internal" href="../glossary/#term-chunk"><em class="xref std std-term">chunks</em></a>
in a <a class="reference internal" href="../glossary/#term-sharding"><em class="xref std std-term">sharded</em></a> environment. While splitting is
typically managed automatically by the <a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances,
this command makes it possible for administrators to manually
create splits.</p>
<div class="admonition-in-normal-operation-there-is-no-need-to-manually-split-chunks admonition">
<p class="first admonition-title">In normal operation there is no need to manually split chunks</p>
<p class="last">The <a class="reference internal" href="../glossary/#term-balancer"><em class="xref std std-term">balancer</em></a> and other sharding infrastructure will
automatically create chunks in the course of normal
operations. See <a class="reference internal" href="../../core/sharding-internals/"><em>Sharding Internals</em></a> for more
information.</p>
</div>
<p>Consider the following example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">split</span> <span class="o">:</span> <span class="s2">&quot;test.people&quot;</span> <span class="p">,</span> <span class="nx">find</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">_id</span> <span class="o">:</span> <span class="mi">99</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>This command inserts a new split in the collection named
<tt class="docutils literal"><span class="pre">people</span></tt> in the <tt class="docutils literal"><span class="pre">test</span></tt> database. This will split the chunk
that contains the document that matches the query <tt class="docutils literal"><span class="pre">{</span> <span class="pre">_id</span> <span class="pre">:</span> <span class="pre">99</span>
<span class="pre">}</span></tt> in half. If the document specified by the query does not (yet)
exist, the <a class="reference internal" href="#split" title="split"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">split</span></tt></a> will divide the chunk where that
document <em>would</em> exist.</p>
<p>The split divides the chunk in half, and does <em>not</em> split the chunk
using the identified document as the middle. To define an arbitrary split
point, use the following form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">split</span> <span class="o">:</span> <span class="s2">&quot;test.people&quot;</span> <span class="p">,</span> <span class="nx">middle</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">_id</span> <span class="o">:</span> <span class="mi">99</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>This form is typically used when <a class="reference internal" href="../glossary/#term-pre-splitting"><em class="xref std std-term">pre-splitting</em></a> data in a
collection.</p>
<p><a class="reference internal" href="#split" title="split"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">split</span></tt></a> is an administrative command that is only
available for <a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances.</p>
</dd></dl>

</div>
<div class="section" id="internal-use-commands">
<h2>Internal Use Commands<a class="headerlink" href="#internal-use-commands" title="Permalink to this headline">¶</a></h2>
<dl class="dbcommand">
<dt id="availableQueryOptions">
<tt class="descname">availableQueryOptions</tt><a class="headerlink" href="#availableQueryOptions" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#availableQueryOptions" title="availableQueryOptions"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">availableQueryOptions</span></tt></a> is an internal command that is only
available on <a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="closeAllDatabases">
<tt class="descname">closeAllDatabases</tt><a class="headerlink" href="#closeAllDatabases" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#closeAllDatabases" title="closeAllDatabases"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">closeAllDatabases</span></tt></a> is an internal command that
invalidates all cursors and closes the open database files. The
next operation that uses the database will reopen the file.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This command obtains a global write lock and will block other
operations until it has completed.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="netstat">
<tt class="descname">netstat</tt><a class="headerlink" href="#netstat" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#netstat" title="netstat"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">netstat</span></tt></a> is an internal command that is only
available on <a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="setShardVersion">
<tt class="descname">setShardVersion</tt><a class="headerlink" href="#setShardVersion" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#setShardVersion" title="setShardVersion"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">setShardVersion</span></tt></a> is an internal command that supports
sharding functionality.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="getShardVersion">
<tt class="descname">getShardVersion</tt><a class="headerlink" href="#getShardVersion" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="../method/getShardVersion/#getShardVersion" title="getShardVersion"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">getShardVersion</span></tt></a> is an internal command that supports
sharding functionality.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="unsetSharding">
<tt class="descname">unsetSharding</tt><a class="headerlink" href="#unsetSharding" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#unsetSharding" title="unsetSharding"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">unsetSharding</span></tt></a> is an internal command that supports sharding
functionality.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="whatsmyuri">
<tt class="descname">whatsmyuri</tt><a class="headerlink" href="#whatsmyuri" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#whatsmyuri" title="whatsmyuri"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">whatsmyuri</span></tt></a> is an internal command.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="features">
<tt class="descname">features</tt><a class="headerlink" href="#features" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#features" title="features"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">features</span></tt></a> is an internal command that returns the build-level
feature settings.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="driverOIDTest">
<tt class="descname">driverOIDTest</tt><a class="headerlink" href="#driverOIDTest" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#driverOIDTest" title="driverOIDTest"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">driverOIDTest</span></tt></a> is an internal command.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="diagLogging">
<tt class="descname">diagLogging</tt><a class="headerlink" href="#diagLogging" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#diagLogging" title="diagLogging"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">diagLogging</span></tt></a> is an internal command.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This command obtains a write lock on the affected database and
will block other operations until it has completed.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="copydbgetnonce">
<tt class="descname">copydbgetnonce</tt><a class="headerlink" href="#copydbgetnonce" title="Permalink to this definition">¶</a></dt>
<dd><p>Client libraries use <a class="reference internal" href="#copydbgetnonce" title="copydbgetnonce"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">copydbgetnonce</span></tt></a> to get a one-time
password for use with the <a class="reference internal" href="#copydb" title="copydb"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">copydb</span></tt></a> command.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This command obtains a write lock on the affected database and
will block other operations until it has completed; however, the
write lock for this operation is short lived.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="dbHash">
<tt class="descname">dbHash</tt><a class="headerlink" href="#dbHash" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#dbHash" title="dbHash"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">dbHash</span></tt></a> is an internal command.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="medianKey">
<tt class="descname">medianKey</tt><a class="headerlink" href="#medianKey" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#medianKey" title="medianKey"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">medianKey</span></tt></a> is an internal command.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="geoWalk">
<tt class="descname">geoWalk</tt><a class="headerlink" href="#geoWalk" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#geoWalk" title="geoWalk"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">geoWalk</span></tt></a> is an internal command.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="sleep">
<tt class="descname">sleep</tt><a class="headerlink" href="#sleep" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#sleep" title="sleep"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">sleep</span></tt></a> is an internal command for testing purposes. The
<a class="reference internal" href="#sleep" title="sleep"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">sleep</span></tt></a> command forces the database to block all operations. It
takes the following options:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>w</strong> (<em>boolean</em>) &#8211; If true, obtain a global write lock. Otherwise
obtains a read lock.</li>
<li><strong>secs</strong> (<em>integer</em>) &#8211; Specifies the number of seconds to sleep.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">sleep</span><span class="o">:</span> <span class="p">{</span> <span class="nx">w</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">secs</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">seconds</span><span class="o">&gt;</span> <span class="p">}</span> <span class="p">}</span>
</pre></div>
</div>
<p>The above command places the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> instance in a
&#8220;write-lock&#8221; state for a specified (i.e. <tt class="docutils literal"><span class="pre">&lt;seconds&gt;</span></tt>) number of
seconds. Without arguments, <a class="reference internal" href="#sleep" title="sleep"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">sleep</span></tt></a>, causes a &#8220;read
lock&#8221; for 100 seconds.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><a class="reference internal" href="#sleep" title="sleep"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">sleep</span></tt></a> claims the lock specified in the <tt class="docutils literal"><span class="pre">w</span></tt>
argument and blocks <em>all</em> operations on the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt>
instance for the specified amount of time.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="getnonce">
<tt class="descname">getnonce</tt><a class="headerlink" href="#getnonce" title="Permalink to this definition">¶</a></dt>
<dd><p>Client libraries use <a class="reference internal" href="#getnonce" title="getnonce"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">getnonce</span></tt></a>  to generate a one-time
password for authentication.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="getoptime">
<tt class="descname">getoptime</tt><a class="headerlink" href="#getoptime" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#getoptime" title="getoptime"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">getoptime</span></tt></a> is an internal command.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="godinsert">
<tt class="descname">godinsert</tt><a class="headerlink" href="#godinsert" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#godinsert" title="godinsert"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">godinsert</span></tt></a> is an internal command for testing purposes only.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This command obtains a write lock on the affected database and will
block other operations until it has completed.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="clean">
<tt class="descname">clean</tt><a class="headerlink" href="#clean" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#clean" title="clean"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">clean</span></tt></a> is an internal command.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This command obtains a write lock on the affected database and will
block other operations until it has completed.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="applyOps">
<tt class="descname">applyOps</tt><a class="headerlink" href="#applyOps" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>operations</strong> (<em>array</em>) &#8211; an array of operations to perform.</li>
<li><strong>preCondition</strong> (<em>array</em>) &#8211; Optional. Defines one or more conditions that the destination must meet
applying the entries from the <tt class="docutils literal"><span class="pre">&lt;operations&gt;</span></tt> array.
Use <tt class="docutils literal"><span class="pre">ns</span></tt> to
specify a <a class="reference internal" href="../glossary/#term-namespace"><em class="xref std std-term">namespace</em></a>, <tt class="docutils literal"><span class="pre">q</span></tt> to specify a <a class="reference internal" href="../glossary/#term-query"><em class="xref std std-term">query</em></a> and
<tt class="docutils literal"><span class="pre">res</span></tt> to specify the result that the query should match. You may
specify zero, one, or many <tt class="docutils literal"><span class="pre">preCondition</span></tt> documents.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="#applyOps" title="applyOps"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">applyOps</span></tt></a> provides a way to apply entries from an
<a class="reference internal" href="../glossary/#term-oplog"><em class="xref std std-term">oplog</em></a> created by <a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a> members and
<a class="reference internal" href="../glossary/#term-master"><em class="xref std std-term">master</em></a> instances in a master/<a class="reference internal" href="../glossary/#term-slave"><em class="xref std std-term">slave</em></a>
deployment. <a class="reference internal" href="#applyOps" title="applyOps"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">applyOps</span></tt></a> is primarily an internal command
to support sharding functionality, and has the following prototype
form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">applyOps</span><span class="o">:</span> <span class="p">[</span> <span class="o">&lt;</span><span class="nx">operations</span><span class="o">&gt;</span> <span class="p">],</span> <span class="nx">preCondition</span><span class="o">:</span> <span class="p">[</span> <span class="p">{</span> <span class="nx">ns</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">namespace</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">q</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">query</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">res</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">result</span><span class="o">&gt;</span> <span class="p">}</span> <span class="p">]</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#applyOps" title="applyOps"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">applyOps</span></tt></a> applies oplog entries from the
<tt class="docutils literal"><span class="pre">&lt;operations&gt;</span></tt> array, to the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> instance. The
<tt class="docutils literal"><span class="pre">preCondition</span></tt> array provides the ability to specify conditions
that must be true in order to apply the oplog entry.</p>
<p>You can specify as many <tt class="docutils literal"><span class="pre">preCondition</span></tt> sets as needed. If you
specify the <tt class="docutils literal"><span class="pre">ns</span></tt> option, <a class="reference internal" href="#applyOps" title="applyOps"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">applyOps</span></tt></a> will only apply
oplog entries for the <a class="reference internal" href="../glossary/#term-collection"><em class="xref std std-term">collection</em></a> described by that
namespace. You may also specify a query in the <tt class="docutils literal"><span class="pre">q</span></tt> field with a
corresponding expected result in the <tt class="docutils literal"><span class="pre">res</span></tt> field that must match
in order to apply the oplog entry.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This command obtains a global write lock and will block other
operations until it has completed.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="replSetElect">
<tt class="descname">replSetElect</tt><a class="headerlink" href="#replSetElect" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#replSetElect" title="replSetElect"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetElect</span></tt></a> is an internal command that support replica set
functionality.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="replSetGetRBID">
<tt class="descname">replSetGetRBID</tt><a class="headerlink" href="#replSetGetRBID" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#replSetGetRBID" title="replSetGetRBID"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetGetRBID</span></tt></a> is an internal command that supports replica set
functionality.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="replSetHeartbeat">
<tt class="descname">replSetHeartbeat</tt><a class="headerlink" href="#replSetHeartbeat" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#replSetHeartbeat" title="replSetHeartbeat"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetHeartbeat</span></tt></a> is an internal command that supports
replica set functionality.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="replSetFresh">
<tt class="descname">replSetFresh</tt><a class="headerlink" href="#replSetFresh" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#replSetFresh" title="replSetFresh"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetFresh</span></tt></a> is an internal command that supports replica set
functionality.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="replSetMaintenance">
<tt class="descname">replSetMaintenance</tt><a class="headerlink" href="#replSetMaintenance" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="../replica-commands/#replSetMaintenance" title="replSetMaintenance"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetMaintenance</span></tt></a> admin command enables or disables the
maintenance mode for a <a class="reference internal" href="../glossary/#term-secondary"><em class="xref std std-term">secondary</em></a> member of a <a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica
set</em></a>.</p>
<p>The command has the following prototype form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">replSetMaintenance</span><span class="o">:</span> <span class="o">&lt;</span><span class="kr">boolean</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
<p>Consider the following behavior when running the
<a class="reference internal" href="../replica-commands/#replSetMaintenance" title="replSetMaintenance"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetMaintenance</span></tt></a> command:</p>
<ul class="simple">
<li>You cannot run the command on the Primary.</li>
<li>You must run the command against the <tt class="docutils literal"><span class="pre">admin</span></tt> database.</li>
<li>When enabled <tt class="docutils literal"><span class="pre">replSetMaintenance:</span> <span class="pre">1</span></tt>, the member enters the
<tt class="docutils literal"><span class="pre">RECOVERING</span></tt> state. While the secondary is <tt class="docutils literal"><span class="pre">RECOVERING</span></tt>:<ul>
<li>The member is not accessible for read operations.</li>
<li>The member continues to sync its <a class="reference internal" href="../glossary/#term-oplog"><em class="xref std std-term">oplog</em></a> from the Primary.</li>
</ul>
</li>
</ul>
</dd></dl>

<dl class="dbcommand">
<dt id="replSetTest">
<tt class="descname">replSetTest</tt><a class="headerlink" href="#replSetTest" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#replSetTest" title="replSetTest"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetTest</span></tt></a> is internal diagnostic command used for regression
tests that supports replica set functionality.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="writeBacksQueued">
<tt class="descname">writeBacksQueued</tt><a class="headerlink" href="#writeBacksQueued" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="../server-status/#writeBacksQueued" title="writeBacksQueued"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">writeBacksQueued</span></tt></a> is an internal command that returns
a document reporting there are operations in the write back queue
for the given <a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> and information about the queues.</p>
<dl class="data">
<dt id="hasOpsQueued">
<tt class="descname">hasOpsQueued</tt><a class="headerlink" href="#hasOpsQueued" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean.</p>
<p><a class="reference internal" href="#hasOpsQueued" title="hasOpsQueued"><tt class="xref mongodb mongodb-data docutils literal"><span class="pre">hasOpsQueued</span></tt></a> is <tt class="docutils literal"><span class="pre">true</span></tt> if there are <tt class="docutils literal"><span class="pre">write</span> <span class="pre">Back</span></tt>
operations queued.</p>
</dd></dl>

<dl class="data">
<dt id="totalOpsQueued">
<tt class="descname">totalOpsQueued</tt><a class="headerlink" href="#totalOpsQueued" title="Permalink to this definition">¶</a></dt>
<dd><p>Integer.</p>
<p><a class="reference internal" href="#totalOpsQueued" title="totalOpsQueued"><tt class="xref mongodb mongodb-data docutils literal"><span class="pre">totalOpsQueued</span></tt></a> reflects the number of operations queued.</p>
</dd></dl>

<dl class="data">
<dt id="queues">
<tt class="descname">queues</tt><a class="headerlink" href="#queues" title="Permalink to this definition">¶</a></dt>
<dd><p>Document.</p>
<p><a class="reference internal" href="#queues" title="queues"><tt class="xref mongodb mongodb-data docutils literal"><span class="pre">queues</span></tt></a> holds a sub-document where the fields are all
write back queues. These field hold a document with two fields
that reports on the state of the queue. The fields in these
documents are:</p>
<dl class="data">
<dt id="queues.n">
<tt class="descclassname">queues.</tt><tt class="descname">n</tt><a class="headerlink" href="#queues.n" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#queues.n" title="queues.n"><tt class="xref mongodb mongodb-data docutils literal"><span class="pre">queues.n</span></tt></a> reflects the size, by number of items, in
the queues.</p>
</dd></dl>

<dl class="data">
<dt id="queues.minutesSinceLastCall">
<tt class="descclassname">queues.</tt><tt class="descname">minutesSinceLastCall</tt><a class="headerlink" href="#queues.minutesSinceLastCall" title="Permalink to this definition">¶</a></dt>
<dd><p>The number of minutes since the last time the
<a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> touched this queue.</p>
</dd></dl>

</dd></dl>

<p>The command document has the following prototype form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span><span class="nx">writeBacksQueued</span><span class="o">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
<p>To call <a class="reference internal" href="../server-status/#writeBacksQueued" title="writeBacksQueued"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">writeBacksQueued</span></tt></a> from the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt>
shell, use the following <a class="reference internal" href="../method/db.runCommand/#db.runCommand" title="db.runCommand"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.runCommand()</span></tt></a> form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">({</span><span class="nx">writeBacksQueued</span><span class="o">:</span> <span class="mi">1</span><span class="p">})</span>
</pre></div>
</div>
<p>Consider the following example output:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;hasOpsQueued&quot;</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">&quot;totalOpsQueued&quot;</span> <span class="o">:</span> <span class="mi">7</span><span class="p">,</span>
  <span class="s2">&quot;queues&quot;</span> <span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;50b4f09f6671b11ff1944089&quot;</span> <span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;n&quot;</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;minutesSinceLastCall&quot;</span> <span class="o">:</span> <span class="mi">1</span> <span class="p">},</span>
          <span class="s2">&quot;50b4f09fc332bf1c5aeaaf59&quot;</span> <span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;n&quot;</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;minutesSinceLastCall&quot;</span> <span class="o">:</span> <span class="mi">0</span> <span class="p">},</span>
          <span class="s2">&quot;50b4f09f6671b1d51df98cb6&quot;</span> <span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;n&quot;</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;minutesSinceLastCall&quot;</span> <span class="o">:</span> <span class="mi">0</span> <span class="p">},</span>
          <span class="s2">&quot;50b4f0c67ccf1e5c6effb72e&quot;</span> <span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;n&quot;</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;minutesSinceLastCall&quot;</span> <span class="o">:</span> <span class="mi">0</span> <span class="p">},</span>
          <span class="s2">&quot;50b4faf12319f193cfdec0d1&quot;</span> <span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;n&quot;</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;minutesSinceLastCall&quot;</span> <span class="o">:</span> <span class="mi">4</span> <span class="p">},</span>
          <span class="s2">&quot;50b4f013d2c1f8d62453017e&quot;</span> <span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;n&quot;</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;minutesSinceLastCall&quot;</span> <span class="o">:</span> <span class="mi">0</span> <span class="p">},</span>
          <span class="s2">&quot;50b4f0f12319f193cfdec0d1&quot;</span> <span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;n&quot;</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;minutesSinceLastCall&quot;</span> <span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="connPoolSync">
<tt class="descname">connPoolSync</tt><a class="headerlink" href="#connPoolSync" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#connPoolSync" title="connPoolSync"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">connPoolSync</span></tt></a> is an internal command.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="checkShardingIndex">
<tt class="descname">checkShardingIndex</tt><a class="headerlink" href="#checkShardingIndex" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#checkShardingIndex" title="checkShardingIndex"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">checkShardingIndex</span></tt></a> is an internal command that supports the
sharding functionality.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="getShardMap">
<tt class="descname">getShardMap</tt><a class="headerlink" href="#getShardMap" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#getShardMap" title="getShardMap"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">getShardMap</span></tt></a> is an internal command that supports the sharding
functionality.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="splitChunk">
<tt class="descname">splitChunk</tt><a class="headerlink" href="#splitChunk" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#splitChunk" title="splitChunk"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">splitChunk</span></tt></a> is an internal command. Use the
<a class="reference internal" href="../method/sh.splitFind/#sh.splitFind" title="sh.splitFind"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.splitFind()</span></tt></a> and <a class="reference internal" href="../method/sh.splitAt/#sh.splitAt" title="sh.splitAt"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.splitAt()</span></tt></a> functions in the
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell to access this functionality.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="moveChunk">
<tt class="descname">moveChunk</tt><a class="headerlink" href="#moveChunk" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#moveChunk" title="moveChunk"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">moveChunk</span></tt></a> is an internal administrative command that
moves <a class="reference internal" href="../glossary/#term-chunk"><em class="xref std std-term">chunks</em></a> between <a class="reference internal" href="../glossary/#term-shard"><em class="xref std std-term">shards</em></a>.
You must issue the
<a class="reference internal" href="#moveChunk" title="moveChunk"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">moveChunk</span></tt></a>
command against the <a class="reference internal" href="../glossary/#term-admin-database"><em class="xref std std-term">admin database</em></a> in the form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="nx">moveChunk</span> <span class="o">:</span> <span class="o">&lt;</span><span class="nx">namespace</span><span class="o">&gt;</span> <span class="p">,</span>
                 <span class="nx">find</span> <span class="o">:</span> <span class="o">&lt;</span><span class="nx">query</span><span class="o">&gt;</span> <span class="p">,</span>
                 <span class="nx">to</span> <span class="o">:</span> <span class="o">&lt;</span><span class="nx">destination</span><span class="o">&gt;</span><span class="p">,</span>
                 <span class="o">&lt;</span><span class="nx">options</span><span class="o">&gt;</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>moveChunk</strong> &#8211; The name of the <a class="reference internal" href="../glossary/#term-collection"><em class="xref std std-term">collection</em></a> where
the <a class="reference internal" href="../glossary/#term-chunk"><em class="xref std std-term">chunk</em></a> exists. Specify the
collection&#8217;s full namespace, including
the database name.</li>
<li><strong>find</strong> &#8211; A document including the <a class="reference internal" href="../glossary/#term-shard-key"><em class="xref std std-term">shard key</em></a>.</li>
<li><strong>to</strong> &#8211; The identifier of the shard, that you want to migrate the
chunk to.</li>
<li><strong>_secondaryThrottle</strong> &#8211; Optional. Set to <tt class="docutils literal"><span class="pre">false</span></tt> by
default. Provides <a class="reference internal" href="../../core/write-operations/#write-concern"><em>write concern</em></a>
support for chunk
migrations.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>If you set <tt class="docutils literal"><span class="pre">_secondaryThrottle</span></tt> to <tt class="docutils literal"><span class="pre">true</span></tt>, during chunk
migrations when a <a class="reference internal" href="../glossary/#term-shard"><em class="xref std std-term">shard</em></a> hosted by a <a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a>,
the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> will wait until the <a class="reference internal" href="../glossary/#term-secondary"><em class="xref std std-term">secondary</em></a> members
replicate the migration operations continuing to migrate chunk
data. You may also configure <tt class="docutils literal"><span class="pre">_secondaryThrottle</span></tt> in the balancer
configuration.</p>
<p>Use the <a class="reference internal" href="../method/sh.moveChunk/#sh.moveChunk" title="sh.moveChunk"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.moveChunk()</span></tt></a> helper in the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt>
shell to migrate chunks manually.</p>
<p>The <a class="reference internal" href="../../core/sharding-internals/#sharding-chunk-migration"><em>chunk migration</em></a> section
describes how chunks move between shards on MongoDB.</p>
<p><a class="reference internal" href="#moveChunk" title="moveChunk"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">moveChunk</span></tt></a> will return the following if another cursor
is using the chunk you are moving:</p>
<div class="highlight-none"><div class="highlight"><pre>errmsg: &quot;The collection&#39;s metadata lock is already taken.&quot;
</pre></div>
</div>
<p>These errors usually occur when there are too many open
<a class="reference internal" href="../glossary/#term-cursor"><em class="xref std std-term">cursors</em></a> accessing the chunk you are migrating. You
can either wait until the cursors complete their operation or close
the cursors manually.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only use the <a class="reference internal" href="#moveChunk" title="moveChunk"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">moveChunk</span></tt></a> in special circumstances
such as preparing your <a class="reference internal" href="../glossary/#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a> for an initial
ingestion of data, or a large bulk import operation. See
<a class="reference internal" href="../../administration/sharding/#sharding-administration-create-chunks"><em>Create Chunks (Pre-Splitting)</em></a> for more information.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="writebacklisten">
<tt class="descname">writebacklisten</tt><a class="headerlink" href="#writebacklisten" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#writebacklisten" title="writebacklisten"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">writebacklisten</span></tt></a> is an internal command.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="dataSize">
<tt class="descname">dataSize</tt><a class="headerlink" href="#dataSize" title="Permalink to this definition">¶</a></dt>
<dd><p>For internal use.</p>
<p>The <a class="reference internal" href="../database-statistics/#dataSize" title="dataSize"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">dataSize</span></tt></a> command returns the size data size for a set of
data within a certain range:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">dataSize</span><span class="o">:</span> <span class="s2">&quot;database.collection&quot;</span><span class="p">,</span> <span class="nx">keyPattern</span><span class="o">:</span> <span class="p">{</span> <span class="nx">field</span><span class="o">:</span> <span class="mi">1</span> <span class="p">},</span> <span class="nx">min</span><span class="o">:</span> <span class="p">{</span> <span class="nx">field</span><span class="o">:</span> <span class="mi">10</span> <span class="p">},</span> <span class="nx">max</span><span class="o">:</span> <span class="p">{</span> <span class="nx">field</span><span class="o">:</span> <span class="mi">100</span> <span class="p">}</span> <span class="p">}</span>
</pre></div>
</div>
<p>This will return a document that contains the size of all matching
documents. Replace <tt class="docutils literal"><span class="pre">database.collection</span></tt> value with database
and collection from your deployment. The <tt class="docutils literal"><span class="pre">keyPattern</span></tt>, <tt class="docutils literal"><span class="pre">min</span></tt>,
and <tt class="docutils literal"><span class="pre">max</span></tt> parameters are options.</p>
<p>The amount of time required to return <a class="reference internal" href="../database-statistics/#dataSize" title="dataSize"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">dataSize</span></tt></a> depends on the
amount of data in the collection.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="authenticate">
<tt class="descname">authenticate</tt><a class="headerlink" href="#authenticate" title="Permalink to this definition">¶</a></dt>
<dd><p>Clients use <a class="reference internal" href="#authenticate" title="authenticate"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">authenticate</span></tt></a> to authenticate a
connection. When using the shell, use the command helper as follows:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">(</span> <span class="s2">&quot;username&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span> <span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="handshake">
<tt class="descname">handshake</tt><a class="headerlink" href="#handshake" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#handshake" title="handshake"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">handshake</span></tt></a> is an internal command.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="mapreduce.shardedfinish">
<tt class="descclassname">mapreduce.</tt><tt class="descname">shardedfinish</tt><a class="headerlink" href="#mapreduce.shardedfinish" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides internal functionality to support <a class="reference internal" href="../glossary/#term-map-reduce"><em class="xref std std-term">map-reduce</em></a> in
<a class="reference internal" href="../glossary/#term-sharded-cluster"><em class="xref std std-term">sharded</em></a> environments.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">&#8220;<a class="reference internal" href="#mapReduce" title="mapReduce"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">mapReduce</span></tt></a>&#8220;</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="_isSelf">
<tt class="descname">_isSelf</tt><a class="headerlink" href="#_isSelf" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#_isSelf" title="_isSelf"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">_isSelf</span></tt></a> is an internal command.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="_migrateClone">
<tt class="descname">_migrateClone</tt><a class="headerlink" href="#_migrateClone" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#_migrateClone" title="_migrateClone"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">_migrateClone</span></tt></a> is an internal command. Do not call
directly.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="_recvChunkAbort">
<tt class="descname">_recvChunkAbort</tt><a class="headerlink" href="#_recvChunkAbort" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#_recvChunkAbort" title="_recvChunkAbort"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">_recvChunkAbort</span></tt></a> is an internal command. Do not call
directly.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="_recvChunkCommit">
<tt class="descname">_recvChunkCommit</tt><a class="headerlink" href="#_recvChunkCommit" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#_recvChunkCommit" title="_recvChunkCommit"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">_recvChunkCommit</span></tt></a> is an internal command. Do not call
directly.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="_recvChunkStatus">
<tt class="descname">_recvChunkStatus</tt><a class="headerlink" href="#_recvChunkStatus" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#_recvChunkStatus" title="_recvChunkStatus"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">_recvChunkStatus</span></tt></a> is an internal command. Do not call
directly.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="_recvChunkStart">
<tt class="descname">_recvChunkStart</tt><a class="headerlink" href="#_recvChunkStart" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#_recvChunkStart" title="_recvChunkStart"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">_recvChunkStart</span></tt></a> is an internal command. Do not call
directly.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This command obtains a write lock on the affected database and
will block other operations until it has completed.</p>
</div>
</dd></dl>

<dl class="dbcommand">
<dt id="_skewClockCommand">
<tt class="descname">_skewClockCommand</tt><a class="headerlink" href="#_skewClockCommand" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#_skewClockCommand" title="_skewClockCommand"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">_skewClockCommand</span></tt></a> is an internal command. Do not call
directly.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="_testDistLockWithSkew">
<tt class="descname">_testDistLockWithSkew</tt><a class="headerlink" href="#_testDistLockWithSkew" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#_testDistLockWithSkew" title="_testDistLockWithSkew"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">_testDistLockWithSkew</span></tt></a> is an internal command. Do not call
directly.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="_testDistLockWithSyncCluster">
<tt class="descname">_testDistLockWithSyncCluster</tt><a class="headerlink" href="#_testDistLockWithSyncCluster" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#_testDistLockWithSyncCluster" title="_testDistLockWithSyncCluster"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">_testDistLockWithSyncCluster</span></tt></a> is an internal command. Do not call
directly.</p>
</dd></dl>

<dl class="dbcommand">
<dt id="_transferMods">
<tt class="descname">_transferMods</tt><a class="headerlink" href="#_transferMods" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#_transferMods" title="_transferMods"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">_transferMods</span></tt></a> is an internal command. Do not call
directly.</p>
</dd></dl>

</div>
</div>


<div id="btnv">
<ul id="btnvl">
</ul>
</div>
</div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">

<h3><a href="../../contents/">MongoDB Manual</a>
<small>(<a href="../../genindex/">Index</a>)</small>
</h3>

<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/">About MongoDB Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/">Installing MongoDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../replication/">Replication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sharding/">Sharding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../administration/">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crud/">CRUD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aggregation/">Aggregation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../indexes/">Indexes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../applications/">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mongo/">Using the MongoDB Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../use-cases/">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../">Reference</a></li>
</ul>

<h3>Formats</h3>
<ul class="this-page-menu">
  <li><a href="/master/single/">MongoDB Manual, Single HTML Page</a></li>
  <li><a href="http://docs.mongodb.org/master/MongoDB-Manual-master.pdf" rel="nofollow">MongoDB Manual, PDF Format</a></li>
  <li><a href="http://docs.mongodb.org/master/MongoDB-Manual-master.epub" rel="nofollow">MongoDB Manual, ePub Format</a></li>
</ul>

<h3>Translations</h3>
<ul class="translation-menu">
  <li><a href="http://jp.docs.mongodb.org/master/reference/commands" rel="nofollow">Japanese</a></li>
  <li><a href="http://cn.docs.mongodb.org/master/reference/commands" rel="nofollow">Chinese</a></li>
  <!-- <li><a href="http://docs.mongodb.org/master/reference/commands" rel="nofollow">English</a></li> -->
</ul>
<h3>Knowledge Base </h3>
<ul class="kb-menu">
  <li><a href="../../tutorial/">Tutorials</a></li>
  <li><a href="../../faq/">Frequently Asked Questions</a></li>
  <li><a href="../../use-cases/">Use Cases</a></li>
</ul><h3>MongoDB Wiki</h3>

<ul>
 <li><strong>Getting Started</strong>
   <ul>
     <!-- <li><a href="http://mongodb.org/display/DOCS/Quickstart">Quickstart</a></li> -->
     <li><a href="http://mongodb.org/display/DOCS/Introduction">Introduction</a></li>
     <li><a href="http://www.mongodb.org/downloads">Downloads</a></li>
     <!-- <li><a href="http://mongodb.org/display/DOCS/SQL+to+Mongo+Mapping+Chart">SQL to MongoDB Mapping</a></li> -->
   </ul>
 </li>
 <li><strong><a href="http://mongodb.org/display/DOCS/Developer+Zone">Developer Documentation</a></strong>
   <!-- <ul> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Connections">Connections</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Databases">Databases</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Collections">Collections</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Documents">Documents</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/GridFS">GridFS</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Indexes">Indexes</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Querying">Querying</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Aggregation">Aggregation</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Optimization">Optimization</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Inserting">Inserting</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Updating">Updating</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Removing">Removing</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/MapReduce">MapReduce</a></li> -->
   <!-- </ul> -->
 </li>
 <li><strong><a href="http://mongodb.org/display/DOCS/Admin+Zone">Administrative Documentation</a></strong>
   <ul>
     <!-- <li><a href="http://mongodb.org/display/DOCS/Components">Components</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Journaling">Journaling</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Production+Notes">Production Notes</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Replication">Replication</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Sharding">Sharding</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Monitoring+and+Diagnostics">Monitoring and Diagnostics</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Backups">Backups</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Durability+and+Repair">Durability and Repair</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Security+and+Authentication">Security and Authentication</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Starting+and+Stopping+Mongo">Starting/Stopping MongoDB</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/GridFS+Tools">GridFS Tools</a></li> -->
     <li><a href="http://mongodb.org/display/DOCS/DBA+Operations+from+the+Shell">DB Operations from the Shell</a></li>
     <!-- <li><a href="http://mongodb.org/display/DOCS/Architecture+and+Components">Architecture and Components</a></li> -->
     <li><a href="http://mongodb.org/display/DOCS/Windows">Windows</a></li>
     <li><a href="http://mongodb.org/display/DOCS/Troubleshooting">Troubleshooting</a></li>
   </ul>
 </li>
 <li><strong><a href="http://www.mongodb.org/display/DOCS/Community">Community and Ecosystem</a></strong>
   <ul>
     <li><a href="http://10gen.com">10gen</a></li>
     <li><a href="http://www.mongodb.org/events">MongoDB Events</a></li>
     <li><a href="http://planet.mongodb.org">Planet MongoDB</a></li>
     <li><a href="http://mongodb.org/display/DOCS/MongoDB+Masters">MongoDB Masters</a></li>
     <li><a href="http://mongodb.org/display/DOCS/Slides+and+Video">Slides and Video</a></li>
     <!-- <li><a href="http://cookbook.mongodb.org/">Cookbook</a></li> -->
     <li><a href="http://mongodb.org/display/DOCS/Hosting+Center">Hosting Center</a></li>
     <li><a href="http://mms.10gen.com/">MongoDB Monitoring Service</a> (<a href="http://mms.10gen.com/help/">docs</a>)</li>
     <li><a href="http://mongodb.org/display/DOCS/Admin+UIs">Administrative Interfaces</a></li>
     <!-- <li><a href="http://mongodb.org/display/DOCS/International+Docs">International Documentation</a></li> -->
     <li><a href="http://10gen.com/books/">MongoDB Books</a></li>
   </ul>
 </li>
 <li><strong><a href="http://www.mongodb.org/display/DOCS/Drivers">Drivers</a></strong>
   <ul>
     <li>JavaScript (<a href="http://mongodb.org/display/DOCS/Javascript+Language+Center">wiki</a>, <a href="http://api.mongodb.org/js/current">docs</a>)</li>
     <li>Python (<a href="http://mongodb.org/display/DOCS/Python+Language+Center">wiki</a>, <a href="http://api.mongodb.org/python/current">docs</a>)</li>
     <li>Ruby (<a href="http://mongodb.org/display/DOCS/Ruby+Language+Center">wiki</a>, <a href="http://api.mongodb.org/ruby/current">docs</a>)</li>
     <li>PHP (<a href="http://mongodb.org/display/DOCS/PHP+Language+Center">wiki</a>, <a href="http://php.net/mongo/">docs</a>)</li>
     <li>Perl (<a href="http://mongodb.org/display/DOCS/Perl+Language+Center">wiki</a>, <a href="http://api.mongodb.org/perl/current/">docs</a>)</li>
     <li>Java (<a href="http://mongodb.org/display/DOCS/Java+Language+Center">wiki</a>, <a href="http://api.mongodb.org/java/current">docs</a>)</li>
     <li>Scala (<a href="http://mongodb.org/display/DOCS/Scala+Language+Center">wiki</a>, <a href="http://api.mongodb.org/scala/casbah/current/">docs</a>)</li>
     <li>C# (<a href="http://mongodb.org/display/DOCS/CSharp+Language+Center">wiki</a>, <a href="http://api.mongodb.org/csharp/current/">docs</a>)</li>
     <li>C (<a href="http://mongodb.org/display/DOCS/C+Language+Center">wiki</a>, <a href="http://api.mongodb.org/c/current/">docs</a>)</li>
     <li>C++ (<a href="http://mongodb.org/pages/viewpage.action?pageId=133409">wiki</a>, <a href="http://api.mongodb.org/cplusplus/current/">docs</a>)</li>
     <li>Haskell (<a href="http://mongodb.org/display/DOCS/Haskell+Language+Center">wiki</a>, <a href="http://api.mongodb.org/haskell">docs</a>)</li>
     <li>Erlang (<a href="http://mongodb.org/display/DOCS/Erlang+Language+Center">wiki</a>, <a href="http://api.mongodb.org/erlang">docs</a>)</li>
   </ul>
 </li>
</ul>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
        &copy; Copyright 2011-2012, 10gen, Inc.  Licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons</a>.

    <p>MongoDB&reg;, Mongo&reg;, and the leaf logo are registered trademarks of 10gen, Inc.</p>
    <p>The MongoDB Documentation Project uses <a href="https://github.com/mongodb/docs">GitHub</a>. Fork the repository and submit pull requests to contribute.</p>
    <p>If you find any issues with the documentation feel free to open a <a href="http://jira.mongodb.org/browse/DOCS">Jira Case</a> and we'll work to resolve it promptly.</p>

  </div><script type="text/javascript">
var _gaq = _gaq || [];
var pluginUrl = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.') + 'google-analytics.com/plugins/ga/inpage_linkid.js';
_gaq.push(['_require', 'inpage_linkid', pluginUrl]);
_gaq.push(['_setAccount', 'UA-7301842-8']);
_gaq.push(['_setDomainName', 'docs.mongodb.org']);
_gaq.push(['_trackPageview']);
(function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
        })();
</script>

<script type="text/javascript">
document.write(unescape("%3Cscript src='" + document.location.protocol + "//munchkin.marketo.net/munchkin.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script>try { mktoMunchkin("017-HGS-593"); } catch(e) {}</script>
  </body>
</html>