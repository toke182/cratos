<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>JavaScript Interface &mdash; MongoDB Manual</title>

    <link rel="shortcut icon" href="http://media.mongodb.org/favicon.ico" />
    <meta name="robots" content="index" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="canonical" href="http://docs.mongodb.org/master/reference/javascript" />

    
    
    <link rel="stylesheet" href="../../_static/mongodb-docs.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.2.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
      <link rel="search" type="application/opensearchdescription+xml" href="http://docs.mongodb.org/osd.xml" title="MongoDB Help"/>
<link rel="author" title="About these documents" href="../../about/" />
<link rel="top" title="MongoDB Manual" href="../../" />
<!-- Put the following javascript before the closing </head> tag. -->
<script>
  (function() {
    var cx = '017213726194841070573:WMX6838984';
    var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
  })();
</script>
  </head>
  <body>
<div id="top-right">
        <div class="user-right">
                <ul id="header-menu-bar" class="ajs-menu-bar">
                <li class="normal"><a target="_blank" href="http://groups.google.com/group/mongodb-user">Forums</a></li>
                <li class="normal"><a target="_blank" href="http://blog.mongodb.org/">Blog</a></li>
                <li class="normal"><a href="http://www.mongodb.org/downloads">Download</a></li>
                <li class="normal"><a href="http://www.mongodb.org/display/DOCS/Drivers">Drivers</a></li>
                <li class="normal"><a href="http://www.mongodb.org/display/DOCS/Events">Events</a></li>
                <li class="normal last"><a class="last" href="http://www.mongodb.org/display/DOCS/International+Documentation">International</a></li>
                </ul>
        </div>
</div>
<div id="header-db" class="spread">
        <div class="split">
                <div id="logo">
                        <div><a href="../../"><img src="../../_static/logo-mongodb.png" width="190" height="55" alt="mongoDB" /></a></div>
                </div>
        </div>
<div class="search-db"><gcse:searchbox></gcse:searchbox></div>
<div id="etp">
<ul>
<li><a href="https://github.com/mongodb/docs/blob/master/source/reference/javascript.txt" target="_blank" title="Edit reference/javascript.txt on github">Edit this Page</a></li>
<li><a href="http://github.com/mongodb/docs" target="_blank" title="Fork the documentation on GitHub and contribute.">GitHub</a></li>
<li><a href="https://jira.mongodb.org/secure/CreateIssueDetails!init.jspa?pid=10380&issuetype=4&priority=4&summary=Comment+on%3a+%22reference/javascript%2Etxt%22" target="_blank" title="Report a problem with reference/javascript.txt on Jira">Report a problem</a></li>
</ul>
</div>
</div>  
    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            <div id="cse-results"><gcse:searchresults></gcse:searchresults></div>
            
  <div class="section" id="javascript-interface">
<h1>JavaScript Interface<a class="headerlink" href="#javascript-interface" title="Permalink to this headline">¶</a></h1>
<div class="section" id="data-manipulation">
<h2>Data Manipulation<a class="headerlink" href="#data-manipulation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="query-and-update-methods">
<span id="js-query-and-update-methods"></span><h3>Query and Update Methods<a class="headerlink" href="#query-and-update-methods" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="db.collection.find">
<tt class="descclassname">db.collection.</tt><tt class="descname">find</tt><big>(</big><em>query</em>, <em>projection</em><big>)</big><a class="headerlink" href="#db.collection.find" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="../method/db.collection.find/#db.collection.find" title="db.collection.find"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">find()</span></tt></a> method selects documents
in a collection and returns a <a class="reference internal" href="../glossary/#term-cursor"><em class="xref std std-term">cursor</em></a> to the selected
documents.</p>
<p>The <a class="reference internal" href="../method/db.collection.find/#db.collection.find" title="db.collection.find"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">find()</span></tt></a> method takes the
following parameters.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>query</strong> (<em>document</em>) &#8211; Optional. Specifies the selection criteria
using <a class="reference internal" href="../operators/"><em>query operators</em></a>. Omit the
<tt class="docutils literal"><span class="pre">query</span></tt> parameter or pass an empty document (e.g. <tt class="docutils literal"><span class="pre">{}</span></tt>)
to return all documents in the collection.</li>
<li><strong>projection</strong> (<em>document</em>) &#8211; <p>Optional. Controls the fields to return, or the
<a class="reference internal" href="../glossary/#term-projection"><em class="xref std std-term">projection</em></a>. The <tt class="docutils literal"><span class="pre">projection</span></tt> argument will
resemble the following prototype:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">field1</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">,</span> <span class="nx">field2</span><span class="o">:</span> <span class="kr">boolean</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">boolean</span></tt> can take the following include or exclude
values:</p>
<ul>
<li><tt class="docutils literal"><span class="pre">1</span></tt> or <tt class="docutils literal"><span class="pre">true</span></tt> to include. The <a class="reference internal" href="../method/db.collection.find/#db.collection.find" title="db.collection.find"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">find()</span></tt></a> method always includes the
<a class="reference internal" href="../glossary/#term-id"><em class="xref std std-term">_id</em></a> field even if the field is not explicitly
stated to return in the <a class="reference internal" href="../glossary/#term-projection"><em class="xref std std-term">projection</em></a> parameter.</li>
<li><tt class="docutils literal"><span class="pre">0</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt> to exclude.</li>
</ul>
<p>The <tt class="docutils literal"><span class="pre">projection</span></tt> cannot contain both include and exclude
specifications except for the exclusion of the <tt class="docutils literal"><span class="pre">_id</span></tt> field.</p>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A <a class="reference internal" href="../glossary/#term-cursor"><em class="xref std std-term">cursor</em></a> to the documents that match
the <tt class="docutils literal"><span class="pre">query</span></tt> criteria and contain the <tt class="docutils literal"><span class="pre">projection</span></tt> fields.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell, you can access the returned
documents directly without explicitly using the JavaScript cursor
handling method. Executing the query directly on the
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell prompt automatically iterates the cursor
to display up to the first 20 documents. Type <tt class="docutils literal"><span class="pre">it</span></tt> to continue
iteration.</p>
</div>
<p>Consider the following examples of the <a class="reference internal" href="../method/db.collection.find/#db.collection.find" title="db.collection.find"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">find()</span></tt></a> method:</p>
<ul>
<li><p class="first">To select all documents in a collection, call the
<a class="reference internal" href="../method/db.collection.find/#db.collection.find" title="db.collection.find"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">find()</span></tt></a> method with no parameters:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span>
</pre></div>
</div>
<p>This operation returns all the documents with all the fields from
the collection <tt class="docutils literal"><span class="pre">products</span></tt>. By default, in the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt>
shell, the cursor returns the first batch of 20 matching
documents. In the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell, iterate through the next
batch by typing <tt class="docutils literal"><span class="pre">it</span></tt>. Use the appropriate cursor
handling mechanism for your specific language driver.</p>
</li>
<li><p class="first">To select the documents that match a selection criteria, call the
<a class="reference internal" href="../method/db.collection.find/#db.collection.find" title="db.collection.find"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">find()</span></tt></a> method with the <tt class="docutils literal"><span class="pre">query</span></tt>
criteria:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="p">{</span> <span class="nx">qty</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">25</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>This operation returns all the documents from the collection
<tt class="docutils literal"><span class="pre">products</span></tt> where <tt class="docutils literal"><span class="pre">qty</span></tt> is greater than <tt class="docutils literal"><span class="pre">25</span></tt>, including all fields.</p>
</li>
<li><p class="first">To select the documents that match a selection criteria and
return, or <em>project</em> only certain fields into the result set,
call the <a class="reference internal" href="../method/db.collection.find/#db.collection.find" title="db.collection.find"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">find()</span></tt></a> method with the
<tt class="docutils literal"><span class="pre">query</span></tt> criteria and the <tt class="docutils literal"><span class="pre">projection</span></tt> parameter, as in the
following example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="p">{</span> <span class="nx">qty</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">25</span> <span class="p">}</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">item</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">qty</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>This operation returns all the documents from the collection
<tt class="docutils literal"><span class="pre">products</span></tt> where <tt class="docutils literal"><span class="pre">qty</span></tt> is greater than <tt class="docutils literal"><span class="pre">25</span></tt>. The documents
in the result set only include the <tt class="docutils literal"><span class="pre">_id</span></tt>, <tt class="docutils literal"><span class="pre">item</span></tt>, and <tt class="docutils literal"><span class="pre">qty</span></tt>
fields using &#8220;inclusion&#8221; projection. <a class="reference internal" href="../method/db.collection.find/#db.collection.find" title="db.collection.find"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">find()</span></tt></a> always returns the <tt class="docutils literal"><span class="pre">_id</span></tt> field, even
when not explicitly included:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span> <span class="o">:</span> <span class="s2">&quot;pencil&quot;</span><span class="p">,</span> <span class="s2">&quot;qty&quot;</span> <span class="o">:</span> <span class="mi">50</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;50634d86be4617f17bb159cd&quot;</span><span class="p">),</span> <span class="s2">&quot;item&quot;</span> <span class="o">:</span> <span class="s2">&quot;bottle&quot;</span><span class="p">,</span> <span class="s2">&quot;qty&quot;</span> <span class="o">:</span> <span class="mi">30</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;50634dbcbe4617f17bb159d0&quot;</span><span class="p">),</span> <span class="s2">&quot;item&quot;</span> <span class="o">:</span> <span class="s2">&quot;paper&quot;</span><span class="p">,</span> <span class="s2">&quot;qty&quot;</span> <span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first">To select the documents that match a query criteria and exclude a
set of fields from the resulting documents, call the
<a class="reference internal" href="../method/db.collection.find/#db.collection.find" title="db.collection.find"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">find()</span></tt></a> method with the <tt class="docutils literal"><span class="pre">query</span></tt>
criteria and the <tt class="docutils literal"><span class="pre">projection</span></tt> parameter using the <tt class="docutils literal"><span class="pre">exclude</span></tt>
syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="p">{</span> <span class="nx">qty</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">25</span> <span class="p">}</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">_id</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">qty</span><span class="o">:</span> <span class="mi">0</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>The query will return all the documents from the collection
<tt class="docutils literal"><span class="pre">products</span></tt> where <tt class="docutils literal"><span class="pre">qty</span></tt> is greater than <tt class="docutils literal"><span class="pre">25</span></tt>. The documents
in the result set will contain all fields <em>except</em> the <tt class="docutils literal"><span class="pre">_id</span></tt>
and <tt class="docutils literal"><span class="pre">qty</span></tt> fields, as in the following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;item&quot;</span> <span class="o">:</span> <span class="s2">&quot;pencil&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span> <span class="o">:</span> <span class="s2">&quot;no.2&quot;</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&quot;item&quot;</span> <span class="o">:</span> <span class="s2">&quot;bottle&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span> <span class="o">:</span> <span class="s2">&quot;blue&quot;</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&quot;item&quot;</span> <span class="o">:</span> <span class="s2">&quot;paper&quot;</span> <span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="db.collection.findOne">
<tt class="descclassname">db.collection.</tt><tt class="descname">findOne</tt><big>(</big><em>query</em><big>)</big><a class="headerlink" href="#db.collection.findOne" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>query</strong> (<em>document</em>) &#8211; Optional. A <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a> that specifies the <a class="reference internal" href="../glossary/#term-query"><em class="xref std std-term">query</em></a>
using the JSON-like syntax and <a class="reference internal" href="../operators/"><em>query operators</em></a>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">One document that satisfies the query specified as the
argument to this method.</p>
</td>
</tr>
</tbody>
</table>
<p>Returns only one document that satisfies the specified query. If
multiple documents satisfy the query, this method returns the first
document according to the <a class="reference internal" href="../glossary/#term-natural-order"><em class="xref std std-term">natural order</em></a> which reflects the
order of documents on the disc. In <a class="reference internal" href="../glossary/#term-capped-collection"><em class="xref std std-term">capped collections</em></a>, natural order is the same as insertion order.</p>
</dd></dl>

<dl class="method">
<dt id="db.collection.findAndModify">
<tt class="descclassname">db.collection.</tt><tt class="descname">findAndModify</tt><big>(</big><big>)</big><a class="headerlink" href="#db.collection.findAndModify" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="../method/db.collection.findAndModify/#db.collection.findAndModify" title="db.collection.findAndModify"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.findAndModify()</span></tt></a> method atomically
modifies and returns a single document. By default, the returned
document does not include the modifications made on the update. To
return the document with the modifications made on the update, use
the <tt class="docutils literal"><span class="pre">new</span></tt> option.</p>
<p>The <a class="reference internal" href="../method/db.collection.findAndModify/#db.collection.findAndModify" title="db.collection.findAndModify"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.findAndModify()</span></tt></a> method takes a document
parameter with the following subdocument fields:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Fields:</th><td class="field-body"><ul class="first last simple">
<li><strong>query</strong> (<em>document</em>) &#8211; <p>Optional. Specifies the selection criteria for the
modification. The <tt class="docutils literal"><span class="pre">query</span></tt> field employs the same
<a class="reference internal" href="../operators/#query-selectors"><em>query selectors</em></a> as used in the
<a class="reference internal" href="../method/db.collection.find/#db.collection.find" title="db.collection.find"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.find()</span></tt></a> method. Although the query may
match multiple documents, <a class="reference internal" href="../method/db.collection.findAndModify/#db.collection.findAndModify" title="db.collection.findAndModify"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">findAndModify()</span></tt></a> will
only select one document to modify.</p>
<p>The <tt class="docutils literal"><span class="pre">query</span></tt> field has the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">query</span><span class="o">:</span> <span class="p">{</span> <span class="o">&lt;</span><span class="nx">query</span> <span class="nx">expression</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
</li>
<li><strong>sort</strong> (<em>document</em>) &#8211; <p>Optional. Determines which document the operation will
modify if the query selects multiple
documents. <a class="reference internal" href="../method/db.collection.findAndModify/#db.collection.findAndModify" title="db.collection.findAndModify"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">findAndModify()</span></tt></a> will modify the first
document in the sort order specified by this argument.</p>
<p>The <tt class="docutils literal"><span class="pre">sort</span></tt> field has the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">sort</span><span class="o">:</span> <span class="p">{</span> <span class="nx">field1</span><span class="o">:</span> <span class="nx">value1</span><span class="p">,</span> <span class="nx">field2</span><span class="o">:</span> <span class="nx">value2</span><span class="p">,</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</div>
</li>
<li><strong>remove</strong> (<em>boolean</em>) &#8211; <p>Optional if <tt class="docutils literal"><span class="pre">update</span></tt> field exists. When <tt class="docutils literal"><span class="pre">true</span></tt>, removes
the selected document. The default is <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
<p>The <tt class="docutils literal"><span class="pre">remove</span></tt> field has the following syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">remove</span><span class="o">:</span> <span class="o">&lt;</span><span class="kr">boolean</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><strong>update</strong> (<em>document</em>) &#8211; <p>Optional if <tt class="docutils literal"><span class="pre">remove</span></tt> field exists. Performs an update of
the selected document. The <tt class="docutils literal"><span class="pre">update</span></tt> field employs the same
<a class="reference internal" href="../operators/#update-operators"><em>update operators</em></a> or <tt class="docutils literal"><span class="pre">field:</span> <span class="pre">value</span></tt>
specifications to modify the selected document.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">update</span><span class="o">:</span> <span class="p">{</span> <span class="o">&lt;</span><span class="nx">update</span> <span class="nx">expression</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
</li>
<li><strong>new</strong> (<em>boolean</em>) &#8211; <p>Optional. When <tt class="docutils literal"><span class="pre">true</span></tt>, returns the modified document rather
than the original. The <a class="reference internal" href="../commands/#findAndModify" title="findAndModify"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">findAndModify</span></tt></a> method
ignores the <tt class="docutils literal"><span class="pre">new</span></tt> option for <tt class="docutils literal"><span class="pre">remove</span></tt> operations. The
default is <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="k">new</span><span class="o">:</span> <span class="o">&lt;</span><span class="kr">boolean</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><strong>fields</strong> (<em>document</em>) &#8211; <p>Optional. A subset of fields to return.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">fields</span><span class="o">:</span> <span class="p">{</span> <span class="nx">field1</span><span class="o">:</span> <span class="o">&lt;</span><span class="kr">boolean</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">field2</span><span class="o">:</span> <span class="o">&lt;</span><span class="kr">boolean</span><span class="o">&gt;</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</div>
</li>
<li><strong>upsert</strong> (<em>boolean</em>) &#8211; <p>Optional. Used in conjunction with the <tt class="docutils literal"><span class="pre">update</span></tt> field. When
<tt class="docutils literal"><span class="pre">true</span></tt>, <a class="reference internal" href="../commands/#findAndModify" title="findAndModify"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">findAndModify</span></tt></a> creates a new document
if the <tt class="docutils literal"><span class="pre">query</span></tt> returns no documents. The default is
<tt class="docutils literal"><span class="pre">false</span></tt>. In version 2.2, the <a class="reference internal" href="../commands/#findAndModify" title="findAndModify"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">findAndModify</span></tt></a>
command returns <tt class="docutils literal"><span class="pre">null</span></tt> when <tt class="docutils literal"><span class="pre">upsert</span></tt> is <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">upsert</span><span class="o">:</span> <span class="o">&lt;</span><span class="kr">boolean</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Consider the following example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">findAndModify</span><span class="p">(</span> <span class="p">{</span>
    <span class="nx">query</span><span class="o">:</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Tom&quot;</span><span class="p">,</span> <span class="nx">state</span><span class="o">:</span> <span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="nx">rating</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">10</span> <span class="p">}</span> <span class="p">},</span>
    <span class="nx">sort</span><span class="o">:</span> <span class="p">{</span> <span class="nx">rating</span><span class="o">:</span> <span class="mi">1</span> <span class="p">},</span>
    <span class="nx">update</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$inc</span><span class="o">:</span> <span class="p">{</span> <span class="nx">score</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span>
    <span class="p">}</span> <span class="p">);</span>
</pre></div>
</div>
<p>This command performs the following actions:</p>
<ol class="arabic simple">
<li>The <tt class="docutils literal"><span class="pre">query</span></tt> finds a document in the <tt class="docutils literal"><span class="pre">people</span></tt> collection where
the <tt class="docutils literal"><span class="pre">name</span></tt> field has the value <tt class="docutils literal"><span class="pre">Tom</span></tt>, the <tt class="docutils literal"><span class="pre">state</span></tt> field has
the value <tt class="docutils literal"><span class="pre">active</span></tt> and the <tt class="docutils literal"><span class="pre">rating</span></tt> field has a value
<a class="reference internal" href="../operators/#_S_gt" title="$gt"><tt class="xref mongodb mongodb-operator docutils literal"><span class="pre">greater</span> <span class="pre">than</span></tt></a> 10.</li>
<li>The <tt class="docutils literal"><span class="pre">sort</span></tt> orders the results of the query in ascending order.</li>
<li>The update <a class="reference internal" href="../operators/#_S_inc" title="$inc"><tt class="xref mongodb mongodb-operator docutils literal"><span class="pre">increments</span></tt></a> the value of the
<tt class="docutils literal"><span class="pre">score</span></tt> field by 1.</li>
<li>The command returns the original unmodified document
selected for this update.</li>
</ol>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">When using <a class="reference internal" href="../commands/#findAndModify" title="findAndModify"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">findAndModify</span></tt></a> in a <a class="reference internal" href="../glossary/#term-sharding"><em class="xref std std-term">sharded</em></a> environment, the <tt class="docutils literal"><span class="pre">query</span></tt> must contain the
<a class="reference internal" href="../glossary/#term-shard-key"><em class="xref std std-term">shard key</em></a> for all operations against the shard
cluster. <a class="reference internal" href="../commands/#findAndModify" title="findAndModify"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">findAndModify</span></tt></a> operations issued against
<a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instances for non-sharded collections function
normally.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="db.collection.insert">
<tt class="descclassname">db.collection.</tt><tt class="descname">insert</tt><big>(</big><em>document</em><big>)</big><a class="headerlink" href="#db.collection.insert" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="../method/db.collection.insert/#db.collection.insert" title="db.collection.insert"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">insert()</span></tt></a> method inserts a
document or documents into a collection.</p>
<p class="versionchanged">
<span class="versionmodified">Changed in version 2.2: </span>The <a class="reference internal" href="../method/db.collection.insert/#db.collection.insert" title="db.collection.insert"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">insert()</span></tt></a> method can accept
an array of documents to perform a bulk insert of the
documents into the collection.</p>
<p>Consider the following behaviors of the <a class="reference internal" href="../method/db.collection.insert/#db.collection.insert" title="db.collection.insert"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">insert()</span></tt></a> method:</p>
<ul class="simple">
<li>If the collection does not exist, then the <a class="reference internal" href="../method/db.collection.insert/#db.collection.insert" title="db.collection.insert"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">insert()</span></tt></a> method will create the collection.</li>
<li>If the document does not specify an <a class="reference internal" href="../glossary/#term-id"><em class="xref std std-term">_id</em></a> field,
then MongoDB will add the <tt class="docutils literal"><span class="pre">_id</span></tt> field and assign a unique
<a class="reference internal" href="../glossary/#term-objectid"><em class="xref std std-term">ObjectId</em></a> for the document before inserting. Most drivers
create an ObjectId  and insert the <tt class="docutils literal"><span class="pre">_id</span></tt> field, but the
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> will create and populate the <tt class="docutils literal"><span class="pre">_id</span></tt> if the
driver or application does not.</li>
<li>If the document specifies a new field, then the <a class="reference internal" href="../method/db.collection.insert/#db.collection.insert" title="db.collection.insert"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">insert()</span></tt></a> method inserts the document with the
new field. This requires no changes to the data model for the
collection or the existing documents.</li>
</ul>
<p>The <a class="reference internal" href="../method/db.collection.insert/#db.collection.insert" title="db.collection.insert"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">insert()</span></tt></a> method takes one of
the following parameters:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>document</strong> &#8211; A document to insert into the collection.</li>
<li><strong>documents</strong> (<em>array</em>) &#8211; <p class="versionadded">
<span class="versionmodified">New in version 2.2.</span></p>
<p>An array of documents to insert into the collection.</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Consider the following examples of the <a class="reference internal" href="../method/db.collection.insert/#db.collection.insert" title="db.collection.insert"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">insert()</span></tt></a> method:</p>
<ul>
<li><p class="first">To insert a single document and have MongoDB generate the unique
<tt class="docutils literal"><span class="pre">_id</span></tt>, omit the <tt class="docutils literal"><span class="pre">_id</span></tt> field in the document and pass the
document to the <a class="reference internal" href="../method/db.collection.insert/#db.collection.insert" title="db.collection.insert"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">insert()</span></tt></a>
method as in the following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span> <span class="p">{</span> <span class="nx">item</span><span class="o">:</span> <span class="s2">&quot;card&quot;</span><span class="p">,</span> <span class="nx">qty</span><span class="o">:</span> <span class="mi">15</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>This operation inserts a new document into the <tt class="docutils literal"><span class="pre">products</span></tt>
collection with the <tt class="docutils literal"><span class="pre">item</span></tt> field set to <tt class="docutils literal"><span class="pre">card</span></tt>, the <tt class="docutils literal"><span class="pre">qty</span></tt>
field set to <tt class="docutils literal"><span class="pre">15</span></tt>, and the <tt class="docutils literal"><span class="pre">_id</span></tt> field set to a unique
<tt class="docutils literal"><span class="pre">ObjectId</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;5063114bd386d8fadbd6b004&quot;</span><span class="p">),</span> <span class="s2">&quot;item&quot;</span> <span class="o">:</span> <span class="s2">&quot;card&quot;</span><span class="p">,</span> <span class="s2">&quot;qty&quot;</span> <span class="o">:</span> <span class="mi">15</span> <span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Most MongoDB driver clients will include the <tt class="docutils literal"><span class="pre">_id</span></tt> field and
generate an <tt class="docutils literal"><span class="pre">ObjectId</span></tt> before sending the insert operation to
MongoDB; however, if the client sends a document without an <tt class="docutils literal"><span class="pre">_id</span></tt>
field, the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> will add the <tt class="docutils literal"><span class="pre">_id</span></tt> field and generate
the <tt class="docutils literal"><span class="pre">ObjectId</span></tt>.</p>
</div>
</li>
<li><p class="first">To insert a single document, with a custom <tt class="docutils literal"><span class="pre">_id</span></tt> field, include
the <tt class="docutils literal"><span class="pre">_id</span></tt> field set to a unique identifier and pass the
document to the <a class="reference internal" href="../method/db.collection.insert/#db.collection.insert" title="db.collection.insert"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">insert()</span></tt></a>
method as follows:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span> <span class="p">{</span> <span class="nx">_id</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span> <span class="nx">item</span><span class="o">:</span> <span class="s2">&quot;box&quot;</span><span class="p">,</span> <span class="nx">qty</span><span class="o">:</span> <span class="mi">20</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>This operation inserts a new document in the <tt class="docutils literal"><span class="pre">products</span></tt>
collection with the <tt class="docutils literal"><span class="pre">_id</span></tt> field set to <tt class="docutils literal"><span class="pre">10</span></tt>, the <tt class="docutils literal"><span class="pre">item</span></tt>
field set to <tt class="docutils literal"><span class="pre">box</span></tt>, the <tt class="docutils literal"><span class="pre">qty</span></tt> field set to <tt class="docutils literal"><span class="pre">20</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span> <span class="o">:</span> <span class="s2">&quot;box&quot;</span><span class="p">,</span> <span class="s2">&quot;qty&quot;</span> <span class="o">:</span> <span class="mi">20</span> <span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Most MongoDB driver clients will include the <tt class="docutils literal"><span class="pre">_id</span></tt> field and
generate an <tt class="docutils literal"><span class="pre">ObjectId</span></tt> before sending the insert operation to
MongoDB; however, if the client sends a document without an <tt class="docutils literal"><span class="pre">_id</span></tt>
field, the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> will add the <tt class="docutils literal"><span class="pre">_id</span></tt> field and generate
the <tt class="docutils literal"><span class="pre">ObjectId</span></tt>.</p>
</div>
</li>
<li><p class="first">To insert multiple documents, pass an array of documents to the
<a class="reference internal" href="../method/db.collection.insert/#db.collection.insert" title="db.collection.insert"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">insert()</span></tt></a> method as in the
following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span> <span class="p">[</span> <span class="p">{</span> <span class="nx">_id</span><span class="o">:</span> <span class="mi">11</span><span class="p">,</span> <span class="nx">item</span><span class="o">:</span> <span class="s2">&quot;pencil&quot;</span><span class="p">,</span> <span class="nx">qty</span><span class="o">:</span> <span class="mi">50</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;no.2&quot;</span> <span class="p">},</span>
                      <span class="p">{</span>          <span class="nx">item</span><span class="o">:</span> <span class="s2">&quot;pen&quot;</span><span class="p">,</span> <span class="nx">qty</span><span class="o">:</span> <span class="mi">20</span> <span class="p">},</span>
                      <span class="p">{</span>          <span class="nx">item</span><span class="o">:</span> <span class="s2">&quot;eraser&quot;</span><span class="p">,</span> <span class="nx">qty</span><span class="o">:</span> <span class="mi">25</span> <span class="p">}</span> <span class="p">]</span> <span class="p">)</span>
</pre></div>
</div>
<p>The operation will insert three documents into the <tt class="docutils literal"><span class="pre">products</span></tt>
collection:</p>
<ul class="simple">
<li>A document with the fields <tt class="docutils literal"><span class="pre">_id</span></tt> set to <tt class="docutils literal"><span class="pre">11</span></tt>, <tt class="docutils literal"><span class="pre">item</span></tt>
set to <tt class="docutils literal"><span class="pre">pencil</span></tt>, <tt class="docutils literal"><span class="pre">qty</span></tt> set to <tt class="docutils literal"><span class="pre">50</span></tt>, and the <tt class="docutils literal"><span class="pre">type</span></tt> set
to <tt class="docutils literal"><span class="pre">no.2</span></tt>.</li>
<li>A document with the fields <tt class="docutils literal"><span class="pre">_id</span></tt> set to a unique
<tt class="docutils literal"><span class="pre">objectid</span></tt>, <tt class="docutils literal"><span class="pre">item</span></tt> set to <tt class="docutils literal"><span class="pre">pen</span></tt>,
and <tt class="docutils literal"><span class="pre">qty</span></tt> set to <tt class="docutils literal"><span class="pre">20</span></tt>.</li>
<li>A document with the fields <tt class="docutils literal"><span class="pre">_id</span></tt> set to a unique
<tt class="docutils literal"><span class="pre">objectid</span></tt>, <tt class="docutils literal"><span class="pre">item</span></tt> set to
<tt class="docutils literal"><span class="pre">eraser</span></tt>, and <tt class="docutils literal"><span class="pre">qty</span></tt> set to <tt class="docutils literal"><span class="pre">25</span></tt>.</li>
</ul>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span> <span class="o">:</span> <span class="s2">&quot;pencil&quot;</span><span class="p">,</span> <span class="s2">&quot;qty&quot;</span> <span class="o">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span> <span class="o">:</span> <span class="s2">&quot;no.2&quot;</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;50631bc0be4617f17bb159ca&quot;</span><span class="p">),</span> <span class="s2">&quot;item&quot;</span> <span class="o">:</span> <span class="s2">&quot;pen&quot;</span><span class="p">,</span> <span class="s2">&quot;qty&quot;</span> <span class="o">:</span> <span class="mi">20</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;50631bc0be4617f17bb159cb&quot;</span><span class="p">),</span> <span class="s2">&quot;item&quot;</span> <span class="o">:</span> <span class="s2">&quot;eraser&quot;</span><span class="p">,</span> <span class="s2">&quot;qty&quot;</span> <span class="o">:</span> <span class="mi">25</span> <span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="db.collection.save">
<tt class="descclassname">db.collection.</tt><tt class="descname">save</tt><big>(</big><em>document</em><big>)</big><a class="headerlink" href="#db.collection.save" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="../method/db.collection.save/#db.collection.save" title="db.collection.save"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">save()</span></tt></a> method updates an
existing document or inserts a document depending on the parameter.</p>
<p>The <a class="reference internal" href="../method/db.collection.save/#db.collection.save" title="db.collection.save"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">save()</span></tt></a> method takes the following
parameter:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>document</strong> &#8211; <p>Specify a document to save to the collection.</p>
<p><strong>If</strong> the document does not contain an <a class="reference internal" href="../glossary/#term-id"><em class="xref std std-term">_id</em></a> field,
then the <a class="reference internal" href="../method/db.collection.save/#db.collection.save" title="db.collection.save"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">save()</span></tt></a> method performs
an insert with the specified fields in the document as well
as an <tt class="docutils literal"><span class="pre">_id</span></tt> field with a unique <a class="reference internal" href="../glossary/#term-objectid"><em class="xref std std-term">objectid</em></a> value.</p>
<p><strong>If</strong> the document contains an <tt class="docutils literal"><span class="pre">_id</span></tt> field, then the
<a class="reference internal" href="../method/db.collection.save/#db.collection.save" title="db.collection.save"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">save()</span></tt></a> method performs an
<tt class="docutils literal"><span class="pre">upsert</span></tt> querying the collection on the <tt class="docutils literal"><span class="pre">_id</span></tt> field:</p>
<ul>
<li>If a document does not exist with the specified <tt class="docutils literal"><span class="pre">_id</span></tt> value,
the <a class="reference internal" href="../method/db.collection.save/#db.collection.save" title="db.collection.save"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">save()</span></tt></a> method performs an
insert with the specified fields in the document.</li>
<li>If a document exists with the specified <tt class="docutils literal"><span class="pre">_id</span></tt> value, the
<a class="reference internal" href="../method/db.collection.save/#db.collection.save" title="db.collection.save"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">save()</span></tt></a> method performs an
update, replacing all field in the existing record with the
fields from the document.</li>
</ul>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Consider the following examples of the <a class="reference internal" href="../method/db.collection.save/#db.collection.save" title="db.collection.save"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">save()</span></tt></a> method:</p>
<ul>
<li><p class="first">Pass to the <a class="reference internal" href="../method/db.collection.save/#db.collection.save" title="db.collection.save"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">save()</span></tt></a> method a
document without an <tt class="docutils literal"><span class="pre">_id</span></tt> field, so that to insert the document into the
collection and have MongoDB generate the unique <tt class="docutils literal"><span class="pre">_id</span></tt> as in the
following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span> <span class="p">{</span> <span class="nx">item</span><span class="o">:</span> <span class="s2">&quot;book&quot;</span><span class="p">,</span> <span class="nx">qty</span><span class="o">:</span> <span class="mi">40</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>This operation inserts a new document into the <tt class="docutils literal"><span class="pre">products</span></tt>
collection with the <tt class="docutils literal"><span class="pre">item</span></tt> field set to <tt class="docutils literal"><span class="pre">book</span></tt>, the <tt class="docutils literal"><span class="pre">qty</span></tt>
field set to <tt class="docutils literal"><span class="pre">40</span></tt>, and the <tt class="docutils literal"><span class="pre">_id</span></tt> field set to a unique
<tt class="docutils literal"><span class="pre">ObjectId</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;50691737d386d8fadbd6b01d&quot;</span><span class="p">),</span> <span class="s2">&quot;item&quot;</span> <span class="o">:</span> <span class="s2">&quot;book&quot;</span><span class="p">,</span> <span class="s2">&quot;qty&quot;</span> <span class="o">:</span> <span class="mi">40</span> <span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Most MongoDB driver clients will include the <tt class="docutils literal"><span class="pre">_id</span></tt> field and
generate an <tt class="docutils literal"><span class="pre">ObjectId</span></tt> before sending the insert operation to
MongoDB; however, if the client sends a document without an <tt class="docutils literal"><span class="pre">_id</span></tt>
field, the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> will add the <tt class="docutils literal"><span class="pre">_id</span></tt> field and generate
the <tt class="docutils literal"><span class="pre">ObjectId</span></tt>.</p>
</div>
</li>
<li><p class="first">Pass to the <a class="reference internal" href="../method/db.collection.save/#db.collection.save" title="db.collection.save"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">save()</span></tt></a> method a
document with an <tt class="docutils literal"><span class="pre">_id</span></tt> field that holds a value that does not
exist in the collection to insert the document with that value in
the <tt class="docutils literal"><span class="pre">_id</span></tt> value into the collection, as in the following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span> <span class="p">{</span> <span class="nx">_id</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nx">item</span><span class="o">:</span> <span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="nx">qty</span><span class="o">:</span> <span class="mi">30</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>This operation inserts a new document into the <tt class="docutils literal"><span class="pre">products</span></tt>
collection with the <tt class="docutils literal"><span class="pre">_id</span></tt> field set to <tt class="docutils literal"><span class="pre">100</span></tt>, the <tt class="docutils literal"><span class="pre">item</span></tt>
field set to <tt class="docutils literal"><span class="pre">water</span></tt>, and the field <tt class="docutils literal"><span class="pre">qty</span></tt> set to <tt class="docutils literal"><span class="pre">30</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span> <span class="o">:</span> <span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="s2">&quot;qty&quot;</span> <span class="o">:</span> <span class="mi">30</span> <span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Most MongoDB driver clients will include the <tt class="docutils literal"><span class="pre">_id</span></tt> field and
generate an <tt class="docutils literal"><span class="pre">ObjectId</span></tt> before sending the insert operation to
MongoDB; however, if the client sends a document without an <tt class="docutils literal"><span class="pre">_id</span></tt>
field, the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> will add the <tt class="docutils literal"><span class="pre">_id</span></tt> field and generate
the <tt class="docutils literal"><span class="pre">ObjectId</span></tt>.</p>
</div>
</li>
<li><p class="first">Pass to the <a class="reference internal" href="../method/db.collection.save/#db.collection.save" title="db.collection.save"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">save()</span></tt></a> method a
document with the <tt class="docutils literal"><span class="pre">_id</span></tt> field set to a value in the
<tt class="docutils literal"><span class="pre">collection</span></tt> to replace all fields and values of the matching
document with the new fields and values, as in the following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span> <span class="p">{</span> <span class="nx">_id</span><span class="o">:</span><span class="mi">100</span><span class="p">,</span> <span class="nx">item</span><span class="o">:</span><span class="s2">&quot;juice&quot;</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>This operation replaces the existing document with a value of
<tt class="docutils literal"><span class="pre">100</span></tt> in the <tt class="docutils literal"><span class="pre">_id</span></tt> field. The updated document will resemble
the following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span> <span class="o">:</span> <span class="s2">&quot;juice&quot;</span> <span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="db.collection.update">
<tt class="descclassname">db.collection.</tt><tt class="descname">update</tt><big>(</big><em>query</em>, <em>update</em><span class="optional">[</span>, <em>options</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#db.collection.update" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="../method/db.collection.update/#db.collection.update" title="db.collection.update"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">update()</span></tt></a> method modifies an
existing document or documents in a collection. By default the
<a class="reference internal" href="../method/db.collection.update/#db.collection.update" title="db.collection.update"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">update()</span></tt></a> method updates a single
document. To update all documents in the collection that match the
update query criteria, specify the <tt class="docutils literal"><span class="pre">multi</span></tt> option. To insert a
document if no document matches the update query criteria, specify
the <tt class="docutils literal"><span class="pre">upsert</span></tt> option.</p>
<p class="versionchanged">
<span class="versionmodified">Changed in version 2.2: </span>The <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell provides an updated interface that
accepts the options parameter in a document format to specify
<tt class="docutils literal"><span class="pre">multi</span></tt> and <tt class="docutils literal"><span class="pre">upsert</span></tt> options.</p>
<p>Prior to version 2.2, in the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell, <tt class="docutils literal"><span class="pre">upsert</span></tt> and
<tt class="docutils literal"><span class="pre">multi</span></tt> were positional boolean options:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="o">&lt;</span><span class="nx">upsert</span><span class="p">,</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="nx">multi</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../method/db.collection.update/#db.collection.update" title="db.collection.update"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">update()</span></tt></a> method takes the following
parameters:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>query</strong> (<em>document</em>) &#8211; Specifies the selection criteria for the
update. The <tt class="docutils literal"><span class="pre">query</span></tt> parameter employs the same <a class="reference internal" href="../operators/#query-selectors"><em>query
selectors</em></a> as used in the
<a class="reference internal" href="../method/db.collection.find/#db.collection.find" title="db.collection.find"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.find()</span></tt></a> method.</li>
<li><strong>update</strong> (<em>document</em>) &#8211; <p>Specifies the modifications to apply.</p>
<p><strong>If</strong> the <tt class="docutils literal"><span class="pre">update</span></tt> parameter contains any <a class="reference internal" href="../operators/#update-operators"><em>update
operators</em></a> expressions such as the
<a class="reference internal" href="../operators/#_S_set" title="$set"><tt class="xref mongodb mongodb-operator docutils literal"><span class="pre">$set</span></tt></a> operator expression, then:</p>
<ul>
<li>the <tt class="docutils literal"><span class="pre">update</span></tt> parameter must contain only <tt class="docutils literal"><span class="pre">update</span>
<span class="pre">operators</span></tt> expressions.</li>
<li>the <a class="reference internal" href="../method/db.collection.update/#db.collection.update" title="db.collection.update"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">update()</span></tt></a> method updates only
the corresponding fields in the document.</li>
</ul>
<p><strong>If</strong> the <tt class="docutils literal"><span class="pre">update</span></tt> parameter consists only of <tt class="docutils literal"><span class="pre">field:</span>
<span class="pre">value</span></tt> expressions, then:</p>
<ul>
<li>the <a class="reference internal" href="../method/db.collection.update/#db.collection.update" title="db.collection.update"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">update()</span></tt></a> method
<em>replaces</em> the document with the <tt class="docutils literal"><span class="pre">updates</span></tt> document. If
the <tt class="docutils literal"><span class="pre">updates</span></tt> document is missing the <a class="reference internal" href="../glossary/#term-id"><em class="xref std std-term">_id</em></a> field,
MongoDB will add the <tt class="docutils literal"><span class="pre">_id</span></tt> field and assign to it a
unique <a class="reference internal" href="../glossary/#term-objectid"><em class="xref std std-term">objectid</em></a> .</li>
<li>the <a class="reference internal" href="../method/db.collection.update/#db.collection.update" title="db.collection.update"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">update()</span></tt></a> method updates cannot
update multiple documents.</li>
</ul>
</li>
<li><strong>options</strong> (<em>document</em>) &#8211; <p class="versionadded">
<span class="versionmodified">New in version 2.2.</span></p>
<p>Optional. Specifies whether to perform an <a class="reference internal" href="../glossary/#term-upsert"><em class="xref std std-term">upsert</em></a>
and/or a multiple update. Use the <tt class="docutils literal"><span class="pre">options</span></tt> parameter
instead of the individual <tt class="docutils literal"><span class="pre">upsert</span></tt> and <tt class="docutils literal"><span class="pre">multi</span></tt>
parameters.</p>
</li>
<li><strong>upsert</strong> (<em>boolean</em>) &#8211; <p>Optional. Specifies an <a class="reference internal" href="../glossary/#term-upsert"><em class="xref std std-term">upsert</em></a> operation</p>
<p>The default value is <tt class="docutils literal"><span class="pre">false</span></tt>. When <tt class="docutils literal"><span class="pre">true</span></tt>, the
<a class="reference internal" href="../method/db.collection.update/#db.collection.update" title="db.collection.update"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">update()</span></tt></a> method will
update an existing document that matches the <tt class="docutils literal"><span class="pre">query</span></tt>
selection criteria <strong>or</strong> if no document matches the
criteria, insert a new document with the fields and values of
the <tt class="docutils literal"><span class="pre">update</span></tt> parameter and if the <tt class="docutils literal"><span class="pre">update</span></tt> included only
<tt class="docutils literal"><span class="pre">update</span> <span class="pre">operators</span></tt>, the <tt class="docutils literal"><span class="pre">query</span></tt> parameter as well .</p>
<p>In version 2.2 of the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell, you may also
specify <tt class="docutils literal"><span class="pre">upsert</span></tt> in the <tt class="docutils literal"><span class="pre">options</span></tt> parameter.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An upsert operation affects only <em>one</em> document, and
cannot update multiple documents.</p>
</div>
</li>
<li><strong>multi</strong> (<em>boolean</em>) &#8211; <p>Optional. Specifies whether to update multiple
documents that meet the query criteria.</p>
<p>When not specified, the default value is <tt class="docutils literal"><span class="pre">false</span></tt> and the
<a class="reference internal" href="../method/db.collection.update/#db.collection.update" title="db.collection.update"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">update()</span></tt></a> method updates a single
document that meet the <tt class="docutils literal"><span class="pre">query</span></tt> criteria.</p>
<p>When <tt class="docutils literal"><span class="pre">true</span></tt>, the <a class="reference internal" href="../method/db.collection.update/#db.collection.update" title="db.collection.update"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">update()</span></tt></a> method
updates all documents that meet the <tt class="docutils literal"><span class="pre">query</span></tt> criteria.</p>
<p>In version 2.2 of the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell, you may also
specify <tt class="docutils literal"><span class="pre">multi</span></tt> in the <tt class="docutils literal"><span class="pre">options</span></tt> parameter.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">multi</span></tt> update operation may interleave with other
write operations. For unsharded
collections, you can override this behavior
with the <a class="reference internal" href="../operators/#_S_atomic" title="$atomic"><tt class="xref mongodb mongodb-operator docutils literal"><span class="pre">$atomic</span></tt></a> isolation operator, which
isolates the update operation and blocks
other write operations during the update. See the
<a class="reference internal" href="../operator/atomic/"><em>isolation operator</em></a>.</p>
</div>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Although the update operation may apply mostly to updating the
values of the fields, the <a class="reference internal" href="../method/db.collection.update/#db.collection.update" title="db.collection.update"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">update()</span></tt></a> method can also modify the name of the
<tt class="docutils literal"><span class="pre">field</span></tt> in a document using the <a class="reference internal" href="../operators/#_S_rename" title="$rename"><tt class="xref mongodb mongodb-operator docutils literal"><span class="pre">$rename</span></tt></a> operator.</p>
<p>Consider the following examples of the <a class="reference internal" href="../method/db.collection.update/#db.collection.update" title="db.collection.update"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">update()</span></tt></a> method. These examples all use the 2.2
interface to specify options in the document form.</p>
<ul>
<li><p class="first">To update specific fields in a document, call the
<a class="reference internal" href="../method/db.collection.update/#db.collection.update" title="db.collection.update"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">update()</span></tt></a> method with an
<tt class="docutils literal"><span class="pre">update</span></tt> parameter using <tt class="docutils literal"><span class="pre">field:</span> <span class="pre">value</span></tt> pairs and expressions
using <a class="reference internal" href="../operators/#update-operators"><em>update operators</em></a> as in the
following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span> <span class="p">{</span> <span class="nx">item</span><span class="o">:</span> <span class="s2">&quot;book&quot;</span><span class="p">,</span> <span class="nx">qty</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">5</span> <span class="p">}</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">$set</span><span class="o">:</span> <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">6</span> <span class="p">},</span> <span class="nx">$inc</span><span class="o">:</span> <span class="p">{</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">5</span><span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>This operation updates a document in the <tt class="docutils literal"><span class="pre">products</span></tt>
collection that matches the query criteria and sets the value of
the field <tt class="docutils literal"><span class="pre">x</span></tt> to <tt class="docutils literal"><span class="pre">6</span></tt>, and increment the value of the field
<tt class="docutils literal"><span class="pre">y</span></tt> by <tt class="docutils literal"><span class="pre">5</span></tt>. All other fields of the document remain the same.</p>
</li>
<li><p class="first">To replace all the fields in a document with the document as
specified in the <tt class="docutils literal"><span class="pre">update</span></tt> parameter, call the <a class="reference internal" href="../method/db.collection.update/#db.collection.update" title="db.collection.update"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">update()</span></tt></a> method with an <tt class="docutils literal"><span class="pre">update</span></tt> parameter
that consists of <em>only</em> <tt class="docutils literal"><span class="pre">key:</span> <span class="pre">value</span></tt> expressions, as in the following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span> <span class="p">{</span> <span class="nx">item</span><span class="o">:</span> <span class="s2">&quot;book&quot;</span><span class="p">,</span> <span class="nx">qty</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">5</span> <span class="p">}</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">15</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>This operation selects a document from the <tt class="docutils literal"><span class="pre">products</span></tt>
collection that matches the query criteria sets the value of the
field <tt class="docutils literal"><span class="pre">x</span></tt> to <tt class="docutils literal"><span class="pre">6</span></tt> and the value of the field <tt class="docutils literal"><span class="pre">y</span></tt> to
<tt class="docutils literal"><span class="pre">15</span></tt>. All other fields of the matched document are <em>removed</em>,
except the <a class="reference internal" href="../glossary/#term-id"><em class="xref std std-term">_id</em></a> field.</p>
</li>
<li><p class="first">To update multiple documents, call the <a class="reference internal" href="../method/db.collection.update/#db.collection.update" title="db.collection.update"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">update()</span></tt></a> method and specify the <tt class="docutils literal"><span class="pre">multi</span></tt> option
in the <tt class="docutils literal"><span class="pre">options</span></tt> argument, as in the following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span> <span class="p">{</span> <span class="nx">item</span><span class="o">:</span> <span class="s2">&quot;book&quot;</span><span class="p">,</span> <span class="nx">qty</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">5</span> <span class="p">}</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">$set</span><span class="o">:</span> <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">15</span> <span class="p">}</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">multi</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>This operation updates <em>all</em> documents in the <tt class="docutils literal"><span class="pre">products</span></tt>
collection that match the query criteria by setting the value of
the field <tt class="docutils literal"><span class="pre">x</span></tt> to <tt class="docutils literal"><span class="pre">6</span></tt> and the value of the field <tt class="docutils literal"><span class="pre">y</span></tt> to
<tt class="docutils literal"><span class="pre">15</span></tt>. This operation does not affect any other fields in
documents in the <tt class="docutils literal"><span class="pre">products</span></tt> collection.</p>
<p>You can perform the same operation by calling the
<a class="reference internal" href="../method/db.collection.update/#db.collection.update" title="db.collection.update"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">update()</span></tt></a> method with the <tt class="docutils literal"><span class="pre">multi</span></tt>
parameter:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span> <span class="p">{</span> <span class="nx">item</span><span class="o">:</span> <span class="s2">&quot;book&quot;</span><span class="p">,</span> <span class="nx">qty</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">5</span> <span class="p">}</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">$set</span><span class="o">:</span> <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">15</span> <span class="p">}</span> <span class="p">},</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">true</span> <span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">To update a document or to insert a new document if no
document matches the query criteria, call the
<a class="reference internal" href="../method/db.collection.update/#db.collection.update" title="db.collection.update"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">update()</span></tt></a> and specify the
<tt class="docutils literal"><span class="pre">upsert</span></tt> option in the <tt class="docutils literal"><span class="pre">options</span></tt> argument, as in the
following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span> <span class="p">{</span> <span class="nx">item</span><span class="o">:</span> <span class="s2">&quot;magazine&quot;</span><span class="p">,</span> <span class="nx">qty</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">5</span> <span class="p">}</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">$set</span><span class="o">:</span> <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">25</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">50</span> <span class="p">}</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">upsert</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>This operation, will:</p>
<ul class="simple">
<li>update a single document in the <tt class="docutils literal"><span class="pre">products</span></tt> collection that
matches the query criteria, setting the value of the field
<tt class="docutils literal"><span class="pre">x</span></tt> to <tt class="docutils literal"><span class="pre">25</span></tt> and the value of the field <tt class="docutils literal"><span class="pre">y</span></tt> to <tt class="docutils literal"><span class="pre">50</span></tt>, <em>or</em></li>
<li>if no matching document exists, insert a document in the
<tt class="docutils literal"><span class="pre">products</span></tt> collection, with the field <tt class="docutils literal"><span class="pre">item</span></tt> set to
<tt class="docutils literal"><span class="pre">magazine</span></tt>, the field <tt class="docutils literal"><span class="pre">x</span></tt> set to <tt class="docutils literal"><span class="pre">25</span></tt>, and the field <tt class="docutils literal"><span class="pre">y</span></tt>
set to <tt class="docutils literal"><span class="pre">50</span></tt>.</li>
</ul>
</li>
</ul>
</dd></dl>

</div>
<div class="section" id="cursor-methods">
<span id="js-query-cursor-methods"></span><h3>Cursor Methods<a class="headerlink" href="#cursor-methods" title="Permalink to this headline">¶</a></h3>
<p>Call cursor methods on cursors to modify how MongoDB returns objects to the cursor.</p>
<dl class="method">
<dt id="cursor.next">
<tt class="descclassname">cursor.</tt><tt class="descname">next</tt><big>(</big><big>)</big><a class="headerlink" href="#cursor.next" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">The next document in the cursor returned by the
<a class="reference internal" href="../method/db.collection.find/#db.collection.find" title="db.collection.find"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.find()</span></tt></a> method. See
<a class="reference internal" href="../method/cursor.hasNext/#cursor.hasNext" title="cursor.hasNext"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.hasNext()</span></tt></a> related functionality.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cursor.size">
<tt class="descclassname">cursor.</tt><tt class="descname">size</tt><big>(</big><big>)</big><a class="headerlink" href="#cursor.size" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A count of the number of documents that match the
<a class="reference internal" href="../method/db.collection.find/#db.collection.find" title="db.collection.find"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.find()</span></tt></a> query after applying any
<a class="reference internal" href="../method/cursor.skip/#cursor.skip" title="cursor.skip"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.skip()</span></tt></a> and <a class="reference internal" href="../method/cursor.limit/#cursor.limit" title="cursor.limit"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.limit()</span></tt></a> methods.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cursor.explain">
<tt class="descclassname">cursor.</tt><tt class="descname">explain</tt><big>(</big><big>)</big><a class="headerlink" href="#cursor.explain" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="../method/cursor.explain/#cursor.explain" title="cursor.explain"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.explain()</span></tt></a> method provides information on the
query plan. The query plan is the plan the server uses to find the
matches for a query. This information may be useful when optimizing
a query.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>verbose</strong> (<em>boolean</em>) &#8211; Specifies the level of detail to include in the output. If
<tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">1</span></tt>, include the <tt class="docutils literal"><span class="pre">allPlans</span></tt> and <tt class="docutils literal"><span class="pre">oldPlan</span></tt>
fields in the <a class="reference internal" href="../explain/"><em>output document</em></a>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A <a class="reference internal" href="../explain/"><em>document</em></a> that
describes the process used to return the query results.</p>
</td>
</tr>
</tbody>
</table>
<p>Retrieve the query plan by appending <a class="reference internal" href="../method/cursor.explain/#cursor.explain" title="cursor.explain"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">explain()</span></tt></a> to a <tt class="xref mongodb mongodb-method docutils literal"><span class="pre">find()</span></tt> query, as in the following
example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">explain</span><span class="p">()</span>
</pre></div>
</div>
<p>For details on the output, see <a class="reference internal" href="../explain/"><em>Explain Output</em></a>.</p>
<p><a class="reference internal" href="../method/cursor.explain/#cursor.explain" title="cursor.explain"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">explain</span></tt></a> runs the actual query to
determine the result. Although there are some differences between
running the query with <a class="reference internal" href="../method/cursor.explain/#cursor.explain" title="cursor.explain"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">explain</span></tt></a> and
running without, generally, the performance will be similar between
the two. So, if the query is slow, the <a class="reference internal" href="../method/cursor.explain/#cursor.explain" title="cursor.explain"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">explain</span></tt></a> operation is also slow.</p>
<p>Additionally, the <a class="reference internal" href="../method/cursor.explain/#cursor.explain" title="cursor.explain"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">explain</span></tt></a> operation reevaluates a set
of candidate query plans, which may cause the <a class="reference internal" href="../method/cursor.explain/#cursor.explain" title="cursor.explain"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">explain</span></tt></a>
operation to perform differently than a normal query. As a result,
these operations generally provide an accurate account of <em>how</em>
MongoDB would perform the query, but do not reflect the length of
these queries.</p>
<p>To determine the performance of a particular index, you can use
<a class="reference internal" href="../method/cursor.hint/#cursor.hint" title="cursor.hint"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">hint()</span></tt></a>  and in conjunction with
<a class="reference internal" href="../method/cursor.explain/#cursor.explain" title="cursor.explain"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">explain()</span></tt></a>, as in the following example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">hint</span><span class="p">(</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">).</span><span class="nx">explain</span><span class="p">()</span>
</pre></div>
</div>
<p>When you run <a class="reference internal" href="../method/cursor.explain/#cursor.explain" title="cursor.explain"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">explain</span></tt></a> with
<a class="reference internal" href="../method/cursor.hint/#cursor.hint" title="cursor.hint"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">hint()</span></tt></a>, the query optimizer does not
reevaluate the query plans.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In some situations, the <a class="reference internal" href="../method/cursor.explain/#cursor.explain" title="cursor.explain"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">explain()</span></tt></a>
operation may differ from the actual query plan used by MongoDB
in a normal query.</p>
<p class="last">The <a class="reference internal" href="../method/cursor.explain/#cursor.explain" title="cursor.explain"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">explain()</span></tt></a> operation evaluates
the set of query plans and reports on the winning plan for the
query. In normal operations the query optimizer caches winning
query plans and uses them for similar related queries in the
future.  As a result MongoDB may sometimes select query plans
from the cache that are different from the plan displayed using
<a class="reference internal" href="../method/cursor.explain/#cursor.explain" title="cursor.explain"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">explain</span></tt></a>.</p>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference internal" href="../operator/explain/#_S_explain" title="$explain"><tt class="xref mongodb mongodb-operator docutils literal"><span class="pre">$explain</span></tt></a></li>
<li><a class="reference external" href="http://www.mongodb.org/display/DOCS/Optimization">Optimization</a> wiki page for information regarding
optimization strategies.</li>
<li><a class="reference external" href="http://www.mongodb.org/display/DOCS/Database Profiler">Database Profiler</a> wiki page for information regarding
optimization strategies.</li>
<li><a class="reference internal" href="../current-op/"><em>Current Operation Reporting</em></a></li>
</ul>
</div>
</dd></dl>

<dl class="method">
<dt id="cursor.showDiskLoc">
<tt class="descclassname">cursor.</tt><tt class="descname">showDiskLoc</tt><big>(</big><big>)</big><a class="headerlink" href="#cursor.showDiskLoc" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A modified cursor object that contains documents with
appended information that describes the on-disk location
of the document.</td>
</tr>
</tbody>
</table>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../operator/showDiskLoc/#_S_showDiskLoc" title="$showDiskLoc"><tt class="xref mongodb mongodb-operator docutils literal"><span class="pre">$showDiskLoc</span></tt></a> for related
functionality.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="cursor.forEach">
<tt class="descclassname">cursor.</tt><tt class="descname">forEach</tt><big>(</big><em>function</em><big>)</big><a class="headerlink" href="#cursor.forEach" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>function</strong> &#8211; function to apply to each document visited by the cursor.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Provides the ability to loop or iterate over the cursor returned by
a <a class="reference internal" href="../method/db.collection.find/#db.collection.find" title="db.collection.find"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.find()</span></tt></a> query and returns each result on the
shell. Specify a JavaScript function as the argument for the
<a class="reference internal" href="../method/cursor.forEach/#cursor.forEach" title="cursor.forEach"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.forEach()</span></tt></a> function. Consider the following example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">forEach</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span><span class="nx">u</span><span class="p">)</span> <span class="p">{</span> <span class="nx">print</span><span class="p">(</span><span class="s2">&quot;user: &quot;</span> <span class="o">+</span> <span class="nx">u</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span> <span class="p">}</span> <span class="p">);</span>
</pre></div>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../method/cursor.map/#cursor.map" title="cursor.map"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.map()</span></tt></a> for similar functionality.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="cursor.map">
<tt class="descclassname">cursor.</tt><tt class="descname">map</tt><big>(</big><em>function</em><big>)</big><a class="headerlink" href="#cursor.map" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>function</strong> &#8211; function to apply to each document visited by the cursor.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Apply <cite>function</cite> to each document visited by the cursor, and
collect the return values from successive application into
an array.  Consider the following example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">map</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span><span class="nx">u</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">u</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span> <span class="p">}</span> <span class="p">);</span>
</pre></div>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../method/cursor.forEach/#cursor.forEach" title="cursor.forEach"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.forEach()</span></tt></a> for similar functionality.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="cursor.hasNext">
<tt class="descclassname">cursor.</tt><tt class="descname">hasNext</tt><big>(</big><big>)</big><a class="headerlink" href="#cursor.hasNext" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Boolean.</td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="../method/cursor.hasNext/#cursor.hasNext" title="cursor.hasNext"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.hasNext()</span></tt></a> returns <tt class="docutils literal"><span class="pre">true</span></tt> if the cursor returned by
the <a class="reference internal" href="../method/db.collection.find/#db.collection.find" title="db.collection.find"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.find()</span></tt></a> query can iterate further to
return more documents.</p>
</dd></dl>

<dl class="method">
<dt id="cursor.count">
<tt class="descclassname">cursor.</tt><tt class="descname">count</tt><big>(</big><big>)</big><a class="headerlink" href="#cursor.count" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="../method/cursor.count/#cursor.count" title="cursor.count"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">count()</span></tt></a> method counts the number of
documents referenced by a cursor. Append the <a class="reference internal" href="../method/cursor.count/#cursor.count" title="cursor.count"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">count()</span></tt></a> method to a <a class="reference internal" href="../method/db.collection.find/#db.collection.find" title="db.collection.find"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">find()</span></tt></a> query to return the number of matching
documents, as in the following prototype:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">count</span><span class="p">()</span>
</pre></div>
</div>
<p>This operation does not actually perform the <a class="reference internal" href="../method/db.collection.find/#db.collection.find" title="db.collection.find"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">find()</span></tt></a>; instead, the operation counts the results
that would be returned by the <a class="reference internal" href="../method/db.collection.find/#db.collection.find" title="db.collection.find"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">find()</span></tt></a>.</p>
<p>The <a class="reference internal" href="../method/cursor.count/#cursor.count" title="cursor.count"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">count()</span></tt></a> can accept the following argument:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>applySkipLimit</strong> (<em>boolean</em>) &#8211; <p>Optional. Specifies whether to consider the effects of the
<a class="reference internal" href="../method/cursor.skip/#cursor.skip" title="cursor.skip"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.skip()</span></tt></a> and <a class="reference internal" href="../method/cursor.limit/#cursor.limit" title="cursor.limit"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.limit()</span></tt></a> methods
in the count. By default, the <a class="reference internal" href="../method/cursor.count/#cursor.count" title="cursor.count"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">count()</span></tt></a> method ignores the effects of the
<a class="reference internal" href="../method/cursor.skip/#cursor.skip" title="cursor.skip"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.skip()</span></tt></a> and <a class="reference internal" href="../method/cursor.limit/#cursor.limit" title="cursor.limit"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.limit()</span></tt></a>. Set
<tt class="docutils literal"><span class="pre">applySkipLimit</span></tt> to <tt class="docutils literal"><span class="pre">true</span></tt> to consider the effect of
these methods.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../method/cursor.size/#cursor.size" title="cursor.size"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.size()</span></tt></a></p>
</div>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>MongoDB also provides the shell wrapper
<a class="reference internal" href="../method/db.collection.count/#db.collection.count" title="db.collection.count"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.count()</span></tt></a> for the
<tt class="docutils literal"><span class="pre">db.collection.find().count()</span></tt> construct.</p>
<p>Consider the following examples of the <a class="reference internal" href="../method/cursor.count/#cursor.count" title="cursor.count"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">count()</span></tt></a> method:</p>
<ul>
<li><p class="first">Count the number of all documents in the <tt class="docutils literal"><span class="pre">orders</span></tt> collection:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">count</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p class="first">Count the number of the documents in the <tt class="docutils literal"><span class="pre">orders</span></tt> collection
with the field <tt class="docutils literal"><span class="pre">ord_dt</span></tt> greater than <tt class="docutils literal"><span class="pre">new</span> <span class="pre">Date('01/01/2012')</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="p">{</span> <span class="nx">ord_dt</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;01/01/2012&#39;</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span> <span class="p">).</span><span class="nx">count</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p class="first">Count the number of the documents in the <tt class="docutils literal"><span class="pre">orders</span></tt> collection
with the field <tt class="docutils literal"><span class="pre">ord_dt</span></tt> greater than <tt class="docutils literal"><span class="pre">new</span> <span class="pre">Date('01/01/2012')</span></tt>
<em>taking into account</em> the effect of the <tt class="docutils literal"><span class="pre">limit(5)</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="p">{</span> <span class="nx">ord_dt</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;01/01/2012&#39;</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span> <span class="p">).</span><span class="nx">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="nx">count</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="cursor.limit">
<tt class="descclassname">cursor.</tt><tt class="descname">limit</tt><big>(</big><big>)</big><a class="headerlink" href="#cursor.limit" title="Permalink to this definition">¶</a></dt>
<dd><p>Use the <a class="reference internal" href="../method/cursor.limit/#cursor.limit" title="cursor.limit"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.limit()</span></tt></a> method on a cursor to specify the maximum
number of documents a the cursor will return. <a class="reference internal" href="../method/cursor.limit/#cursor.limit" title="cursor.limit"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.limit()</span></tt></a> is
analogous to the <tt class="docutils literal"><span class="pre">LIMIT</span></tt> statement in a SQL database.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You must apply <a class="reference internal" href="../method/cursor.limit/#cursor.limit" title="cursor.limit"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.limit()</span></tt></a> to the cursor before
retrieving any documents from the database.</p>
</div>
<p>Use <a class="reference internal" href="../method/cursor.limit/#cursor.limit" title="cursor.limit"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.limit()</span></tt></a> to maximize performance and prevent
MongoDB from returning more results than required for processing.</p>
<p>A <a class="reference internal" href="../method/cursor.limit/#cursor.limit" title="cursor.limit"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.limit()</span></tt></a> value of 0 (e.g. &#8220;<a class="reference internal" href="../method/cursor.limit/#cursor.limit" title="cursor.limit"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">.limit(0)</span></tt></a>&#8221;)
is equivalent to setting no limit.</p>
</dd></dl>

<dl class="method">
<dt id="cursor.skip">
<tt class="descclassname">cursor.</tt><tt class="descname">skip</tt><big>(</big><big>)</big><a class="headerlink" href="#cursor.skip" title="Permalink to this definition">¶</a></dt>
<dd><p>Call the <a class="reference internal" href="../method/cursor.skip/#cursor.skip" title="cursor.skip"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.skip()</span></tt></a> method on a cursor to control where MongoDB
begins returning results. This approach may be useful in
implementing &#8220;paged&#8221; results.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You must apply <a class="reference internal" href="../method/cursor.skip/#cursor.skip" title="cursor.skip"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.skip()</span></tt></a> to the cursor before
retrieving any documents from the database.</p>
</div>
<p>Consider the following JavaScript function as an example of the
sort function:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">printStudents</span><span class="p">(</span><span class="nx">pageNumber</span><span class="p">,</span> <span class="nx">nPerPage</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">print</span><span class="p">(</span><span class="s2">&quot;Page: &quot;</span> <span class="o">+</span> <span class="nx">pageNumber</span><span class="p">);</span>
   <span class="nx">db</span><span class="p">.</span><span class="nx">students</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">skip</span><span class="p">((</span><span class="nx">pageNumber</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nx">nPerPage</span><span class="p">).</span><span class="nx">limit</span><span class="p">(</span><span class="nx">nPerPage</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span><span class="nx">student</span><span class="p">)</span> <span class="p">{</span> <span class="nx">print</span><span class="p">(</span><span class="nx">student</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;&lt;p&gt;&quot;</span><span class="p">);</span> <span class="p">}</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../method/cursor.skip/#cursor.skip" title="cursor.skip"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.skip()</span></tt></a> method is often expensive because it requires
the server to walk from the beginning of the collection or index to
get the offset or skip position before beginning to return
result. As offset (e.g. <tt class="docutils literal"><span class="pre">pageNumber</span></tt> above) increases,
<a class="reference internal" href="../method/cursor.skip/#cursor.skip" title="cursor.skip"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.skip()</span></tt></a> will become slower and more CPU intensive. With
larger collections, <a class="reference internal" href="../method/cursor.skip/#cursor.skip" title="cursor.skip"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.skip()</span></tt></a> may become IO bound.</p>
<p>Consider using range-based pagination for these kinds of
tasks. That is, query for a range of objects, using logic within
the application to determine the pagination rather than the
database itself. This approach features better index utilization,
if you do not need to easily jump to a specific page.</p>
</dd></dl>

<dl class="method">
<dt id="cursor.readPref">
<tt class="descclassname">cursor.</tt><tt class="descname">readPref</tt><big>(</big><big>)</big><a class="headerlink" href="#cursor.readPref" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>mode</strong> (<em>string</em>) &#8211; Read preference mode</li>
<li><strong>tagSet</strong> (<em>array</em>) &#8211; Optional. Array of tag set objects</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Append the <a class="reference internal" href="../method/cursor.readPref/#cursor.readPref" title="cursor.readPref"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">readPref()</span></tt></a> to a cursor to
control how the client will route the query will route to members
of the replica set.</p>
<p>The <tt class="docutils literal"><span class="pre">mode</span></tt> string should be one of:</p>
<ul class="simple">
<li><a class="reference internal" href="../../applications/replication/#primary" title="primary"><tt class="xref mongodb mongodb-readmode docutils literal"><span class="pre">primary</span></tt></a></li>
<li><a class="reference internal" href="../../applications/replication/#primaryPreferred" title="primaryPreferred"><tt class="xref mongodb mongodb-readmode docutils literal"><span class="pre">primaryPreferred</span></tt></a></li>
<li><a class="reference internal" href="../../applications/replication/#secondary" title="secondary"><tt class="xref mongodb mongodb-readmode docutils literal"><span class="pre">secondary</span></tt></a></li>
<li><a class="reference internal" href="../../applications/replication/#secondaryPreferred" title="secondaryPreferred"><tt class="xref mongodb mongodb-readmode docutils literal"><span class="pre">secondaryPreferred</span></tt></a></li>
<li><a class="reference internal" href="../../applications/replication/#nearest" title="nearest"><tt class="xref mongodb mongodb-readmode docutils literal"><span class="pre">nearest</span></tt></a></li>
</ul>
<p>The <tt class="docutils literal"><span class="pre">tagSet</span></tt> parameter, if given, should consist of an array of tag set
objects for filtering secondary read operations. For example, a secondary
member tagged <tt class="docutils literal"><span class="pre">{</span> <span class="pre">dc:</span> <span class="pre">'ny',</span> <span class="pre">rack:</span> <span class="pre">2,</span> <span class="pre">size:</span> <span class="pre">'large'</span> <span class="pre">}</span></tt> will match the tag set
<tt class="docutils literal"><span class="pre">{</span> <span class="pre">dc:</span> <span class="pre">'ny',</span> <span class="pre">rack:</span> <span class="pre">2</span> <span class="pre">}</span></tt>. Clients match tag sets first in the
order they appear in the read preference specification. You may
specify an empty tag set <tt class="docutils literal"><span class="pre">{}</span></tt> as the last element to default to
any available secondary. See the <a class="reference internal" href="../../applications/replication/#replica-set-read-preference-tag-sets"><em>tag sets</em></a>
documentation for more information.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You must apply <a class="reference internal" href="../method/cursor.readPref/#cursor.readPref" title="cursor.readPref"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.readPref()</span></tt></a> to the cursor before retrieving
any documents from the database.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="cursor.snapshot">
<tt class="descclassname">cursor.</tt><tt class="descname">snapshot</tt><big>(</big><big>)</big><a class="headerlink" href="#cursor.snapshot" title="Permalink to this definition">¶</a></dt>
<dd><p>Append the <a class="reference internal" href="../method/cursor.snapshot/#cursor.snapshot" title="cursor.snapshot"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.snapshot()</span></tt></a> method to a cursor to toggle
the &#8220;snapshot&#8221; mode. This ensures that the query will not return a
document multiple times, even if intervening write operations result
in a move of the document due to the growth in document size.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<ul class="last simple">
<li>You must apply <a class="reference internal" href="../method/cursor.snapshot/#cursor.snapshot" title="cursor.snapshot"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.snapshot()</span></tt></a> to the cursor before
retrieving any documents from the database.</li>
<li>You can only use <a class="reference internal" href="../method/cursor.snapshot/#cursor.snapshot" title="cursor.snapshot"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">snapshot()</span></tt></a> with
<strong>unsharded</strong> collections.</li>
</ul>
</div>
<p>The <a class="reference internal" href="../method/cursor.snapshot/#cursor.snapshot" title="cursor.snapshot"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">snapshot()</span></tt></a> does not guarantee
isolation from insertion or deletions.</p>
<p>The <a class="reference internal" href="../method/cursor.snapshot/#cursor.snapshot" title="cursor.snapshot"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.snapshot()</span></tt></a> traverses the index on the <tt class="docutils literal"><span class="pre">_id</span></tt>
field. As such, <a class="reference internal" href="../method/cursor.snapshot/#cursor.snapshot" title="cursor.snapshot"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">snapshot()</span></tt></a> <strong>cannot</strong>
be used with <a class="reference internal" href="../method/cursor.sort/#cursor.sort" title="cursor.sort"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sort()</span></tt></a> or <a class="reference internal" href="../method/cursor.hint/#cursor.hint" title="cursor.hint"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">hint()</span></tt></a>.</p>
<p>Queries with results of less than 1 megabyte are effectively
implicitly snapshotted.</p>
</dd></dl>

<dl class="method">
<dt id="cursor.sort">
<tt class="descclassname">cursor.</tt><tt class="descname">sort</tt><big>(</big><em>sort</em><big>)</big><a class="headerlink" href="#cursor.sort" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>sort</strong> &#8211; A document whose fields specify the attributes on
which to sort the result set.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Append the <a class="reference internal" href="../method/cursor.sort/#cursor.sort" title="cursor.sort"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sort()</span></tt></a> method to a cursor to
control the order that the query returns matching documents.  For
each field in the sort document, if the field&#8217;s corresponding value
is positive, then <a class="reference internal" href="../method/cursor.sort/#cursor.sort" title="cursor.sort"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sort()</span></tt></a> returns query
results in ascending order for that attribute: if the field&#8217;s
corresponding value is negative, then <a class="reference internal" href="../method/cursor.sort/#cursor.sort" title="cursor.sort"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sort()</span></tt></a> returns query results in descending order.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You must apply <a class="reference internal" href="../method/cursor.limit/#cursor.limit" title="cursor.limit"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.limit()</span></tt></a> to the cursor before
retrieving any documents from the database.</p>
</div>
<p>Consider the following example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">sort</span><span class="p">(</span> <span class="p">{</span> <span class="nx">age</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span> <span class="p">}</span> <span class="p">);</span>
</pre></div>
</div>
<p>Here, the query returns all documents in <tt class="docutils literal"><span class="pre">collection</span></tt> sorted by
the <tt class="docutils literal"><span class="pre">age</span></tt> field in descending order. Specify a value of negative
one (e.g. <tt class="docutils literal"><span class="pre">-1</span></tt>), as above, to sort in descending order or a
positive value (e.g. <tt class="docutils literal"><span class="pre">1</span></tt>) to sort in ascending order.</p>
<p>Unless you have a index for the specified key pattern, use
<a class="reference internal" href="../method/cursor.sort/#cursor.sort" title="cursor.sort"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.sort()</span></tt></a> in conjunction with <a class="reference internal" href="../method/cursor.limit/#cursor.limit" title="cursor.limit"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.limit()</span></tt></a> to avoid
requiring MongoDB to perform a large, in-memory
sort. <a class="reference internal" href="../method/cursor.limit/#cursor.limit" title="cursor.limit"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.limit()</span></tt></a> increases the speed and reduces the amount
of memory required to return this query by way of an optimized
algorithm.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The sort function requires that the entire sort be able to
complete within 32 megabytes. When the sort option consumes more
than 32 megabytes, MongoDB will return an error. Use
<a class="reference internal" href="../method/cursor.limit/#cursor.limit" title="cursor.limit"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.limit()</span></tt></a>, or create an index on the field that you&#8217;re
sorting to avoid this error.</p>
</div>
<p>The <a class="reference internal" href="../operator/natural/#_S_natural" title="$natural"><tt class="xref mongodb mongodb-operator docutils literal"><span class="pre">$natural</span></tt></a> parameter returns items according to their
order on disk. Consider the following query:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">sort</span><span class="p">(</span> <span class="p">{</span> <span class="nx">$natural</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>This will return documents in the reverse of the order on
disk. Typically, the order of documents on disks reflects insertion
order, <em>except</em> when documents move internal because of document
growth due to update operations.</p>
</dd></dl>

<dl class="method">
<dt id="cursor.hint">
<tt class="descclassname">cursor.</tt><tt class="descname">hint</tt><big>(</big><em>index</em><big>)</big><a class="headerlink" href="#cursor.hint" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>index</strong> &#8211; The specification for the index to &#8220;hint&#8221; or force
MongoDB to use when performing the query.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Call this method on a query to override MongoDB&#8217;s default index
selection and query optimization process. The argument is an index
specification, like the argument to <a class="reference internal" href="../method/db.collection.ensureIndex/#db.collection.ensureIndex" title="db.collection.ensureIndex"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">ensureIndex()</span></tt></a>. Use
<a class="reference internal" href="../method/db.collection.getIndexes/#db.collection.getIndexes" title="db.collection.getIndexes"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.getIndexes()</span></tt></a> to return the list of current indexes on a
collection.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">&#8220;<a class="reference internal" href="../operator/hint/#_S_hint" title="$hint"><tt class="xref mongodb mongodb-operator docutils literal"><span class="pre">$hint</span></tt></a>&#8220;</p>
</div>
</dd></dl>

</div>
<div class="section" id="data-aggregation-methods">
<h3>Data Aggregation Methods<a class="headerlink" href="#data-aggregation-methods" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="db.collection.aggregate">
<tt class="descclassname">db.collection.</tt><tt class="descname">aggregate</tt><big>(</big><em>pipeline</em><big>)</big><a class="headerlink" href="#db.collection.aggregate" title="Permalink to this definition">¶</a></dt>
<dd><p class="versionadded">
<span class="versionmodified">New in version 2.1.0.</span></p>
<p>Always call the <a class="reference internal" href="../method/db.collection.aggregate/#db.collection.aggregate" title="db.collection.aggregate"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.aggregate()</span></tt></a> method on a collection
object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>pipeline</strong> &#8211; Specifies a sequence of data aggregation
processes. See the <a class="reference internal" href="../aggregation/"><em>aggregation reference</em></a> for documentation of
these operators.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Consider the following example from the <a class="reference internal" href="../../applications/aggregation/"><em>aggregation
documentation</em></a>.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">article</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">(</span>
  <span class="p">{</span> <span class="nx">$project</span> <span class="o">:</span> <span class="p">{</span>
     <span class="nx">author</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
     <span class="nx">tags</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="p">}</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">$unwind</span> <span class="o">:</span> <span class="s2">&quot;$tags&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">$group</span> <span class="o">:</span> <span class="p">{</span>
     <span class="nx">_id</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">tags</span> <span class="o">:</span> <span class="mi">1</span> <span class="p">},</span>
     <span class="nx">authors</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">$addToSet</span> <span class="o">:</span> <span class="s2">&quot;$author&quot;</span> <span class="p">}</span>
  <span class="p">}</span> <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">&#8220;<a class="reference internal" href="../commands/#aggregate" title="aggregate"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">aggregate</span></tt></a>,&#8221;
&#8220;<a class="reference internal" href="../../applications/aggregation/"><em>Aggregation Framework</em></a>,&#8221; and
&#8220;<a class="reference internal" href="../aggregation/"><em>Aggregation Framework Reference</em></a>.&#8221;</p>
</div>
</dd></dl>

<dl class="method">
<dt id="db.collection.group">
<tt class="descclassname">db.collection.</tt><tt class="descname">group</tt><big>(</big><em>{ key, reduce, initial, [keyf,] [cond,] finalize }</em><big>)</big><a class="headerlink" href="#db.collection.group" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="../method/db.collection.group/#db.collection.group" title="db.collection.group"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.group()</span></tt></a> method groups documents in a
collection by the specified keys and performs simple aggregation
functions such as computing counts and sums. The method is analogous
to a <tt class="docutils literal"><span class="pre">SELECT</span> <span class="pre">..</span> <span class="pre">GROUP</span> <span class="pre">BY</span></tt> statement in SQL. The <a class="reference internal" href="../method/db.collection.group/#db.collection.group" title="db.collection.group"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">group()</span></tt></a> method returns an array.</p>
<p>The <a class="reference internal" href="../method/db.collection.group/#db.collection.group" title="db.collection.group"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.group()</span></tt></a> accepts a single <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a> that
contains the following:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Fields:</th><td class="field-body"><ul class="first last simple">
<li><strong>key</strong> &#8211; Specifies one or more document fields to group by.</li>
<li><strong>reduce</strong> &#8211; Specifies a function for the group operation perform
on the documents during the grouping operation, such
as compute a sum or a count. The aggregation
function takes two arguments: the current document
and the aggregate result for the previous documents
in the.</li>
<li><strong>initial</strong> &#8211; Initializes the aggregation result document.</li>
<li><strong>keyf</strong> &#8211; Optional. Alternative to the <tt class="docutils literal"><span class="pre">key</span></tt> field. Specifies a
function that creates a &#8220;key object&#8221; for use as the
grouping key. Use the <tt class="docutils literal"><span class="pre">keyf</span></tt> instead of <tt class="docutils literal"><span class="pre">key</span></tt> to
group by calculated fields rather than existing
document fields.</li>
<li><strong>cond</strong> &#8211; Optional. Specifies the selection criteria to
determine which documents in the collection to
process. If you omit the <tt class="docutils literal"><span class="pre">cond</span></tt> field,
<a class="reference internal" href="../method/db.collection.group/#db.collection.group" title="db.collection.group"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.group()</span></tt></a> processes all the
documents in the collection for the group operation.</li>
<li><strong>finalize</strong> &#8211; Optional. Specifies a function that runs each item
in the result set before <a class="reference internal" href="../method/db.collection.group/#db.collection.group" title="db.collection.group"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.group()</span></tt></a>
returns the final value. This function
can either modify the result document or
replace the result document as a whole.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The <a class="reference internal" href="../method/db.collection.group/#db.collection.group" title="db.collection.group"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.group()</span></tt></a> method is a shell wrapper for
the <a class="reference internal" href="../commands/#group" title="group"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">group</span></tt></a> command; however, the
<a class="reference internal" href="../method/db.collection.group/#db.collection.group" title="db.collection.group"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.group()</span></tt></a> method takes the <tt class="docutils literal"><span class="pre">keyf</span></tt> field and
the <tt class="docutils literal"><span class="pre">reduce</span></tt> field whereas the <a class="reference internal" href="../commands/#group" title="group"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">group</span></tt></a> command takes
the <tt class="docutils literal"><span class="pre">$keyf</span></tt> field and the <tt class="docutils literal"><span class="pre">$reduce</span></tt> field.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<ul class="last simple">
<li>The <a class="reference internal" href="../method/db.collection.group/#db.collection.group" title="db.collection.group"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.group()</span></tt></a> method does not work with
<a class="reference internal" href="../glossary/#term-sharded-cluster"><em class="xref std std-term">sharded clusters</em></a>. Use the
<a class="reference internal" href="../glossary/#term-aggregation-framework"><em class="xref std std-term">aggregation framework</em></a> or <a class="reference internal" href="../glossary/#term-map-reduce"><em class="xref std std-term">map-reduce</em></a> in
<a class="reference internal" href="../glossary/#term-sharding"><em class="xref std std-term">sharded environments</em></a>.</li>
<li>The <a class="reference internal" href="../commands/#group" title="group"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">group</span></tt></a> command takes a read lock and does not
allow any other threads to execute JavaScript while it is
running.</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>The result set must fit within the <a class="reference internal" href="../limits/#limit-bson-document-size"><em>maximum BSON document
size</em></a>.</li>
<li>In version 2.2, the returned array can contain at most 20,000
elements; i.e. at most 20,000 unique groupings. For group by
operations that results in more than 20,000 unique groupings,
use <a class="reference internal" href="../commands/#mapReduce" title="mapReduce"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">mapReduce</span></tt></a>. Previous versions had a limit of
10,000 elements.</li>
</ul>
</div>
</dd></dl>

<p>Consider the following examples of the <a class="reference internal" href="../method/db.collection.group/#db.collection.group" title="db.collection.group"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.group()</span></tt></a> method:</p>
<p>The examples assume an <tt class="docutils literal"><span class="pre">orders</span></tt> collection with documents of the
following prototype:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="nx">_id</span><span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;5085a95c8fada716c89d0021&quot;</span><span class="p">),</span>
  <span class="nx">ord_dt</span><span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-07-01T04:00:00Z&quot;</span><span class="p">),</span>
  <span class="nx">ship_dt</span><span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-07-02T04:00:00Z&quot;</span><span class="p">),</span>
  <span class="nx">item</span><span class="o">:</span> <span class="p">{</span> <span class="nx">sku</span><span class="o">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">,</span>
          <span class="nx">price</span><span class="o">:</span> <span class="mf">1.99</span><span class="p">,</span>
          <span class="nx">uom</span><span class="o">:</span> <span class="s2">&quot;pcs&quot;</span><span class="p">,</span>
          <span class="nx">qty</span><span class="o">:</span> <span class="mi">25</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul>
<li><p class="first">The following example groups by the <tt class="docutils literal"><span class="pre">ord_dt</span></tt> and <tt class="docutils literal"><span class="pre">item.sku</span></tt>
fields those documents that have <tt class="docutils literal"><span class="pre">ord_dt</span></tt> greater than
<tt class="docutils literal"><span class="pre">01/01/2011</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">group</span><span class="p">(</span> <span class="p">{</span>
                   <span class="nx">key</span><span class="o">:</span> <span class="p">{</span> <span class="nx">ord_dt</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;item.sku&#39;</span><span class="o">:</span> <span class="mi">1</span> <span class="p">},</span>
                   <span class="nx">cond</span><span class="o">:</span> <span class="p">{</span> <span class="nx">ord_dt</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span> <span class="s1">&#39;01/01/2012&#39;</span> <span class="p">)</span> <span class="p">}</span> <span class="p">},</span>
                   <span class="nx">reduce</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">curr</span><span class="p">,</span> <span class="nx">result</span> <span class="p">)</span> <span class="p">{</span> <span class="p">},</span>
                   <span class="nx">initial</span><span class="o">:</span> <span class="p">{</span> <span class="p">}</span>
                <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>The result is an array of documents that contain the group by fields:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span> <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-07-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-07-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc456&quot;</span><span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-07-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;bcd123&quot;</span><span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-07-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;efg456&quot;</span><span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-06-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-06-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;efg456&quot;</span><span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-06-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;ijk123&quot;</span><span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-05-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-05-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc456&quot;</span><span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-06-08T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-06-08T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc456&quot;</span><span class="p">}</span> <span class="p">]</span>
</pre></div>
</div>
<p>The method call is analogous to the SQL statement:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">ord_dt</span><span class="p">,</span> <span class="n">item_sku</span>
<span class="k">FROM</span> <span class="n">orders</span>
<span class="k">WHERE</span> <span class="n">ord_dt</span> <span class="o">&gt;</span> <span class="s1">&#39;01/01/2012&#39;</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">ord_dt</span><span class="p">,</span> <span class="n">item_sku</span>
</pre></div>
</div>
</li>
<li><p class="first">The following example groups by the <tt class="docutils literal"><span class="pre">ord_dt</span></tt> and <tt class="docutils literal"><span class="pre">item.sku</span></tt>
fields, those documents that have <tt class="docutils literal"><span class="pre">ord_dt</span></tt> greater than
<tt class="docutils literal"><span class="pre">01/01/2011</span></tt> and calculates the sum of the <tt class="docutils literal"><span class="pre">qty</span></tt> field for each
grouping:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">group</span><span class="p">(</span> <span class="p">{</span>
                   <span class="nx">key</span><span class="o">:</span> <span class="p">{</span> <span class="nx">ord_dt</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;item.sku&#39;</span><span class="o">:</span> <span class="mi">1</span> <span class="p">},</span>
                   <span class="nx">cond</span><span class="o">:</span> <span class="p">{</span> <span class="nx">ord_dt</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span> <span class="s1">&#39;01/01/2012&#39;</span> <span class="p">)</span> <span class="p">}</span> <span class="p">},</span>
                   <span class="nx">reduce</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">curr</span><span class="p">,</span> <span class="nx">result</span> <span class="p">)</span> <span class="p">{</span>
                               <span class="nx">result</span><span class="p">.</span><span class="nx">total</span> <span class="o">+=</span> <span class="nx">curr</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">qty</span><span class="p">;</span>
                           <span class="p">},</span>
                   <span class="nx">initial</span><span class="o">:</span> <span class="p">{</span> <span class="nx">total</span> <span class="o">:</span> <span class="mi">0</span> <span class="p">}</span>
                <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>The result is an array of documents that contain the group by fields
and the calculated aggregation field:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span> <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-07-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">25</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-07-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc456&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">25</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-07-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;bcd123&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">10</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-07-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;efg456&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">10</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-06-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">25</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-06-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;efg456&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">15</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-06-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;ijk123&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">20</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-05-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">45</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-05-01T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc456&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">25</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-06-08T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">25</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;ord_dt&quot;</span> <span class="o">:</span> <span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;2012-06-08T04:00:00Z&quot;</span><span class="p">),</span> <span class="s2">&quot;item.sku&quot;</span> <span class="o">:</span> <span class="s2">&quot;abc456&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">25</span> <span class="p">}</span> <span class="p">]</span>
</pre></div>
</div>
<p>The method call is analogous to the SQL statement:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">ord_dt</span><span class="p">,</span> <span class="n">item_sku</span><span class="p">,</span> <span class="k">SUM</span><span class="p">(</span><span class="n">item_qty</span><span class="p">)</span> <span class="k">as</span> <span class="n">total</span>
<span class="k">FROM</span> <span class="n">orders</span>
<span class="k">WHERE</span> <span class="n">ord_dt</span> <span class="o">&gt;</span> <span class="s1">&#39;01/01/2012&#39;</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">ord_dt</span><span class="p">,</span> <span class="n">item_sku</span>
</pre></div>
</div>
</li>
<li><p class="first">The following example groups by the calculated <tt class="docutils literal"><span class="pre">day_of_week</span></tt> field,
those documents that have <tt class="docutils literal"><span class="pre">ord_dt</span></tt> greater than <tt class="docutils literal"><span class="pre">01/01/2011</span></tt> and
calculates the sum, count, and average of the <tt class="docutils literal"><span class="pre">qty</span></tt> field for each
grouping:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">group</span><span class="p">(</span> <span class="p">{</span>
                   <span class="nx">keyf</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
                             <span class="k">return</span> <span class="p">{</span> <span class="nx">day_of_week</span><span class="o">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">ord_dt</span><span class="p">.</span><span class="nx">getDay</span><span class="p">()</span> <span class="p">}</span> <span class="p">;</span> <span class="p">},</span>
                   <span class="nx">cond</span><span class="o">:</span> <span class="p">{</span> <span class="nx">ord_dt</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span> <span class="s1">&#39;01/01/2012&#39;</span> <span class="p">)</span> <span class="p">}</span> <span class="p">},</span>
                   <span class="nx">reduce</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">curr</span><span class="p">,</span> <span class="nx">result</span> <span class="p">)</span> <span class="p">{</span>
                              <span class="nx">result</span><span class="p">.</span><span class="nx">total</span> <span class="o">+=</span> <span class="nx">curr</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">qty</span><span class="p">;</span>
                              <span class="nx">result</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span><span class="p">;</span>
                           <span class="p">},</span>
                   <span class="nx">initial</span><span class="o">:</span> <span class="p">{</span> <span class="nx">total</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">count</span><span class="o">:</span> <span class="mi">0</span> <span class="p">},</span>
                   <span class="nx">finalize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                               <span class="kd">var</span> <span class="nx">weekdays</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;Sunday&quot;</span><span class="p">,</span> <span class="s2">&quot;Monday&quot;</span><span class="p">,</span> <span class="s2">&quot;Tuesday&quot;</span><span class="p">,</span>
                                                <span class="s2">&quot;Wednesday&quot;</span><span class="p">,</span> <span class="s2">&quot;Thursday&quot;</span><span class="p">,</span>
                                                <span class="s2">&quot;Friday&quot;</span><span class="p">,</span> <span class="s2">&quot;Saturday&quot;</span> <span class="p">];</span>

                               <span class="nx">result</span><span class="p">.</span><span class="nx">day_of_week</span> <span class="o">=</span> <span class="nx">weekdays</span><span class="p">[</span><span class="nx">result</span><span class="p">.</span><span class="nx">day_of_week</span><span class="p">];</span>
                               <span class="nx">result</span><span class="p">.</span><span class="nx">avg</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">total</span> <span class="o">/</span> <span class="nx">result</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span>

                   <span class="p">}</span>
                <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>The result is an array of documents that contain the group by fields
and the calculated aggregation field:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span> <span class="p">{</span> <span class="s2">&quot;day_of_week&quot;</span> <span class="o">:</span> <span class="s2">&quot;Sunday&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">70</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span> <span class="o">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;avg&quot;</span> <span class="o">:</span> <span class="mi">18</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;day_of_week&quot;</span> <span class="o">:</span> <span class="s2">&quot;Friday&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">110</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span> <span class="o">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;avg&quot;</span> <span class="o">:</span> <span class="mi">18</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s2">&quot;day_of_week&quot;</span> <span class="o">:</span> <span class="s2">&quot;Tuesday&quot;</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">70</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span> <span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;avg&quot;</span> <span class="o">:</span> <span class="mi">23</span> <span class="p">}</span> <span class="p">]</span>
</pre></div>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../../applications/aggregation/"><em>Aggregation Framework</em></a></p>
</div>
</li>
</ul>
<dl class="method">
<dt id="db.collection.mapReduce">
<tt class="descclassname">db.collection.</tt><tt class="descname">mapReduce</tt><big>(</big><em>map</em>, <em>reduce</em>, <em>{&lt;out&gt;</em>, <em>&lt;query&gt;</em>, <em>&lt;sort&gt;</em>, <em>&lt;limit&gt;</em>, <em>&lt;finalize&gt;</em>, <em>&lt;scope&gt;</em>, <em>&lt;jsMode&gt;</em>, <em>&lt;verbose&gt;}</em><big>)</big><a class="headerlink" href="#db.collection.mapReduce" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="../method/db.collection.mapReduce/#db.collection.mapReduce" title="db.collection.mapReduce"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.mapReduce()</span></tt></a> method provides a wrapper
around the <a class="reference internal" href="../commands/#mapReduce" title="mapReduce"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">mapReduce</span></tt></a> command.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">mapReduce</span><span class="p">(</span>
                         <span class="nx">mapfunction</span><span class="p">,</span>
                         <span class="nx">reducefunction</span><span class="p">,</span>
                         <span class="p">{</span>
                           <span class="nx">out</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">collection</span><span class="o">&gt;</span><span class="p">,</span>
                           <span class="nx">query</span><span class="o">:</span> <span class="o">&lt;</span><span class="nb">document</span><span class="o">&gt;</span><span class="p">,</span>
                           <span class="nx">sort</span><span class="o">:</span> <span class="o">&lt;</span><span class="nb">document</span><span class="o">&gt;</span><span class="p">,</span>
                           <span class="nx">limit</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">number</span><span class="o">&gt;</span><span class="p">,</span>
                           <span class="nx">finalize</span><span class="o">:</span> <span class="o">&lt;</span><span class="kd">function</span><span class="o">&gt;</span><span class="p">,</span>
                           <span class="nx">scope</span><span class="o">:</span> <span class="o">&lt;</span><span class="nb">document</span><span class="o">&gt;</span><span class="p">,</span>
                           <span class="nx">jsMode</span><span class="o">:</span> <span class="o">&lt;</span><span class="kr">boolean</span><span class="o">&gt;</span><span class="p">,</span>
                           <span class="nx">verbose</span><span class="o">:</span> <span class="o">&lt;</span><span class="kr">boolean</span><span class="o">&gt;</span>
                         <span class="p">}</span>
                       <span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="../method/db.collection.mapReduce/#db.collection.mapReduce" title="db.collection.mapReduce"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.mapReduce()</span></tt></a> takes the following parameters:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>map</strong> &#8211; <p>A JavaScript function that associates or &#8220;maps&#8221; a value with a
key.</p>
<p>The <tt class="docutils literal"><span class="pre">map</span></tt> function has the following prototype:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
   <span class="p">...</span>
   <span class="nx">emit</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">map</span></tt> function process every input document for the
map-reduce operation. All the <tt class="docutils literal"><span class="pre">key</span></tt> and <tt class="docutils literal"><span class="pre">value</span></tt> pairs
emitted by the map function. In map-reduce operations, the
operation groups the output from the map phase by the <tt class="docutils literal"><span class="pre">key</span></tt>
value and passes these groupings to the <tt class="docutils literal"><span class="pre">reduce</span></tt> function.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li>In the <tt class="docutils literal"><span class="pre">map</span></tt> function, reference the current document as
<tt class="docutils literal"><span class="pre">this</span></tt> within the function.</li>
<li>The <tt class="docutils literal"><span class="pre">map</span></tt> function should <em>not</em> access the database for
any reason.</li>
<li>The <tt class="docutils literal"><span class="pre">map</span></tt> function should be pure, or have <em>no</em> impact
outside of the function (i.e. side effects.)</li>
<li>The <tt class="docutils literal"><span class="pre">emit(key,value)</span></tt> function associates the <tt class="docutils literal"><span class="pre">key</span></tt>
with a <tt class="docutils literal"><span class="pre">value</span></tt>.<ul>
<li>A single emit can only hold half of MongoDB&#8217;s <a class="reference internal" href="../limits/#limit-bson-document-size"><em>maximum
BSON document size</em></a>.</li>
<li>There is no limit to the number of times you may call the
<tt class="docutils literal"><span class="pre">emit</span></tt> function per document.</li>
</ul>
</li>
<li>The <tt class="docutils literal"><span class="pre">map</span></tt> function can access the variables defined in
the <tt class="docutils literal"><span class="pre">scope</span></tt> parameter.</li>
</ul>
</div>
</li>
<li><strong>reduce</strong> &#8211; <p>A JavaScript function that &#8220;reduces&#8221; to a single object all the
<tt class="docutils literal"><span class="pre">values</span></tt> associated with a particular <tt class="docutils literal"><span class="pre">key</span></tt>.</p>
<p>The <tt class="docutils literal"><span class="pre">reduce</span></tt> function has the following prototype:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
   <span class="p">...</span>
   <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">reduce</span></tt> function accepts <tt class="docutils literal"><span class="pre">key</span></tt> and <tt class="docutils literal"><span class="pre">values</span></tt>
arguments. The elements of the <tt class="docutils literal"><span class="pre">values</span></tt> array are the
individual <tt class="docutils literal"><span class="pre">value</span></tt> objects emitted by the <tt class="docutils literal"><span class="pre">&lt;map&gt;</span></tt> function,
grouped by the <tt class="docutils literal"><span class="pre">key</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li>The <tt class="docutils literal"><span class="pre">reduce</span></tt> function should <em>not</em> access the database,
even to perform read operations.</li>
<li>The <tt class="docutils literal"><span class="pre">reduce</span></tt> function should <em>not</em> affect the outside
system.</li>
<li>Because it is possible to invoke the <tt class="docutils literal"><span class="pre">reduce</span></tt> function
more than once for the same key, the following three
properties need to be true:<ol class="loweralpha">
<li>the <em>type</em> of the return object must be <strong>identical</strong>
to the type of the <tt class="docutils literal"><span class="pre">value</span></tt> emitted by the <tt class="docutils literal"><span class="pre">&lt;map&gt;</span></tt>
function to ensure that the following operations is
true:<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">reduce</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="p">[</span> <span class="nx">C</span><span class="p">,</span> <span class="nx">reduce</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="p">[</span> <span class="nx">A</span><span class="p">,</span> <span class="nx">B</span> <span class="p">])</span> <span class="p">]</span> <span class="p">)</span> <span class="o">==</span> <span class="nx">reduce</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="p">[</span> <span class="nx">C</span><span class="p">,</span> <span class="nx">A</span><span class="p">,</span> <span class="nx">B</span> <span class="p">]</span> <span class="p">)</span>
</pre></div>
</div>
</li>
<li>the <tt class="docutils literal"><span class="pre">reduce</span></tt> function must be <em>idempotent</em>. Ensure
that the following statement is true:<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">reduce</span><span class="p">(</span> <span class="nx">key</span><span class="p">,</span> <span class="p">[</span> <span class="nx">reduce</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">valuesArray</span><span class="p">)</span> <span class="p">]</span> <span class="p">)</span> <span class="o">==</span> <span class="nx">reduce</span> <span class="p">(</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">valuesArray</span> <span class="p">)</span>
</pre></div>
</div>
</li>
<li>the order of the elements in the
<tt class="docutils literal"><span class="pre">valuesArray</span></tt> should not affect the output of the
<tt class="docutils literal"><span class="pre">reduce</span></tt> function, so that the following statement is
true:<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">reduce</span> <span class="p">(</span> <span class="nx">key</span><span class="p">,</span> <span class="p">[</span> <span class="nx">A</span><span class="p">,</span> <span class="nx">B</span> <span class="p">]</span> <span class="p">)</span> <span class="o">==</span> <span class="nx">reduce</span> <span class="p">(</span> <span class="nx">key</span><span class="p">,</span> <span class="p">[</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">A</span> <span class="p">]</span> <span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</li>
<li>MongoDB will <strong>not</strong> call the <tt class="docutils literal"><span class="pre">reduce</span></tt> function for a key
that has only a single value.</li>
<li>The <tt class="docutils literal"><span class="pre">reduce</span></tt> function can access the variables defined
in the <tt class="docutils literal"><span class="pre">scope</span></tt> parameter.</li>
</ul>
</div>
</li>
<li><strong>out</strong> &#8211; <p>Specifies the location of the result of the map-reduce
operation. You may output to a collection when performing map
reduce operations on the primary members of the set, on
<a class="reference internal" href="../glossary/#term-secondary"><em class="xref std std-term">secondary</em></a> members you may only use the <tt class="docutils literal"><span class="pre">inline</span></tt>
output.</p>
<p>You can specify the following options for the <tt class="docutils literal"><span class="pre">out</span></tt> parameter:</p>
<ul>
<li><strong>Output to a collection</strong>.<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">out</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">collectionName</span><span class="o">&gt;</span> <span class="p">}</span>
</pre></div>
</div>
</li>
<li><strong>Output to a collection and specify one of the following
actions</strong>. This option is only available when passing <tt class="docutils literal"><span class="pre">out</span></tt>
a collection that already exists. This option is not
available on secondary members of replica sets.<div class="highlight-none"><div class="highlight"><pre>{ out: { &lt;action&gt;: &lt;collectionName&gt;[, db: &lt;dbName&gt;][, sharded: &lt;boolean&gt; ][, nonAtomic: &lt;boolean&gt; ] } }
</pre></div>
</div>
<ul>
<li><tt class="docutils literal"><span class="pre">&lt;action&gt;</span></tt>: Specify one of the following actions:<blockquote>
<div><ul>
<li><tt class="docutils literal"><span class="pre">replace</span></tt><div class="highlight-none"><div class="highlight"><pre>{ out: { replace: &lt;collectionName&gt; } }
</pre></div>
</div>
<p>Replace the contents of the <tt class="docutils literal"><span class="pre">&lt;collectionName&gt;</span></tt> if the
collection with the <tt class="docutils literal"><span class="pre">&lt;collectionName&gt;</span></tt> exists.</p>
</li>
<li><tt class="docutils literal"><span class="pre">merge</span></tt><div class="highlight-none"><div class="highlight"><pre>{ out: { merge: &lt;collectionName&gt; } }
</pre></div>
</div>
<p>Merge the new result with the existing result if the
output collection already exists. If an existing document
has the same key as the new result, <em>overwrite</em> that
existing document.</p>
</li>
<li><tt class="docutils literal"><span class="pre">reduce</span></tt><div class="highlight-none"><div class="highlight"><pre>{ out: { reduce: &lt;collectionName&gt; } }
</pre></div>
</div>
<p>Merge the new result with the existing result if the
output collection already exists. If an existing document
has the same key as the new result, apply the <tt class="docutils literal"><span class="pre">&lt;reduce&gt;</span></tt>
function to both the new and the existing documents and
overwrite the existing document with the result.</p>
</li>
</ul>
</div></blockquote>
</li>
<li><tt class="docutils literal"><span class="pre">db</span></tt>:<p>Optional.The name of the database that you want the
map-reduce operation to write its output. By default
this will be the same database as the input collection.</p>
</li>
<li><tt class="docutils literal"><span class="pre">sharded</span></tt>:<p>Optional. If <tt class="docutils literal"><span class="pre">true</span></tt> <em>and</em> you have enabled sharding on
output database, the map-reduce operation will shard the
output collection using the <tt class="docutils literal"><span class="pre">_id</span></tt> field as the shard key.</p>
</li>
<li><tt class="docutils literal"><span class="pre">nonAtomic</span></tt>:<p class="versionadded">
<span class="versionmodified">New in version 2.1.</span></p>
<p>Optional. Specify output operation as non-atomic and is
valid <em>only</em> for <tt class="docutils literal"><span class="pre">merge</span></tt> and <tt class="docutils literal"><span class="pre">reduce</span></tt> output modes which
may take minutes to execute.</p>
<p>If <tt class="docutils literal"><span class="pre">nonAtomic</span></tt> is <tt class="docutils literal"><span class="pre">true</span></tt>, the post-processing step will
prevent MongoDB from locking the database; however, other
clients will be able to read intermediate states of the
output collection. Otherwise the map reduce operation must
lock the database during post-processing.</p>
</li>
</ul>
</li>
<li><strong>Output inline</strong>. Perform the map-reduce operation in memory
and return the result. This option is the only available
option for <tt class="docutils literal"><span class="pre">out</span></tt> on secondary members of replica sets.<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">out</span><span class="o">:</span> <span class="p">{</span> <span class="nx">inline</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span>
</pre></div>
</div>
<p>The result must fit within the <a class="reference internal" href="../limits/#limit-bson-document-size"><em>maximum size of a BSON
document</em></a>.</p>
</li>
</ul>
</li>
<li><strong>query</strong> &#8211; Optional. Specifies the selection criteria using <a class="reference internal" href="../operators/"><em>query
operators</em></a> for determining the documents
input to the <tt class="docutils literal"><span class="pre">map</span></tt> function.</li>
<li><strong>sort</strong> &#8211; Optional. Sorts the <em>input</em> documents. This option is useful for
optimization. For example, specify the sort key to be the same
as the emit key so that there are fewer reduce operations.</li>
<li><strong>limit</strong> &#8211; Optional. Specifies a maximum number of documents to return from
the collection.</li>
<li><strong>finalize</strong> &#8211; <p>Optional. A JavaScript function that follows the <tt class="docutils literal"><span class="pre">&lt;reduce&gt;</span></tt>
method and modifies the output and has the following prototype:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">reducedValue</span><span class="p">)</span> <span class="p">{</span>
   <span class="p">...</span>
   <span class="k">return</span> <span class="nx">modifiedObject</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">&lt;finalize&gt;</span></tt> function receives as its arguments a <tt class="docutils literal"><span class="pre">key</span></tt>
value and the <tt class="docutils literal"><span class="pre">reducedValue</span></tt> from the <tt class="docutils literal"><span class="pre">&lt;reduce&gt;</span></tt> function.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last">
<li>The <tt class="docutils literal"><span class="pre">finalize</span></tt> function should <em>not</em> access the database for
any reason.</li>
<li>The <tt class="docutils literal"><span class="pre">finalize</span></tt> function should be pure, or have <em>no</em> impact
outside of the function (i.e. side effects.)</li>
<li>The <tt class="docutils literal"><span class="pre">finalize</span></tt> function can access the variables
defined in the <tt class="docutils literal"><span class="pre">scope</span></tt> parameter.</li>
</ul>
</div>
</li>
<li><strong>scope</strong> (<em>document</em>) &#8211; Optional. Specifies global variables that are accessible in the
<tt class="docutils literal"><span class="pre">map</span></tt> , <tt class="docutils literal"><span class="pre">reduce</span></tt> and the <tt class="docutils literal"><span class="pre">finalize</span></tt> functions.</li>
<li><strong>jsMode</strong> (<em>Boolean</em>) &#8211; <p>Optional. Specifies whether to convert intermediate data into
BSON format between the execution of the <tt class="docutils literal"><span class="pre">map</span></tt> and <tt class="docutils literal"><span class="pre">reduce</span></tt>
functions.</p>
<p>If <tt class="docutils literal"><span class="pre">false</span></tt>:</p>
<ul>
<li>Internally, MongoDB converts the JavaScript objects emitted
by the <tt class="docutils literal"><span class="pre">map</span></tt>
function to BSON objects. These BSON
objects are then converted back to JavaScript objects when
calling the <tt class="docutils literal"><span class="pre">reduce</span></tt> function.</li>
<li>The map-reduce operation places the intermediate BSON objects
in temporary, on-disk storage. This allows the map-reduce
operation to execute over arbitrarily large data sets.</li>
</ul>
<p>If <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<ul>
<li>Internally, the JavaScript objects emitted during <tt class="docutils literal"><span class="pre">map</span></tt>
function remain as JavaScript objects. There is no need to
convert the objects for the <tt class="docutils literal"><span class="pre">reduce</span></tt> function, which
can result in faster execution.</li>
<li>You can only use <tt class="docutils literal"><span class="pre">jsMode</span></tt> for result sets with fewer than
500,000 distinct <tt class="docutils literal"><span class="pre">key</span></tt> arguments to the mapper&#8217;s <tt class="docutils literal"><span class="pre">emit()</span></tt>
function.</li>
</ul>
<p>The <tt class="docutils literal"><span class="pre">jsMode</span></tt> defaults to false.</p>
</li>
<li><strong>verbose</strong> (<em>Boolean</em>) &#8211; Optional. Specifies whether to include the <tt class="docutils literal"><span class="pre">timing</span></tt>
information in the result information. The <tt class="docutils literal"><span class="pre">verbose</span></tt>
defaults to <tt class="docutils literal"><span class="pre">true</span></tt> to include the <tt class="docutils literal"><span class="pre">timing</span></tt> information.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Consider the following map-reduce operations on a collection <tt class="docutils literal"><span class="pre">orders</span></tt>
that contains documents of the following prototype:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
     <span class="nx">_id</span><span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;50a8240b927d5d8b5891743c&quot;</span><span class="p">),</span>
     <span class="nx">cust_id</span><span class="o">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">,</span>
     <span class="nx">ord_date</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="s2">&quot;Oct 04, 2012&quot;</span><span class="p">),</span>
     <span class="nx">status</span><span class="o">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span>
     <span class="nx">price</span><span class="o">:</span> <span class="mi">250</span><span class="p">,</span>
     <span class="nx">items</span><span class="o">:</span> <span class="p">[</span> <span class="p">{</span> <span class="nx">sku</span><span class="o">:</span> <span class="s2">&quot;mmm&quot;</span><span class="p">,</span> <span class="nx">qty</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">price</span><span class="o">:</span> <span class="mf">2.5</span> <span class="p">},</span>
              <span class="p">{</span> <span class="nx">sku</span><span class="o">:</span> <span class="s2">&quot;nnn&quot;</span><span class="p">,</span> <span class="nx">qty</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">price</span><span class="o">:</span> <span class="mf">2.5</span> <span class="p">}</span> <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<ul>
<li><p class="first">Perform map-reduce operation on the <tt class="docutils literal"><span class="pre">orders</span></tt> collection to group by
the <tt class="docutils literal"><span class="pre">cust_id</span></tt>, and for each <tt class="docutils literal"><span class="pre">cust_id</span></tt>, calculate the sum of the
<tt class="docutils literal"><span class="pre">price</span></tt> for each <tt class="docutils literal"><span class="pre">cust_id</span></tt>:</p>
<blockquote>
<div></div></blockquote>
<ol class="arabic">
<li><p class="first">Define the map function to process each input document:</p>
<ul class="simple">
<li>In the function, <tt class="docutils literal"><span class="pre">this</span></tt> refers to the document that the
map-reduce operation is processing.</li>
<li>The function maps the <tt class="docutils literal"><span class="pre">price</span></tt> to the <tt class="docutils literal"><span class="pre">cust_id</span></tt> for each
document and emits the <tt class="docutils literal"><span class="pre">cust_id</span></tt> and <tt class="docutils literal"><span class="pre">price</span></tt> pair.</li>
</ul>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">mapFunction1</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                       <span class="nx">emit</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cust_id</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">price</span><span class="p">);</span>
                   <span class="p">};</span>
</pre></div>
</div>
</li>
<li><p class="first">Define the corresponding reduce function with two arguments
<tt class="docutils literal"><span class="pre">keyCustId</span></tt> and <tt class="docutils literal"><span class="pre">valuesPrices</span></tt>:</p>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">valuesPrices</span></tt> is an array whose elements are the <tt class="docutils literal"><span class="pre">price</span></tt>
values emitted by the map function and grouped by <tt class="docutils literal"><span class="pre">keyCustId</span></tt>.</li>
<li>The function reduces the <tt class="docutils literal"><span class="pre">valuesPrice</span></tt> array to the
sum of its elements.</li>
</ul>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">reduceFunction1</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">keyCustId</span><span class="p">,</span> <span class="nx">valuesPrices</span><span class="p">)</span> <span class="p">{</span>
                          <span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">sum</span><span class="p">(</span><span class="nx">valuesPrices</span><span class="p">);</span>
                      <span class="p">};</span>
</pre></div>
</div>
</li>
<li><p class="first">Perform the map-reduce on all documents in the <tt class="docutils literal"><span class="pre">orders</span></tt> collection
using the <tt class="docutils literal"><span class="pre">mapFunction1</span></tt> map function and the <tt class="docutils literal"><span class="pre">reduceFunction1</span></tt>
reduce function.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">mapReduce</span><span class="p">(</span>
                     <span class="nx">mapFunction1</span><span class="p">,</span>
                     <span class="nx">reduceFunction1</span><span class="p">,</span>
                     <span class="p">{</span> <span class="nx">out</span><span class="o">:</span> <span class="s2">&quot;map_reduce_example&quot;</span> <span class="p">}</span>
                   <span class="p">)</span>
</pre></div>
</div>
<p>This operation outputs the results to a collection named
<tt class="docutils literal"><span class="pre">map_reduce_example</span></tt>. If the <tt class="docutils literal"><span class="pre">map_reduce_example</span></tt> collection
already exists, the operation will replace the contents with the
results of this map-reduce operation:</p>
</li>
</ol>
</li>
<li><p class="first">In this example you will perform a map-reduce operation on the <tt class="docutils literal"><span class="pre">orders</span></tt> collection, for
all documents that have an <tt class="docutils literal"><span class="pre">ord_date</span></tt> value
greater than <tt class="docutils literal"><span class="pre">01/01/2012</span></tt>. The operation groups by
the <tt class="docutils literal"><span class="pre">item.sku</span></tt> field, and for each <tt class="docutils literal"><span class="pre">sku</span></tt> calculates the number of orders and the
total quantity ordered. The operation concludes by calculating the average quantity per
order for each <tt class="docutils literal"><span class="pre">sku</span></tt> value:</p>
<ol class="arabic">
<li><p class="first">Define the map function to process each input document:</p>
<ul class="simple">
<li>In the function, <tt class="docutils literal"><span class="pre">this</span></tt> refers to the document that the
map-reduce operation is processing.</li>
<li>For each item, the function associates the <tt class="docutils literal"><span class="pre">sku</span></tt> with a new
object <tt class="docutils literal"><span class="pre">value</span></tt> that contains the <tt class="docutils literal"><span class="pre">count</span></tt> of <tt class="docutils literal"><span class="pre">1</span></tt> and the
item <tt class="docutils literal"><span class="pre">qty</span></tt> for the order and emits the <tt class="docutils literal"><span class="pre">sku</span></tt> and <tt class="docutils literal"><span class="pre">value</span></tt> pair.</li>
</ul>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">mapFunction2</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                       <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">idx</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                           <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">idx</span><span class="p">].</span><span class="nx">sku</span><span class="p">;</span>
                           <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="p">{</span>
                                         <span class="nx">count</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
                                         <span class="nx">qty</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">idx</span><span class="p">].</span><span class="nx">qty</span>
                                       <span class="p">};</span>
                           <span class="nx">emit</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
                       <span class="p">}</span>
                    <span class="p">};</span>
</pre></div>
</div>
</li>
<li><p class="first">Define the corresponding reduce function with two arguments
<tt class="docutils literal"><span class="pre">keySKU</span></tt> and <tt class="docutils literal"><span class="pre">valuesCountObjects</span></tt>:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">valuesCountObjects</span></tt> is an array whose elements are the objects
mapped to the grouped <tt class="docutils literal"><span class="pre">keySKU</span></tt> values passed by map
function to the reducer function.</li>
<li>The function reduces the <tt class="docutils literal"><span class="pre">valuesCountObjects</span></tt> array to a single
object <tt class="docutils literal"><span class="pre">reducedValue</span></tt> that also contains the <tt class="docutils literal"><span class="pre">count</span></tt> and the
<tt class="docutils literal"><span class="pre">qty</span></tt> fields.</li>
<li>In <tt class="docutils literal"><span class="pre">reducedValue</span></tt>, the <tt class="docutils literal"><span class="pre">count</span></tt> field contains the sum of the
<tt class="docutils literal"><span class="pre">count</span></tt> fields from the individual array elements, and the
<tt class="docutils literal"><span class="pre">qty</span></tt> field contains the sum of the <tt class="docutils literal"><span class="pre">qty</span></tt> fields from the
individual array elements.</li>
</ul>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">reduceFunction2</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">keySKU</span><span class="p">,</span> <span class="nx">valuesCountObjects</span><span class="p">)</span> <span class="p">{</span>
                          <span class="nx">reducedValue</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">count</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">qty</span><span class="o">:</span> <span class="mi">0</span> <span class="p">};</span>

                          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">idx</span> <span class="o">&lt;</span> <span class="nx">valuesCountObjects</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                              <span class="nx">reducedValue</span><span class="p">.</span><span class="nx">count</span> <span class="o">+=</span> <span class="nx">valuesCountObjects</span><span class="p">[</span><span class="nx">idx</span><span class="p">].</span><span class="nx">count</span><span class="p">;</span>
                              <span class="nx">reducedValue</span><span class="p">.</span><span class="nx">qty</span> <span class="o">+=</span> <span class="nx">valuesCountObjects</span><span class="p">[</span><span class="nx">idx</span><span class="p">].</span><span class="nx">qty</span><span class="p">;</span>
                          <span class="p">}</span>

                          <span class="k">return</span> <span class="nx">reducedValue</span><span class="p">;</span>
                      <span class="p">};</span>
</pre></div>
</div>
</li>
<li><p class="first">Define a finalize function with two arguments <tt class="docutils literal"><span class="pre">key</span></tt> and
<tt class="docutils literal"><span class="pre">reducedValue</span></tt>. The function modifies the <tt class="docutils literal"><span class="pre">reducedValue</span></tt> object
to add a computed field named <tt class="docutils literal"><span class="pre">average</span></tt> and returns the modified
object:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">finalizeFunction2</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">reducedValue</span><span class="p">)</span> <span class="p">{</span>

                            <span class="nx">reducedValue</span><span class="p">.</span><span class="nx">average</span> <span class="o">=</span> <span class="nx">reducedValue</span><span class="p">.</span><span class="nx">qty</span><span class="o">/</span><span class="nx">reducedValue</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>

                            <span class="k">return</span> <span class="nx">reducedValue</span><span class="p">;</span>
                        <span class="p">};</span>
</pre></div>
</div>
</li>
<li><p class="first">Perform the map-reduce operation on the <tt class="docutils literal"><span class="pre">orders</span></tt> collection using
the <tt class="docutils literal"><span class="pre">mapFunction2</span></tt>, <tt class="docutils literal"><span class="pre">reduceFunction2</span></tt>, and
<tt class="docutils literal"><span class="pre">finalizeFunction2</span></tt> functions.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">mapReduce</span><span class="p">(</span> <span class="nx">mapFunction2</span><span class="p">,</span>
                     <span class="nx">reduceFunction2</span><span class="p">,</span>
                     <span class="p">{</span>
                       <span class="nx">out</span><span class="o">:</span> <span class="p">{</span> <span class="nx">merge</span><span class="o">:</span> <span class="s2">&quot;map_reduce_example&quot;</span> <span class="p">},</span>
                       <span class="nx">query</span><span class="o">:</span> <span class="p">{</span> <span class="nx">ord_date</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;01/01/2012&#39;</span><span class="p">)</span> <span class="p">}</span> <span class="p">},</span>
                       <span class="nx">finalize</span><span class="o">:</span> <span class="nx">finalizeFunction2</span>
                     <span class="p">}</span>
                   <span class="p">)</span>
</pre></div>
</div>
<p>This operation uses the <tt class="docutils literal"><span class="pre">query</span></tt> field to select only those
documents with <tt class="docutils literal"><span class="pre">ord_date</span></tt> greater than <tt class="docutils literal"><span class="pre">new</span>
<span class="pre">Date(01/01/2012)</span></tt>. Then it output the results to a collection
<tt class="docutils literal"><span class="pre">map_reduce_example</span></tt>. If the <tt class="docutils literal"><span class="pre">map_reduce_example</span></tt> collection
already exists, the operation will merge the existing contents with
the results of this map-reduce operation:</p>
</li>
</ol>
</li>
</ul>
<p>For more information and examples, see the <a class="reference internal" href="../../applications/map-reduce/"><em>Map-Reduce</em></a> page.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference internal" href="../glossary/#term-map-reduce"><em class="xref std std-term">map-reduce</em></a> and <a class="reference internal" href="../commands/#mapReduce" title="mapReduce"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">mapReduce</span></tt></a></li>
<li><a class="reference internal" href="../../applications/aggregation/"><em>Aggregation Framework</em></a></li>
</ul>
</div>
</dd></dl>

</div>
</div>
<div class="section" id="administrative-functions">
<h2>Administrative Functions<a class="headerlink" href="#administrative-functions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="database-methods">
<h3>Database Methods<a class="headerlink" href="#database-methods" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="db.addUser">
<tt class="descclassname">db.</tt><tt class="descname">addUser</tt><big>(</big><em>&quot;username&quot;</em>, <em>&quot;password&quot;</em><span class="optional">[</span>, <em>readOnly</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#db.addUser" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>username</strong> (<em>string</em>) &#8211; Specifies a new username.</li>
<li><strong>password</strong> (<em>string</em>) &#8211; Specifies the corresponding password.</li>
<li><strong>readOnly</strong> (<em>boolean</em>) &#8211; Optional. Restrict a user to
read-privileges only. Defaults to false.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Use this function to create new database users, by specifying a
username and password as arguments to the command. If you want to
restrict the user to have only read-only privileges, supply a true
third argument; however, this defaults to false.</p>
</dd></dl>

<dl class="method">
<dt id="db.auth">
<tt class="descclassname">db.</tt><tt class="descname">auth</tt><big>(</big><em>&quot;username&quot;</em>, <em>&quot;password&quot;</em><big>)</big><a class="headerlink" href="#db.auth" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>username</strong> (<em>string</em>) &#8211; Specifies an existing username with access
privileges for this database.</li>
<li><strong>password</strong> (<em>string</em>) &#8211; Specifies the corresponding password.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Allows a user to authenticate to the database from within the
shell. Alternatively use <a class="reference internal" href="../mongo/#cmdoption-mongo--username"><em class="xref std std-option">mongo --username</em></a> and
<a class="reference internal" href="../mongo/#cmdoption-mongo--password"><em class="xref std std-option">--password</em></a> to specify authentication
credentials.</p>
</dd></dl>

<dl class="method">
<dt id="db.cloneDatabase">
<tt class="descclassname">db.</tt><tt class="descname">cloneDatabase</tt><big>(</big><em>&quot;hostname&quot;</em><big>)</big><a class="headerlink" href="#db.cloneDatabase" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>hostname</strong> (<em>string</em>) &#8211; Specifies the hostname to copy the current
instance.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Use this function to copy a database from a remote to the current
database. The command assumes that the remote database has the same
name as the current database. For example, to clone a database
named <tt class="docutils literal"><span class="pre">importdb</span></tt> on a host named <tt class="docutils literal"><span class="pre">hostname</span></tt>, do</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">use</span> <span class="nx">importdb</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">cloneDatabase</span><span class="p">(</span><span class="s2">&quot;hostname&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>New databases are implicitly created, so the current host does not
need to have a database named <tt class="docutils literal"><span class="pre">importdb</span></tt> for this command to
succeed.</p>
<p>This function provides a wrapper around the MongoDB <a class="reference internal" href="../glossary/#term-database-command"><em class="xref std std-term">database
command</em></a> &#8220;<a class="reference internal" href="../commands/#clone" title="clone"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">clone</span></tt></a>.&#8221; The <a class="reference internal" href="../commands/#copydb" title="copydb"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">copydb</span></tt></a> database command
provides related functionality.</p>
</dd></dl>

<dl class="method">
<dt id="db.commandHelp">
<tt class="descclassname">db.</tt><tt class="descname">commandHelp</tt><big>(</big><em>command</em><big>)</big><a class="headerlink" href="#db.commandHelp" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>command</strong> &#8211; Specifies a <a class="reference internal" href="../commands/"><em>database command name</em></a>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Help text for the specified <a class="reference internal" href="../glossary/#term-database-command"><em class="xref std std-term">database command</em></a>. See
the <a class="reference internal" href="../commands/"><em>database command reference</em></a> for full documentation of these
commands.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="db.copyDatabase">
<tt class="descclassname">db.</tt><tt class="descname">copyDatabase</tt><big>(</big><em>origin</em>, <em>destination</em>, <em>hostname</em><big>)</big><a class="headerlink" href="#db.copyDatabase" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>origin</strong> (<em>database</em>) &#8211; Specifies the name of the database on the
origin system.</li>
<li><strong>destination</strong> (<em>database</em>) &#8211; Specifies the name of the database
that you wish to copy the origin
database into.</li>
<li><strong>hostname</strong> (<em>origin</em>) &#8211; Indicate the hostname of the origin database
host. Omit the hostname to copy from one
name to another on the same server.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Use this function to copy a specific database, named <tt class="docutils literal"><span class="pre">origin</span></tt>
running on the system accessible via <tt class="docutils literal"><span class="pre">hostname</span></tt> into the local
database named <tt class="docutils literal"><span class="pre">destination</span></tt>. The command creates destination
databases implicitly when they do not exist. If you omit the
hostname, MongoDB will copy data from one database into another on
the same instance.</p>
<p>This function provides a wrapper around the MongoDB <a class="reference internal" href="../glossary/#term-database-command"><em class="xref std std-term">database
command</em></a> &#8220;<a class="reference internal" href="../commands/#copydb" title="copydb"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">copydb</span></tt></a>.&#8221; The <a class="reference internal" href="../commands/#clone" title="clone"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">clone</span></tt></a> database
command provides related functionality.</p>
</dd></dl>

<dl class="method">
<dt id="db.createCollection">
<tt class="descclassname">db.</tt><tt class="descname">createCollection</tt><big>(</big><em>name</em><span class="optional">[</span>, <em>{capped: &lt;boolean&gt;</em>, <em>size: &lt;value&gt;</em>, <em>max &lt;bytes&gt;}</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#db.createCollection" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> (<em>string</em>) &#8211; Specifies the name of a collection to create.</li>
<li><strong>capped</strong> (<em>boolean</em>) &#8211; Optional. If this <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a> is
present, this command creates a capped
collection. The capped argument is a
<a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a> that contains the
following three fields:</li>
<li><strong>capped</strong> &#8211; Enables a <a class="reference internal" href="../glossary/#term-capped-collection"><em class="xref std std-term">collection cap</em></a>. False by default. If enabled,
you must specify a <tt class="docutils literal"><span class="pre">size</span></tt> parameter.</li>
<li><strong>size</strong> (<em>bytes</em>) &#8211; If <tt class="docutils literal"><span class="pre">capped</span></tt> is <tt class="docutils literal"><span class="pre">true</span></tt>, <tt class="docutils literal"><span class="pre">size</span></tt> Specifies a
maximum size in bytes, for the as a &#8220;<a class="reference internal" href="../glossary/#term-capped-collection"><em class="xref std std-term">cap</em></a> for the collection. When
<tt class="docutils literal"><span class="pre">capped</span></tt> is false, you may use <tt class="docutils literal"><span class="pre">size</span></tt></li>
<li><strong>max</strong> (<em>int</em>) &#8211; Optional. Specifies a maximum &#8220;cap,&#8221; in number of
documents for capped collections. You must also
specify <tt class="docutils literal"><span class="pre">size</span></tt> when specifying <tt class="docutils literal"><span class="pre">max</span></tt>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Options:</th><td class="field-body"><ul class="first last simple">
<li><strong>autoIndexId</strong> &#8211; If <tt class="docutils literal"><span class="pre">capped</span></tt> is <tt class="docutils literal"><span class="pre">true</span></tt> you can specify
<tt class="docutils literal"><span class="pre">false</span></tt> to disable the automatic index
created on the <tt class="docutils literal"><span class="pre">_id</span></tt> field. Before 2.2, the
default value for <tt class="docutils literal"><span class="pre">autoIndexId</span></tt> was
<tt class="docutils literal"><span class="pre">false</span></tt>. See <a class="reference internal" href="../../release-notes/2.2/#id-indexes-capped-collections"><em>_id Fields and Indexes on Capped Collections</em></a>
for more information.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Explicitly creates a new collation. Because MongoDB creates
collections implicitly when referenced, this command is primarily
used for creating new capped collections. In some circumstances,
you may use this command to pre-allocate space for an ordinary
collection.</p>
<p>Capped collections have maximum size or document counts that
prevent them from growing beyond maximum thresholds. All capped
collections must specify a maximum size, but may also specify a
maximum document count. The collection will remove older documents
if a collection reaches the maximum size limit before it reaches
the maximum document count. Consider the following example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">createCollection</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">capped</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">size</span> <span class="o">:</span> <span class="mi">5242880</span><span class="p">,</span> <span class="nx">max</span> <span class="o">:</span> <span class="mi">5000</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>This command creates a collection named log with a maximum size of
5 megabytes or a maximum of 5000 documents.</p>
<p>The following command simply pre-allocates a 2 gigabyte, uncapped,
collection named <tt class="docutils literal"><span class="pre">people</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">createCollection</span><span class="p">(</span><span class="s2">&quot;people&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">size</span><span class="o">:</span> <span class="mi">2147483648</span> <span class="p">})</span>
</pre></div>
</div>
<p>This command provides a wrapper around the database command
<a class="reference internal" href="../commands/#create" title="create"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">create</span></tt></a>. See the &#8220;<a class="reference external" href="http://www.mongodb.org/display/DOCS/Capped+Collections">Capped Collections</a>&#8221;
wiki page for more information about capped collections.</p>
</dd></dl>

<dl class="method">
<dt id="db.currentOp">
<tt class="descclassname">db.</tt><tt class="descname">currentOp</tt><big>(</big><big>)</big><a class="headerlink" href="#db.currentOp" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a> that contains an array named
<tt class="docutils literal"><span class="pre">inprog</span></tt>.</td>
</tr>
</tbody>
</table>
<p>The <tt class="docutils literal"><span class="pre">inprog</span></tt> array reports the current operation in progress for
the database instance.  See <a class="reference internal" href="../current-op/"><em>Current Operation Reporting</em></a> for full
documentation of the output of <a class="reference internal" href="../method/db.currentOp/#db.currentOp" title="db.currentOp"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.currentOp()</span></tt></a>.</p>
<p><a class="reference internal" href="../method/db.currentOp/#db.currentOp" title="db.currentOp"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.currentOp()</span></tt></a> is only available for users with
administrative privileges.</p>
<p>Consider the following JavaScript operations for the
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell that you can use to filter the output of
identify specific types of operations:</p>
<ul>
<li><p class="first">Return all pending write operations:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">currentOp</span><span class="p">().</span><span class="nx">inprog</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span>
   <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span>
     <span class="k">if</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">waitingForLock</span> <span class="o">&amp;&amp;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">lockType</span> <span class="o">!=</span> <span class="s2">&quot;read&quot;</span><span class="p">)</span>
        <span class="nx">printjson</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span>
     <span class="p">})</span>
</pre></div>
</div>
</li>
<li><p class="first">Return the active write operation:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">currentOp</span><span class="p">().</span><span class="nx">inprog</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span>
   <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span>
     <span class="k">if</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">active</span> <span class="o">&amp;&amp;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">lockType</span> <span class="o">==</span> <span class="s2">&quot;write&quot;</span><span class="p">)</span>
        <span class="nx">printjson</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span>
     <span class="p">})</span>
</pre></div>
</div>
</li>
<li><p class="first">Return all active read operations:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">currentOp</span><span class="p">().</span><span class="nx">inprog</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span>
   <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span>
     <span class="k">if</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">active</span> <span class="o">&amp;&amp;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">lockType</span> <span class="o">==</span> <span class="s2">&quot;read&quot;</span><span class="p">)</span>
        <span class="nx">printjson</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span>
     <span class="p">})</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Terminate running operations with extreme caution. Only use
<a class="reference internal" href="../method/db.killOp/#db.killOp" title="db.killOp"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.killOp()</span></tt></a> to terminate operations initiated by clients
and <em>do not</em> terminate internal database operations.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="db.dropDatabase">
<tt class="descclassname">db.</tt><tt class="descname">dropDatabase</tt><big>(</big><big>)</big><a class="headerlink" href="#db.dropDatabase" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes the current database. Does not change the current database,
so the insertion of any documents in this database will allocate a
fresh set of data files.</p>
</dd></dl>

<dl class="method">
<dt id="db.eval">
<tt class="descclassname">db.</tt><tt class="descname">eval</tt><big>(</big><em>function</em>, <em>arguments</em><big>)</big><a class="headerlink" href="#db.eval" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="../method/db.eval/#db.eval" title="db.eval"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.eval()</span></tt></a> provides the ability to run JavaScript code
on the MongoDB server. It is a <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell wrapper around
the <a class="reference internal" href="../commands/#eval" title="eval"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">eval</span></tt></a> command.</p>
<p>The method accepts the following parameters:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>function</strong> (<em>JavaScript</em>) &#8211; <p>A JavaScript function.</p>
<p>The function need not take any arguments, as in the first
example, or may optionally take arguments as in the second:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">)</span> <span class="p">{</span>
   <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><strong>arguments</strong> &#8211; A list of arguments to pass to the JavaScript <tt class="docutils literal"><span class="pre">function</span></tt> if
the function accepts arguments. Omit if the <tt class="docutils literal"><span class="pre">function</span></tt> does
not take arguments.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Consider the following example of the <a class="reference internal" href="../method/db.eval/#db.eval" title="db.eval"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.eval()</span></tt></a> method:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nb">eval</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">incAmount</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">myCollection</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(</span> <span class="p">{</span> <span class="nx">name</span> <span class="o">:</span> <span class="nx">name</span> <span class="p">}</span> <span class="p">);</span>

            <span class="nx">doc</span> <span class="o">=</span> <span class="nx">doc</span> <span class="o">||</span> <span class="p">{</span> <span class="nx">name</span> <span class="o">:</span> <span class="nx">name</span> <span class="p">,</span> <span class="nx">num</span> <span class="o">:</span> <span class="mi">0</span> <span class="p">,</span> <span class="nx">total</span> <span class="o">:</span> <span class="mi">0</span> <span class="p">,</span> <span class="nx">avg</span> <span class="o">:</span> <span class="mi">0</span> <span class="p">};</span>

            <span class="nx">doc</span><span class="p">.</span><span class="nx">num</span><span class="o">++</span><span class="p">;</span>
            <span class="nx">doc</span><span class="p">.</span><span class="nx">total</span> <span class="o">+=</span> <span class="nx">incAmount</span><span class="p">;</span>
            <span class="nx">doc</span><span class="p">.</span><span class="nx">avg</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">total</span> <span class="o">/</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">num</span><span class="p">;</span>

            <span class="nx">db</span><span class="p">.</span><span class="nx">myCollection</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span> <span class="nx">doc</span> <span class="p">);</span>
            <span class="k">return</span> <span class="nx">doc</span><span class="p">;</span>
         <span class="p">},</span>
         <span class="s2">&quot;&lt;name&gt;&quot;</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">db</span></tt> in the function refers to the current database.</li>
<li><tt class="docutils literal"><span class="pre">&quot;&lt;name&gt;&quot;</span></tt> is the argument passed to the function, and
corresponds to the <tt class="docutils literal"><span class="pre">name</span></tt> argument.</li>
<li><tt class="docutils literal"><span class="pre">5</span></tt> is an argument to the function and corresponds to the
<tt class="docutils literal"><span class="pre">incAmount</span></tt> field.</li>
</ul>
<p>If you want to use the server&#8217;s interpreter, you must run
<a class="reference internal" href="../method/db.eval/#db.eval" title="db.eval"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.eval()</span></tt></a>. Otherwise, the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell&#8217;s
JavaScript interpreter evaluates functions entered directly into the
shell.</p>
<p>If an error occurs, <a class="reference internal" href="../method/db.eval/#db.eval" title="db.eval"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.eval()</span></tt></a> throws an exception. Consider
the following invalid function that uses the variable <tt class="docutils literal"><span class="pre">x</span></tt> without
declaring it as an argument:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nb">eval</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">x</span><span class="p">;</span> <span class="p">},</span> <span class="mi">3</span> <span class="p">);</span>
</pre></div>
</div>
<p>The statement will result in the following exception:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
   <span class="s2">&quot;errno&quot;</span> <span class="o">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span>
   <span class="s2">&quot;errmsg&quot;</span> <span class="o">:</span> <span class="s2">&quot;invoke failed: JS Error: ReferenceError: x is not defined nofile_b:1&quot;</span><span class="p">,</span>
   <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<ul class="last simple">
<li>The <a class="reference internal" href="../method/db.eval/#db.eval" title="db.eval"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.eval()</span></tt></a> operation takes a write lock by
default.  This means that <a class="reference internal" href="../method/db.eval/#db.eval" title="db.eval"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.eval()</span></tt></a> blocks all other
read and write operations to the database while
the <a class="reference internal" href="../method/db.eval/#db.eval" title="db.eval"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.eval()</span></tt></a> operation runs. However, if you are using the
<a class="reference internal" href="../commands/#eval" title="eval"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">eval</span></tt></a> command using <a class="reference internal" href="../method/db.runCommand/#db.runCommand" title="db.runCommand"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.runCommand()</span></tt></a>
rather than the helper, you can disable the lock by setting
the <tt class="docutils literal"><span class="pre">nolock</span></tt> flag to <tt class="docutils literal"><span class="pre">true</span></tt> if the <a class="reference internal" href="../commands/#eval" title="eval"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">eval</span></tt></a>
performs a strictly read-only operation.</li>
<li><a class="reference internal" href="../method/db.eval/#db.eval" title="db.eval"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.eval()</span></tt></a> also takes a JavaScript lock which blocks
all</li>
<li>Do not use <a class="reference internal" href="../method/db.eval/#db.eval" title="db.eval"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.eval()</span></tt></a> for long running operations, as
<a class="reference internal" href="../method/db.eval/#db.eval" title="db.eval"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.eval()</span></tt></a> blocks all other operations. Consider using
<a class="reference internal" href="../../applications/server-side-javascript/"><em>other server side code execution options</em></a>.</li>
<li>You can not use <a class="reference internal" href="../method/db.eval/#db.eval" title="db.eval"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.eval()</span></tt></a> with <a class="reference internal" href="../glossary/#term-sharding"><em class="xref std std-term">sharded</em></a> data. In general, you should avoid using
<a class="reference internal" href="../method/db.eval/#db.eval" title="db.eval"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.eval()</span></tt></a> in <a class="reference internal" href="../glossary/#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a>; nevertheless,
it is possible to use <a class="reference internal" href="../method/db.eval/#db.eval" title="db.eval"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.eval()</span></tt></a> with non-sharded
collections and databases stored in <a class="reference internal" href="../glossary/#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a>.</li>
</ul>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../../applications/server-side-javascript/"><em>Server-side JavaScript</em></a></p>
</div>
</dd></dl>

<dl class="method">
<dt id="db.loadServerScripts">
<tt class="descclassname">db.</tt><tt class="descname">loadServerScripts</tt><big>(</big><big>)</big><a class="headerlink" href="#db.loadServerScripts" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="../method/db.loadServerScripts/#db.loadServerScripts" title="db.loadServerScripts"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.loadServerScripts()</span></tt></a> loads all scripts in the
<tt class="docutils literal"><span class="pre">system.js</span></tt> collection for the current database into the
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell session.</p>
<p>Documents in the <tt class="docutils literal"><span class="pre">system.js</span></tt> collection have the following
prototype form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">_id</span> <span class="o">:</span> <span class="s2">&quot;&lt;name&gt;&quot;</span> <span class="p">,</span> <span class="nx">value</span> <span class="o">:</span> <span class="o">&lt;</span><span class="kd">function</span><span class="o">&gt;</span> <span class="p">}</span> <span class="p">}</span>
</pre></div>
</div>
<p>The documents in the <tt class="docutils literal"><span class="pre">system.js</span></tt> collection provide functions
that your applications can use in any JavaScript context with
MongoDB in this database. These contexts include <a class="reference internal" href="../operators/#_S_where" title="$where"><tt class="xref mongodb mongodb-operator docutils literal"><span class="pre">$where</span></tt></a>
clauses and <a class="reference internal" href="../commands/#mapReduce" title="mapReduce"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">mapReduce</span></tt></a> operations.</p>
</dd></dl>

<dl class="method">
<dt id="db.getCollection">
<tt class="descclassname">db.</tt><tt class="descname">getCollection</tt><big>(</big><em>name</em><big>)</big><a class="headerlink" href="#db.getCollection" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> &#8211; The name of a collection.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A collection.</p>
</td>
</tr>
</tbody>
</table>
<p>Use this command to obtain a handle on a collection whose name
might interact with the shell itself, including collections with
names that begin with <tt class="docutils literal"><span class="pre">_</span></tt> or mirror the <a class="reference internal" href="../commands/"><em>database commands</em></a>.</p>
</dd></dl>

<dl class="method">
<dt id="db.getCollectionNames">
<tt class="descclassname">db.</tt><tt class="descname">getCollectionNames</tt><big>(</big><big>)</big><a class="headerlink" href="#db.getCollectionNames" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">An array containing all collections in the existing
database.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="db.getLastError">
<tt class="descclassname">db.</tt><tt class="descname">getLastError</tt><big>(</big><big>)</big><a class="headerlink" href="#db.getLastError" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">The last error message string.</td>
</tr>
</tbody>
</table>
<p>Sets the level of <a class="reference internal" href="../glossary/#term-write-concern"><em class="xref std std-term">write concern</em></a> for confirming the success of write operations.</p>
<div class="admonition-see admonition seealso">
<p class="first admonition-title">See</p>
<p class="last"><a class="reference internal" href="../commands/#getLastError" title="getLastError"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">getLastError</span></tt></a> for all options, <a class="reference internal" href="../../core/write-operations/#write-concern"><em>Write
Concern</em></a> for a conceptual overview,
<a class="reference internal" href="../../core/write-operations/"><em>Write Operations</em></a> for information about all write
operations in MongoDB, and <a class="reference internal" href="../../applications/replication/#replica-set-write-concern"><em>Replica Set Write Concern</em></a> for special considerations related
to write concern for replica sets.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="db.getLastErrorObj">
<tt class="descclassname">db.</tt><tt class="descname">getLastErrorObj</tt><big>(</big><big>)</big><a class="headerlink" href="#db.getLastErrorObj" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A full <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a> with status information.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="db.getMongo">
<tt class="descclassname">db.</tt><tt class="descname">getMongo</tt><big>(</big><big>)</big><a class="headerlink" href="#db.getMongo" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">The current database connection.</td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="../method/db.getMongo/#db.getMongo" title="db.getMongo"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.getMongo()</span></tt></a> runs when the shell initiates. Use this
command to test that the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell has a connection to
the proper database instance.</p>
</dd></dl>

<dl class="method">
<dt id="mongo.setSlaveOk">
<tt class="descclassname">mongo.</tt><tt class="descname">setSlaveOk</tt><big>(</big><big>)</big><a class="headerlink" href="#mongo.setSlaveOk" title="Permalink to this definition">¶</a></dt>
<dd><p>For the current session, this command permits read operations from
non-master (i.e. <a class="reference internal" href="../glossary/#term-slave"><em class="xref std std-term">slave</em></a> or <a class="reference internal" href="../glossary/#term-secondary"><em class="xref std std-term">secondary</em></a>)
instances. Practically, use this method in the following form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">getMongo</span><span class="p">().</span><span class="nx">setSlaveOk</span><span class="p">()</span>
</pre></div>
</div>
<p>Indicates that &#8220;<a class="reference internal" href="../glossary/#term-eventual-consistency"><em class="xref std std-term">eventually consistent</em></a>&#8221; read operations are acceptable for the current
application. This function provides the same functionality as
<a class="reference internal" href="../replica-commands/#rs.slaveOk" title="rs.slaveOk"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">rs.slaveOk()</span></tt></a>.</p>
<p>See the <a class="reference internal" href="../method/cursor.readPref/#cursor.readPref" title="cursor.readPref"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">readPref()</span></tt></a> method for more
fine-grained control over <a class="reference internal" href="../../applications/replication/#read-preference"><em>read preference</em></a>
in the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell.</p>
</dd></dl>

<dl class="method">
<dt id="db.getName">
<tt class="descclassname">db.</tt><tt class="descname">getName</tt><big>(</big><big>)</big><a class="headerlink" href="#db.getName" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the current database name.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="db.getProfilingLevel">
<tt class="descclassname">db.</tt><tt class="descname">getProfilingLevel</tt><big>(</big><big>)</big><a class="headerlink" href="#db.getProfilingLevel" title="Permalink to this definition">¶</a></dt>
<dd><p>This method provides a wrapper around the database command
&#8220;<a class="reference internal" href="../configuration-options/#profile" title="profile"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">profile</span></tt></a>&#8221; and returns the current profiling level.</p>
<p class="deprecated">
<span class="versionmodified">Deprecated since version 1.8.4: </span>Use <a class="reference internal" href="../method/db.getProfilingStatus/#db.getProfilingStatus" title="db.getProfilingStatus"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.getProfilingStatus()</span></tt></a> for related functionality.</p>
</dd></dl>

<dl class="method">
<dt id="db.getProfilingStatus">
<tt class="descclassname">db.</tt><tt class="descname">getProfilingStatus</tt><big>(</big><big>)</big><a class="headerlink" href="#db.getProfilingStatus" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">The current <a class="reference internal" href="../configuration-options/#profile" title="profile"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">profile</span></tt></a> level and
<a class="reference internal" href="../configuration-options/#slowms" title="slowms"><tt class="xref mongodb mongodb-setting docutils literal"><span class="pre">slowms</span></tt></a> setting.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="db.getReplicationInfo">
<tt class="descclassname">db.</tt><tt class="descname">getReplicationInfo</tt><big>(</big><big>)</big><a class="headerlink" href="#db.getReplicationInfo" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A status document.</td>
</tr>
</tbody>
</table>
<p>The output reports statistics related to replication.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">&#8220;<a class="reference internal" href="../replication-info/"><em>Replication Info Reference</em></a>&#8221; for full
documentation of this output.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="db.getSiblingDB">
<tt class="descclassname">db.</tt><tt class="descname">getSiblingDB</tt><big>(</big><big>)</big><a class="headerlink" href="#db.getSiblingDB" title="Permalink to this definition">¶</a></dt>
<dd><p>Used to return another database without modifying the
<tt class="docutils literal"><span class="pre">db</span></tt> variable in the shell environment.</p>
</dd></dl>

<dl class="method">
<dt id="db.killOp">
<tt class="descclassname">db.</tt><tt class="descname">killOp</tt><big>(</big><em>opid</em><big>)</big><a class="headerlink" href="#db.killOp" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>opid</strong> &#8211; Specify an operation ID.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Terminates the specified operation. Use <a class="reference internal" href="../method/db.currentOp/#db.currentOp" title="db.currentOp"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.currentOp()</span></tt></a>
to find operations and their corresponding ids. See
<a class="reference internal" href="../current-op/"><em>Current Operation Reporting</em></a> for full documentation of the output
of <a class="reference internal" href="../method/db.currentOp/#db.currentOp" title="db.currentOp"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.currentOp()</span></tt></a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Terminate running operations with extreme caution. Only use
<a class="reference internal" href="../method/db.killOp/#db.killOp" title="db.killOp"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.killOp()</span></tt></a> to terminate operations initiated by clients
and <em>do not</em> terminate internal database operations.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="db.listCommands">
<tt class="descclassname">db.</tt><tt class="descname">listCommands</tt><big>(</big><big>)</big><a class="headerlink" href="#db.listCommands" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides a list of all database commands. See the
&#8220;<a class="reference internal" href="../commands/"><em>Command Reference</em></a>&#8221; document for a more extensive index of
these options.</p>
</dd></dl>

<dl class="method">
<dt id="db.logout">
<tt class="descclassname">db.</tt><tt class="descname">logout</tt><big>(</big><big>)</big><a class="headerlink" href="#db.logout" title="Permalink to this definition">¶</a></dt>
<dd><p>Ends the current authentication session. This function has no effect
if the current session is not authenticated.</p>
<p>This function provides a wrapper around the database command
&#8220;<a class="reference internal" href="../commands/#logout" title="logout"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">logout</span></tt></a>&#8221;.</p>
</dd></dl>

<dl class="method">
<dt id="db.printCollectionStats">
<tt class="descclassname">db.</tt><tt class="descname">printCollectionStats</tt><big>(</big><big>)</big><a class="headerlink" href="#db.printCollectionStats" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides a wrapper around the <a class="reference internal" href="../method/db.collection.stats/#db.collection.stats" title="db.collection.stats"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.stats()</span></tt></a>
method. Returns statistics from every collection separated by three
hyphen characters.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">&#8220;<a class="reference internal" href="../collection-statistics/"><em>Collection Statistics Reference</em></a>&#8220;</p>
</div>
</dd></dl>

<dl class="method">
<dt id="db.printReplicationInfo">
<tt class="descclassname">db.</tt><tt class="descname">printReplicationInfo</tt><big>(</big><big>)</big><a class="headerlink" href="#db.printReplicationInfo" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides a formatted report of the status of a <a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a>
from the perspective of the <a class="reference internal" href="../glossary/#term-primary"><em class="xref std std-term">primary</em></a> set member. See the
&#8220;<a class="reference internal" href="../replica-status/"><em>Replica Set Status Reference</em></a>&#8221; for more information regarding
the contents of this output.</p>
<p>This function will return <a class="reference internal" href="../method/db.printSlaveReplicationInfo/#db.printSlaveReplicationInfo" title="db.printSlaveReplicationInfo"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.printSlaveReplicationInfo()</span></tt></a>
if issued against a <a class="reference internal" href="../glossary/#term-secondary"><em class="xref std std-term">secondary</em></a> set member.</p>
</dd></dl>

<dl class="method">
<dt id="db.printSlaveReplicationInfo">
<tt class="descclassname">db.</tt><tt class="descname">printSlaveReplicationInfo</tt><big>(</big><big>)</big><a class="headerlink" href="#db.printSlaveReplicationInfo" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides a formatted report of the status of a <a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a>
from the perspective of the <a class="reference internal" href="../glossary/#term-secondary"><em class="xref std std-term">secondary</em></a> set member. See the
&#8220;<a class="reference internal" href="../replica-status/"><em>Replica Set Status Reference</em></a>&#8221; for more information regarding
the contents of this output.</p>
</dd></dl>

<dl class="method">
<dt id="db.printShardingStatus">
<tt class="descclassname">db.</tt><tt class="descname">printShardingStatus</tt><big>(</big><big>)</big><a class="headerlink" href="#db.printShardingStatus" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides a formatted report of the sharding configuration and the
information regarding existing chunks in a <a class="reference internal" href="../glossary/#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a>.</p>
<p>Only use <a class="reference internal" href="../method/db.printShardingStatus/#db.printShardingStatus" title="db.printShardingStatus"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.printShardingStatus()</span></tt></a> when connected to a
<a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instance.</p>
<p>This method is a wrapper around the <a class="reference internal" href="../commands/#printShardingStatus" title="printShardingStatus"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">printShardingStatus</span></tt></a>
command.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../method/sh.status/#sh.status" title="sh.status"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.status()</span></tt></a>, <a class="reference internal" href="../commands/#printShardingStatus" title="printShardingStatus"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">printShardingStatus</span></tt></a></p>
</div>
</dd></dl>

<dl class="method">
<dt id="db.removeUser">
<tt class="descclassname">db.</tt><tt class="descname">removeUser</tt><big>(</big><em>username</em><big>)</big><a class="headerlink" href="#db.removeUser" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>username</strong> &#8211; Specify a database username.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Removes the specified username from the database.</p>
</dd></dl>

<dl class="method">
<dt id="db.repairDatabase">
<tt class="descclassname">db.</tt><tt class="descname">repairDatabase</tt><big>(</big><big>)</big><a class="headerlink" href="#db.repairDatabase" title="Permalink to this definition">¶</a></dt>
<dd><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In general, if you have an intact copy of your data, such as
would exist on a very recent backup or an intact member of a
<a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a>, <strong>do not</strong> use <a class="reference internal" href="../commands/#repairDatabase" title="repairDatabase"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">repairDatabase</span></tt></a>
or related options like <a class="reference internal" href="../method/db.repairDatabase/#db.repairDatabase" title="db.repairDatabase"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.repairDatabase()</span></tt></a> in the
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell or <a class="reference internal" href="../mongod/#cmdoption-mongod--repair"><em class="xref std std-option">mongod --repair</em></a>. Restore
from an intact copy of your data.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When using <a class="reference internal" href="../glossary/#term-journal"><em class="xref std std-term">journaling</em></a>, there is almost never
any need to run <a class="reference internal" href="../commands/#repairDatabase" title="repairDatabase"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">repairDatabase</span></tt></a>. In the event of an
unclean shutdown, the server will be able restore the data files
to a pristine state automatically.</p>
</div>
<p><a class="reference internal" href="../method/db.repairDatabase/#db.repairDatabase" title="db.repairDatabase"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.repairDatabase()</span></tt></a> provides a wrapper around the database
command <a class="reference internal" href="../commands/#repairDatabase" title="repairDatabase"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">repairDatabase</span></tt></a>, and has the same effect as
the run-time option <a class="reference internal" href="../mongod/#cmdoption-mongod--repair"><em class="xref std std-option">mongod --repair</em></a> option, limited to
<em>only</em> the current database. See <a class="reference internal" href="../commands/#repairDatabase" title="repairDatabase"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">repairDatabase</span></tt></a> for
full documentation.</p>
</dd></dl>

<dl class="method">
<dt id="db.runCommand">
<tt class="descclassname">db.</tt><tt class="descname">runCommand</tt><big>(</big><em>command</em><big>)</big><a class="headerlink" href="#db.runCommand" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>command</strong> (<em>string</em>) &#8211; Specifies a <a class="reference internal" href="../glossary/#term-database-command"><em class="xref std std-term">database command</em></a> in the
form of a <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a>.</li>
<li><strong>command</strong> &#8211; When specifying a <a class="reference internal" href="../commands/"><em>command</em></a> as a string,
<a class="reference internal" href="../method/db.runCommand/#db.runCommand" title="db.runCommand"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.runCommand()</span></tt></a> transforms the
command into the form <tt class="docutils literal"><span class="pre">{</span> <span class="pre">command:</span> <span class="pre">1</span> <span class="pre">}</span></tt>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Provides a helper to run specified <a class="reference internal" href="../commands/"><em>database commands</em></a>. This is the preferred method to issue
database commands, as it provides a consistent interface between
the shell and drivers.</p>
</dd></dl>

<dl class="method">
<dt id="db.serverStatus">
<tt class="descclassname">db.</tt><tt class="descname">serverStatus</tt><big>(</big><big>)</big><a class="headerlink" href="#db.serverStatus" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a> that provides an overview of the
database process&#8217;s state.</p>
<p>This command provides a wrapper around the database command
<a class="reference internal" href="../commands/#serverStatus" title="serverStatus"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">serverStatus</span></tt></a>.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">&#8220;<a class="reference internal" href="../server-status/"><em>Server Status Reference</em></a>&#8221; for complete
documentation of the output of this function.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="db.setProfilingLevel">
<tt class="descclassname">db.</tt><tt class="descname">setProfilingLevel</tt><big>(</big><em>level</em><span class="optional">[</span>, <em>slowms</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#db.setProfilingLevel" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>level</strong> &#8211; Specifies a profiling level, see list of possible
values below.</li>
<li><strong>slowms</strong> &#8211; Optionally modify the threshold for the profile to
consider a query or operation &#8220;slow.&#8221;</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Modifies the current <a class="reference internal" href="../glossary/#term-database-profiler"><em class="xref std std-term">database profiler</em></a> level. This allows
administrators to capture data regarding performance. The database
profiling system can impact performance and can allow the server to
write the contents of queries to the log, which might information
security implications for your deployment.</p>
<p>The following profiling levels are available:</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Level</strong></td>
<td><strong>Setting</strong></td>
</tr>
<tr class="row-even"><td>0</td>
<td>Off. No profiling.</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>On. Only includes slow operations.</td>
</tr>
<tr class="row-even"><td>2</td>
<td>On. Includes all operations.</td>
</tr>
</tbody>
</table>
<p>Also configure the <a class="reference internal" href="../configuration-options/#slowms" title="slowms"><tt class="xref mongodb mongodb-setting docutils literal"><span class="pre">slowms</span></tt></a> option to set the threshold
for the profiler to consider a query &#8220;slow.&#8221; Specify this value in
milliseconds to override the default.</p>
<p>This command provides a wrapper around the <a class="reference internal" href="../glossary/#term-database-command"><em class="xref std std-term">database command</em></a>
<a class="reference internal" href="../configuration-options/#profile" title="profile"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">profile</span></tt></a>.</p>
<p><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> writes the output of the database profiler to the
<tt class="docutils literal"><span class="pre">system.profile</span></tt> collection.</p>
<p><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> prints information about queries that take longer than
the <a class="reference internal" href="../configuration-options/#slowms" title="slowms"><tt class="xref mongodb mongodb-setting docutils literal"><span class="pre">slowms</span></tt></a> to the log even when the database profiler is
not active.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The database cannot be locked with <a class="reference internal" href="../method/db.fsyncLock/#db.fsyncLock" title="db.fsyncLock"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.fsyncLock()</span></tt></a> while profiling is enabled.
You must disable profiling before locking the database with <a class="reference internal" href="../method/db.fsyncLock/#db.fsyncLock" title="db.fsyncLock"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.fsyncLock()</span></tt></a>.
Disable profiling using <a class="reference internal" href="../method/db.setProfilingLevel/#db.setProfilingLevel" title="db.setProfilingLevel"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.setProfilingLevel()</span></tt></a> as follows in the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell:</p>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">setProfilingLevel</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="db.shutdownServer">
<tt class="descclassname">db.</tt><tt class="descname">shutdownServer</tt><big>(</big><big>)</big><a class="headerlink" href="#db.shutdownServer" title="Permalink to this definition">¶</a></dt>
<dd><p>Shuts down the current <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> or <a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a>
process cleanly and safely.</p>
<p>This operation fails when the current database <em>is not</em> the
<a class="reference internal" href="../glossary/#term-admin-database"><em class="xref std std-term">admin database</em></a>.</p>
<p>This command provides a wrapper around the <a class="reference internal" href="../commands/#shutdown" title="shutdown"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">shutdown</span></tt></a>.</p>
</dd></dl>

<dl class="method">
<dt id="db.stats">
<tt class="descclassname">db.</tt><tt class="descname">stats</tt><big>(</big><em>scale</em><big>)</big><a class="headerlink" href="#db.stats" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>scale</strong> &#8211; Optional. Specifies the scale to deliver
results. Unless specified, this command
returns all data in bytes.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a> that contains statistics reflecting
the database system&#8217;s state.</p>
</td>
</tr>
</tbody>
</table>
<p>This function provides a wrapper around the database command
&#8220;<a class="reference internal" href="../commands/#dbStats" title="dbStats"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">dbStats</span></tt></a>&#8221;. The <tt class="docutils literal"><span class="pre">scale</span></tt> option allows you to
configure how the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell scales the sizes
of things in the output. For example, specify a <tt class="docutils literal"><span class="pre">scale</span></tt>
value of <tt class="docutils literal"><span class="pre">1024</span></tt> to display kilobytes rather than bytes.</p>
<p>See the &#8220;<a class="reference internal" href="../database-statistics/"><em>Database Statistics Reference</em></a>&#8221; document for an
overview of this output.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The scale factor rounds values to whole numbers. This can
produce unpredictable and unexpected results in some situations.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="db.version">
<tt class="descclassname">db.</tt><tt class="descname">version</tt><big>(</big><big>)</big><a class="headerlink" href="#db.version" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">The version of the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> instance.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="db.fsyncLock">
<tt class="descclassname">db.</tt><tt class="descname">fsyncLock</tt><big>(</big><big>)</big><a class="headerlink" href="#db.fsyncLock" title="Permalink to this definition">¶</a></dt>
<dd><p>Forces the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> to flush pending all write operations
to the disk and locks the <em>entire</em> <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> instance to
prevent additional writes until the user releases the lock with the
<a class="reference internal" href="../method/db.fsyncUnlock/#db.fsyncUnlock" title="db.fsyncUnlock"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.fsyncUnlock()</span></tt></a> command. <a class="reference internal" href="../method/db.fsyncLock/#db.fsyncLock" title="db.fsyncLock"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.fsyncLock()</span></tt></a> is an
administrative command.</p>
<p>This command provides a simple wrapper around a
<a class="reference internal" href="../commands/#fsync" title="fsync"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">fsync</span></tt></a> database command with the following
syntax:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span> <span class="nx">fsync</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">lock</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span>
</pre></div>
</div>
<p>This function locks the database and create a window for
<a class="reference internal" href="../../administration/backups/"><em>backup operations</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The database cannot be locked with <a class="reference internal" href="../method/db.fsyncLock/#db.fsyncLock" title="db.fsyncLock"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.fsyncLock()</span></tt></a> while profiling is enabled.
You must disable profiling before locking the database with <a class="reference internal" href="../method/db.fsyncLock/#db.fsyncLock" title="db.fsyncLock"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.fsyncLock()</span></tt></a>.
Disable profiling using <a class="reference internal" href="../method/db.setProfilingLevel/#db.setProfilingLevel" title="db.setProfilingLevel"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.setProfilingLevel()</span></tt></a> as follows in the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell:</p>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">setProfilingLevel</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="db.fsyncUnlock">
<tt class="descclassname">db.</tt><tt class="descname">fsyncUnlock</tt><big>(</big><big>)</big><a class="headerlink" href="#db.fsyncUnlock" title="Permalink to this definition">¶</a></dt>
<dd><p>Unlocks a <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> instance to allow writes and reverses the
operation of a <a class="reference internal" href="../method/db.fsyncLock/#db.fsyncLock" title="db.fsyncLock"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.fsyncLock()</span></tt></a> operation. Typically you will
use <a class="reference internal" href="../method/db.fsyncUnlock/#db.fsyncUnlock" title="db.fsyncUnlock"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.fsyncUnlock()</span></tt></a> following a database <a class="reference internal" href="../../administration/backups/"><em>backup
operation</em></a>.</p>
<p><a class="reference internal" href="../method/db.fsyncUnlock/#db.fsyncUnlock" title="db.fsyncUnlock"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.fsyncUnlock()</span></tt></a> is an administrative command.</p>
</dd></dl>

</div>
<div class="section" id="collection-methods">
<h3>Collection Methods<a class="headerlink" href="#collection-methods" title="Permalink to this headline">¶</a></h3>
<p>These methods operate on collection objects. Also consider the
&#8220;<a class="reference internal" href="#js-query-and-update-methods"><em>Query and Update Methods</em></a>&#8221; and
&#8220;<a class="reference internal" href="#js-query-cursor-methods"><em>Cursor Methods</em></a>&#8221; documentation for additional methods
that you may use with collection objects.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Call these methods on a <a class="reference internal" href="../glossary/#term-collection"><em class="xref std std-term">collection</em></a> object in the shell
(i.e. <tt class="docutils literal"><span class="pre">db.collection.[method]()</span></tt>, where <tt class="docutils literal"><span class="pre">collection</span></tt> is the
name of the collection) to produce the documented behavior.</p>
</div>
<dl class="method">
<dt id="db.collection.dataSize">
<tt class="descclassname">db.collection.</tt><tt class="descname">dataSize</tt><big>(</big><big>)</big><a class="headerlink" href="#db.collection.dataSize" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">The size of the collection. This method provides a wrapper
around the <a class="reference internal" href="../collection-statistics/#size" title="size"><tt class="xref mongodb mongodb-stats docutils literal"><span class="pre">size</span></tt></a> output of the <a class="reference internal" href="../commands/#collStats" title="collStats"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">collStats</span></tt></a>
(i.e. <a class="reference internal" href="../method/db.collection.stats/#db.collection.stats" title="db.collection.stats"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.stats()</span></tt></a>) command.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="db.collection.storageSize">
<tt class="descclassname">db.collection.</tt><tt class="descname">storageSize</tt><big>(</big><big>)</big><a class="headerlink" href="#db.collection.storageSize" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">The amount of storage space, calculated using the number of
extents, used by the collection. This method provides a wrapper
around the <a class="reference internal" href="../database-statistics/#storageSize" title="storageSize"><tt class="xref mongodb mongodb-stats docutils literal"><span class="pre">storageSize</span></tt></a> output of the
<a class="reference internal" href="../commands/#collStats" title="collStats"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">collStats</span></tt></a> (i.e. <a class="reference internal" href="../method/db.collection.stats/#db.collection.stats" title="db.collection.stats"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.stats()</span></tt></a>) command.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="db.collection.totalIndexSize">
<tt class="descclassname">db.collection.</tt><tt class="descname">totalIndexSize</tt><big>(</big><big>)</big><a class="headerlink" href="#db.collection.totalIndexSize" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">The total size of all indexes for the collection. This
method provides a wrapper around the <a class="reference internal" href="../method/db.collection.totalIndexSize/#db.collection.totalIndexSize" title="db.collection.totalIndexSize"><tt class="xref mongodb mongodb-stats docutils literal"><span class="pre">db.collection.totalIndexSize()</span></tt></a> output
of the <a class="reference internal" href="../commands/#collStats" title="collStats"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">collStats</span></tt></a> (i.e. <a class="reference internal" href="../method/db.collection.stats/#db.collection.stats" title="db.collection.stats"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.stats()</span></tt></a>) command.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="db.collection.distinct">
<tt class="descclassname">db.collection.</tt><tt class="descname">distinct</tt><big>(</big><big>)</big><a class="headerlink" href="#db.collection.distinct" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="../method/db.collection.distinct/#db.collection.distinct" title="db.collection.distinct"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.distinct()</span></tt></a> method finds the distinct
values for a specified field across a single collection and returns
the results in an array. The method accepts the following argument:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>field</strong> (<em>string</em>) &#8211; Specifies the field for which to return the distinct values.</li>
<li><strong>query</strong> (<em>document</em>) &#8211; Specifies the selection <tt class="docutils literal"><span class="pre">query</span></tt> to determine the subset of
documents from which to retrieve the distinct values.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>The <a class="reference internal" href="../method/db.collection.distinct/#db.collection.distinct" title="db.collection.distinct"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.distinct()</span></tt></a> method provides a
wrapper around the <a class="reference internal" href="../commands/#distinct" title="distinct"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">distinct</span></tt></a> command. Results must
not be larger than the maximum <a class="reference internal" href="../limits/#limit-bson-document-size"><em>BSON size</em></a>.</li>
<li>When possible to use covered indexes, the
<a class="reference internal" href="../method/db.collection.distinct/#db.collection.distinct" title="db.collection.distinct"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.distinct()</span></tt></a> method will use an index to
find the documents in the query as well as to return the data.</li>
</ul>
</div>
<p>Consider the following examples of the
<a class="reference internal" href="../method/db.collection.distinct/#db.collection.distinct" title="db.collection.distinct"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.distinct()</span></tt></a> method:</p>
<ul>
<li><p class="first">Return an array of the distinct values of the field <tt class="docutils literal"><span class="pre">ord_dt</span></tt>
from all documents in the <tt class="docutils literal"><span class="pre">orders</span></tt> collection:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">distinct</span><span class="p">(</span> <span class="s1">&#39;ord_dt&#39;</span> <span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Return an array of the distinct values of the field <tt class="docutils literal"><span class="pre">sku</span></tt> in the
subdocument <tt class="docutils literal"><span class="pre">item</span></tt> from all documents in the <tt class="docutils literal"><span class="pre">orders</span></tt>
collection:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">distinct</span><span class="p">(</span> <span class="s1">&#39;item.sku&#39;</span> <span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Return an array of the distinct values of the field <tt class="docutils literal"><span class="pre">ord_dt</span></tt>
from the documents in the <tt class="docutils literal"><span class="pre">orders</span></tt> collection where the
<tt class="docutils literal"><span class="pre">price</span></tt> is greater than <tt class="docutils literal"><span class="pre">10</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">distinct</span><span class="p">(</span> <span class="s1">&#39;ord_dt&#39;</span><span class="p">,</span>
                    <span class="p">{</span> <span class="nx">price</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">10</span> <span class="p">}</span> <span class="p">}</span>
                  <span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="db.collection.drop">
<tt class="descclassname">db.collection.</tt><tt class="descname">drop</tt><big>(</big><big>)</big><a class="headerlink" href="#db.collection.drop" title="Permalink to this definition">¶</a></dt>
<dd><p>Call the <a class="reference internal" href="../method/db.collection.drop/#db.collection.drop" title="db.collection.drop"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.drop()</span></tt></a> method on a collection to drop it from
the database.</p>
<p><a class="reference internal" href="../method/db.collection.drop/#db.collection.drop" title="db.collection.drop"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.drop()</span></tt></a> takes no arguments and will produce an error if
called with any arguments.</p>
</dd></dl>

<dl class="method">
<dt id="db.collection.dropIndex">
<tt class="descclassname">db.collection.</tt><tt class="descname">dropIndex</tt><big>(</big><em>index</em><big>)</big><a class="headerlink" href="#db.collection.dropIndex" title="Permalink to this definition">¶</a></dt>
<dd><p>Drops or removes the specified index from a collection. The
<a class="reference internal" href="../method/db.collection.dropIndex/#db.collection.dropIndex" title="db.collection.dropIndex"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.dropIndex()</span></tt></a> method provides a wrapper around
the <a class="reference internal" href="../commands/#dropIndexes" title="dropIndexes"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">dropIndexes</span></tt></a> command.</p>
<p>The <a class="reference internal" href="../method/db.collection.dropIndex/#db.collection.dropIndex" title="db.collection.dropIndex"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.dropIndex()</span></tt></a> method takes the following
parameter:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>index</strong> &#8211; Specifies either the name or the key of the index to drop. You <strong>must</strong>
use the name of the index if you specified a name during the
index creation.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The <a class="reference internal" href="../method/db.collection.dropIndex/#db.collection.dropIndex" title="db.collection.dropIndex"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.dropIndex()</span></tt></a> method cannot drop the
<tt class="docutils literal"><span class="pre">_id</span></tt> index. Use the <a class="reference internal" href="../method/db.collection.getIndexes/#db.collection.getIndexes" title="db.collection.getIndexes"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.getIndexes()</span></tt></a> method
to view all indexes on a collection.</p>
<p>Consider the following examples of the
<a class="reference internal" href="../method/db.collection.dropIndex/#db.collection.dropIndex" title="db.collection.dropIndex"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.dropIndex()</span></tt></a> method that assumes the
following indexes on the collection <tt class="docutils literal"><span class="pre">pets</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">pets</span><span class="p">.</span><span class="nx">getIndexes</span><span class="p">()</span>
<span class="p">[</span>
   <span class="p">{</span>  <span class="s2">&quot;v&quot;</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="mi">1</span> <span class="p">},</span>
      <span class="s2">&quot;ns&quot;</span> <span class="o">:</span> <span class="s2">&quot;test.pets&quot;</span><span class="p">,</span>
      <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;_id_&quot;</span>
   <span class="p">},</span>
   <span class="p">{</span>
      <span class="s2">&quot;v&quot;</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;cat&quot;</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span> <span class="p">},</span>
      <span class="s2">&quot;ns&quot;</span> <span class="o">:</span> <span class="s2">&quot;test.pets&quot;</span><span class="p">,</span>
      <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;catIdx&quot;</span>
   <span class="p">},</span>
   <span class="p">{</span>
      <span class="s2">&quot;v&quot;</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;cat&quot;</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;dog&quot;</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span> <span class="p">},</span>
      <span class="s2">&quot;ns&quot;</span> <span class="o">:</span> <span class="s2">&quot;test.pets&quot;</span><span class="p">,</span>
      <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;cat_1_dog_-1&quot;</span>
   <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<ul>
<li><p class="first">To drop the index on the field <tt class="docutils literal"><span class="pre">cat</span></tt>, you must use the index
name <tt class="docutils literal"><span class="pre">catIdx</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">pets</span><span class="p">.</span><span class="nx">dropIndex</span><span class="p">(</span> <span class="s1">&#39;catIdx&#39;</span> <span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">To drop the index on the fields <tt class="docutils literal"><span class="pre">cat</span></tt> and <tt class="docutils literal"><span class="pre">dog</span></tt>, you use
either the index name <tt class="docutils literal"><span class="pre">cat_1_dog_-1</span></tt> or the key <tt class="docutils literal"><span class="pre">{</span> <span class="pre">&quot;cat&quot;</span> <span class="pre">:</span> <span class="pre">1,</span>
<span class="pre">&quot;dog&quot;</span> <span class="pre">:</span> <span class="pre">-1</span> <span class="pre">}</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">pets</span><span class="p">.</span><span class="nx">dropIndex</span><span class="p">(</span> <span class="s1">&#39;cat_1_dog_-1&#39;</span> <span class="p">)</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">pets</span><span class="p">.</span><span class="nx">dropIndex</span><span class="p">(</span> <span class="p">{</span> <span class="nx">cat</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">dog</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="db.collection.dropIndexes">
<tt class="descclassname">db.collection.</tt><tt class="descname">dropIndexes</tt><big>(</big><big>)</big><a class="headerlink" href="#db.collection.dropIndexes" title="Permalink to this definition">¶</a></dt>
<dd><p>Drops all indexes other than the required index on the <tt class="docutils literal"><span class="pre">_id</span></tt>
field. Only call <a class="reference internal" href="../commands/#dropIndexes" title="dropIndexes"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">dropIndexes()</span></tt></a> as a method on a
collection object.</p>
</dd></dl>

<dl class="method">
<dt id="db.collection.ensureIndex">
<tt class="descclassname">db.collection.</tt><tt class="descname">ensureIndex</tt><big>(</big><em>keys</em>, <em>options</em><big>)</big><a class="headerlink" href="#db.collection.ensureIndex" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>keys</strong> (<em>document</em>) &#8211; A <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a> that contains
pairs with the name of the field or
fields to index and order of the index. A
<tt class="docutils literal"><span class="pre">1</span></tt> specifies ascending and a <tt class="docutils literal"><span class="pre">-1</span></tt>
specifies descending.</li>
<li><strong>options</strong> (<em>document</em>) &#8211; A <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a> that controls the creation
of the index. This argument is optional.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Index names, including their full namespace
(i.e. <tt class="docutils literal"><span class="pre">database.collection</span></tt>) can be no longer than 128
characters. See the <a class="reference internal" href="../method/db.collection.getIndexes/#db.collection.getIndexes" title="db.collection.getIndexes"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.getIndexes()</span></tt></a> field
&#8220;<tt class="xref mongodb mongodb-data docutils literal"><span class="pre">name</span></tt>&#8221; for the names of existing indexes.</p>
</div>
<div class="admonition-see admonition seealso">
<p class="first admonition-title">See</p>
<p class="last">The <a class="reference internal" href="../../indexes/"><em>Indexes</em></a> section of this manual for full
documentation of indexes and indexing in MongoDB.</p>
</div>
<p>Creates an index on the field specified, if that index does not
already exist. If the <tt class="docutils literal"><span class="pre">keys</span></tt> document specifies more than one
field, than <a class="reference internal" href="../method/db.collection.ensureIndex/#db.collection.ensureIndex" title="db.collection.ensureIndex"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.ensureIndex()</span></tt></a> creates a <a class="reference internal" href="../glossary/#term-compound-index"><em class="xref std std-term">compound
index</em></a>. For example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">ensureIndex</span><span class="p">({</span> <span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="o">:</span> <span class="mi">1</span><span class="p">})</span>
</pre></div>
</div>
<p>This command creates an index, in ascending order, on the field
<tt class="docutils literal"><span class="pre">[key]</span></tt>. To specify a compound index use the following form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">ensureIndex</span><span class="p">({</span> <span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="nx">key1</span><span class="p">]</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span> <span class="p">})</span>
</pre></div>
</div>
<p>This command creates a compound index on the <tt class="docutils literal"><span class="pre">key</span></tt> field
(in ascending order) and <tt class="docutils literal"><span class="pre">key1</span></tt> field (in descending order.)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Typically the order of an index is only important when doing
<a class="reference internal" href="../method/cursor.sort/#cursor.sort" title="cursor.sort"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">cursor.sort()</span></tt></a> operations on the indexed fields.</p>
</div>
<p>The available options, possible values, and the default settings
are as follows:</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Option</strong></th>
<th class="head"><strong>Plugin</strong></th>
<th class="head"><strong>Default</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>background</td>
<td><tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt></td>
<td><tt class="docutils literal"><span class="pre">false</span></tt></td>
</tr>
<tr class="row-odd"><td>unique</td>
<td><tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt></td>
<td><tt class="docutils literal"><span class="pre">false</span></tt></td>
</tr>
<tr class="row-even"><td>name</td>
<td>string</td>
<td>none</td>
</tr>
<tr class="row-odd"><td>cache</td>
<td><tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt></td>
<td><tt class="docutils literal"><span class="pre">true</span></tt></td>
</tr>
<tr class="row-even"><td>dropDups</td>
<td><tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt></td>
<td><tt class="docutils literal"><span class="pre">false</span></tt></td>
</tr>
<tr class="row-odd"><td>sparse</td>
<td><tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt></td>
<td><tt class="docutils literal"><span class="pre">false</span></tt></td>
</tr>
<tr class="row-even"><td>expireAfterSeconds</td>
<td>integer</td>
<td>none</td>
</tr>
<tr class="row-odd"><td>v</td>
<td>index version</td>
<td>1</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Options:</th><td class="field-body"><ul class="first last simple">
<li><strong>background</strong> (<em>Boolean</em>) &#8211; Specify <tt class="docutils literal"><span class="pre">true</span></tt> to build the index
in the background so that building an
index will <em>not</em> block other database
activities.</li>
<li><strong>unique</strong> (<em>Boolean</em>) &#8211; Specify <tt class="docutils literal"><span class="pre">true</span></tt> to create a unique index
so that the collection will not accept
insertion of documents where the index key
or keys matches an existing value in the
index.</li>
<li><strong>name</strong> (<em>string</em>) &#8211; Specify the name of the index. If unspecified,
MongoDB will generate an index name by concatenating
the names of the indexed fields and the sort order.</li>
<li><strong>cache</strong> (<em>Boolean</em>) &#8211; Specify <tt class="docutils literal"><span class="pre">false</span></tt> to prevent caching of this
<a class="reference internal" href="../method/db.collection.ensureIndex/#db.collection.ensureIndex" title="db.collection.ensureIndex"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.ensureIndex()</span></tt></a> call in
the index cache.</li>
<li><strong>dropDups</strong> (<em>Boolean</em>) &#8211; Specify <tt class="docutils literal"><span class="pre">true</span></tt> when creating a unique
index, on a field that <em>may</em> have
duplicate to index only the first
occurrence of a key, and <strong>remove</strong> all
documents from the collection that
contain subsequent occurrences of that
key.</li>
<li><strong>sparse</strong> (<em>Boolean</em>) &#8211; If <tt class="docutils literal"><span class="pre">true</span></tt>, the index only references
documents with the specified field. These
indexes use less space, but behave
differently in some situations
(particularly sorts.)</li>
<li><strong>expireAfterSeconds</strong> (<em>integer</em>) &#8211; Specify a value, in seconds, as
a <a class="reference internal" href="../glossary/#term-ttl"><em class="xref std std-term">TTL</em></a> to control how
long MongoDB will retain
documents in this collection.
See &#8220;<a class="reference internal" href="../../tutorial/expire-data/"><em>Expire Data from Collections by Setting TTL</em></a>&#8221;
for more information on this
functionality.</li>
<li><strong>v</strong> &#8211; Only specify a different index version in unusual
situations. The latest index version (version 1) provides a smaller
and faster index format.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Please be aware of the following behaviors of
<a class="reference internal" href="../method/db.collection.ensureIndex/#db.collection.ensureIndex" title="db.collection.ensureIndex"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">ensureIndex()</span></tt></a>:</p>
<ul>
<li><p class="first">To add or change index options you must drop the index using the
<a class="reference internal" href="../method/db.collection.dropIndex/#db.collection.dropIndex" title="db.collection.dropIndex"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.dropIndex()</span></tt></a> and issue another
<a class="reference internal" href="../method/db.collection.ensureIndex/#db.collection.ensureIndex" title="db.collection.ensureIndex"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">ensureIndex()</span></tt></a> operation
with the new options.</p>
<p>If you create an index with one set of options, and then issue
<a class="reference internal" href="../method/db.collection.ensureIndex/#db.collection.ensureIndex" title="db.collection.ensureIndex"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">ensureIndex()</span></tt></a> method
command with the same index fields and different options without
first dropping the index, <a class="reference internal" href="../method/db.collection.ensureIndex/#db.collection.ensureIndex" title="db.collection.ensureIndex"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">ensureIndex()</span></tt></a> will <em>not</em> rebuild the existing
index with the new options.</p>
</li>
<li><p class="first">If you call multiple <a class="reference internal" href="../method/db.collection.ensureIndex/#db.collection.ensureIndex" title="db.collection.ensureIndex"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">ensureIndex()</span></tt></a>
methods with the same index specification at the same time, only
the first operation will succeed, all other operations will have
no effect.</p>
</li>
<li><p class="first">Non-background indexing operations will block all other
operations on a database.</p>
</li>
<li><p class="first">You cannot stop a foreground index build once it&#8217;s begun. See the
<a class="reference internal" href="../../administration/indexes/#indexes-admin-stop-in-progress-build"><em>Monitor and Control Index Building</em></a> for more
information.</p>
</li>
</ul>
<table class="docutils footnote" frame="void" id="id1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td>The default index version depends on the version of
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> running when creating the index. Before version
2.0, the this value was 0; versions 2.0 and later use version 1.</td></tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="db.collection.reIndex">
<tt class="descclassname">db.collection.</tt><tt class="descname">reIndex</tt><big>(</big><big>)</big><a class="headerlink" href="#db.collection.reIndex" title="Permalink to this definition">¶</a></dt>
<dd><p>This method drops all indexes and recreates them. This operation
may be expensive for collections that have a large amount of data
and/or a large number of indexes.</p>
<p>Call this method, which takes no arguments, on a collection
object. For example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">reIndex</span><span class="p">()</span>
</pre></div>
</div>
<p>Change <tt class="docutils literal"><span class="pre">collection</span></tt> to the name of the collection that you want
to rebuild the index.</p>
</dd></dl>

<dl class="method">
<dt id="getDB">
<tt class="descname">getDB</tt><big>(</big><big>)</big><a class="headerlink" href="#getDB" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the name of the current database as a string.</p>
</dd></dl>

<dl class="method">
<dt id="db.collection.getIndexes">
<tt class="descclassname">db.collection.</tt><tt class="descname">getIndexes</tt><big>(</big><big>)</big><a class="headerlink" href="#db.collection.getIndexes" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns an array that holds a list of documents that identify and
describe the existing indexes on the collection. You must call the
<a class="reference internal" href="../method/db.collection.getIndexes/#db.collection.getIndexes" title="db.collection.getIndexes"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.getIndexes()</span></tt></a> on a collection. For example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">getIndexes</span><span class="p">()</span>
</pre></div>
</div>
<p>Change <tt class="docutils literal"><span class="pre">collection</span></tt> to the name of the collection whose indexes
you want to learn.</p>
<p>The <a class="reference internal" href="../method/db.collection.getIndexes/#db.collection.getIndexes" title="db.collection.getIndexes"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.getIndexes()</span></tt></a> items consist of the following fields:</p>
<dl class="data">
<dt id="getIndexes.v">
<tt class="descclassname">getIndexes.</tt><tt class="descname">v</tt><a class="headerlink" href="#getIndexes.v" title="Permalink to this definition">¶</a></dt>
<dd><p>Holds the version of the index.</p>
<p>The index version depends on the version of <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt>
that created the index. Before version 2.0 of MongoDB, the this
value was 0; versions 2.0 and later use version 1.</p>
</dd></dl>

<dl class="data">
<dt id="getIndexes.key">
<tt class="descclassname">getIndexes.</tt><tt class="descname">key</tt><a class="headerlink" href="#getIndexes.key" title="Permalink to this definition">¶</a></dt>
<dd><p>Contains a document holding the keys held in the index, and the
order of the index. Indexes may be either descending or
ascending order. A value of negative one (e.g. <tt class="docutils literal"><span class="pre">-1</span></tt>)
indicates an index sorted in descending order while a positive
value (e.g. <tt class="docutils literal"><span class="pre">1</span></tt>) indicates an index sorted in an ascending
order.</p>
</dd></dl>

<dl class="data">
<dt id="getIndexes.ns">
<tt class="descclassname">getIndexes.</tt><tt class="descname">ns</tt><a class="headerlink" href="#getIndexes.ns" title="Permalink to this definition">¶</a></dt>
<dd><p>The namespace context for the index.</p>
</dd></dl>

<dl class="data">
<dt id="getIndexes.name">
<tt class="descclassname">getIndexes.</tt><tt class="descname">name</tt><a class="headerlink" href="#getIndexes.name" title="Permalink to this definition">¶</a></dt>
<dd><p>A unique name for the index comprised of the field names and
orders of all keys.</p>
</dd></dl>

</dd></dl>

<dl class="method">
<dt id="db.collection.remove">
<tt class="descclassname">db.collection.</tt><tt class="descname">remove</tt><big>(</big><em>query</em>, <em>justOne</em><big>)</big><a class="headerlink" href="#db.collection.remove" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="../method/db.collection.remove/#db.collection.remove" title="db.collection.remove"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">remove</span></tt></a> method
removes documents from a collection.</p>
<p>The <a class="reference internal" href="../method/db.collection.remove/#db.collection.remove" title="db.collection.remove"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">remove()</span></tt></a> method can take the
following parameters:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>query</strong> (<em>document</em>) &#8211; Optional. Specifies the deletion criteria using <a class="reference internal" href="../operators/"><em>query
operators</em></a>.  Omit the <tt class="docutils literal"><span class="pre">query</span></tt>
parameter or pass an empty document (e.g. <tt class="docutils literal"><span class="pre">{}</span></tt> ) to delete
all <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">documents</em></a> in the <a class="reference internal" href="../glossary/#term-collection"><em class="xref std std-term">collection</em></a>.</li>
<li><strong>justOne</strong> (<em>boolean</em>) &#8211; Optional. A boolean that limits the deletion to just one
document. The default value is <tt class="docutils literal"><span class="pre">false</span></tt>. Set to <tt class="docutils literal"><span class="pre">true</span></tt> to
delete only the first result.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You cannot apply the <a class="reference internal" href="../method/db.collection.remove/#db.collection.remove" title="db.collection.remove"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">remove()</span></tt></a> method
to a <a class="reference internal" href="../glossary/#term-capped-collection"><em class="xref std std-term">capped collection</em></a>.</p>
</div>
<p>Consider the following examples of the <a class="reference internal" href="../method/db.collection.remove/#db.collection.remove" title="db.collection.remove"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">remove</span></tt></a> method.</p>
<ul>
<li><p class="first">To remove all documents in a collection, call the
<a class="reference internal" href="../method/db.collection.remove/#db.collection.remove" title="db.collection.remove"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">remove</span></tt></a> method with no
parameters:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
</pre></div>
</div>
<p>This operation will remove all the documents from the collection
<tt class="docutils literal"><span class="pre">products</span></tt>.</p>
</li>
<li><p class="first">To remove the documents that match a deletion criteria, call the
<a class="reference internal" href="../method/db.collection.remove/#db.collection.remove" title="db.collection.remove"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">remove</span></tt></a> method with the
<tt class="docutils literal"><span class="pre">query</span></tt> criteria:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span> <span class="p">{</span> <span class="nx">qty</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">20</span> <span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>This operation removes all the documents from the collection
<tt class="docutils literal"><span class="pre">products</span></tt> where <tt class="docutils literal"><span class="pre">qty</span></tt> is greater than <tt class="docutils literal"><span class="pre">20</span></tt>.</p>
</li>
<li><p class="first">To remove the first document that match a deletion criteria, call the
<a class="reference internal" href="../method/db.collection.remove/#db.collection.remove" title="db.collection.remove"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">remove</span></tt></a> method with the <tt class="docutils literal"><span class="pre">query</span></tt>
criteria and the <tt class="docutils literal"><span class="pre">justOne</span></tt> parameter set to <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">1</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span> <span class="p">{</span> <span class="nx">qty</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">20</span> <span class="p">}</span> <span class="p">},</span> <span class="kc">true</span> <span class="p">)</span>
</pre></div>
</div>
<p>This operation removes all the documents from the collection
<tt class="docutils literal"><span class="pre">products</span></tt> where <tt class="docutils literal"><span class="pre">qty</span></tt> is greater than <tt class="docutils literal"><span class="pre">20</span></tt>.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If the <tt class="docutils literal"><span class="pre">query</span></tt> argument to the <a class="reference internal" href="../method/db.collection.remove/#db.collection.remove" title="db.collection.remove"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">remove()</span></tt></a> method matches multiple documents in
the collection, the delete operation may interleave with other
write operations to that collection. For an unsharded collection,
you have the option to override this behavior with the
<a class="reference internal" href="../operators/#_S_atomic" title="$atomic"><tt class="xref mongodb mongodb-operator docutils literal"><span class="pre">$atomic</span></tt></a> isolation operator, effectively isolating the
delete operation and blocking other write operations during the
delete. To isolate the query, include <tt class="docutils literal"><span class="pre">$atomic:</span> <span class="pre">1</span></tt> in the
<tt class="docutils literal"><span class="pre">query</span></tt> parameter as in the following example:</p>
<div class="last highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span> <span class="p">{</span> <span class="nx">qty</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">20</span> <span class="p">},</span> <span class="nx">$atomic</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</dd></dl>

<dl class="method">
<dt id="db.collection.renameCollection">
<tt class="descclassname">db.collection.</tt><tt class="descname">renameCollection</tt><big>(</big><big>)</big><a class="headerlink" href="#db.collection.renameCollection" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="../method/db.collection.renameCollection/#db.collection.renameCollection" title="db.collection.renameCollection"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.renameCollection()</span></tt></a> provides a helper for
the <a class="reference internal" href="../commands/#renameCollection" title="renameCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">renameCollection</span></tt></a> <a class="reference internal" href="../glossary/#term-database-command"><em class="xref std std-term">database command</em></a> in the
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell to rename existing collections.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>target</strong> (<em>string</em>) &#8211; Specifies the new name of the
collection. Enclose the string in quotes.</li>
<li><strong>dropTarget</strong> (<em>boolean</em>) &#8211; Optional. If <tt class="docutils literal"><span class="pre">true</span></tt>, <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt>
will drop the <cite>target</cite> of
<a class="reference internal" href="../commands/#renameCollection" title="renameCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">renameCollection</span></tt></a> prior to
renaming the collection.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Call the <a class="reference internal" href="../method/db.collection.renameCollection/#db.collection.renameCollection" title="db.collection.renameCollection"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.renameCollection()</span></tt></a> method on a
collection object, to rename a collection. Specify the new name of
the collection as an argument. For example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">rrecord</span><span class="p">.</span><span class="nx">renameCollection</span><span class="p">(</span><span class="s2">&quot;record&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This operation will rename the <tt class="docutils literal"><span class="pre">rrecord</span></tt> collection to
<tt class="docutils literal"><span class="pre">record</span></tt>. If the target name (i.e. <tt class="docutils literal"><span class="pre">record</span></tt>) is the name of an
existing collection, then the operation will fail.</p>
<p>Consider the following limitations:</p>
<ul class="simple">
<li><a class="reference internal" href="../method/db.collection.renameCollection/#db.collection.renameCollection" title="db.collection.renameCollection"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.renameCollection()</span></tt></a> cannot move a
collection between databases. Use <a class="reference internal" href="../commands/#renameCollection" title="renameCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">renameCollection</span></tt></a>
for these rename operations.</li>
<li><a class="reference internal" href="../method/db.collection.renameCollection/#db.collection.renameCollection" title="db.collection.renameCollection"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.renameCollection()</span></tt></a> cannot operation on
sharded collections.</li>
</ul>
<p>The <a class="reference internal" href="../method/db.collection.renameCollection/#db.collection.renameCollection" title="db.collection.renameCollection"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.renameCollection()</span></tt></a> method operates
within a collection by changing the metadata associated with a
given collection.</p>
<p>Refer to the documentation <a class="reference internal" href="../commands/#renameCollection" title="renameCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">renameCollection</span></tt></a> for
additional warnings and messages.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <a class="reference internal" href="../method/db.collection.renameCollection/#db.collection.renameCollection" title="db.collection.renameCollection"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.renameCollection()</span></tt></a> method and
<a class="reference internal" href="../commands/#renameCollection" title="renameCollection"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">renameCollection</span></tt></a> command will invalidate open
cursors which interrupts queries that are currently returning
data.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="db.collection.validate">
<tt class="descclassname">db.collection.</tt><tt class="descname">validate</tt><big>(</big><big>)</big><a class="headerlink" href="#db.collection.validate" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>full</strong> (<em>Boolean</em>) &#8211; Optional. Specify <tt class="docutils literal"><span class="pre">true</span></tt> to enable a full
validation. MongoDB disables full validation
by default because it is a potentially
resource intensive operation.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Provides a wrapper around the <a class="reference internal" href="../commands/#validate" title="validate"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">validate</span></tt></a> <a class="reference internal" href="../glossary/#term-database-command"><em class="xref std std-term">database
command</em></a>. Call the <a class="reference internal" href="../method/db.collection.validate/#db.collection.validate" title="db.collection.validate"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.validate()</span></tt></a> method on a
collection object, to validate the collection itself. Specify the
full option to return full statistics.</p>
<p>The <a class="reference internal" href="../commands/#validate" title="validate"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">validation</span></tt></a> operation scans all of the
data structures for correctness and returns a single
<a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a> that describes the relationship between the
logical collection and the physical representation of that data.</p>
<p>The output can provide a more in depth view of how the collection
uses storage. Be aware that this command is potentially resource
intensive, and may impact the performance of your MongoDB
instance.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../collection-validation/"><em>Collection Validation Data</em></a></p>
</div>
</dd></dl>

<dl class="method">
<dt id="getShardVersion">
<tt class="descname">getShardVersion</tt><big>(</big><big>)</big><a class="headerlink" href="#getShardVersion" title="Permalink to this definition">¶</a></dt>
<dd><p>This method returns information regarding the state of data in a
<a class="reference internal" href="../glossary/#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a> that is useful when diagnosing underlying issues
with a sharded cluster.</p>
<p>For internal and diagnostic use only.</p>
</dd></dl>

<dl class="method">
<dt id="getShardDistribution">
<tt class="descname">getShardDistribution</tt><big>(</big><big>)</big><a class="headerlink" href="#getShardDistribution" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference external" href="https://jira.mongodb.org/browse/SERVER-4902">SERVER-4902</a> for more information.</p>
</dd></dl>

<dl class="method">
<dt id="db.collection.stats">
<tt class="descclassname">db.collection.</tt><tt class="descname">stats</tt><big>(</big><em>scale</em><big>)</big><a class="headerlink" href="#db.collection.stats" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>scale</strong> &#8211; Optional. Specifies the scale to deliver
results. Unless specified, this command
returns all sizes in bytes.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a> containing statistics that
reflecting the state of the specified collection.</p>
</td>
</tr>
</tbody>
</table>
<p>This function provides a wrapper around the database command
<a class="reference internal" href="../commands/#collStats" title="collStats"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">collStats</span></tt></a>. The <tt class="docutils literal"><span class="pre">scale</span></tt> option allows you to
configure how the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell scales the sizes
of things in the output. For example, specify a <tt class="docutils literal"><span class="pre">scale</span></tt>
value of <tt class="docutils literal"><span class="pre">1024</span></tt> to display kilobytes rather than bytes.</p>
<p>Call the <a class="reference internal" href="../method/db.collection.stats/#db.collection.stats" title="db.collection.stats"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.collection.stats()</span></tt></a> method on a collection object, to
return statistics regarding that collection. For example, the
following operation returns stats on the <tt class="docutils literal"><span class="pre">people</span></tt> collection:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">stats</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">&#8220;<a class="reference internal" href="../collection-statistics/"><em>Collection Statistics Reference</em></a>&#8221; for an
overview of the output of this command.</p>
</div>
</dd></dl>

</div>
<div class="section" id="sharding-methods">
<h3>Sharding Methods<a class="headerlink" href="#sharding-methods" title="Permalink to this headline">¶</a></h3>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">The &#8220;<a class="reference internal" href="../../core/sharding/"><em>Sharding Fundamentals</em></a>&#8221; page for more information on
the sharding technology and using MongoDB&#8217;s <a class="reference internal" href="../glossary/#term-sharded-cluster"><em class="xref std std-term">sharded clusters</em></a>.</p>
</div>
<dl class="method">
<dt id="sh.addShard">
<tt class="descclassname">sh.</tt><tt class="descname">addShard</tt><big>(</big><em>host</em><big>)</big><a class="headerlink" href="#sh.addShard" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>host</strong> (<em>string</em>) &#8211; Specify the hostname of a database instance or a
replica set configuration.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Use this method to add a database instance or replica set to a
<a class="reference internal" href="../glossary/#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a>.
This method must be run on a <a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instance.
The <tt class="docutils literal"><span class="pre">host</span></tt> parameter can be in any of the following forms:</p>
<div class="highlight-python"><pre>[hostname]
[hostname]:[port]
[set]/[hostname]
[set]/[hostname],[hostname]:port</pre>
</div>
<p>You can specify shards using the hostname, or a hostname and port
combination if the shard is running on a non-standard port.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not use <tt class="docutils literal"><span class="pre">localhost</span></tt> for the hostname unless your
<a class="reference internal" href="../glossary/#term-config-database"><em class="xref std std-term">configuration server</em></a>
is also running on <tt class="docutils literal"><span class="pre">localhost</span></tt>.</p>
</div>
<p>The optimal configuration is to deploy shards across
<a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica sets</em></a>.
To add a shard on a replica set you must specify the name of the
replica set and the hostname of at least one member of the replica
set. You must specify at least one member of the set, but can
specify all members in the set or another subset if
desired. <a class="reference internal" href="../method/sh.addShard/#sh.addShard" title="sh.addShard"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.addShard()</span></tt></a> takes the following form:</p>
<p>If you specify additional hostnames, all must be members of the
same replica set.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">sh</span><span class="p">.</span><span class="nx">addShard</span><span class="p">(</span><span class="s2">&quot;set-name/seed-hostname&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition-example admonition">
<p class="first admonition-title">Example</p>
<div class="last highlight-javascript"><div class="highlight"><pre><span class="nx">sh</span><span class="p">.</span><span class="nx">addShard</span><span class="p">(</span><span class="s2">&quot;repl0/mongodb3.example.net:27327&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The <a class="reference internal" href="../method/sh.addShard/#sh.addShard" title="sh.addShard"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.addShard()</span></tt></a> method is a helper for the
<a class="reference internal" href="../commands/#addShard" title="addShard"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">addShard</span></tt></a> command.
The <a class="reference internal" href="../commands/#addShard" title="addShard"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">addShard</span></tt></a> command has additional options which are
not available with this helper.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference internal" href="../commands/#addShard" title="addShard"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">addShard</span></tt></a></li>
<li><a class="reference internal" href="../../administration/sharding/"><em>Sharded Cluster Administration</em></a></li>
<li><a class="reference internal" href="../../tutorial/add-shards-to-shard-cluster/"><em>Add Shards to an Existing Cluster</em></a></li>
<li><a class="reference internal" href="../../tutorial/remove-shards-from-cluster/"><em>Remove Shards from an Existing Sharded Cluster</em></a></li>
</ul>
</div>
</dd></dl>

<dl class="method">
<dt id="sh.enableSharding">
<tt class="descclassname">sh.</tt><tt class="descname">enableSharding</tt><big>(</big><em>database</em><big>)</big><a class="headerlink" href="#sh.enableSharding" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>database</strong> (<em>name</em>) &#8211; Specify a database name to shard.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Enables sharding on the specified database. This does not
automatically shard any collections, but makes it possible to begin
sharding collections using <a class="reference internal" href="../method/sh.shardCollection/#sh.shardCollection" title="sh.shardCollection"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.shardCollection()</span></tt></a>.</p>
</dd></dl>

<dl class="method">
<dt id="sh.shardCollection">
<tt class="descclassname">sh.</tt><tt class="descname">shardCollection</tt><big>(</big><em>collection</em>, <em>key</em>, <em>unique</em><big>)</big><a class="headerlink" href="#sh.shardCollection" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>collection</strong> (<em>name</em>) &#8211; The name of the collection to shard.</li>
<li><strong>key</strong> (<em>document</em>) &#8211; A <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a> containing <a class="reference internal" href="../glossary/#term-shard-key"><em class="xref std std-term">shard key</em></a>
that the sharding system uses to
<a class="reference internal" href="../glossary/#term-partition"><em class="xref std std-term">partition</em></a> and distribute objects among
the shards.</li>
<li><strong>unique</strong> (<em>boolean</em>) &#8211; When true, the <tt class="docutils literal"><span class="pre">unique</span></tt> option ensures
that the underlying index enforces
uniqueness so long as the unique index is a
prefix of the shard key.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Shards the named collection, according to the specified
<a class="reference internal" href="../glossary/#term-shard-key"><em class="xref std std-term">shard key</em></a>. Specify shard keys in the form of a <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a>.
Shard keys may refer to a single document field, or more typically
several document fields to form a &#8220;compound shard key.&#8221;</p>
</dd></dl>

<dl class="method">
<dt id="sh.splitFind">
<tt class="descclassname">sh.</tt><tt class="descname">splitFind</tt><big>(</big><em>namespace</em>, <em>query</em><big>)</big><a class="headerlink" href="#sh.splitFind" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>namespace</strong> (<em>string</em>) &#8211; Specify the namespace
(i.e. &#8220;<tt class="docutils literal"><span class="pre">&lt;database&gt;.&lt;collection&gt;</span></tt>&#8221;) of
the sharded collection that contains the
chunk to split.</li>
<li><strong>query</strong> &#8211; Specify a query to identify a document in a specific
chunk. Typically specify the <a class="reference internal" href="../glossary/#term-shard-key"><em class="xref std std-term">shard key</em></a> for a
document as the query.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Splits the chunk containing the document specified by the <tt class="docutils literal"><span class="pre">query</span></tt>
at its median point, creating two roughly equal chunks. Use
<a class="reference internal" href="../method/sh.splitAt/#sh.splitAt" title="sh.splitAt"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.splitAt()</span></tt></a> to split a collection in a specific point.</p>
<p>In most circumstances, you should leave chunk splitting to the
automated processes. However, when initially deploying a
<a class="reference internal" href="../glossary/#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a> it is necessary to perform some measure of
<a class="reference internal" href="../glossary/#term-pre-splitting"><em class="xref std std-term">pre-splitting</em></a> using manual methods including
<a class="reference internal" href="../method/sh.splitFind/#sh.splitFind" title="sh.splitFind"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.splitFind()</span></tt></a>.</p>
</dd></dl>

<dl class="method">
<dt id="sh.splitAt">
<tt class="descclassname">sh.</tt><tt class="descname">splitAt</tt><big>(</big><em>namespace</em>, <em>query</em><big>)</big><a class="headerlink" href="#sh.splitAt" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>namespace</strong> (<em>string</em>) &#8211; Specify the namespace
(i.e. &#8220;<tt class="docutils literal"><span class="pre">&lt;database&gt;.&lt;collection&gt;</span></tt>&#8221;) of
the sharded collection that contains the
chunk to split.</li>
<li><strong>query</strong> (<em>document</em>) &#8211; Specify a query to identify a document in a
specific chunk. Typically specify the
<a class="reference internal" href="../glossary/#term-shard-key"><em class="xref std std-term">shard key</em></a> for a document as the
query.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Splits the chunk containing the document specified by the <tt class="docutils literal"><span class="pre">query</span></tt>
as if that document were at the &#8220;middle&#8221; of the collection, even if
the specified document is not the actual median of the
collection. Use this command to manually split chunks unevenly. Use
the &#8220;<a class="reference internal" href="../method/sh.splitFind/#sh.splitFind" title="sh.splitFind"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.splitFind()</span></tt></a>&#8221; function to split a chunk at the
actual median.</p>
<p>In most circumstances, you should leave chunk splitting to the
automated processes within MongoDB. However, when initially
deploying a <a class="reference internal" href="../glossary/#term-sharded-cluster"><em class="xref std std-term">sharded cluster</em></a> it is necessary to perform some
measure of <a class="reference internal" href="../glossary/#term-pre-splitting"><em class="xref std std-term">pre-splitting</em></a> using manual methods including
<a class="reference internal" href="../method/sh.splitAt/#sh.splitAt" title="sh.splitAt"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.splitAt()</span></tt></a>.</p>
</dd></dl>

<dl class="method">
<dt id="sh.moveChunk">
<tt class="descclassname">sh.</tt><tt class="descname">moveChunk</tt><big>(</big><em>collection</em>, <em>query</em>, <em>destination</em><big>)</big><a class="headerlink" href="#sh.moveChunk" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>collection</strong> (<em>string</em>) &#8211; Specify the sharded collection containing
the chunk to migrate.</li>
<li><strong>query</strong> &#8211; Specify a query to identify documents in a specific
chunk. Typically specify the <a class="reference internal" href="../glossary/#term-shard-key"><em class="xref std std-term">shard key</em></a> for a
document as the query.</li>
<li><strong>destination</strong> (<em>string</em>) &#8211; Specify the name of the shard that you
wish to move the designated chunk to.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Moves the chunk containing the documents specified by the <tt class="docutils literal"><span class="pre">query</span></tt>
to the shard described by <tt class="docutils literal"><span class="pre">destination</span></tt>.</p>
<p>This function provides a wrapper around the
<a class="reference internal" href="../commands/#moveChunk" title="moveChunk"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">moveChunk</span></tt></a>. In most circumstances, allow the
<a class="reference internal" href="../glossary/#term-balancer"><em class="xref std std-term">balancer</em></a> to automatically migrate <a class="reference internal" href="../glossary/#term-chunk"><em class="xref std std-term">chunks</em></a>,
and avoid calling <a class="reference internal" href="../method/sh.moveChunk/#sh.moveChunk" title="sh.moveChunk"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.moveChunk()</span></tt></a> directly.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">&#8220;<a class="reference internal" href="../commands/#moveChunk" title="moveChunk"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">moveChunk</span></tt></a>&#8221; and &#8220;<a class="reference internal" href="../../sharding/"><em>Sharding</em></a>&#8221; for
more information.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="sh.setBalancerState">
<tt class="descclassname">sh.</tt><tt class="descname">setBalancerState</tt><big>(</big><em>state</em><big>)</big><a class="headerlink" href="#sh.setBalancerState" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>state</strong> (<em>boolean</em>) &#8211; <tt class="docutils literal"><span class="pre">true</span></tt> enables the balancer if disabled,
and <tt class="docutils literal"><span class="pre">false</span></tt> disables the balancer.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Enables or disables the <a class="reference internal" href="../glossary/#term-balancer"><em class="xref std std-term">balancer</em></a>. Use
<a class="reference internal" href="../method/sh.setBalancerState/#sh.getBalancerState" title="sh.getBalancerState"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.getBalancerState()</span></tt></a> to determine if the balancer is
currently enabled or disabled and <a class="reference internal" href="../method/sh.isBalancerRunning/#sh.isBalancerRunning" title="sh.isBalancerRunning"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.isBalancerRunning()</span></tt></a>
to check its current state.</p>
</dd></dl>

<dl class="method">
<dt id="sh.getBalancerState">
<tt class="descclassname">sh.</tt><tt class="descname">getBalancerState</tt><big>(</big><big>)</big><a class="headerlink" href="#sh.getBalancerState" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">boolean.</td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="../method/sh.setBalancerState/#sh.getBalancerState" title="sh.getBalancerState"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.getBalancerState()</span></tt></a> returns <tt class="docutils literal"><span class="pre">true</span></tt> when the
<a class="reference internal" href="../glossary/#term-balancer"><em class="xref std std-term">balancer</em></a> is enabled and false when the balancer is
disabled. This does not reflect the current state of balancing
operations: use <a class="reference internal" href="../method/sh.isBalancerRunning/#sh.isBalancerRunning" title="sh.isBalancerRunning"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.isBalancerRunning()</span></tt></a> to check the
balancer&#8217;s current state.</p>
</dd></dl>

<dl class="method">
<dt id="sh.isBalancerRunning">
<tt class="descclassname">sh.</tt><tt class="descname">isBalancerRunning</tt><big>(</big><big>)</big><a class="headerlink" href="#sh.isBalancerRunning" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">boolean.</td>
</tr>
</tbody>
</table>
<p>Returns true if the <a class="reference internal" href="../glossary/#term-balancer"><em class="xref std std-term">balancer</em></a> process is currently running
and migrating chunks and false if the balancer process is not
running. Use <a class="reference internal" href="../method/sh.setBalancerState/#sh.getBalancerState" title="sh.getBalancerState"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.getBalancerState()</span></tt></a> to determine if the
balancer is enabled or disabled.</p>
</dd></dl>

<dl class="method">
<dt id="sh.status">
<tt class="descclassname">sh.</tt><tt class="descname">status</tt><big>(</big><big>)</big><a class="headerlink" href="#sh.status" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a formatted report of the status of the <a class="reference internal" href="../glossary/#term-sharded-cluster"><em class="xref std std-term">sharded
cluster</em></a>, including data regarding the distribution of
chunks.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="sh.addShardTag">
<tt class="descclassname">sh.</tt><tt class="descname">addShardTag</tt><big>(</big><em>shard</em>, <em>tag</em><big>)</big><a class="headerlink" href="#sh.addShardTag" title="Permalink to this definition">¶</a></dt>
<dd><p class="versionadded">
<span class="versionmodified">New in version 2.2.</span></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>shard</strong> &#8211; Specifies the name of the shard that you want to give
a specific tag.</li>
<li><strong>tag</strong> &#8211; Specifies the name of the tag that you want to add to
the shard.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="../method/sh.addShardTag/#sh.addShardTag" title="sh.addShardTag"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.addShardTag()</span></tt></a> associates a shard with a tag or
identifier. MongoDB can use these identifiers, to &#8220;home&#8221; or attach
(i.e. with <a class="reference internal" href="../method/sh.addTagRange/#sh.addTagRange" title="sh.addTagRange"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.addTagRange()</span></tt></a>) specific data to a specific
shard.</p>
<p>Always issue <a class="reference internal" href="../method/sh.addShardTag/#sh.addShardTag" title="sh.addShardTag"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.addShardTag()</span></tt></a> when connected to a
<a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instance. The following example adds three tags,
<tt class="docutils literal"><span class="pre">LGA</span></tt>, <tt class="docutils literal"><span class="pre">EWR</span></tt>, and <tt class="docutils literal"><span class="pre">JFK</span></tt>, to three shards:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">sh</span><span class="p">.</span><span class="nx">addShardTag</span><span class="p">(</span><span class="s2">&quot;shard0000&quot;</span><span class="p">,</span> <span class="s2">&quot;LGA&quot;</span><span class="p">)</span>
<span class="nx">sh</span><span class="p">.</span><span class="nx">addShardTag</span><span class="p">(</span><span class="s2">&quot;shard0001&quot;</span><span class="p">,</span> <span class="s2">&quot;EWR&quot;</span><span class="p">)</span>
<span class="nx">sh</span><span class="p">.</span><span class="nx">addShardTag</span><span class="p">(</span><span class="s2">&quot;shard0002&quot;</span><span class="p">,</span> <span class="s2">&quot;JFK&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="sh.addTagRange">
<tt class="descclassname">sh.</tt><tt class="descname">addTagRange</tt><big>(</big><em>namespace</em>, <em>minimum</em>, <em>maximum</em>, <em>tag</em><big>)</big><a class="headerlink" href="#sh.addTagRange" title="Permalink to this definition">¶</a></dt>
<dd><p class="versionadded">
<span class="versionmodified">New in version 2.2.</span></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>namespace</strong> &#8211; Specifies the namespace, in the form of
<tt class="docutils literal"><span class="pre">&lt;database&gt;.&lt;collection&gt;</span></tt> of the sharded
collection that you would like to tag.</li>
<li><strong>minimum</strong> &#8211; Specifies the minimum value of the <a class="reference internal" href="../glossary/#term-shard-key"><em class="xref std std-term">shard
key</em></a> range to include in the tag. Specify the
minimum value in the form of
<tt class="docutils literal"><span class="pre">&lt;fieldname&gt;:&lt;value&gt;</span></tt>.</li>
<li><strong>maximum</strong> &#8211; Specifies the maximum value of the shard key range
to include in the tag.  Specify the minimum value
in the form of <tt class="docutils literal"><span class="pre">&lt;fieldname&gt;:&lt;value&gt;</span></tt>.</li>
<li><strong>tag</strong> &#8211; Specifies the name of the tag to attach the range
specified by the <tt class="docutils literal"><span class="pre">minimum</span></tt> and <tt class="docutils literal"><span class="pre">maximum</span></tt> arguments
to.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="../method/sh.addTagRange/#sh.addTagRange" title="sh.addTagRange"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.addTagRange()</span></tt></a> attaches a range of values of the shard
key to a shard tag created using the <a class="reference internal" href="../method/sh.addShardTag/#sh.addShardTag" title="sh.addShardTag"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.addShardTag()</span></tt></a>
helper. Use this operation to ensure that the documents that exist
within the specified range exist on shards that have a matching
tag.</p>
<p>Always issue <a class="reference internal" href="../method/sh.addTagRange/#sh.addTagRange" title="sh.addTagRange"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.addTagRange()</span></tt></a> when connected to a
<a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a> instance.</p>
</dd></dl>

<dl class="method">
<dt id="sh.removeShardTag">
<tt class="descclassname">sh.</tt><tt class="descname">removeShardTag</tt><big>(</big><em>shard</em>, <em>tag</em><big>)</big><a class="headerlink" href="#sh.removeShardTag" title="Permalink to this definition">¶</a></dt>
<dd><p class="versionadded">
<span class="versionmodified">New in version 2.2.</span></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>shard</strong> &#8211; Specifies the name of the shard that you want
to remove a tag from.</li>
<li><strong>tag</strong> &#8211; Specifies the name of the tag that you want to remove
from the shard.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Removes the association between a tag and a shard. Always issue
<a class="reference internal" href="../method/sh.removeShardTag/#sh.removeShardTag" title="sh.removeShardTag"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">sh.removeShardTag()</span></tt></a> when connected to a <a class="reference internal" href="../config-database/#mongos" title="mongos"><tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongos</span></tt></a>
instance.</p>
</dd></dl>

<dl class="method">
<dt id="sh.help">
<tt class="descclassname">sh.</tt><tt class="descname">help</tt><big>(</big><big>)</big><a class="headerlink" href="#sh.help" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a basic help text for all sharding related shell
functions.</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="replica-set-methods">
<span id="replica-set-functions"></span><h3>Replica Set Methods<a class="headerlink" href="#replica-set-methods" title="Permalink to this headline">¶</a></h3>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="../../core/replication/"><em>Replication Fundamentals</em></a> for more information regarding
replication.</p>
</div>
<dl class="method">
<dt id="rs.status">
<tt class="descclassname">rs.</tt><tt class="descname">status</tt><big>(</big><big>)</big><a class="headerlink" href="#rs.status" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a> with status information.</td>
</tr>
</tbody>
</table>
<p>This output reflects the current status of the replica set, using
data derived from the heartbeat packets sent by the other members
of the replica set.</p>
<p>This method provides a wrapper around the
<a class="reference internal" href="../replica-commands/#replSetGetStatus" title="replSetGetStatus"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetGetStatus</span></tt></a> <a class="reference internal" href="../glossary/#term-database-command"><em class="xref std std-term">database command</em></a>.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">&#8220;<a class="reference internal" href="../replica-status/"><em>Replica Set Status Reference</em></a>&#8221; for documentation
of this output.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="rs.initiate">
<tt class="descclassname">rs.</tt><tt class="descname">initiate</tt><big>(</big><em>configuration</em><big>)</big><a class="headerlink" href="#rs.initiate" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>configuration</strong> &#8211; Optional. A <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a> that specifies
the configuration of a replica
set. If not specified, MongoDB will
use a default configuration.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Initiates a replica set. Optionally takes a configuration argument
in the form of a <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a> that holds the configuration
of a replica set. Consider the following model of the most basic
configuration for a 3-member replica set:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="nx">_id</span> <span class="o">:</span> <span class="o">&lt;</span><span class="nx">setname</span><span class="o">&gt;</span><span class="p">,</span>
     <span class="nx">members</span> <span class="o">:</span> <span class="p">[</span>
         <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">host</span> <span class="o">:</span> <span class="o">&lt;</span><span class="nx">host0</span><span class="o">&gt;</span><span class="p">},</span>
         <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">host</span> <span class="o">:</span> <span class="o">&lt;</span><span class="nx">host1</span><span class="o">&gt;</span><span class="p">},</span>
         <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">host</span> <span class="o">:</span> <span class="o">&lt;</span><span class="nx">host2</span><span class="o">&gt;</span><span class="p">},</span>
     <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This function provides a wrapper around the
&#8220;<a class="reference internal" href="../replica-commands/#replSetInitiate" title="replSetInitiate"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetInitiate</span></tt></a>&#8221; <a class="reference internal" href="../glossary/#term-database-command"><em class="xref std std-term">database command</em></a>.</p>
</dd></dl>

<dl class="method">
<dt id="rs.conf">
<tt class="descclassname">rs.</tt><tt class="descname">conf</tt><big>(</big><big>)</big><a class="headerlink" href="#rs.conf" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a> that contains the current
<a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a> configuration object.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="rs.config">
<tt class="descclassname">rs.</tt><tt class="descname">config</tt><big>(</big><big>)</big><a class="headerlink" href="#rs.config" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="../replica-commands/#rs.config" title="rs.config"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">rs.config()</span></tt></a> is an alias of <a class="reference internal" href="../replica-commands/#rs.conf" title="rs.conf"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">rs.conf()</span></tt></a>.</p>
</dd></dl>

<dl class="method">
<dt id="rs.reconfig">
<tt class="descclassname">rs.</tt><tt class="descname">reconfig</tt><big>(</big><em>configuration</em><span class="optional">[</span>, <em>force</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#rs.reconfig" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>configuration</strong> &#8211; A <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a> that specifies
the configuration of a replica set.</li>
<li><strong>force</strong> &#8211; Optional. Specify <tt class="docutils literal"><span class="pre">{</span> <span class="pre">force:</span> <span class="pre">true</span> <span class="pre">}</span></tt> as the force
parameter to force the replica set to accept the new
configuration even if a majority of the members are
not accessible. Use with caution, as this can lead to
<a class="reference internal" href="../glossary/#term-rollback"><em class="xref std std-term">rollback</em></a> situations.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Initializes a new <a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a> configuration. This function
will disconnect the shell briefly and forces a reconnection as the
replica set renegotiates which node will be
<a class="reference internal" href="../glossary/#term-primary"><em class="xref std std-term">primary</em></a>. As a result, the shell will display an error even
if this command succeeds.</p>
<p><a class="reference internal" href="../replica-commands/#rs.reconfig" title="rs.reconfig"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">rs.reconfig()</span></tt></a> provides a wrapper around the
&#8220;<a class="reference internal" href="../replica-commands/#replSetReconfig" title="replSetReconfig"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetReconfig</span></tt></a>&#8221; <a class="reference internal" href="../glossary/#term-database-command"><em class="xref std std-term">database command</em></a>.</p>
<p><a class="reference internal" href="../replica-commands/#rs.reconfig" title="rs.reconfig"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">rs.reconfig()</span></tt></a> overwrites the existing replica set
configuration. Retrieve the current configuration object with
<a class="reference internal" href="../replica-commands/#rs.conf" title="rs.conf"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">rs.conf()</span></tt></a>, modify the configuration as needed and then
use <a class="reference internal" href="../replica-commands/#rs.reconfig" title="rs.reconfig"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">rs.reconfig()</span></tt></a> to submit the modified configuration
object.</p>
<p>To reconfigure a replica set, use the following sequence of
operations:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">conf</span> <span class="o">=</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">conf</span><span class="p">()</span>

<span class="c1">// modify conf to change configuration</span>

<span class="nx">rs</span><span class="p">.</span><span class="nx">reconfig</span><span class="p">(</span><span class="nx">conf</span><span class="p">)</span>
</pre></div>
</div>
<p>If you want to force the reconfiguration if a majority of the set
isn&#8217;t connected to the current member, or you&#8217;re issuing the
command against a secondary, use the following form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">conf</span> <span class="o">=</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">conf</span><span class="p">()</span>

<span class="c1">// modify conf to change configuration</span>

<span class="nx">rs</span><span class="p">.</span><span class="nx">reconfig</span><span class="p">(</span><span class="nx">conf</span><span class="p">,</span> <span class="p">{</span> <span class="nx">force</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Forcing a <a class="reference internal" href="../replica-commands/#rs.reconfig" title="rs.reconfig"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">rs.reconfig()</span></tt></a> can lead to <a class="reference internal" href="../glossary/#term-rollback"><em class="xref std std-term">rollback</em></a>
situations and other difficult to recover from
situations. Exercise caution when using this option.</p>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">&#8220;<a class="reference internal" href="../replica-configuration/"><em>Replica Set Configuration</em></a>&#8221; and &#8220;<a class="reference internal" href="../../administration/replica-sets/"><em>Replica Set Administration</em></a>&#8221;.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="rs.add">
<tt class="descclassname">rs.</tt><tt class="descname">add</tt><big>(</big><em>hostspec</em>, <em>arbiterOnly</em><big>)</big><a class="headerlink" href="#rs.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Specify one of the following forms:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>host</strong> (<em>string,document</em>) &#8211; Either a string or a document.  If a string, specifies a host
(and optionally port-number) for a new host member for the
replica set; MongoDB will add this host with the default
configuration. If a document, specifies any attributes about a
member of a replica set.</li>
<li><strong>arbiterOnly</strong> (<em>Boolean</em>) &#8211; Optional. If <tt class="docutils literal"><span class="pre">true</span></tt>, this host is an arbiter. If the second
argument evaluates to <tt class="docutils literal"><span class="pre">true</span></tt>, as is the case with some
<a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">documents</em></a>, then this instance will become an
arbiter.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Provides a simple method to add a member to an existing
<a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a>. You can specify new hosts in one of two ways:</p>
<ol class="arabic simple">
<li>as a &#8220;hostname&#8221; with an optional port number to use the default
configuration as in the <a class="reference internal" href="../../tutorial/expand-replica-set/#replica-set-add-member"><em>Add a Member to an Existing Replica Set</em></a> example.</li>
<li>as a configuration <a class="reference internal" href="../glossary/#term-document"><em class="xref std std-term">document</em></a>, as in the
<a class="reference internal" href="../../tutorial/expand-replica-set/#replica-set-add-member-alternate-procedure"><em>Add a Member to an Existing Replica Set (Alternate Procedure)</em></a> example.</li>
</ol>
<p>This function will disconnect the shell briefly and forces a
reconnection as the replica set renegotiates which node
will be <a class="reference internal" href="../glossary/#term-primary"><em class="xref std std-term">primary</em></a>. As a result, the shell will display an
error even if this command succeeds.</p>
<p><a class="reference internal" href="../replica-commands/#rs.add" title="rs.add"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">rs.add()</span></tt></a> provides a wrapper around some of the
functionality of the &#8220;<a class="reference internal" href="../replica-commands/#replSetReconfig" title="replSetReconfig"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetReconfig</span></tt></a>&#8221; <a class="reference internal" href="../glossary/#term-database-command"><em class="xref std std-term">database
command</em></a> and the corresponding shell helper
<a class="reference internal" href="../replica-commands/#rs.reconfig" title="rs.reconfig"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">rs.reconfig()</span></tt></a>. See the <a class="reference internal" href="../replica-configuration/"><em>Replica Set Configuration</em></a>
document for full documentation of all replica set configuration
options.</p>
<div class="admonition-example admonition">
<p class="first admonition-title">Example</p>
<p>To add a <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongod</span></tt> accessible on the default port
<tt class="docutils literal"><span class="pre">27017</span></tt> running on the host <tt class="docutils literal"><span class="pre">mongodb3.example.net</span></tt>, use the
following <a class="reference internal" href="../replica-commands/#rs.add" title="rs.add"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">rs.add()</span></tt></a> invocation:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">rs</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;mongodb3.example.net:27017&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If <tt class="docutils literal"><span class="pre">mongodb3.example.net</span></tt> is an arbiter, use the following form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">rs</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;mongodb3.example.net:27017&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
</pre></div>
</div>
<p>To add <tt class="docutils literal"><span class="pre">mongodb3.example.net</span></tt> as a <a class="reference internal" href="../../administration/replica-sets/#replica-set-secondary-only-members"><em>secondary-only</em></a> member of set, use the
following form of <a class="reference internal" href="../replica-commands/#rs.add" title="rs.add"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">rs.add()</span></tt></a>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">rs</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span> <span class="p">{</span> <span class="s2">&quot;host&quot;</span><span class="o">:</span> <span class="s2">&quot;mongodbd3.example.net:27017&quot;</span><span class="p">,</span> <span class="s2">&quot;priority&quot;</span><span class="o">:</span> <span class="mi">0</span> <span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p class="last">See the <a class="reference internal" href="../replica-configuration/"><em>Replica Set Configuration</em></a> and
<a class="reference internal" href="../../administration/replica-sets/"><em>Replica Set Administration</em></a> documents for more
information.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="rs.addArb">
<tt class="descclassname">rs.</tt><tt class="descname">addArb</tt><big>(</big><em>hostname</em><big>)</big><a class="headerlink" href="#rs.addArb" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>host</strong> (<em>string</em>) &#8211; Specifies a host (and optionally port-number)
for a arbiter member for the replica set.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Adds a new <a class="reference internal" href="../glossary/#term-arbiter"><em class="xref std std-term">arbiter</em></a> to an existing replica set.</p>
<p>This function will disconnect the shell briefly and forces a
reconnection as the replica set renegotiates which node
will be <a class="reference internal" href="../glossary/#term-primary"><em class="xref std std-term">primary</em></a>. As a result, the shell will display an
error even if this command succeeds.</p>
</dd></dl>

<dl class="method">
<dt id="rs.stepDown">
<tt class="descclassname">rs.</tt><tt class="descname">stepDown</tt><big>(</big><em>seconds</em><big>)</big><a class="headerlink" href="#rs.stepDown" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>seconds</strong> (<em>init</em>) &#8211; Specify the duration of this operation. If not
specified the command uses the default value
of 60 seconds.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">disconnects shell.</p>
</td>
</tr>
</tbody>
</table>
<p>Forces the current replica set member to step down as
<a class="reference internal" href="../glossary/#term-primary"><em class="xref std std-term">primary</em></a> and then attempt to avoid election as primary for
the designated number of seconds. Produces an error if the current
node is not primary.</p>
<p>This function will disconnect the shell briefly and forces a
reconnection as the <a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a> renegotiates which node
will be <a class="reference internal" href="../glossary/#term-primary"><em class="xref std std-term">primary</em></a>. As a result, the shell will display an
error even if this command succeeds.</p>
<p><a class="reference internal" href="../replica-commands/#rs.stepDown" title="rs.stepDown"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">rs.stepDown()</span></tt></a> provides a wrapper around the
<a class="reference internal" href="../glossary/#term-database-command"><em class="xref std std-term">database command</em></a> <a class="reference internal" href="../command/replSetStepDown/#replSetStepDown" title="replSetStepDown"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetStepDown</span></tt></a>.</p>
</dd></dl>

<dl class="method">
<dt id="rs.freeze">
<tt class="descclassname">rs.</tt><tt class="descname">freeze</tt><big>(</big><em>seconds</em><big>)</big><a class="headerlink" href="#rs.freeze" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>seconds</strong> (<em>init</em>) &#8211; Specify the duration of this operation.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Forces the current node to become ineligible to become primary for
the period specified.</p>
<p><a class="reference internal" href="../replica-commands/#rs.freeze" title="rs.freeze"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">rs.freeze()</span></tt></a> provides a wrapper around the <a class="reference internal" href="../glossary/#term-database-command"><em class="xref std std-term">database
command</em></a> <a class="reference internal" href="../replica-commands/#replSetFreeze" title="replSetFreeze"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetFreeze</span></tt></a>.</p>
</dd></dl>

<dl class="method">
<dt id="rs.remove">
<tt class="descclassname">rs.</tt><tt class="descname">remove</tt><big>(</big><em>hostname</em><big>)</big><a class="headerlink" href="#rs.remove" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>hostname</strong> &#8211; Specify one of the existing hosts to remove from
the current replica set.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Removes the node described by the <tt class="docutils literal"><span class="pre">hostname</span></tt> parameter from the
current <a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a>. This function will disconnect the
shell briefly and forces a reconnection as the <a class="reference internal" href="../glossary/#term-replica-set"><em class="xref std std-term">replica set</em></a>
renegotiates negotiates which node will be <a class="reference internal" href="../glossary/#term-primary"><em class="xref std std-term">primary</em></a>. As a
result, the shell will display an error even if this command
succeeds.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Before running the <a class="reference internal" href="../replica-commands/#rs.remove" title="rs.remove"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">rs.remove()</span></tt></a> operation, you must <em>shut
down</em> the replica set member that you&#8217;re removing.</p>
<p class="last versionchanged">
<span class="versionmodified">Changed in version 2.2: </span>This procedure is no longer required when using
<a class="reference internal" href="../replica-commands/#rs.remove" title="rs.remove"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">rs.remove()</span></tt></a>, but it remains good practice.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="rs.slaveOk">
<tt class="descclassname">rs.</tt><tt class="descname">slaveOk</tt><big>(</big><big>)</big><a class="headerlink" href="#rs.slaveOk" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides a shorthand for the following operation:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">getMongo</span><span class="p">().</span><span class="nx">setSlaveOk</span><span class="p">()</span>
</pre></div>
</div>
<p>This allows the current connection to allow read operations to run
on <a class="reference internal" href="../glossary/#term-secondary"><em class="xref std std-term">secondary</em></a> nodes. See the <a class="reference internal" href="../method/cursor.readPref/#cursor.readPref" title="cursor.readPref"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">readPref()</span></tt></a> method for more fine-grained control over
<a class="reference internal" href="../../applications/replication/#read-preference"><em>read preference</em></a> in the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell.</p>
</dd></dl>

<dl class="method">
<dt id="db.isMaster">
<tt class="descclassname">db.</tt><tt class="descname">isMaster</tt><big>(</big><big>)</big><a class="headerlink" href="#db.isMaster" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a status document with fields that includes the
<tt class="docutils literal"><span class="pre">ismaster</span></tt> field that reports if the current node is the
<a class="reference internal" href="../glossary/#term-primary"><em class="xref std std-term">primary</em></a> node, as well as a report of a subset of current
replica set configuration.</p>
<p>This function provides a wrapper around the <a class="reference internal" href="../glossary/#term-database-command"><em class="xref std std-term">database command</em></a>
<a class="reference internal" href="../replica-commands/#isMaster" title="isMaster"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">isMaster</span></tt></a></p>
</dd></dl>

<dl class="method">
<dt id="rs.help">
<tt class="descclassname">rs.</tt><tt class="descname">help</tt><big>(</big><big>)</big><a class="headerlink" href="#rs.help" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a basic help text for all of the <a class="reference internal" href="../../core/replication/"><em>replication</em></a> related shell functions.</p>
</dd></dl>

<dl class="method">
<dt id="rs.syncFrom">
<tt class="descclassname">rs.</tt><tt class="descname">syncFrom</tt><big>(</big><big>)</big><a class="headerlink" href="#rs.syncFrom" title="Permalink to this definition">¶</a></dt>
<dd><p class="versionadded">
<span class="versionmodified">New in version 2.2.</span></p>
<p>Provides a wrapper around the <a class="reference internal" href="../replica-commands/#replSetSyncFrom" title="replSetSyncFrom"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetSyncFrom</span></tt></a>, which
allows administrators to configure the member of a replica set that
the current member will pull data from. Specify the name of the
member you want to sync from in the form of <tt class="docutils literal"><span class="pre">[hostname]:[port]</span></tt>.</p>
<p>See <a class="reference internal" href="../replica-commands/#replSetSyncFrom" title="replSetSyncFrom"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">replSetSyncFrom</span></tt></a> for more details.</p>
</dd></dl>

</div>
</div>
<div class="section" id="native-shell-methods">
<h2>Native Shell Methods<a class="headerlink" href="#native-shell-methods" title="Permalink to this headline">¶</a></h2>
<p>These methods provide a number of low level and internal functions
that may be useful in the context of some advanced operations in the
shell. The JavaScript standard library is accessible in the
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell.</p>
<dl class="method">
<dt id="Date">
<tt class="descname">Date</tt><big>(</big><big>)</big><a class="headerlink" href="#Date" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Current date, as a string.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="load">
<tt class="descname">load</tt><big>(</big><em>&quot;file&quot;</em><big>)</big><a class="headerlink" href="#load" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Para string file:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body">Specify a path and file name containing
JavaScript.</td>
</tr>
</tbody>
</table>
<p>This native function loads and runs a JavaScript file into the
current shell environment. To run JavaScript with the mongo shell,
you can either:</p>
<ul class="simple">
<li>use the &#8220;<a class="reference internal" href="../mongo/#cmdoption-mongo--eval"><em class="xref std std-option">--eval</em></a>&#8221; option when invoking
the shell to evaluate a small amount of JavaScript code, or</li>
<li>specify a file name with &#8220;<a class="reference internal" href="../mongo/#mongo-shell-file"><em>mongo</em></a>&#8221;.
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> will execute the script and then exit. Add the
<a class="reference internal" href="../mongo/#cmdoption-mongo--shell"><em class="xref std std-option">--shell</em></a> option to return to the shell after
running the command.</li>
</ul>
<p>Specify files loaded with the <a class="reference internal" href="#load" title="load"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">load()</span></tt></a> function in relative terms
to the current directory of the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell
session. Check the current directory using the &#8220;<a class="reference internal" href="#pwd" title="pwd"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">pwd()</span></tt></a>&#8221;
function.</p>
</dd></dl>

<dl class="method">
<dt id="quit">
<tt class="descname">quit</tt><big>(</big><big>)</big><a class="headerlink" href="#quit" title="Permalink to this definition">¶</a></dt>
<dd><p>Exits the current shell session.</p>
</dd></dl>

<dl class="method">
<dt id="getMemInfo">
<tt class="descname">getMemInfo</tt><big>(</big><big>)</big><a class="headerlink" href="#getMemInfo" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a document with two fields that report the amount of memory
used by the JavaScript shell process. The fields returned are
<a class="reference internal" href="../glossary/#term-resident-memory"><em class="xref std std-term">resident</em></a> and <a class="reference internal" href="../glossary/#term-virtual-memory"><em class="xref std std-term">virtual</em></a>.</p>
</dd></dl>

<dl class="method">
<dt id="ls">
<tt class="descname">ls</tt><big>(</big><big>)</big><a class="headerlink" href="#ls" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of the files in the current directory.</p>
<p>This function returns with output relative to the current shell
session, and does not impact the server.</p>
</dd></dl>

<dl class="method">
<dt id="pwd">
<tt class="descname">pwd</tt><big>(</big><big>)</big><a class="headerlink" href="#pwd" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the current directory.</p>
<p>This function returns with output relative to the current shell
session, and does not impact the server.</p>
</dd></dl>

<dl class="method">
<dt id="cd">
<tt class="descname">cd</tt><big>(</big><em>&quot;path&quot;</em><big>)</big><a class="headerlink" href="#cd" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>file</strong> (<em>string</em>) &#8211; Specify a path on the local file system.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Changes the current working directory to the specified path.</p>
<p>This function returns with output relative to the current shell
session, and does not impact the server.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This feature is not yet implemented.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="cat">
<tt class="descname">cat</tt><big>(</big><em>&quot;filename&quot;</em><big>)</big><a class="headerlink" href="#cat" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>filename</strong> (<em>string</em>) &#8211; Specify a path and file name on the local file
system.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Returns the contents of the specified file.</p>
<p>This function returns with output relative to the current shell
session, and does not impact the server.</p>
</dd></dl>

<dl class="method">
<dt id="md5sumFile">
<tt class="descname">md5sumFile</tt><big>(</big><em>&quot;filename&quot;</em><big>)</big><a class="headerlink" href="#md5sumFile" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>filename</strong> (<em>string</em>) &#8211; a file name.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">The <a class="reference internal" href="../glossary/#term-md5"><em class="xref std std-term">md5</em></a> hash of the specified file.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The specified filename must refer to a file located on
the system running the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> shell.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="mkdir">
<tt class="descname">mkdir</tt><big>(</big><em>&quot;path&quot;</em><big>)</big><a class="headerlink" href="#mkdir" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>path</strong> (<em>string</em>) &#8211; A path on the local filesystem.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Creates a directory at the specified path. This command will create
the entire path specified, if the enclosing directory or
directories do not already exit.</p>
<p>Equivalent to <strong class="command">mkdir -p</strong> with BSD or GNU utilities.</p>
</dd></dl>

<dl class="method">
<dt id="hostname">
<tt class="descname">hostname</tt><big>(</big><big>)</big><a class="headerlink" href="#hostname" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">The hostname of the system running the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt>
shell process.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="getHostName">
<tt class="descname">getHostName</tt><big>(</big><big>)</big><a class="headerlink" href="#getHostName" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">The hostname of the system running the <tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt>
shell process.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="removeFile">
<tt class="descname">removeFile</tt><big>(</big><em>&quot;filename&quot;</em><big>)</big><a class="headerlink" href="#removeFile" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>filename</strong> (<em>string</em>) &#8211; Specify a filename or path to a local
file.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">boolean.</p>
</td>
</tr>
</tbody>
</table>
<p>Removes the specified file from the local file system.</p>
</dd></dl>

<dl class="method">
<dt id="fuzzFile">
<tt class="descname">fuzzFile</tt><big>(</big><em>&quot;filename&quot;</em><big>)</big><a class="headerlink" href="#fuzzFile" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>filename</strong> (<em>string</em>) &#8211; Specify a filename or path to a local
file.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">null</p>
</td>
</tr>
</tbody>
</table>
<p>For internal use.</p>
</dd></dl>

<dl class="method">
<dt id="listFiles">
<tt class="descname">listFiles</tt><big>(</big><big>)</big><a class="headerlink" href="#listFiles" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns an array, containing one document per object in the
directory. This function operates in the context of the
<tt class="xref mongodb mongodb-program docutils literal"><span class="pre">mongo</span></tt> process. The included fields are:</p>
<dl class="describe">
<dt>
<tt class="descname">name</tt></dt>
<dd><p>Returns a string which contains the name of the object.</p>
</dd></dl>

<dl class="describe">
<dt>
<tt class="descname">isDirectory</tt></dt>
<dd><p>Returns true or false if the object is a directory.</p>
</dd></dl>

<dl class="describe">
<dt>
<tt class="descname">size</tt></dt>
<dd><p>Returns the size of the object in bytes. This field is only
present for files.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="non-user-functions-and-methods">
<h2>Non-User Functions and Methods<a class="headerlink" href="#non-user-functions-and-methods" title="Permalink to this headline">¶</a></h2>
<div class="section" id="deprecated-methods">
<h3>Deprecated Methods<a class="headerlink" href="#deprecated-methods" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="db.getPrevError">
<tt class="descclassname">db.</tt><tt class="descname">getPrevError</tt><big>(</big><big>)</big><a class="headerlink" href="#db.getPrevError" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A status document, containing the errors.</td>
</tr>
</tbody>
</table>
<p class="deprecated">
<span class="versionmodified">Deprecated since version 1.6.</span></p>
<p>This output reports all errors since the last time the database
received a <a class="reference internal" href="../commands/#resetError" title="resetError"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">resetError</span></tt></a> (also
<a class="reference internal" href="../method/db.resetError/#db.resetError" title="db.resetError"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.resetError()</span></tt></a>) command.</p>
<p>This method provides a wrapper around the
<a class="reference internal" href="../commands/#getPrevError" title="getPrevError"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">getPrevError</span></tt></a> command.</p>
</dd></dl>

<dl class="method">
<dt id="db.resetError">
<tt class="descclassname">db.</tt><tt class="descname">resetError</tt><big>(</big><big>)</big><a class="headerlink" href="#db.resetError" title="Permalink to this definition">¶</a></dt>
<dd><p class="deprecated">
<span class="versionmodified">Deprecated since version 1.6.</span></p>
<p>Resets the error message returned by <a class="reference internal" href="../method/db.getPrevError/#db.getPrevError" title="db.getPrevError"><tt class="xref mongodb mongodb-method docutils literal"><span class="pre">db.getPrevError</span></tt></a> or
<a class="reference internal" href="../commands/#getPrevError" title="getPrevError"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">getPrevError</span></tt></a>. Provides a wrapper around the
<a class="reference internal" href="../commands/#resetError" title="resetError"><tt class="xref mongodb mongodb-dbcommand docutils literal"><span class="pre">resetError</span></tt></a> command.</p>
</dd></dl>

</div>
<div class="section" id="native-methods">
<h3>Native Methods<a class="headerlink" href="#native-methods" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="_srand">
<tt class="descname">_srand</tt><big>(</big><big>)</big><a class="headerlink" href="#_srand" title="Permalink to this definition">¶</a></dt>
<dd><p>For internal use.</p>
</dd></dl>

<dl class="method">
<dt id="_rand">
<tt class="descname">_rand</tt><big>(</big><big>)</big><a class="headerlink" href="#_rand" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A random number between <tt class="docutils literal"><span class="pre">0</span></tt> and <tt class="docutils literal"><span class="pre">1</span></tt>.</td>
</tr>
</tbody>
</table>
<p>This function provides functionality similar to the
<tt class="docutils literal"><span class="pre">Math.rand()</span></tt> function from the standard library.</p>
</dd></dl>

<dl class="method">
<dt id="_isWindows">
<tt class="descname">_isWindows</tt><big>(</big><big>)</big><a class="headerlink" href="#_isWindows" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">boolean.</td>
</tr>
</tbody>
</table>
<p>Returns &#8220;true&#8221; if the server is running on a system that is
Windows, or &#8220;false&#8221;  if the server is running on a Unix or Linux
systems.</p>
</dd></dl>

</div>
<div class="section" id="internal-methods">
<h3>Internal Methods<a class="headerlink" href="#internal-methods" title="Permalink to this headline">¶</a></h3>
<p>These methods are accessible in the shell but exist to support other
functionality in the environment. Do not call these methods
directly.</p>
<dl class="method">
<dt id="_startMongoProgram">
<tt class="descname">_startMongoProgram</tt><big>(</big><big>)</big><a class="headerlink" href="#_startMongoProgram" title="Permalink to this definition">¶</a></dt>
<dd><p>For internal use.</p>
</dd></dl>

<dl class="method">
<dt id="runProgram">
<tt class="descname">runProgram</tt><big>(</big><big>)</big><a class="headerlink" href="#runProgram" title="Permalink to this definition">¶</a></dt>
<dd><p>For internal use.</p>
</dd></dl>

<dl class="method">
<dt id="run">
<tt class="descname">run</tt><big>(</big><big>)</big><a class="headerlink" href="#run" title="Permalink to this definition">¶</a></dt>
<dd><p>For internal use.</p>
</dd></dl>

<dl class="method">
<dt id="runMongoProgram">
<tt class="descname">runMongoProgram</tt><big>(</big><big>)</big><a class="headerlink" href="#runMongoProgram" title="Permalink to this definition">¶</a></dt>
<dd><p>For internal use.</p>
</dd></dl>

<dl class="method">
<dt id="stopMongod">
<tt class="descname">stopMongod</tt><big>(</big><big>)</big><a class="headerlink" href="#stopMongod" title="Permalink to this definition">¶</a></dt>
<dd><p>For internal use.</p>
</dd></dl>

<dl class="method">
<dt id="stopMongoProgram">
<tt class="descname">stopMongoProgram</tt><big>(</big><big>)</big><a class="headerlink" href="#stopMongoProgram" title="Permalink to this definition">¶</a></dt>
<dd><p>For internal use.</p>
</dd></dl>

<dl class="method">
<dt id="stopMongoProgramByPid">
<tt class="descname">stopMongoProgramByPid</tt><big>(</big><big>)</big><a class="headerlink" href="#stopMongoProgramByPid" title="Permalink to this definition">¶</a></dt>
<dd><p>For internal use.</p>
</dd></dl>

<dl class="method">
<dt id="rawMongoProgramOutput">
<tt class="descname">rawMongoProgramOutput</tt><big>(</big><big>)</big><a class="headerlink" href="#rawMongoProgramOutput" title="Permalink to this definition">¶</a></dt>
<dd><p>For internal use.</p>
</dd></dl>

<dl class="method">
<dt id="clearRawMongoProgramOutput">
<tt class="descname">clearRawMongoProgramOutput</tt><big>(</big><big>)</big><a class="headerlink" href="#clearRawMongoProgramOutput" title="Permalink to this definition">¶</a></dt>
<dd><p>For internal use.</p>
</dd></dl>

<dl class="method">
<dt id="waitProgram">
<tt class="descname">waitProgram</tt><big>(</big><big>)</big><a class="headerlink" href="#waitProgram" title="Permalink to this definition">¶</a></dt>
<dd><p>For internal use.</p>
</dd></dl>

<dl class="method">
<dt id="waitMongoProgramOnPort">
<tt class="descname">waitMongoProgramOnPort</tt><big>(</big><big>)</big><a class="headerlink" href="#waitMongoProgramOnPort" title="Permalink to this definition">¶</a></dt>
<dd><p>For internal use.</p>
</dd></dl>

<dl class="method">
<dt id="resetDbpath">
<tt class="descname">resetDbpath</tt><big>(</big><big>)</big><a class="headerlink" href="#resetDbpath" title="Permalink to this definition">¶</a></dt>
<dd><p>For internal use.</p>
</dd></dl>

<dl class="method">
<dt id="copyDbpath">
<tt class="descname">copyDbpath</tt><big>(</big><big>)</big><a class="headerlink" href="#copyDbpath" title="Permalink to this definition">¶</a></dt>
<dd><p>For internal use.</p>
</dd></dl>

</div>
</div>
</div>


<div id="btnv">
<ul id="btnvl">
</ul>
</div>
</div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">

<h3><a href="../../contents/">MongoDB Manual</a>
<small>(<a href="../../genindex/">Index</a>)</small>
</h3>

<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/">About MongoDB Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/">Installing MongoDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../replication/">Replication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sharding/">Sharding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../administration/">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crud/">CRUD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aggregation/">Aggregation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../indexes/">Indexes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../applications/">Application Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mongo/">Using the MongoDB Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../use-cases/">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../">Reference</a></li>
</ul>

<h3>Formats</h3>
<ul class="this-page-menu">
  <li><a href="/master/single/">MongoDB Manual, Single HTML Page</a></li>
  <li><a href="http://docs.mongodb.org/master/MongoDB-Manual-master.pdf" rel="nofollow">MongoDB Manual, PDF Format</a></li>
  <li><a href="http://docs.mongodb.org/master/MongoDB-Manual-master.epub" rel="nofollow">MongoDB Manual, ePub Format</a></li>
</ul>

<h3>Translations</h3>
<ul class="translation-menu">
  <li><a href="http://jp.docs.mongodb.org/master/reference/javascript" rel="nofollow">Japanese</a></li>
  <li><a href="http://cn.docs.mongodb.org/master/reference/javascript" rel="nofollow">Chinese</a></li>
  <!-- <li><a href="http://docs.mongodb.org/master/reference/javascript" rel="nofollow">English</a></li> -->
</ul>
<h3>Knowledge Base </h3>
<ul class="kb-menu">
  <li><a href="../../tutorial/">Tutorials</a></li>
  <li><a href="../../faq/">Frequently Asked Questions</a></li>
  <li><a href="../../use-cases/">Use Cases</a></li>
</ul><h3>MongoDB Wiki</h3>

<ul>
 <li><strong>Getting Started</strong>
   <ul>
     <!-- <li><a href="http://mongodb.org/display/DOCS/Quickstart">Quickstart</a></li> -->
     <li><a href="http://mongodb.org/display/DOCS/Introduction">Introduction</a></li>
     <li><a href="http://www.mongodb.org/downloads">Downloads</a></li>
     <!-- <li><a href="http://mongodb.org/display/DOCS/SQL+to+Mongo+Mapping+Chart">SQL to MongoDB Mapping</a></li> -->
   </ul>
 </li>
 <li><strong><a href="http://mongodb.org/display/DOCS/Developer+Zone">Developer Documentation</a></strong>
   <!-- <ul> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Connections">Connections</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Databases">Databases</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Collections">Collections</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Documents">Documents</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/GridFS">GridFS</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Indexes">Indexes</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Querying">Querying</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Aggregation">Aggregation</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Optimization">Optimization</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Inserting">Inserting</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Updating">Updating</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Removing">Removing</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/MapReduce">MapReduce</a></li> -->
   <!-- </ul> -->
 </li>
 <li><strong><a href="http://mongodb.org/display/DOCS/Admin+Zone">Administrative Documentation</a></strong>
   <ul>
     <!-- <li><a href="http://mongodb.org/display/DOCS/Components">Components</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Journaling">Journaling</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Production+Notes">Production Notes</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Replication">Replication</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Sharding">Sharding</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Monitoring+and+Diagnostics">Monitoring and Diagnostics</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Backups">Backups</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Durability+and+Repair">Durability and Repair</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Security+and+Authentication">Security and Authentication</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/Starting+and+Stopping+Mongo">Starting/Stopping MongoDB</a></li> -->
     <!-- <li><a href="http://mongodb.org/display/DOCS/GridFS+Tools">GridFS Tools</a></li> -->
     <li><a href="http://mongodb.org/display/DOCS/DBA+Operations+from+the+Shell">DB Operations from the Shell</a></li>
     <!-- <li><a href="http://mongodb.org/display/DOCS/Architecture+and+Components">Architecture and Components</a></li> -->
     <li><a href="http://mongodb.org/display/DOCS/Windows">Windows</a></li>
     <li><a href="http://mongodb.org/display/DOCS/Troubleshooting">Troubleshooting</a></li>
   </ul>
 </li>
 <li><strong><a href="http://www.mongodb.org/display/DOCS/Community">Community and Ecosystem</a></strong>
   <ul>
     <li><a href="http://10gen.com">10gen</a></li>
     <li><a href="http://www.mongodb.org/events">MongoDB Events</a></li>
     <li><a href="http://planet.mongodb.org">Planet MongoDB</a></li>
     <li><a href="http://mongodb.org/display/DOCS/MongoDB+Masters">MongoDB Masters</a></li>
     <li><a href="http://mongodb.org/display/DOCS/Slides+and+Video">Slides and Video</a></li>
     <!-- <li><a href="http://cookbook.mongodb.org/">Cookbook</a></li> -->
     <li><a href="http://mongodb.org/display/DOCS/Hosting+Center">Hosting Center</a></li>
     <li><a href="http://mms.10gen.com/">MongoDB Monitoring Service</a> (<a href="http://mms.10gen.com/help/">docs</a>)</li>
     <li><a href="http://mongodb.org/display/DOCS/Admin+UIs">Administrative Interfaces</a></li>
     <!-- <li><a href="http://mongodb.org/display/DOCS/International+Docs">International Documentation</a></li> -->
     <li><a href="http://10gen.com/books/">MongoDB Books</a></li>
   </ul>
 </li>
 <li><strong><a href="http://www.mongodb.org/display/DOCS/Drivers">Drivers</a></strong>
   <ul>
     <li>JavaScript (<a href="http://mongodb.org/display/DOCS/Javascript+Language+Center">wiki</a>, <a href="http://api.mongodb.org/js/current">docs</a>)</li>
     <li>Python (<a href="http://mongodb.org/display/DOCS/Python+Language+Center">wiki</a>, <a href="http://api.mongodb.org/python/current">docs</a>)</li>
     <li>Ruby (<a href="http://mongodb.org/display/DOCS/Ruby+Language+Center">wiki</a>, <a href="http://api.mongodb.org/ruby/current">docs</a>)</li>
     <li>PHP (<a href="http://mongodb.org/display/DOCS/PHP+Language+Center">wiki</a>, <a href="http://php.net/mongo/">docs</a>)</li>
     <li>Perl (<a href="http://mongodb.org/display/DOCS/Perl+Language+Center">wiki</a>, <a href="http://api.mongodb.org/perl/current/">docs</a>)</li>
     <li>Java (<a href="http://mongodb.org/display/DOCS/Java+Language+Center">wiki</a>, <a href="http://api.mongodb.org/java/current">docs</a>)</li>
     <li>Scala (<a href="http://mongodb.org/display/DOCS/Scala+Language+Center">wiki</a>, <a href="http://api.mongodb.org/scala/casbah/current/">docs</a>)</li>
     <li>C# (<a href="http://mongodb.org/display/DOCS/CSharp+Language+Center">wiki</a>, <a href="http://api.mongodb.org/csharp/current/">docs</a>)</li>
     <li>C (<a href="http://mongodb.org/display/DOCS/C+Language+Center">wiki</a>, <a href="http://api.mongodb.org/c/current/">docs</a>)</li>
     <li>C++ (<a href="http://mongodb.org/pages/viewpage.action?pageId=133409">wiki</a>, <a href="http://api.mongodb.org/cplusplus/current/">docs</a>)</li>
     <li>Haskell (<a href="http://mongodb.org/display/DOCS/Haskell+Language+Center">wiki</a>, <a href="http://api.mongodb.org/haskell">docs</a>)</li>
     <li>Erlang (<a href="http://mongodb.org/display/DOCS/Erlang+Language+Center">wiki</a>, <a href="http://api.mongodb.org/erlang">docs</a>)</li>
   </ul>
 </li>
</ul>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
        &copy; Copyright 2011-2012, 10gen, Inc.  Licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons</a>.

    <p>MongoDB&reg;, Mongo&reg;, and the leaf logo are registered trademarks of 10gen, Inc.</p>
    <p>The MongoDB Documentation Project uses <a href="https://github.com/mongodb/docs">GitHub</a>. Fork the repository and submit pull requests to contribute.</p>
    <p>If you find any issues with the documentation feel free to open a <a href="http://jira.mongodb.org/browse/DOCS">Jira Case</a> and we'll work to resolve it promptly.</p>

  </div><script type="text/javascript">
var _gaq = _gaq || [];
var pluginUrl = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.') + 'google-analytics.com/plugins/ga/inpage_linkid.js';
_gaq.push(['_require', 'inpage_linkid', pluginUrl]);
_gaq.push(['_setAccount', 'UA-7301842-8']);
_gaq.push(['_setDomainName', 'docs.mongodb.org']);
_gaq.push(['_trackPageview']);
(function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
        })();
</script>

<script type="text/javascript">
document.write(unescape("%3Cscript src='" + document.location.protocol + "//munchkin.marketo.net/munchkin.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script>try { mktoMunchkin("017-HGS-593"); } catch(e) {}</script>
  </body>
</html>